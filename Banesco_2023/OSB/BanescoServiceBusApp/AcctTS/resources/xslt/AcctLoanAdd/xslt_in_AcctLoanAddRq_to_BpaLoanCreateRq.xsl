<?xml version="1.0" encoding="UTF-8" ?>
<xsl:stylesheet version="1.0"
                xmlns:UUIDUserFunction="http://www.oracle.com/XSL/Transform/java/com.bea.wli.sb.stages.functions.UUIDUserFunction"
                xmlns:IsUserInGroupFunction="http://www.oracle.com/XSL/Transform/java/com.bea.wli.sb.stages.functions.IsUserInGroupFunction"
                xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
                xmlns:IsUserInRoleFunction="http://www.oracle.com/XSL/Transform/java/com.bea.wli.sb.stages.functions.IsUserInRoleFunction"
                xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
                xmlns:DVMFunctions="http://www.oracle.com/XSL/Transform/java/com.bea.wli.sb.functions.dvm.DVMFunctions"
                xmlns:ns0="http://xmlns.banesco.com/eopt/AcctLoanAdd_V1.0"
                xmlns:oracle-xsl-mapper="http://www.oracle.com/xsl/mapper/schemas"
                xmlns:oraxsl="http://www.oracle.com/XSL/Transform/java"
                xmlns:RuntimeTypeConversionFunctions="http://www.oracle.com/XSL/Transform/java/com.bea.wli.sb.stages.functions.RuntimeTypeConversionFunctions"
                xmlns:XrefFunctions="http://www.oracle.com/XSL/Transform/java/com.bea.wli.sb.functions.xref.XrefFunctions"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:BasicCredentialsUserFunction="http://www.oracle.com/XSL/Transform/java/com.bea.wli.sb.stages.functions.BasicCredentialsUserFunction"
                xmlns:tns="http://www.temenos.com/T24/ofs/Request"
                exclude-result-prefixes="xsd oracle-xsl-mapper xsi xsl ns0 tns UUIDUserFunction IsUserInGroupFunction oraext IsUserInRoleFunction xp20 DVMFunctions oraxsl RuntimeTypeConversionFunctions XrefFunctions BasicCredentialsUserFunction"
                xmlns:ns6="http://xmlns.banesco.com/eo/Product_V1.0"
                xmlns:eoAcct="http://xmlns.banesco.com/eo/Acct_V1.0" xmlns:ns7="http://xmlns.banesco.com/eo/Party_V1.0"
                xmlns:eoStatus="http://xmlns.banesco.com/eo/Status_V1.0"
                xmlns:ns8="http://xmlns.banesco.com/eo/Chk_V1.0" xmlns:ns3="http://xmlns.banesco.com/eo/Banking_V1.0"
                xmlns:ns5="http://xmlns.banesco.com/eo/Fee_V1.0" xmlns:ns1="http://xmlns.banesco.com/eo/Card_V1.0"
                xmlns:ns2="http://xmlns.banesco.com/eo/Payee_V1.0" xmlns:ns4="http://xmlns.banesco.com/eo/Common_V1.0"
                xmlns:ns9="http://www.temenos.com/T24/ofs/AAARRANGEMENTACTIVITYBPAWSLOANCREATEType"
                xmlns:reqcns="http://www.temenos.com/T24/ofs/RequestCommon"
                xmlns:ns10="http://xmlns.banesco.com/appopt/AOptCommon_V1.0">
  <oracle-xsl-mapper:schema>
    <!--SPECIFICATION OF MAP SOURCES AND TARGETS, DO NOT MODIFY.-->
    <oracle-xsl-mapper:mapSources>
      <oracle-xsl-mapper:source type="XSD">
        <oracle-xsl-mapper:schema location="../../../../Commons/xsd/EOpt/AccountLoan/AcctLoanAdd/AcctLoanAdd_V1.0.xsd"/>
        <oracle-xsl-mapper:rootElement name="AcctLoanAddRq" namespace="http://xmlns.banesco.com/eopt/AcctLoanAdd_V1.0"/>
      </oracle-xsl-mapper:source>
      <oracle-xsl-mapper:source type="XSD">
        <oracle-xsl-mapper:schema location="../../../../Commons/xsd/AppOpt/AOptCommon/AOptCommon_V1.0.xsd"/>
        <oracle-xsl-mapper:rootElement name="MsgHdrRq" namespace="http://xmlns.banesco.com/appopt/AOptCommon_V1.0"/>
        <oracle-xsl-mapper:param name="varHeader"/>
      </oracle-xsl-mapper:source>
    </oracle-xsl-mapper:mapSources>
    <oracle-xsl-mapper:mapTargets>
      <oracle-xsl-mapper:target type="XSD">
        <oracle-xsl-mapper:schema location="../../../../Commons/backends/T24/resources/xsd/BpaLoanCreate/CreaciondePrestamoRequest.xsd"/>
        <oracle-xsl-mapper:rootElement name="AAARRANGEMENTACTIVITYBPAWSLOANCREATERequest"
                                       namespace="http://www.temenos.com/T24/ofs/Request"/>
      </oracle-xsl-mapper:target>
    </oracle-xsl-mapper:mapTargets>
    <!--GENERATED BY ORACLE XSL MAPPER 12.2.1.2.0(XSLT Build 161003.0739.0018) AT [TUE JUL 24 15:48:38 COT 2018].-->
  </oracle-xsl-mapper:schema>
  <xsl:include href="../../../../Commons/xslt/Template/TemplateServiceUtil.xsl"/>
  <xsl:include href="../../../../Commons/xslt/Template/TemplatePmtFrequency.xsl"/>
  <!--User Editing allowed BELOW this line - DO NOT DELETE THIS LINE-->
  <xsl:param name="varHeader"/>
  <xsl:template match="/">
    <opaq:opaqueElement xmlns:opaq="http://xmlns.oracle.com/pcbpel/adapter/opaque/">
      <tns:AAARRANGEMENTACTIVITYBPAWSLOANCREATERequest>
        <RequestCommon>
          <UserName>
            <xsl:value-of select="$varHeader/ns10:ClientApp/ns10:UserId"/>
          </UserName>
        </RequestCommon>
        <AAARRANGEMENTACTIVITYBPAWSLOANCREATE>
          <ARRANGEMENT>
            <xsl:value-of select='DVMFunctions:lookupValue ("Commons/dvm/ServiceProperties", "CODE", "ArragementNew", "VALUE", "NEW" )'/>
          </ARRANGEMENT>
          <ACTIVITY>
            <xsl:value-of select='DVMFunctions:lookupValue ("Commons/dvm/ServiceProperties", "CODE", "ActivityNew", "VALUE", "LENDING-NEW-ARRANGEMENT" )'/>
          </ACTIVITY>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:OpenDt/text()">
            <EFFECTIVEDATE>
              <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:OpenDt"/>
            </EFFECTIVEDATE>
          </xsl:if>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctMember">
            <gCUSTOMER>
              <xsl:for-each select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctMember">
                <mCUSTOMER>
                  <CUSTOMER>
                    <xsl:value-of select="eoAcct:PartyKey/ns7:PartyId"/>
                  </CUSTOMER>
                  <xsl:if test="eoAcct:PartyRole/ns4:Cod/text()">
                    <CUSTOMERROLE>
                      <xsl:value-of select="eoAcct:PartyRole/ns4:Cod"/>
                    </CUSTOMERROLE>
                  </xsl:if>
                </mCUSTOMER>
              </xsl:for-each>
            </gCUSTOMER>
          </xsl:if>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctSubtype/ns4:Cod/text()">
            <PRODUCT>
              <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctSubtype/ns4:Cod"/>
            </PRODUCT>
          </xsl:if>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CurCode/text()">
            <CURRENCY>
              <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CurCode"/>
            </CURRENCY>
          </xsl:if>
          <gPROPERTY>
            <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:ClubBanesco/text()">
              <mPROPERTY>
                <PROPERTY>CUSTOMER</PROPERTY>
                <sgFIELDNAME>
                  <FIELDNAME>
                    <FIELDNAME>LT.CLUB.BANESCO</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:call-template name="Boolean_Regex">
                        <xsl:with-param name="operation">Add</xsl:with-param>
                        <xsl:with-param name="parametro">
                          <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:ClubBanesco"></xsl:value-of>
                        </xsl:with-param>
                      </xsl:call-template>
                    </FIELDVALUE>
                  </FIELDNAME>
                </sgFIELDNAME>
              </mPROPERTY>
            </xsl:if>
            <mPROPERTY>
              <PROPERTY>OFFICERS</PROPERTY>
              <sgFIELDNAME>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:CollOfficer/text()">
                  <FIELDNAME>
                    <FIELDNAME>LT.COLL.OFFICER</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:CollOfficer"/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
                <xsl:if test="ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:SaleOfficer/text()">
                  <FIELDNAME>
                    <FIELDNAME>LT.SALE.OFFICER</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:SaleOfficer"/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
              </sgFIELDNAME>
            </mPROPERTY>
            <mPROPERTY>
              <PROPERTY>ACCOUNT</PROPERTY>
              <sgFIELDNAME>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:SubCategory/text()">
                  <FIELDNAME>
                    <FIELDNAME>LT.SUBPRODUCT</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:SubCategory"/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:FundsDestination/text()">
                  <FIELDNAME>
                    <FIELDNAME>LT.DESTINO</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:FundsDestination"/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
              </sgFIELDNAME>
            </mPROPERTY>
            <mPROPERTY>
              <PROPERTY>COMMITMENT</PROPERTY>
              <sgFIELDNAME>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:InitialAmt/ns4:Amt/text()">
                  <FIELDNAME>
                    <FIELDNAME>AMOUNT</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:InitialAmt/ns4:Amt"/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:Term/eoAcct:ProposedTerm/text()">
                  <FIELDNAME>
                    <FIELDNAME>TERM</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:Term/eoAcct:ProposedTerm"/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:ClosedDt/text()">
                  <FIELDNAME>
                    <FIELDNAME>MATURITY.DATE</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select='xp20:format-dateTime (/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:ClosedDt, "[Y0001][M01][D01]" )'/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:WritingType/text()">
                  <FIELDNAME>
                    <FIELDNAME>LT.WRITING.TYPE</FIELDNAME>
                    <FIELDVALUE>
                      <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:WritingType"/>
                    </FIELDVALUE>
                  </FIELDNAME>
                </xsl:if>
              </sgFIELDNAME>
            </mPROPERTY>
            <xsl:for-each select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:IntRateData">
              <mPROPERTY>
                <PROPERTY>
                  <!--xsl:value-of select='DVMFunctions:lookupValue ("Commons/dvm/AcctLoanMappingProperties", "NAME", eoAcct:IntRateType, "INTEREST", "PorpiedadNoEncontrada" )'/-->
                  <xsl:value-of select="eoAcct:IntRateType"/>
                </PROPERTY>
                <sgFIELDNAME>
                  <xsl:if test="eoAcct:IntRate/text()">
                    <FIELDNAME>
                      <FIELDNAME>FIXED.RATE</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="eoAcct:IntRate"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="eoAcct:IntDayBasis/text()">
                    <FIELDNAME>
                      <FIELDNAME>DAY.BASIS</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="eoAcct:IntDayBasis"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="eoAcct:AccrualRule/text()">
                    <FIELDNAME>
                      <FIELDNAME>ACCRUAL.RULE</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="eoAcct:AccrualRule"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                </sgFIELDNAME>
              </mPROPERTY>
            </xsl:for-each>
            <xsl:for-each select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:Charge">
              <mPROPERTY>
                <PROPERTY>
                  <!--xsl:value-of select='DVMFunctions:lookupValue ("Commons/dvm/AcctLoanMappingProperties", "NAME", eoAcct:ChargeType, "CHARGE", "PorpiedadNoEncontrada" )'/-->
                  <xsl:value-of select="eoAcct:ChargeType"/>
                </PROPERTY>
                <sgFIELDNAME>
                  <xsl:if test="eoAcct:ChargeClass/text()">
                    <FIELDNAME>
                      <FIELDNAME>CHARGE.TYPE</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="eoAcct:ChargeClass"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="eoAcct:CurAmt/ns4:CurCode/text()">
                    <FIELDNAME>
                      <FIELDNAME>CURRENCY</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="eoAcct:CurAmt/ns4:CurCode"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="eoAcct:CurAmt/ns4:Amt/text()">
                    <FIELDNAME>
                      <FIELDNAME>FIXED.AMOUNT</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="eoAcct:CurAmt/ns4:Amt"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                </sgFIELDNAME>
              </mPROPERTY>
            </xsl:for-each>
            <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:TaxData">
              <mPROPERTY>
                <PROPERTY>TAX</PROPERTY>
                <sgFIELDNAME>
                  <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:TaxData/ns3:TaxType/text()">
                    <FIELDNAME>
                      <FIELDNAME>PROPERTY</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:TaxData/ns3:TaxType"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:TaxData/ns3:TaxCode/text()">
                    <FIELDNAME>
                      <FIELDNAME>PROP.TAX.CODE</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:TaxData/ns3:TaxCode"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:TaxData/ns3:TaxCondition/text()">
                    <FIELDNAME>
                      <FIELDNAME>PROP.TAX.COND</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:TaxData/ns3:TaxCondition"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                </sgFIELDNAME>
              </mPROPERTY>
            </xsl:if>
            <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:CreditRegularPmt">
              <mPROPERTY>
                <PROPERTY>SCHEDULE</PROPERTY>
                <xsl:for-each select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:CreditRegularPmt">
                  <xsl:variable name="indice">
                    <xsl:value-of select="position()"/>
                  </xsl:variable>
                  <xsl:variable name="freq">
                    <xsl:call-template name="CreditPmtFreq">
                      <xsl:with-param name="noPaymentMonth">
                                <xsl:value-of select="eoAcct:Freq/ns4:NoPaymentMonth"/>
                              </xsl:with-param>
                      <xsl:with-param name="onDayNumber">
                                <xsl:value-of select="eoAcct:Freq/ns4:OnDayNumber"/>
                              </xsl:with-param>
                    </xsl:call-template>
                  </xsl:variable>
                  <sgFIELDNAME>
                    <xsl:if test="eoAcct:PmtType/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYMENT.TYPE:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:PmtType"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:PmtClass/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYMENT.METHOD:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:PmtClass"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <!--xsl:if test="eoAcct:Freq/ns4:NoPaymentMonth/text() and eoAcct:Freq/ns4:OnDayNumber/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYMENT.FREQ:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:call-template name="CreditPmtFreq">
                            <xsl:with-param name="noPaymentMonth">
                                <xsl:value-of select="eoAcct:Freq/ns4:NoPaymentMonth"/>
                              </xsl:with-param>
                            <xsl:with-param name="onDayNumber">
                                <xsl:value-of select="eoAcct:Freq/ns4:OnDayNumber"/>
                              </xsl:with-param>
                          </xsl:call-template>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if-->
                    <xsl:if test="$freq != ''">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYMENT.FREQ:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="normalize-space($freq)"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:BillType/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('BILL.TYPE:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:BillType"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:for-each select="eoAcct:PmtDetail">
                      <xsl:variable name="indicePmtDetail">
                        <xsl:value-of select="position()"/>
                      </xsl:variable>
                      <xsl:if test="eoAcct:PmtTarget/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('PROPERTY:', $indice, ':', $indicePmtDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:PmtTarget"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:Freq/text() or $freq != ''">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('DUE.FREQ:', $indice, ':', $indicePmtDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <!--xsl:value-of select="eoAcct:Freq"/-->
                            <xsl:choose>
                              <xsl:when test="eoAcct:Freq/text()">
                                <xsl:value-of select="eoAcct:Freq"/>
                              </xsl:when>
                              <xsl:otherwise>
                                <xsl:value-of select="normalize-space($freq)"/>
                              </xsl:otherwise>
                            </xsl:choose>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                    </xsl:for-each>
                    <xsl:for-each select="eoAcct:PmtTargetDetail">
                      <xsl:variable name="indicePmtTargetDetail">
                        <xsl:value-of select="position()"/>
                      </xsl:variable>
                      <xsl:if test="eoAcct:Percentage/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('PERCENTAGE:', $indice, ':', $indicePmtTargetDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:Percentage"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:StartDate/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('START.DATE:', $indice, ':', $indicePmtTargetDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="concat('D_', xp20:format-dateTime(eoAcct:StartDate, &quot;[Y0001][M01][D01]&quot; ))"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:EndDate/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('END.DATE:', $indice, ':', $indicePmtTargetDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="concat('D_', xp20:format-dateTime(eoAcct:EndDate, &quot;[Y0001][M01][D01]&quot; ))"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:NumPayments/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('NUM.PAYMENTS:', $indice, ':', $indicePmtTargetDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:NumPayments"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:ActualAmt/ns4:Amt/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('ACTUAL.AMT:', $indice, ':', $indicePmtTargetDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:ActualAmt/ns4:Amt"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                    </xsl:for-each>
                  </sgFIELDNAME>
                </xsl:for-each>
                <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:BillsCombined/text()">
                  <sgFIELDNAME>
                    <FIELDNAME>
                      <FIELDNAME>BILLS.COMBINED</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:call-template name="Boolean_Regex">
                          <xsl:with-param name="operation">Add</xsl:with-param>
                          <xsl:with-param name="parametro">
                            <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:BillsCombined"></xsl:value-of>
                          </xsl:with-param>
                        </xsl:call-template>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </sgFIELDNAME>
                </xsl:if>
              </mPROPERTY>
            </xsl:if>
            <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:ActivityCharge">
              <mPROPERTY>
                <PROPERTY>ACTIVITY.CHARGES</PROPERTY>
                <xsl:for-each select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:ActivityCharge">
                  <xsl:variable name="indice">
                    <xsl:value-of select="position()"/>
                  </xsl:variable>
                  <sgFIELDNAME>
                    <FIELDNAME>
                      <FIELDNAME>
                        <xsl:value-of select="concat('ACTIVITY.ID:', $indice)"/>
                      </FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="eoAcct:ActivityId"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                    <xsl:for-each select="eoAcct:ActivityChargeDetail">
                      <xsl:variable name="indiceChargeDetail">
                        <xsl:value-of select="position()"/>
                      </xsl:variable>
                      <xsl:if test="eoAcct:Period/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('APP.PERIOD:', $indice, ':', $indiceChargeDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:Period"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:ActivityMethod/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('APP.METHOD:', $indice, ':', $indiceChargeDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:ActivityMethod"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:ChargeAutoSettle/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('CHARGE.AUTO.SETTLE:', $indice, ':', $indiceChargeDetail)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:ChargeAutoSettle"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                    </xsl:for-each>
                  </sgFIELDNAME>
                </xsl:for-each>
              </mPROPERTY>
            </xsl:if>
            <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction">
              <mPROPERTY>
                <PROPERTY>SETTLEMENT</PROPERTY>
                <sgFIELDNAME>
                  <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:ExeAutoPay/text()">
                    <FIELDNAME>
                      <FIELDNAME>LT.EXEC.PAY</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:call-template name="Boolean_Regex">
                          <xsl:with-param name="operation">Add</xsl:with-param>
                          <xsl:with-param name="parametro">
                            <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:ExeAutoPay"></xsl:value-of>
                          </xsl:with-param>
                        </xsl:call-template>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:FromDay/text()">
                    <FIELDNAME>
                      <FIELDNAME>LT.FROM.DAY</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:FromDay"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                  <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:ToDay/text()">
                    <FIELDNAME>
                      <FIELDNAME>LT.TO.DAY</FIELDNAME>
                      <FIELDVALUE>
                        <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:ToDay"/>
                      </FIELDVALUE>
                    </FIELDNAME>
                  </xsl:if>
                </sgFIELDNAME>
                <xsl:for-each select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:PayIn">
                  <xsl:variable name="indice">
                    <xsl:value-of select="position()"/>
                  </xsl:variable>
                  <sgFIELDNAME>
                    <xsl:if test="eoAcct:PmtType/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYMENT.TYPE:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:PmtType"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:Settlement/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYIN.SETTLEMENT:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:call-template name="Boolean_Regex">
                            <xsl:with-param name="operation">Add</xsl:with-param>
                            <xsl:with-param name="parametro">
                              <xsl:value-of select="eoAcct:Settlement"></xsl:value-of>
                            </xsl:with-param>
                          </xsl:call-template>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:ACDBRule/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYIN.AC.DB.RULE:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:ACDBRule"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:SettleActivity/ns4:Cod/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYIN.SETTLE.ACTIVITY:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:SettleActivity/ns4:Cod"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:for-each select="eoAcct:PayInAcctRef">
                      <xsl:variable name="indicePayInAcctRef">
                        <xsl:value-of select="position()"/>
                      </xsl:variable>
                      <xsl:if test="eoAcct:Activity/ns4:Cod/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('PAYIN.ACTIVITY:', $indice, ':', $indicePayInAcctRef)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:Activity/ns4:Cod"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                      <xsl:if test="eoAcct:PayInAcct/eoAcct:AcctReference/text()">
                        <FIELDNAME>
                          <FIELDNAME>
                            <xsl:value-of select="concat('PAYIN.ACCOUNT:', $indice, ':', $indicePayInAcctRef)"/>
                          </FIELDNAME>
                          <FIELDVALUE>
                            <xsl:value-of select="eoAcct:PayInAcct/eoAcct:AcctReference"/>
                          </FIELDVALUE>
                        </FIELDNAME>
                      </xsl:if>
                    </xsl:for-each>
                  </sgFIELDNAME>
                </xsl:for-each>
                <xsl:for-each select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:CreditAcctData/eoAcct:SettleInstruction/eoAcct:PayOut">
                  <xsl:variable name="indice">
                    <xsl:value-of select="position()"/>
                  </xsl:variable>
                  <sgFIELDNAME>
                    <xsl:if test="eoAcct:Property/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYOUT.PROPERTY:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:Property"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:Settlement/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYOUT.SETTLEMENT:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:call-template name="Boolean_Regex">
                            <xsl:with-param name="operation">Add</xsl:with-param>
                            <xsl:with-param name="parametro">
                              <xsl:value-of select="eoAcct:Settlement"></xsl:value-of>
                            </xsl:with-param>
                          </xsl:call-template>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:PayOutAcct/eoAcct:AcctReference/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYOUT.ACCOUNT:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:PayOutAcct/eoAcct:AcctReference"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:Activity/ns4:Cod/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYOUT.ACCTIVITY:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:Activity/ns4:Cod"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                    <xsl:if test="eoAcct:SettleActivity/ns4:Cod/text()">
                      <FIELDNAME>
                        <FIELDNAME>
                          <xsl:value-of select="concat('PAYOUT.SETTLE.ACTIVITY:', $indice)"/>
                        </FIELDNAME>
                        <FIELDVALUE>
                          <xsl:value-of select="eoAcct:SettleActivity/ns4:Cod"/>
                        </FIELDVALUE>
                      </FIELDNAME>
                    </xsl:if>
                  </sgFIELDNAME>
                </xsl:for-each>
              </mPROPERTY>
            </xsl:if>
          </gPROPERTY>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:Variation/ns4:Cod/text()">
            <PRODUCTVARIATION>
              <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:Variation/ns4:Cod"/>
            </PRODUCTVARIATION>
          </xsl:if>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:RqReason/text()">
            <REASON>
              <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:RqReason"/>
            </REASON>
          </xsl:if>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:AgentId/ns7:PartyId/text()">
            <AGENTID>
              <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:AgentId/ns7:PartyId"/>
            </AGENTID>
          </xsl:if>
          <xsl:if test="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:AgentArrId/text()">
            <AGENTARRID>
              <xsl:value-of select="/ns0:AcctLoanAddRq/ns0:AccLoan/eoAcct:AcctOpeningInfo/eoAcct:AgentArrId"/>
            </AGENTARRID>
          </xsl:if>
        </AAARRANGEMENTACTIVITYBPAWSLOANCREATE>
      </tns:AAARRANGEMENTACTIVITYBPAWSLOANCREATERequest>
    </opaq:opaqueElement>
  </xsl:template>
</xsl:stylesheet>