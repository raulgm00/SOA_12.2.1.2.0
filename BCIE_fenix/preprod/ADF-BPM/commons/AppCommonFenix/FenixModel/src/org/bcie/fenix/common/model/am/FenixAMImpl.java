package org.bcie.fenix.common.model.am;

import com.bcie.xmlns.aprobacionservice.Aprobacion;
import com.bcie.xmlns.aprobacionservice.AprobacionPT;
import com.bcie.xmlns.clienteservice.Cliente12BndQSService;
import com.bcie.xmlns.comisionservice.Comision;
import com.bcie.xmlns.comisionservice.ComisionPT;
import com.bcie.xmlns.correoelectronicoservice.CorreoElectronico12BndQSService;
import com.bcie.xmlns.correoelectronicoservice.CorreoElectronicoPT;
import com.bcie.xmlns.documentoservice.Documento12BndQSService;
import com.bcie.xmlns.documentoservice.DocumentoPT;
import com.bcie.xmlns.evaluacionservice.Evaluacion12BndQSService;
import com.bcie.xmlns.evaluacionservice.EvaluacionPT;
import com.bcie.xmlns.lineacreditoservice.LineaCreditoPT;
import com.bcie.xmlns.operacionservice.Operacion12BndQSService;
import com.bcie.xmlns.operacionservice.Operacion12Port;
import com.bcie.xmlns.seguridadservice.Seguridad12BndQSService;
import com.bcie.xmlns.seguridadservice.SeguridadPT;
import com.bcie.xmlns.solicitudaprobacionservice.SolicitudAprobacion12BndQSService;
import com.bcie.xmlns.solicitudaprobacionservice.SolicitudAprobacionPT;
import com.bcie.xmlns.usuarioservice.Usuario12BndQSService;
import com.bcie.xmlns.usuarioservice.UsuarioPT;


import oracle.jbo.server.ViewObjectImpl;

import org.bcie.fenix.common.model.vo.ComponenteProductoPoseeMoraVOImpl;
import org.bcie.fenix.common.model.vo.CondicionPreviasFormalizarPorValidarVOImpl;
import org.bcie.fenix.common.model.vo.ContratoDesembolsoEstadoVOImpl;
import com.oracle.xmlns.bpmn.bpmnprocess.administrarclienteprocess.InicioAdministrarCliente;
import com.oracle.xmlns.bpmn.bpmnprocess.administraroperacionprocess.InicioAdministrarOperacion;
import com.oracle.xmlns.bpmn.bpmnprocess.formalizacionenmiendasprocess.ConfigGatewaysType;
import com.oracle.xmlns.bpmn.bpmnprocess.procesosalternos.ProcesosAlternosBindingQSService;
import com.oracle.xmlns.bpmn.bpmnprocess.procesosalternos.ProcesosAlternosPortType;
import com.oracle.xmlns.bpmn.bpmnprocess.procesosprincipales.ProcesosPrincipalesBindingQSService;
import com.oracle.xmlns.bpmn.bpmnprocess.procesosprincipales.ProcesosPrincipalesPortType;
import com.oracle.xmlns.bpmn.bpmnprocess.procesosutilidad.ProcesosUtilidadBindingQSService;
import com.oracle.xmlns.bpmn.bpmnprocess.procesosutilidad.ProcesosUtilidadPortType;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

import org.bcie.fenix.common.model.vo.CrearOperacionVOImpl;
import org.bcie.fenix.common.model.vo.DatosLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.DetalleOperacionEditableVOImpl;
import org.bcie.fenix.common.model.vo.DocumentosTrazabilidadOperacionAdquisicionesVOImpl;
import org.bcie.fenix.common.model.vo.JustificacionOperacionVOImpl;
import org.bcie.fenix.common.model.vo.QPreguntaVOImpl;
import org.bcie.fenix.common.model.vo.consultarconfigcondicionesfinancieras.TcaTareaConBtnDinVOImpl;
import java.io.StringWriter;
import org.bcie.fenix.common.model.vo.ValidarOperacionGestorTipoDocumentoVOImpl;
import org.bcie.fenix.common.model.vo.consultarconfigcondicionesfinancieras.TcaTareaConBtnDinVOImpl;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.math.RoundingMode;

import java.sql.SQLException;
import java.sql.Timestamp;

import java.text.DecimalFormat;
import java.text.SimpleDateFormat;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.ResourceBundle;
import java.util.Set;

import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Marshaller;
import javax.xml.datatype.DatatypeConfigurationException;
import javax.xml.datatype.DatatypeFactory;
import javax.xml.datatype.XMLGregorianCalendar;
import javax.xml.namespace.QName;

import javax.xml.ws.BindingProvider;

import oracle.adf.share.ADFContext;
import oracle.adf.share.logging.ADFLogger;

import oracle.javatools.resourcebundle.BundleFactory;

import oracle.jbo.JboException;
import oracle.jbo.Key;
import oracle.jbo.NameValuePairs;
import oracle.jbo.Row;
import oracle.jbo.RowSetIterator;
import oracle.jbo.ViewCriteria;
import oracle.jbo.domain.BlobDomain;
import oracle.jbo.domain.Number;
import oracle.jbo.server.ApplicationModuleImpl;
import oracle.jbo.server.SequenceImpl;
import oracle.jbo.server.ViewLinkImpl;

import org.bcie.aprobacionmo.ActualizarAprobacionRequestType;
import org.bcie.aprobacionmo.ActualizarAprobacionResponseType;
import org.bcie.aprobacionmo.ConsultarAprobacionRequestType;
import org.bcie.aprobacionmo.ConsultarAprobacionResponseType;
import org.bcie.aprobacionmo.CrearAprobacionRequestType;
import org.bcie.aprobacionmo.CrearAprobacionResponseType;
import org.bcie.atributobo.Accion;
import org.bcie.catalogobo.Catalogo;
import org.bcie.clientebo.Cliente;
import org.bcie.clientebo.ClienteBasicType;
import org.bcie.clientemo.ConsultarClienteResponseType;
import org.bcie.clientemo.ConsultarClientesByIdClienteRequestType;
import org.bcie.comisionbo.MontoBase;
import org.bcie.comisionmo.ConsultarComisionRequestType;
import org.bcie.comisionmo.ConsultarComisionResponseType;
import org.bcie.comisionmo.CrearCargoTramiteRequestType;
import org.bcie.comisionmo.CrearCargoTramiteResponseType;
import org.bcie.condicionbo.Condicion;
import org.bcie.condicionbo.TransaccionCondicion;
import org.bcie.condicionmo.CondicionesDemandaRequestType;
import org.bcie.condicionmo.CondicionesDemandaResponseType; 
import org.bcie.condicionmo.GenerarReporteCondicionValidadorRequestType;
import org.bcie.condicionmo.GenerarReporteCondicionValidadorResponseType; 
import org.bcie.condicionservice.Condicion12BndQSService;
import org.bcie.condicionservice.CondicionPT;
import org.bcie.contratobo.Contrato;
import org.bcie.contratobo.Cuentas;
import org.bcie.contratomo.ActualizarTCCAprobacionRequestType;
import org.bcie.contratomo.ActualizarTCCAprobacionResponseType;
import org.bcie.contratomo.ConsultarPlazoCondicionRequestType;
import org.bcie.contratomo.ConsultarPlazoCondicionResponseType;
import org.bcie.contratoservice.Contrato12BndQSService;
import org.bcie.contratoservice.ContratoPT;
import org.bcie.conversormonedas.ConversorMonedasPT;
import org.bcie.conversormonedas.ConversorMonedasPT12BndQSService;
import org.bcie.conversormonedasbo.ConvierteMonedas;
import org.bcie.conversormonedasbo.ConvierteMonedasImporte;
import org.bcie.conversormonedasmo.ConvertirMonedasImportesRequestType;
import org.bcie.conversormonedasmo.ConvertirMonedasImportesResponseType;
import org.bcie.correobo.Param;
import org.bcie.correomo.EnviarCorreoElectronicoRequestType;
import org.bcie.correomo.EnviarCorreoElectronicoResponseType;
import org.bcie.desembolso.DesembolsoPT;
import org.bcie.desembolso.DesembolsoPTSOAP12BindingQSService;
import org.bcie.desembolsomo.ActualizarEstadoContratoDesembolsoRequestType;
import org.bcie.desembolsomo.ActualizarEstadoContratoDesembolsoResponseType;
import org.bcie.desembolsomo.ConsultarComisionesNoCobradasBPELRequestType;
import org.bcie.desembolsomo.ConsultarComisionesNoCobradasBPELResponseType;
import org.bcie.documentobo.Documento;
import org.bcie.documentobo.ListaDocumentos;
import org.bcie.documentomo.CargarDocumentoRequestType;
import org.bcie.documentomo.CargarDocumentoResponseType;
import org.bcie.documentomo.ConsultaDocumentosRequestType;
import org.bcie.documentomo.ConsultaDocumentosResponseType;
import org.bcie.errorbo.Error;
import org.bcie.evaluacionbo.Cuestionario;
import org.bcie.evaluacionbo.Cuestionarios;
import org.bcie.evaluacionbo.EVALType;
import org.bcie.evaluacionbo.Evaluacion;
import org.bcie.evaluacionbo.Evaluaciones;
import org.bcie.evaluacionmo.CompensarEvaluacionRequestType;
import org.bcie.evaluacionmo.CompensarEvaluacionRespnseType;
import org.bcie.evaluacionmo.ConsultarCuestionarioRequestType;
import org.bcie.evaluacionmo.ConsultarCuestionarioResponseType;
import org.bcie.evaluacionmo.ConsultarEvaluacionRequestType;
import org.bcie.evaluacionmo.ConsultarEvaluacionResponseType;
import org.bcie.evaluacionmo.CrearEvaluacionRequestType;
import org.bcie.evaluacionmo.CrearEvaluacionResponseType;
import org.bcie.evaluacionmo.DuplicarEvaluacionRequestType;
import org.bcie.evaluacionmo.DuplicarEvaluacionResponseType;
import org.bcie.evaluacionmo.EliminarCuestionarioRequestType;
import org.bcie.evaluacionmo.EliminarCuestionarioResponseType;
import org.bcie.fenix.common.model.FenixModelConstants;
import static org.bcie.fenix.common.model.FenixModelConstants.ACTUALIZAR_TEXT;
import static org.bcie.fenix.common.model.FenixModelConstants.ADQUISICIONES_C;
import static org.bcie.fenix.common.model.FenixModelConstants.APROBADO_TEXT;
import static org.bcie.fenix.common.model.FenixModelConstants.ASIGNA_TAREA_BPM_ACTUALIZA_TCC;
import static org.bcie.fenix.common.model.FenixModelConstants.BANESTATUS_FALSE;
import static org.bcie.fenix.common.model.FenixModelConstants.BANESTATUS_TRUE;
import static org.bcie.fenix.common.model.FenixModelConstants.BANSUGERIDA_DEFAULT;
import static org.bcie.fenix.common.model.FenixModelConstants.BANVALIDADOJEFATURA;
import static org.bcie.fenix.common.model.FenixModelConstants.BAN_RETORNO;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_01;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_02;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_03;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_04;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_05;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_06;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_07;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_08;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_09;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_10;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_11;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_12;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_13;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_14;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_15;
import static org.bcie.fenix.common.model.FenixModelConstants.COL_16;
import static org.bcie.fenix.common.model.FenixModelConstants.COMISIONCOMPARTIDA_DEFAULT;
import static org.bcie.fenix.common.model.FenixModelConstants.CONVERTIR_MILISEGUNDOS_SEGUNDOS;
import static org.bcie.fenix.common.model.FenixModelConstants.ELIMINAR_TEXT;
import static org.bcie.fenix.common.model.FenixModelConstants.EMITE_VOTO;
import static org.bcie.fenix.common.model.FenixModelConstants.EN_ANALISIS_DEFAULT;
import static org.bcie.fenix.common.model.FenixModelConstants.ES_FINANCIERA_ESPECIAL_TRUE;
import static org.bcie.fenix.common.model.FenixModelConstants.ES_FUERA_SISTEMA;
import static org.bcie.fenix.common.model.FenixModelConstants.ES_RECURSOS_ORDINARIOS_FALSE;
import static org.bcie.fenix.common.model.FenixModelConstants.ES_REVOLVENTE_TRUE_INT;
import static org.bcie.fenix.common.model.FenixModelConstants.HOJA_PCT_C;
import static org.bcie.fenix.common.model.FenixModelConstants.IDTCAESTADOTCC_DEFAULT;
import static org.bcie.fenix.common.model.FenixModelConstants.IDTCASUBESTADOTCC_DEFAULT;
import static org.bcie.fenix.common.model.FenixModelConstants.ID_MODALIDAD_TCC_TREE;
import static org.bcie.fenix.common.model.FenixModelConstants.INIT_ATTR_ID;
import static org.bcie.fenix.common.model.FenixModelConstants.NIVEL_APROBACION_COMITE_CREDITO_INT;
import static org.bcie.fenix.common.model.FenixModelConstants.NIVEL_APROBACION_PRESIDENCIA_INT;
import static org.bcie.fenix.common.model.FenixModelConstants.NIVEL_APROBACION_PRESIDENCIA_NUM;
import static org.bcie.fenix.common.model.FenixModelConstants.NO_TEXT;
import static org.bcie.fenix.common.model.FenixModelConstants.OPINION_TECNICA_C;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_CANCELAREFORMULACION;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_COMP_CONCILIADO_NO;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_COMP_CONCILIADO_SI;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_DEFAULT_ID;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_ETAPA_ELEGIBILIDAD;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_FALSE;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_INIT_CONFIG_VISIBILIDAD;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_INIT_ID;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_PORSEGUIMIENTO;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_PROGRAMADO_NO;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_PROGRAMADO_SI;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_TIPOENMIENDA;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_TIPOINICIO;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_TIPO_FORMALIZACIONENMIENDA;
import static org.bcie.fenix.common.model.FenixModelConstants.PARAM_TRUE;
import static org.bcie.fenix.common.model.FenixModelConstants.PRELIMINAR_TEXT;
import static org.bcie.fenix.common.model.FenixModelConstants.RAROC_C;
import static org.bcie.fenix.common.model.FenixModelConstants.SI_TEXT;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_ADQUISION_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_ENVIAR_ANALISIS_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_EQUIPOS_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_HOJAPCT_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_OPINION_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_RAROC_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_REVCOMISION_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TERMINO_PLAZO_FINANCIAMIENTO;
import static org.bcie.fenix.common.model.FenixModelConstants.TERMINO_TIPO_FECHA_INICIO_APROBACION;
import static org.bcie.fenix.common.model.FenixModelConstants.TERMINO_TIPO_FECHA_INICIO_ESCRITURACION;
import static org.bcie.fenix.common.model.FenixModelConstants.TERMINO_TIPO_FECHA_INICIO_NOTIFICACION;
import static org.bcie.fenix.common.model.FenixModelConstants.TERMINO_TIPO_FECHA_INICIO_PRIMER_DESEMBOLSO;
import static org.bcie.fenix.common.model.FenixModelConstants.TERMINO_TIPO_FECHA_INICIO_VIGENCIA;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_MIEMBRO_COMITE_CREDITO;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_MIEMBRO_EQUIPO_TRABAJO;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_MIEMBRO_NOTIFICACION;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_PLAZO_ANIO;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_PLAZO_DIA;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_PLAZO_MES;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_REUNION_PRESENCIAL;
import static org.bcie.fenix.common.model.FenixModelConstants.TIPO_REUNION_VIRTUAL;
import static org.bcie.fenix.common.model.FenixModelConstants.VERSION_EVALUACION;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD_C;
import static org.bcie.fenix.common.model.FenixModelConstants.TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD_C;
import org.bcie.fenix.common.model.am.common.FenixAM;
import org.bcie.fenix.common.model.bo.BaseBO;
import org.bcie.fenix.common.model.bo.adminlineacredito.CargarContratoOperacionProcesoBO;
import org.bcie.fenix.common.model.bo.adminlineacredito.CargarLineaCreditoByIdBO;
import org.bcie.fenix.common.model.bo.adminlineacredito.CargarLineasByContratoBO;
import org.bcie.fenix.common.model.bo.adminlineacredito.CrearContratoOperacionProcesoBO;
import org.bcie.fenix.common.model.dto.CorreoElectronicoDTO;
import org.bcie.fenix.common.model.utils.IWsdlLocation;
import org.bcie.fenix.common.model.utils.ModelUtils;
import org.bcie.fenix.common.model.vo.AccionVOImpl;
import org.bcie.fenix.common.model.vo.AccionVORowImpl;
import org.bcie.fenix.common.model.vo.AccionesTablaVOImpl;
import org.bcie.fenix.common.model.vo.ActualizarClasificacionAmbientalVOImpl;
import org.bcie.fenix.common.model.vo.ActualizarOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ActualizarOperacionVORowImpl;
import org.bcie.fenix.common.model.vo.AdjudicatariosVOImpl;
import org.bcie.fenix.common.model.vo.AdjuntarContratoFirmadoVOImpl;
import org.bcie.fenix.common.model.vo.AdjuntoVOImpl;
import org.bcie.fenix.common.model.vo.AdminContactosVOImpl;
import org.bcie.fenix.common.model.vo.AgregarComisionVOImpl;
import org.bcie.fenix.common.model.vo.AgregarFuentePorLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.AgregarFuenteVOImpl;
import org.bcie.fenix.common.model.vo.AgregarLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.AgregarParticipanteTramoFormalizarVOImpl;
import org.bcie.fenix.common.model.vo.AgregarTramoFormalizarVOImpl;
import org.bcie.fenix.common.model.vo.AgregarVencimientoPlazoVOImpl;
import org.bcie.fenix.common.model.vo.AnalisisVOImpl;
import org.bcie.fenix.common.model.vo.AnalisisVORowImpl;
import org.bcie.fenix.common.model.vo.AplicacionExternaVOImpl;
import org.bcie.fenix.common.model.vo.AprobacionVOImpl;
import org.bcie.fenix.common.model.vo.AsociadasVOImpl;
import org.bcie.fenix.common.model.vo.AsociadasVORowImpl;
import org.bcie.fenix.common.model.vo.BitacoraSeguimientoAccionVOImpl;
import org.bcie.fenix.common.model.vo.BuscarClienteVOImpl;
import org.bcie.fenix.common.model.vo.CFTasaReferenciaVOImpl;
import org.bcie.fenix.common.model.vo.CFTempVOImpl;
import org.bcie.fenix.common.model.vo.CFTempVORowImpl;
import org.bcie.fenix.common.model.vo.CFTerminoVOImpl;
import org.bcie.fenix.common.model.vo.CFandCC1VOImpl;
import org.bcie.fenix.common.model.vo.CFandCC2VOImpl;
import org.bcie.fenix.common.model.vo.CFandCC3VOImpl;
import org.bcie.fenix.common.model.vo.CFandCC4VOImpl;
import org.bcie.fenix.common.model.vo.CFandCalendario1VOImpl;
import org.bcie.fenix.common.model.vo.CFandComponente1VOImpl;
import org.bcie.fenix.common.model.vo.CFandComponente2VOImpl;
import org.bcie.fenix.common.model.vo.CalendarioVOImpl;
import org.bcie.fenix.common.model.vo.CalendarioVORowImpl;
import org.bcie.fenix.common.model.vo.CambiarResponsableClienteVOImpl;
import org.bcie.fenix.common.model.vo.CambiarResponsableVOImpl;
import org.bcie.fenix.common.model.vo.CargoTramiteVOImpl;
import org.bcie.fenix.common.model.vo.CargoTramiteVORowImpl;
import org.bcie.fenix.common.model.vo.CargoVOImpl;
import org.bcie.fenix.common.model.vo.CargoVORowImpl;
import org.bcie.fenix.common.model.vo.CatCuentaClienteLOVImpl;
import org.bcie.fenix.common.model.vo.CatCuentaClienteLOVRowImpl;
import org.bcie.fenix.common.model.vo.CatDiasFeriadosVOImpl;
import org.bcie.fenix.common.model.vo.CatFondoContableVOImpl;
import org.bcie.fenix.common.model.vo.CatGrupoEconomicoVOImpl;
import org.bcie.fenix.common.model.vo.CatOficinaVOImpl;
import org.bcie.fenix.common.model.vo.CatPaisesVOImpl;
import org.bcie.fenix.common.model.vo.CatPeriodoGraciaLOVImpl;
import org.bcie.fenix.common.model.vo.CatPlazoFinanciamientoLOVImpl;
import org.bcie.fenix.common.model.vo.CatPlazoVencimientoLOVImpl;
import org.bcie.fenix.common.model.vo.CatProductoFlexcubeLOVImpl;
import org.bcie.fenix.common.model.vo.CatProductoVOImpl;
import org.bcie.fenix.common.model.vo.CatTipoFrecuenciaVOImpl;
import org.bcie.fenix.common.model.vo.CategoriaCondicionVOImpl;
import org.bcie.fenix.common.model.vo.ClasificacionAmbientalEditableVOImpl;
import org.bcie.fenix.common.model.vo.ClasificacionAmbientalVOImpl;
import org.bcie.fenix.common.model.vo.ClasificacionEstrategicaEditableVOImpl;
import org.bcie.fenix.common.model.vo.ClasificacionEstrategicaLOVImpl;
import org.bcie.fenix.common.model.vo.ClasificacionEstrategicaVOImpl;
import org.bcie.fenix.common.model.vo.ClienteLVOImpl;
import org.bcie.fenix.common.model.vo.ClienteOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ClientesRepetidosVOImpl;
import org.bcie.fenix.common.model.vo.ClientesVOImpl;
import org.bcie.fenix.common.model.vo.CodigoTasaReferenciaImpl;
import org.bcie.fenix.common.model.vo.ComentarioClienteVOImpl;
import org.bcie.fenix.common.model.vo.ComentarioOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ComentarioReunionVOImpl;
import org.bcie.fenix.common.model.vo.ComentarioReunionVORowImpl;
import org.bcie.fenix.common.model.vo.ComisionEnmendadaVOImpl;
import org.bcie.fenix.common.model.vo.ComisionRegistradaFlexVOImpl;
import org.bcie.fenix.common.model.vo.ComisionTreeVOImpl;
import org.bcie.fenix.common.model.vo.ComisionTreeVORowImpl;
import org.bcie.fenix.common.model.vo.ComisionVOImpl;
import org.bcie.fenix.common.model.vo.ComisionVORowImpl;
import org.bcie.fenix.common.model.vo.ComisionesLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.ComisionesLineaCreditoVORowImpl;
import org.bcie.fenix.common.model.vo.ComisionesNoPagadasVOImpl;
import org.bcie.fenix.common.model.vo.ComisionesNoPagadasVORowImpl;
import org.bcie.fenix.common.model.vo.ComisionesVOImpl;
import org.bcie.fenix.common.model.vo.ComiteVotoReunionVOImpl;
import org.bcie.fenix.common.model.vo.ComponenteVOImpl;
import org.bcie.fenix.common.model.vo.ComponenteVORowImpl;
import org.bcie.fenix.common.model.vo.CondicionDesembolsoPorValidarVOImpl;
import org.bcie.fenix.common.model.vo.CondicionIncumplimientoVOImpl;
import org.bcie.fenix.common.model.vo.CondicionPorValidarVOImpl;
import org.bcie.fenix.common.model.vo.CondicionGeneralPorValidarVOImpl;
import org.bcie.fenix.common.model.vo.CondicionGeneralPorValidarVORowImpl;
import org.bcie.fenix.common.model.vo.CondicionPorValidarVORowImpl;
import org.bcie.fenix.common.model.vo.CondicionVOImpl;
import org.bcie.fenix.common.model.vo.CondicionValidacionVOImpl;
import org.bcie.fenix.common.model.vo.CondicionValidacionVORowImpl;
import org.bcie.fenix.common.model.vo.CondicionesFinancierasVOImpl;
import org.bcie.fenix.common.model.vo.CondicionesFinancierasVORowImpl;
import org.bcie.fenix.common.model.vo.CondicionesOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ConfigVisibilidadVOImpl;
import org.bcie.fenix.common.model.vo.ConfigVisibilidadVORowImpl;
import org.bcie.fenix.common.model.vo.ConfiguracionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultaComisionNoPagadaVOImpl;
import org.bcie.fenix.common.model.vo.ConsultaComisionNoPagadaVORowImpl;
import org.bcie.fenix.common.model.vo.ConsultaContactosClienteVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarAdjuntoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarAprobacionLOVImpl;
import org.bcie.fenix.common.model.vo.ConsultarAsociadasVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarCalculoInteresesVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarContrapartesTerminoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarContratosDesembolsoQueryVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarFechaAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarFechaEfectivaVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarFechaFirmaContratoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarFormalizacionAutomaticaVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarIDContratoDesembolsoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarLineaCreditoDesembolsoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarLineasPorOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarNumeroSolicitudVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarPreguntasRolVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarProductoByOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarProductoOperacionImpl;
import org.bcie.fenix.common.model.vo.ConsultarReglasNoCumplidasDesembolsoExcepcionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarResponsableOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarSolicitudDesembolsoQueryVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarTccTerminoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarTerminoEnEspecificoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarTreSolicitudLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarUsuarioReunionAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.ConsultarUsuarioReunionAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.ConsutarCondicionVOImpl;
import org.bcie.fenix.common.model.vo.ContactosClienteVOImpl;
import org.bcie.fenix.common.model.vo.ContrapartesTerminoVOImpl;
import org.bcie.fenix.common.model.vo.ContratadosVOImpl;
import org.bcie.fenix.common.model.vo.ContratoDesembolsoQueryVOImpl;
import org.bcie.fenix.common.model.vo.ContratoDesembolsoVOImpl;
import org.bcie.fenix.common.model.vo.ContratoOperacionSaldoNoVencidoVOImpl;
import org.bcie.fenix.common.model.vo.ContratoVOImpl;
import org.bcie.fenix.common.model.vo.ContratoVORowImpl;
import org.bcie.fenix.common.model.vo.ContratosOperacionVOImpl;
import org.bcie.fenix.common.model.vo.CrearClienteVOImpl;
import org.bcie.fenix.common.model.vo.CrearClienteVORowImpl;
import org.bcie.fenix.common.model.vo.CrearOperacionVORowImpl;
import org.bcie.fenix.common.model.vo.CuentasClienteOperacionVOImpl;
import org.bcie.fenix.common.model.vo.CuestionarioVOImpl;
import org.bcie.fenix.common.model.vo.CuestionarioVORowImpl;
import org.bcie.fenix.common.model.vo.DatosDesembolsoClasificacionEstrategicaVOImpl;
import org.bcie.fenix.common.model.vo.DatosGeneralesDesembolsoVOImpl;
import org.bcie.fenix.common.model.vo.DatosGeneralesIntermediacionVOImpl;
import org.bcie.fenix.common.model.vo.DatosLineaCreditoVORowImpl;
import org.bcie.fenix.common.model.vo.DatosSupervisionVOImpl;
import org.bcie.fenix.common.model.vo.DecisionReunionAprobacionUpdateVOImpl;
import org.bcie.fenix.common.model.vo.DecisionReunionAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.DecisionReunionAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.DeclaracionJuradaLaftVOImpl;
import org.bcie.fenix.common.model.vo.DeclaracionVOImpl;
import org.bcie.fenix.common.model.vo.DescripcionExcepcionVOImpl;
import org.bcie.fenix.common.model.vo.DesembolsoServiceVOImpl;
import org.bcie.fenix.common.model.vo.DetalleClasificacionAmbientalVOImpl;
import org.bcie.fenix.common.model.vo.DetalleClasificacionAmbientalVORowImpl;
import org.bcie.fenix.common.model.vo.DetalleClasificacionEstrategicaVOImpl;
import org.bcie.fenix.common.model.vo.DetalleClasificacionEstrategicaVORowImpl;
import org.bcie.fenix.common.model.vo.DetalleClienteVOImpl;
import org.bcie.fenix.common.model.vo.DetalleClienteVORowImpl;
import org.bcie.fenix.common.model.vo.DetalleContratoDesembolsoVOImpl;
import org.bcie.fenix.common.model.vo.DetalleEnmiendaTccVOImpl;
import org.bcie.fenix.common.model.vo.DetalleOperacionEditableVORowImpl;
import org.bcie.fenix.common.model.vo.DetalleOperacionVOImpl;
import org.bcie.fenix.common.model.vo.DetalleOperacionVORowImpl;
import org.bcie.fenix.common.model.vo.DiasHabilesVOImpl;
import org.bcie.fenix.common.model.vo.DiasInhabilesVOImpl;
import org.bcie.fenix.common.model.vo.DiasSpotTasaVOImpl;
import org.bcie.fenix.common.model.vo.DocumentoVOImpl;
import org.bcie.fenix.common.model.vo.DocumentoVORowImpl;
import org.bcie.fenix.common.model.vo.DocumentosAdjuntadosClientesVOImpl;
import org.bcie.fenix.common.model.vo.DocumentosAdjuntadosVOImpl;
import org.bcie.fenix.common.model.vo.DocumentosCondicionesVOImpl;
import org.bcie.fenix.common.model.vo.DocumentosSincronizadosVOImpl;
import org.bcie.fenix.common.model.vo.ElegibilidadVOImpl;
import org.bcie.fenix.common.model.vo.ElegibilidadVORowImpl;
import org.bcie.fenix.common.model.vo.EncabezadoRegistrarDatosLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.EncabezadoRegistrarDatosLineaCreditoVORowImpl;
import org.bcie.fenix.common.model.vo.EnmiendaTccVOImpl;
import org.bcie.fenix.common.model.vo.EnvioDatosReuAproVOImpl;
import org.bcie.fenix.common.model.vo.EvaluacionCalificacionVOImpl;
import org.bcie.fenix.common.model.vo.EvaluacionVOImpl;
import org.bcie.fenix.common.model.vo.EvaluacionVORowImpl;
import org.bcie.fenix.common.model.vo.EvidenciasCondicionesVOImpl;
import org.bcie.fenix.common.model.vo.FT05VOImpl;
import org.bcie.fenix.common.model.vo.FechaCalendarioVOImpl;
import org.bcie.fenix.common.model.vo.FuenteVOImpl;
import org.bcie.fenix.common.model.vo.FuentesExternasVOImpl;
import org.bcie.fenix.common.model.vo.GrupoRolAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.GrupoRolAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.HistoricoVotoAprobacionLOVImpl;
import org.bcie.fenix.common.model.vo.JustificacionEnvioOperacionImpl;
import org.bcie.fenix.common.model.vo.LimitesExcepcionVOImpl;
import org.bcie.fenix.common.model.vo.LineaCreditoActivaVOImpl;
import org.bcie.fenix.common.model.vo.LineaCreditoActivaVORowImpl;
import org.bcie.fenix.common.model.vo.LineaCreditoAsociadaOperacionVOImpl;
import org.bcie.fenix.common.model.vo.LineaCreditoAsociadaVOImpl;
import org.bcie.fenix.common.model.vo.LineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.LineaCreditoVORowImpl;
import org.bcie.fenix.common.model.vo.LineasContratosCreadosImplementacionVOImpl;
import org.bcie.fenix.common.model.vo.LoteFinConcursoVOImpl;
import org.bcie.fenix.common.model.vo.LoteFinConcursoVORowImpl;
import org.bcie.fenix.common.model.vo.LoteFormalizacionVOImpl;
import org.bcie.fenix.common.model.vo.LoteImplementacionFinConcursoVOImpl;
import org.bcie.fenix.common.model.vo.LoteImplementacionVOImpl;
import org.bcie.fenix.common.model.vo.MemoriaProcesoBpmVOImpl;
import org.bcie.fenix.common.model.vo.MiembrosAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.MiembrosAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.MontoFormalizacionesEjecutadasVOImpl;
import org.bcie.fenix.common.model.vo.MontoOperacionPorLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.MontoOperacionVOImpl;
import org.bcie.fenix.common.model.vo.MotivosAnalisisVOImpl;
import org.bcie.fenix.common.model.vo.MotivosAnalisisVORowImpl;
import org.bcie.fenix.common.model.vo.NoObjecionVOImpl;
import org.bcie.fenix.common.model.vo.ObservacionAccionVOImpl;
import org.bcie.fenix.common.model.vo.ObservacionCondicionVOImpl;
import org.bcie.fenix.common.model.vo.OferentesVOImpl;
import org.bcie.fenix.common.model.vo.OperaAsociadaVOImpl;
import org.bcie.fenix.common.model.vo.OperaAsociadaVORowImpl;
import org.bcie.fenix.common.model.vo.OperacionGenericoVOImpl;
import org.bcie.fenix.common.model.vo.OperacionGenericoVORowImpl;
import org.bcie.fenix.common.model.vo.OperacionesAsociadasLOVImpl;
import org.bcie.fenix.common.model.vo.OperacionesAsociadasVOImpl;
import org.bcie.fenix.common.model.vo.OperacionesAsociadasVORowImpl;
import org.bcie.fenix.common.model.vo.OperacionesClienteVOImpl;
import org.bcie.fenix.common.model.vo.ParticipanteTramoFormalizarVOImpl;
import org.bcie.fenix.common.model.vo.PreCargaComisionVOImpl;
import org.bcie.fenix.common.model.vo.PreCargaCondicionVOImpl;
import org.bcie.fenix.common.model.vo.PreCargaCondicionVORowImpl;
import org.bcie.fenix.common.model.vo.PreCargaTerminoVOImpl;
import org.bcie.fenix.common.model.vo.ProcesoClienteVOImpl;
import org.bcie.fenix.common.model.vo.ProcesoOperacionVOImpl;
import org.bcie.fenix.common.model.vo.QPreguntaVORowImpl;
import org.bcie.fenix.common.model.vo.RecuperarDatosLineaByIdImpl;
import org.bcie.fenix.common.model.vo.RegistrarCondicionAprobacionActionsVOImpl;
import org.bcie.fenix.common.model.vo.RegistrarCondicionAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.RegistrarCondicionAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.RegistrarDatosAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.RegistrarDatosAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.RegistrarDatosLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.RegistrarDatosLineaCreditoVORowImpl;
import org.bcie.fenix.common.model.vo.RegistrarFechaFormalizacionAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.RegistrarFechaFormalizacionAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.RegistrarFechaVigenciaVOImpl;
import org.bcie.fenix.common.model.vo.RegistrarLineaCreditoAprobacionActionsVOImpl;
import org.bcie.fenix.common.model.vo.RegistrarLineaCreditoAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.ReglasValidadasDesembolsoPorExcepcionImpl;
import org.bcie.fenix.common.model.vo.ResponsableVOImpl;
import org.bcie.fenix.common.model.vo.RespuestaComentarioClienteVOImpl;
import org.bcie.fenix.common.model.vo.RespuestaComentarioOperacionVOImpl;
import org.bcie.fenix.common.model.vo.RespuestaComentarioVOImpl;
import org.bcie.fenix.common.model.vo.RolesAccionVOImpl;
import org.bcie.fenix.common.model.vo.SectorMercadoVOImpl;
import org.bcie.fenix.common.model.vo.SeguimientoAccionLOVImpl;
import org.bcie.fenix.common.model.vo.SeguimientoAccionVOImpl;
import org.bcie.fenix.common.model.vo.SeguimientoCreditcioVOImpl;
import org.bcie.fenix.common.model.vo.SeguimientoCrediticioAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.SeguimientoCrediticioRetornoVOImpl;
import org.bcie.fenix.common.model.vo.SolicitudAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.SolicitudAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.SolicitudExcepcionVOImpl;
import org.bcie.fenix.common.model.vo.SpreadReferenciaVOImpl;
import org.bcie.fenix.common.model.vo.SuspenderCancelarOperacionVOImpl;
import org.bcie.fenix.common.model.vo.SuspenderCancelarOperacionVORowImpl;
import org.bcie.fenix.common.model.vo.TareaProcesoBpmVOImpl;
import org.bcie.fenix.common.model.vo.TareasActivasOperacionVOImpl;
import org.bcie.fenix.common.model.vo.TasaReferenciaVOImpl;
import org.bcie.fenix.common.model.vo.TbiDocumentoVOImpl;
import org.bcie.fenix.common.model.vo.TcaAccionASeguirLOVImpl;
import org.bcie.fenix.common.model.vo.TcaAccionASeguirLOVRowImpl;
import org.bcie.fenix.common.model.vo.TcaAporteAmbientalVOImpl;
import org.bcie.fenix.common.model.vo.TcaCategoriaAccionVOImpl;
import org.bcie.fenix.common.model.vo.TcaCategoriaAmbientalVOImpl;
import org.bcie.fenix.common.model.vo.TcaCategoriaCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TcaCategoriaLeccionVOImpl;
import org.bcie.fenix.common.model.vo.TcaComisionLOVImpl;
import org.bcie.fenix.common.model.vo.TcaCondicionLOVImpl;
import org.bcie.fenix.common.model.vo.TcaEstadoLeccionVOImpl;
import org.bcie.fenix.common.model.vo.TcaEventoCondicionLOVImpl;
import org.bcie.fenix.common.model.vo.TcaLugarAprobacionLOVImpl;
import org.bcie.fenix.common.model.vo.TcaMiembroReunionVOImpl;
import org.bcie.fenix.common.model.vo.TcaRolBPMVOImpl;
import org.bcie.fenix.common.model.vo.TcaRolBpmLOVImpl;
import org.bcie.fenix.common.model.vo.TcaSCRVOImpl;
import org.bcie.fenix.common.model.vo.TcaSectorAmbientalVOImpl;
import org.bcie.fenix.common.model.vo.TcaSubcategoriaAmbientalVOImpl;
import org.bcie.fenix.common.model.vo.TcaTareaBpmVOImpl;
import org.bcie.fenix.common.model.vo.TcaTipoFrecuenciaVOImpl;
import org.bcie.fenix.common.model.vo.TcaTipoMonedaVOImpl;
import org.bcie.fenix.common.model.vo.TcaTipoMoraVOImpl;
import org.bcie.fenix.common.model.vo.TcaTipoRedondeoVOImpl;
import org.bcie.fenix.common.model.vo.TccAgregarEnmendadoVOImpl;
import org.bcie.fenix.common.model.vo.TccAgregarVOImpl;
import org.bcie.fenix.common.model.vo.TccComisionVOImpl;
import org.bcie.fenix.common.model.vo.TccComisionVORowImpl;
import org.bcie.fenix.common.model.vo.TccCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TccCondicionVORowImpl;
import org.bcie.fenix.common.model.vo.TccDatosTcaTerminoVOImpl;
import org.bcie.fenix.common.model.vo.TccEditarTerminoVOImpl;
import org.bcie.fenix.common.model.vo.TccEditarTerminoVORowImpl;
import org.bcie.fenix.common.model.vo.TccElementosOperVOImpl;
import org.bcie.fenix.common.model.vo.TccElementosOperVORowImpl;
import org.bcie.fenix.common.model.vo.TccElementosTreeVOImpl;
import org.bcie.fenix.common.model.vo.TccFuenteCondicionLOVImpl;
import org.bcie.fenix.common.model.vo.TccLineaCreditoCondicionLOVImpl;
import org.bcie.fenix.common.model.vo.TccObservacionCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TccRootNodeVOImpl;
import org.bcie.fenix.common.model.vo.TccSeleccionarVOImpl;
import org.bcie.fenix.common.model.vo.TccTcaProcesoTareaBpmVOImpl;
import org.bcie.fenix.common.model.vo.TccTcaProcesoTareaBpmVORowImpl;
import org.bcie.fenix.common.model.vo.TccTcaTerminoVOImpl;
import org.bcie.fenix.common.model.vo.TccTcaTerminoVORowImpl;
import org.bcie.fenix.common.model.vo.TccTerminoTipoFechaInicioLOVImpl;
import org.bcie.fenix.common.model.vo.TccTerminoVOImpl;
import org.bcie.fenix.common.model.vo.TccTerminoVORowImpl;
import org.bcie.fenix.common.model.vo.TccTipoPorOperVOImpl;
import org.bcie.fenix.common.model.vo.TccTreeCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TccTreeTcaCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TccTreeTcaTipoCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TcoAtributoTccVOImpl;
import org.bcie.fenix.common.model.vo.TerminosLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.TerminosOperacionVOImpl;
import org.bcie.fenix.common.model.vo.TimeLineEnmiendaVOImpl;
import org.bcie.fenix.common.model.vo.TimeLineEvaluacionExpostVOImpl;
import org.bcie.fenix.common.model.vo.TimeLineEvaluacionSiemasVOImpl;
import org.bcie.fenix.common.model.vo.TimeLineFechaUltimoDesembolsoVOImpl;
import org.bcie.fenix.common.model.vo.TimeLineFormalizacionEnmiendaVOImpl;
import org.bcie.fenix.common.model.vo.TimeLineOperacionVOImpl;
import org.bcie.fenix.common.model.vo.TiposActividadEconomicaLOVImpl;
import org.bcie.fenix.common.model.vo.TiposActividadEconomicaPadreLOVImpl;
import org.bcie.fenix.common.model.vo.TiposAreaFocalizacionLOVImpl;
import org.bcie.fenix.common.model.vo.TiposCantidadPaisesBeneficiadosLOVImpl;
import org.bcie.fenix.common.model.vo.TiposComisionLOVImpl;
import org.bcie.fenix.common.model.vo.TiposDocumentoLOVImpl;
import org.bcie.fenix.common.model.vo.TiposEjeEstrategicoLOVImpl;
import org.bcie.fenix.common.model.vo.TiposFuenteLOVImpl;
import org.bcie.fenix.common.model.vo.TiposIniciativaEstrategicaLOVImpl;
import org.bcie.fenix.common.model.vo.TramoFormalizarVOImpl;
import org.bcie.fenix.common.model.vo.TransferenciasConsolidarVOImpl;
import org.bcie.fenix.common.model.vo.TrazabilidadOperacionVOImpl;
import org.bcie.fenix.common.model.vo.TreCategoriaAccionRolVOImpl;
import org.bcie.fenix.common.model.vo.TreCategoriaCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TreClienteProcesoBpmVOImpl;
import org.bcie.fenix.common.model.vo.TreComisionPrepagoVOImpl;
import org.bcie.fenix.common.model.vo.TreComiteRolBpmVOImpl;
import org.bcie.fenix.common.model.vo.TreContrapartesTerminoVOImpl;
import org.bcie.fenix.common.model.vo.TreEvidenciaAdquisicionVOImpl;
import org.bcie.fenix.common.model.vo.TreEvidenciaCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TreEvidenciaSolicitudVOImpl;
import org.bcie.fenix.common.model.vo.TreExcepcionSolicitudVOImpl;
import org.bcie.fenix.common.model.vo.TreTareaProcesoBpmVOImpl;
import org.bcie.fenix.common.model.vo.TreTcaEventoCondicionVOImpl;
import org.bcie.fenix.common.model.vo.TreVisibilidadVOImpl;
import org.bcie.fenix.common.model.vo.Tre_Componente_Cal_VOImpl;
import org.bcie.fenix.common.model.vo.Tre_Componente_Cal_VORowImpl;
import org.bcie.fenix.common.model.vo.Tre_Condicion_Financiera_Cal_VOImpl;
import org.bcie.fenix.common.model.vo.Tre_Condicion_Financiera_Cal_VORowImpl;
import org.bcie.fenix.common.model.vo.TreeCategoriaAccionGesVOImpl;
import org.bcie.fenix.common.model.vo.TreeCategoriaEnmiendaVOImpl;
import org.bcie.fenix.common.model.vo.TreeTcaEventoEnmiendaImpl;
import org.bcie.fenix.common.model.vo.UsuReunionRolBPMLOVImpl;
import org.bcie.fenix.common.model.vo.UsuarioReunionAprobacionLOVImpl;
import org.bcie.fenix.common.model.vo.UsuarioReunionAprobacionLOVRowImpl;
import org.bcie.fenix.common.model.vo.UsuarioReunionAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.ValidaCondicionVOImpl;
import org.bcie.fenix.common.model.vo.ValidaDocOperTareaLOVImpl;
import org.bcie.fenix.common.model.vo.ValidaProcesoIniciadoByOperacionVOImpl;
import org.bcie.fenix.common.model.vo.ValidacionCondicionVOImpl;
import org.bcie.fenix.common.model.vo.ValidarAccionClienteVOImpl;
import org.bcie.fenix.common.model.vo.ValidarClienteScrVOImpl;
import org.bcie.fenix.common.model.vo.ValidarClienteTipoDocumentoVOImpl;
import org.bcie.fenix.common.model.vo.ValidarCondicionProcesoActivoVOImpl;
import org.bcie.fenix.common.model.vo.ValidarEstadoCondicionesVOImpl;
import org.bcie.fenix.common.model.vo.ValidarOperacionTareaTipoDocumentoVOImpl;
import org.bcie.fenix.common.model.vo.ValidarTareaMensajesVOImpl;
import org.bcie.fenix.common.model.vo.VencimientoPlazoVOImpl;
import org.bcie.fenix.common.model.vo.VencimientoPlazoVORowImpl;
import org.bcie.fenix.common.model.vo.VencimientosLineaCreditoVOImpl;
import org.bcie.fenix.common.model.vo.VencimientosLineaCreditoVORowImpl;
import org.bcie.fenix.common.model.vo.VotoActualAprobLOVImpl;
import org.bcie.fenix.common.model.vo.VotoActualAprobLOVRowImpl;
import org.bcie.fenix.common.model.vo.VotoAprobacionLOVImpl;
import org.bcie.fenix.common.model.vo.VotoAprobacionVOImpl;
import org.bcie.fenix.common.model.vo.VotoAprobacionVORowImpl;
import org.bcie.fenix.common.model.vo.common.ComisionEnmendadaVO;
import org.bcie.fenix.common.model.vo.common.ComisionRegistradaFlexVO;
import org.bcie.fenix.common.model.vo.common.ComisionTreeVO;
import org.bcie.fenix.common.model.vo.consultarconfigcondicionesfinancieras.TcaTareaConBtnDinVOImpl;
import org.bcie.fenix.common.model.vo.common.CondicionGeneralPorValidarVO;
import org.bcie.fenix.common.model.vo.gestioncuestionarios.GestionCuestionariosVOImpl;
import org.bcie.fenix.common.model.vo.validarClienteTipoDocumentoYMimeTypeVOImpl;
import org.bcie.fenix.common.model.vo.vtaEvaluacionesVOImpl;
import org.bcie.lineacreditobo.Flexcube;
import org.bcie.lineacreditobo.LineaCredito;
import org.bcie.lineacreditobo.ObjectFactory;
import org.bcie.lineacreditomo.ActualizarContratoLineaCreditoRequestType;
import org.bcie.lineacreditomo.ActualizarContratoLineaCreditoResponseType;
import org.bcie.lineacreditomo.PropagarLineaCreditoRequestType;
import org.bcie.lineacreditomo.PropagarLineaCreditoResponsetType;
import org.bcie.matriztccbo.ListaTCC;
import org.bcie.matriztccbo.ProcesarEnmiendaRequestType;
import org.bcie.matriztccbo.ProcesarEnmiendaResponseType;
import org.bcie.matriztccbo.TCC;
import org.bcie.matriztccbo.Tipo;
import org.bcie.matriztccmo.ActualizarEstadoTCCRequestType;
import org.bcie.matriztccmo.ActualizarEstadoTCCResponseType;
import org.bcie.matriztccmo.ActualizarTCCRequestType;
import org.bcie.matriztccmo.ActualizarTCCResponseType;
import org.bcie.matriztccmo.CrearReporteTCCRequestType;
import org.bcie.matriztccmo.CrearReporteTCCResponseType;
import org.bcie.matriztccmo.ValidarTCCRequestType;
import org.bcie.matriztccmo.ValidarTCCResponseType;
import org.bcie.matriztccservice.MatrizTCC12BndQSService; 
import org.bcie.matriztccservice.MatrizTCCPT; 
import org.bcie.operacionbo.AsociadasOperaciones;
import org.bcie.operacionbo.ClasificacionAmbiental;
import org.bcie.operacionbo.ClasificacionEstrategicaMultisectorial;
import org.bcie.operacionbo.ComponenteClasificacionAmbientalType;
import org.bcie.operacionbo.ComponenteClasificacionEstrategicaType;
import org.bcie.operacionbo.InsertClasificacionAmbiental;
import org.bcie.operacionbo.MontoOperacion;
import org.bcie.operacionbo.MontosOperacion;
import org.bcie.operacionbo.Operacion;
import org.bcie.operacionbo.OperacionBasicType;
import org.bcie.operacionmo.ActualizarOperacionRequestType;
import org.bcie.operacionmo.ActualizarOperacionResponseType;
import org.bcie.operacionmo.ConsultarOperacionByIdOperacionRequestType;
import org.bcie.operacionmo.ConsultarOperacionResponseType;
import org.bcie.operacionmo.CrearOperacionAsociadaRequestType;
import org.bcie.operacionmo.CrearOperacionAsociadaResponseType;
import org.bcie.operacionmo.CrearOperacionRequestType;
import org.bcie.operacionmo.CrearOperacionResponseType;
import org.bcie.operacionmo.ReactivarOperacionRequestType;
import org.bcie.operacionmo.ReactivarOperacionResponseType;
import org.bcie.productobo.Producto;
import org.bcie.resultbo.Resultado;
import org.bcie.resultbo.SuccessType;
import org.bcie.solicitudaprobacionbo.ListadoMiembroReunion;
import org.bcie.solicitudaprobacionbo.ListadoUsuariosReunion;
import org.bcie.solicitudaprobacionbo.MiembroReunion;
import org.bcie.solicitudaprobacionbo.SolicitudAprobacion;
import org.bcie.solicitudaprobacionbo.UsuarioReunion;
import org.bcie.solicitudaprobacionmo.ConfigurarSolicitudAprobacionRequestType;
import org.bcie.solicitudaprobacionmo.ConfigurarSolicitudAprobacionResponseType;
import org.bcie.solicitudaprobacionmo.CrearSolicitudAprobacionRequestType;
import org.bcie.solicitudaprobacionmo.CrearSolicitudAprobacionResponseType;
import org.bcie.terminobo.Termino;
import org.bcie.usuariobo.ListaGrupos;
import org.bcie.usuariobo.ListaNombres;
import org.bcie.usuariobo.ListaUsuarios;
import org.bcie.usuariobo.Usuario;
import org.bcie.usuariomo.ConsultarAtributosUsuarioRequestType;
import org.bcie.usuariomo.ConsultarAtributosUsuarioResponseType;
import org.bcie.xmlns.objetoproceso.comun.cliente.v1.ClienteType;
import org.bcie.xmlns.objetoproceso.comun.header.v1.Header;
import org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType;
import org.bcie.xmlns.objetoproceso.comun.tarea.v1.Tarea;
import org.bcie.fenix.common.model.vo.consultarconfigcondicionesfinancieras.clases.TablaDinamicaVOBean;
import org.bcie.fenix.common.model.vo.consultarconfigcondicionesfinancieras.common.TcaTareaConBtnDinVO;
import org.bcie.fenix.common.model.vo.common.CondicionesFinancierasVO;
import org.bcie.fenix.common.model.vo.consultarconfigcondicionesfinancieras.TcaTareaConBtnDinVOImpl;
import org.bcie.fenix.common.model.vo.consultarconfigcondicionesfinancieras.clases.TablaDinamicaVOBean;
import org.bcie.fenix.common.model.vo.gestioncuestionarios.GestionCuestionariosVORowImpl;
import org.bcie.lineacreditobo.TBILineaCreditoCollection;
import org.bcie.lineacreditobo.TBILineaCreditoType;
import org.bcie.lineacreditomo.TBILineaCreditoRequestType;
import org.bcie.lineacreditomo.TBILineaCreditoResponseType;
import org.bcie.seguridadmo.ObtienePermisosUsuarioRequestType;
import org.bcie.seguridadmo.ObtienePermisosUsuarioResponseType;
import org.bcie.seguridadmo.PERMISOTYPE;

// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Mon Aug 10 19:00:52 CDT 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class FenixAMImpl extends ApplicationModuleImpl implements FenixAM {

    private static ADFLogger logger = null;
    private static final Integer ESTADO_VALIDACION_CONDICION = 1;
    public static final String NOMBRE_USUARIO_OTRO = "Otro";
    public static final String NOMBRE_USUARIO_EXCUSADO = "Excusado";
    public static final String NOMBRE_USUARIO_OTRO_AUX = "(otro)";
    public static final String NOMBRE_USUARIO_EXCUSADO_AUX = "(excusado)";

    /**
     * This is the default constructor (do not remove).
     */
    public FenixAMImpl() {

        if (logger == null) {
            logger = ADFLogger.createADFLogger(this.getClass());
        }
    }
    
	/**
	Class Name.
	*/
	private static final String CLASS_NAME = FenixAMImpl.class.getName();

    /**
         * Método de prueba de ejecucón de VO asociadoo a US2012
         * @funtion: Visibilidad dinamica de botones
         * @restriccciones: metodo de pruebas (no funcional)
         * @since 11/05/2021
         * @by Raul Garcia / Krugers
         */
    public String invocaTcaTareaConBtnDinVo(String p_nombreTabla, Integer p_idTareaBpm){
        String mess = "Fallo";
        Map<String,TablaDinamicaVOBean> map = new HashMap <String,TablaDinamicaVOBean>();
        TcaTareaConBtnDinVOImpl vo = this.getTcaTareaConBtnDinVO1();
        map = vo.obtenerDatos(p_nombreTabla, p_idTareaBpm);
        if(!map.isEmpty()){
            mess = "Exito";
            //vo.imprimirTca(map);
        }
        
       return mess;
    }
      
    /** CONDICIONES APROBACION **/
    public void crearCondicionAprobacionCaptura() {
        logger.warning("crearCondicionAprobacionCaptura ");
        RegistrarCondicionAprobacionVOImpl condicionAprobacionVO =
            (RegistrarCondicionAprobacionVOImpl) this.getRegistrarCondicionAprobacionVO();
        RegistrarCondicionAprobacionActionsVOImpl condicionAprobacionActionsVO =
            (RegistrarCondicionAprobacionActionsVOImpl) getRegistrarCondicionAprobacionActionsVO();

        Integer id = condicionAprobacionActionsVO.getNewId();
        logger.warning("id:  " + id);

        Integer idTareBpm = new Integer(ASIGNA_TAREA_BPM_ACTUALIZA_TCC); //Asigna Tarea BPM de Actualizar TCC
        condicionAprobacionVO.agregarCondicion(id, idTareBpm);

        getTcaCategoriaCondicionVO().buscarCategoriaCondicionActivos();
        getTcaEventoCondicionLOV().buscarEventosCondicionActivos();
    }

    @SuppressWarnings("unchecked")
    public void aceptarCondicionAprobacionAgregadaModificada(Integer piId, List pCategoriaCondList,
                                                             List pEventosCondList) {
        RegistrarCondicionAprobacionVOImpl condicionAprobacionVO =
            (RegistrarCondicionAprobacionVOImpl) this.getRegistrarCondicionAprobacionVO();
        RegistrarCondicionAprobacionActionsVOImpl condicionAprobacionActionsVO =
            (RegistrarCondicionAprobacionActionsVOImpl) getRegistrarCondicionAprobacionActionsVO();

        Row rowCondicion = condicionAprobacionVO.obtenerRowCondicion(piId);

        if (rowCondicion != null) {

            Integer idTareBpm = new Integer(ASIGNA_TAREA_BPM_ACTUALIZA_TCC); //Asigna Tarea BPM de Actualizar TCC
            rowCondicion.setAttribute(RegistrarCondicionAprobacionVORowImpl.IDTAREABPM, idTareBpm);

            condicionAprobacionActionsVO.actualizarCondicionActionVO(rowCondicion, idTareBpm);

            if (pCategoriaCondList != null) {
                //Asigna la lista de Id de Catalogo de Condiciones
                condicionAprobacionVO.asignarIdCategoriaCondicionList(rowCondicion, pCategoriaCondList);
                condicionAprobacionActionsVO.asignarIdCategoriaCondicionList((RegistrarCondicionAprobacionVORowImpl) rowCondicion,
                                                                             pCategoriaCondList);
            } else {
                logger.severe("Lista de Id de Categoria Condicion no recibida");
            }

            if (pEventosCondList != null) {
                //Asigna la lista de Id de Evento de Condiciones
                condicionAprobacionVO.asignarIdEventoCondicionList(rowCondicion, pEventosCondList);
                condicionAprobacionActionsVO.asignarIdEventoCondicionList((RegistrarCondicionAprobacionVORowImpl) rowCondicion,
                                                                          pEventosCondList);
            } else {
                logger.severe("Lista de Id de Eventos Condicion no recibida");
            }

            condicionAprobacionVO.setCurrentRow(rowCondicion);
        } else {
            logger.severe("Registro de condicion no encontrado. Id: " + piId);
        }
    }

    public void cancelarCondicionAprobacionCaptura(Integer piId) {
        RegistrarCondicionAprobacionVOImpl condicionAprobacionVO =
            (RegistrarCondicionAprobacionVOImpl) this.getRegistrarCondicionAprobacionVO();

        condicionAprobacionVO.eliminarComision(piId);
    }

    public void cancelarCondicionAprobacionEdicion(Integer piId) {
        RegistrarCondicionAprobacionVOImpl condicionAprobacionVO =
            (RegistrarCondicionAprobacionVOImpl) this.getRegistrarCondicionAprobacionVO();
        RegistrarCondicionAprobacionActionsVOImpl condicionAprobacionActionsVO =
            (RegistrarCondicionAprobacionActionsVOImpl) getRegistrarCondicionAprobacionActionsVO();

        Row condicionAprobacionActionsVORow = condicionAprobacionActionsVO.obtenerRowCondicionAction(piId);

        condicionAprobacionVO.restablecerValoresComision(piId, condicionAprobacionActionsVORow);
    }

    public void eliminarCondicionAprobacion(Integer piId) {
        RegistrarCondicionAprobacionVOImpl condicionAprobacionVO =
            (RegistrarCondicionAprobacionVOImpl) this.getRegistrarCondicionAprobacionVO();
        RegistrarCondicionAprobacionActionsVOImpl condicionAprobacionActionsVO =
            (RegistrarCondicionAprobacionActionsVOImpl) getRegistrarCondicionAprobacionActionsVO();

        Boolean esRegistroActivo = condicionAprobacionVO.eliminarComision(piId);

        if (esRegistroActivo) {
            condicionAprobacionActionsVO.eliminarCondicion(piId);
        } else {
            condicionAprobacionActionsVO.eliminarNuevaCondicion(piId);
        }
    }

    public void consultarCondicionAprobacion(Long plIdOperacion) {
        logger.warning("plIdOperacion: " + plIdOperacion);
        Date horaInicio = null;
        Date horaTermino = null;
        Long tiempoProcesoSegundos;
        SimpleDateFormat dateFormat = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;

        RegistrarFechaFormalizacionAprobacionVOImpl fechaAprobacionVO =
            (RegistrarFechaFormalizacionAprobacionVOImpl) getRegistrarFechaFormalizacionAprobacionVO();
        Row newFechaAprobacionRow = fechaAprobacionVO.inicializarRow();

        try {
            RegistrarCondicionAprobacionActionsVOImpl condicionAprobacionActionsVO =
                (RegistrarCondicionAprobacionActionsVOImpl) getRegistrarCondicionAprobacionActionsVO();
            RegistrarCondicionAprobacionVOImpl condicionAprobacionVO =
                (RegistrarCondicionAprobacionVOImpl) getRegistrarCondicionAprobacionVO();
            condicionAprobacionActionsVO.clearCache();
            condicionAprobacionVO.clearCache();
            String wsdl = getWsdl(IWsdlLocation.CONTRATO);

            Contrato12BndQSService contrato12BndQSService =
                IWsdlLocation.Service.getInstance(Contrato12BndQSService.class, wsdl);
            ContratoPT contratoPT = contrato12BndQSService.getContrato12BndQSPort();
            ConsultarPlazoCondicionRequestType plazoCondicionRequest = new ConsultarPlazoCondicionRequestType();
            plazoCondicionRequest.setIdOperacion(plIdOperacion);


            dateFormat = new SimpleDateFormat("HH:mm:ss");
            horaInicio = new GregorianCalendar().getTime();
            logger.log(ADFLogger.WARNING, ">HNWS" + "Start invocando Servicio - Consultar Condicion Aprobacion-");
            logger.log(ADFLogger.WARNING, ">HNWS" + "Hora de inicio: " + dateFormat.format(horaInicio.getTime()));
            xmlEntrada = this.writeXMLRequest(plazoCondicionRequest, plazoCondicionRequest.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

            ConsultarPlazoCondicionResponseType plazoCondicionResponse =
                contratoPT.consultarPlazoCondicion(plazoCondicionRequest);

            horaTermino = new GregorianCalendar().getTime();
            tiempoProcesoSegundos = (horaTermino.getTime() - horaInicio.getTime()) / CONVERTIR_MILISEGUNDOS_SEGUNDOS;
            logger.log(ADFLogger.WARNING, ">HNWS" + "Tiempo de proceso en segundos: " + tiempoProcesoSegundos);
            logger.log(ADFLogger.WARNING, ">HNWS" + "Respuesta servicio - Consultar Condicion Aprobacion -");
            xmlSalida = this.writeXMLRequest(plazoCondicionResponse, plazoCondicionResponse.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

            if (null != plazoCondicionResponse.getResult() && plazoCondicionResponse.getResult().getResult() != null &&
                plazoCondicionResponse.getResult().getResult().toString().equalsIgnoreCase("OK")) {
                Integer idTareBpm = new Integer(ASIGNA_TAREA_BPM_ACTUALIZA_TCC); //Asigna Tarea BPM de Actualizar TCC
                condicionAprobacionVO.cargarCondiciones(plazoCondicionResponse, idTareBpm);
                condicionAprobacionActionsVO.cargarCondiciones(plazoCondicionResponse);
                fechaAprobacionVO.cargarFechaAprobacion(plazoCondicionResponse, newFechaAprobacionRow);
            } else {

                String msg = "ERROR";

                if (null != plazoCondicionResponse.getResult())
                    msg = plazoCondicionResponse.getResult().getMessage();

                throw new Exception("WS Aprobacion Error:  " + msg);
            }

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al consultar Condiciones, favor de intentar más tarde."));
            throw ex;
        }

    }

    public void crearActualizarCondicionAprobacion(Long plIdOperacion) {
        logger.warning("plIdOperacion: " + plIdOperacion);
        Date horaInicio = null;
        Date horaTermino = null;
        Long tiempoProcesoSegundos;
        SimpleDateFormat dateFormat = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;
        try {
            RegistrarCondicionAprobacionActionsVOImpl condicionAprobacionActionsVO =
                (RegistrarCondicionAprobacionActionsVOImpl) getRegistrarCondicionAprobacionActionsVO();
            String wsdl = getWsdl(IWsdlLocation.CONTRATO);

            Contrato12BndQSService contrato12BndQSService =
                IWsdlLocation.Service.getInstance(Contrato12BndQSService.class, wsdl);
            ContratoPT contratoPT = contrato12BndQSService.getContrato12BndQSPort();
            ActualizarTCCAprobacionRequestType actualizarTCCAprobacionReq = new ActualizarTCCAprobacionRequestType();

            Termino terminoReq = mapearInfoTermino();

            actualizarTCCAprobacionReq.setIdOperacion(plIdOperacion);
            actualizarTCCAprobacionReq.setTermino(terminoReq);

            Integer idTareBpm =
                new Integer(ASIGNA_TAREA_BPM_ACTUALIZA_TCC); //Asigna Id de Tarea BPM de la tarea Actualizar TCC
            condicionAprobacionActionsVO.setCondicionesResquest(actualizarTCCAprobacionReq.getCondicion(), idTareBpm);

            dateFormat = new SimpleDateFormat("HH:mm:ss");
            horaInicio = new GregorianCalendar().getTime();
            logger.log(ADFLogger.WARNING, ">HNWS" + "Start invocando Servicio - Actualizar Condicion Aprobacion-");
            logger.log(ADFLogger.WARNING, ">HNWS" + "Hora de inicio: " + dateFormat.format(horaInicio.getTime()));
            xmlEntrada = this.writeXMLRequest(actualizarTCCAprobacionReq, actualizarTCCAprobacionReq.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

            ActualizarTCCAprobacionResponseType actualizarTCCAprobacionRes =
                contratoPT.actualizarTCCAprobacion(actualizarTCCAprobacionReq);

            horaTermino = new GregorianCalendar().getTime();
            tiempoProcesoSegundos = (horaTermino.getTime() - horaInicio.getTime()) / CONVERTIR_MILISEGUNDOS_SEGUNDOS;
            logger.log(ADFLogger.WARNING, ">HNWS" + "Tiempo de proceso en segundos: " + tiempoProcesoSegundos);
            logger.log(ADFLogger.WARNING, ">HNWS" + "Respuesta servicio - Actualizar Condicion Aprobacion -");
            xmlSalida = this.writeXMLRequest(actualizarTCCAprobacionRes, actualizarTCCAprobacionRes.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

            if (actualizarTCCAprobacionRes != null && null != actualizarTCCAprobacionRes.getResultado() &&
                actualizarTCCAprobacionRes.getResultado().getResult() != null &&
                actualizarTCCAprobacionRes.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                consultarCondicionAprobacion(plIdOperacion);
            } else {
                String msg = "ERROR";

                if (null != actualizarTCCAprobacionRes.getResultado())
                    msg = actualizarTCCAprobacionRes.getResultado().getMessage();

                throw new Exception("WS Aprobacion Error: RESULT " + msg);
            }

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en la creacion/actualizacion de Condiciones, favor de intentar más tarde."));
            throw ex;
        }
    }

    private Termino mapearInfoTermino() {
        RegistrarFechaFormalizacionAprobacionVOImpl fechaFormalizacionVO = getRegistrarFechaFormalizacionAprobacionVO();
        Row rowFechaFormalizacionRow = fechaFormalizacionVO.getCurrentRow();

        Termino termino = new Termino();
        Catalogo tipoFechaInicio = new Catalogo();
        Catalogo tipoFrecuenciaPlazo = new Catalogo();

        if (rowFechaFormalizacionRow != null) {

            if (null != rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.IDTERMINO))
                termino.setIdTermino((Long) rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.IDTERMINO));

            if (null !=
                rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.TIPOFECHAINICIOID))
                tipoFechaInicio.setId(((oracle.jbo.domain.Number) rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.TIPOFECHAINICIOID)).longValue());

            if (null !=
                rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.TIPOPLAZOID))
                tipoFrecuenciaPlazo.setId(((oracle.jbo.domain.Number) rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.TIPOPLAZOID)).longValue());

            if (null != rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.PLAZO))
                termino.setPlazo((Integer) rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.PLAZO));

            try {
                GregorianCalendar cFechaInicio = new GregorianCalendar();
                cFechaInicio.setTime(((oracle.jbo.domain.Date) rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.FECHAINICIO)).getValue());
                termino.setFechaInicio(DatatypeFactory.newInstance().newXMLGregorianCalendar(cFechaInicio));
            } catch (Exception ex) {
                logger.log(ADFLogger.ERROR, ex.getClass() + ":" + ex.getMessage());
            }

            Boolean estado = null;
            try {
                estado =
                    (Boolean) rowFechaFormalizacionRow.getAttribute(RegistrarFechaFormalizacionAprobacionVORowImpl.ESTADO);
            } catch (Exception e) {
                logger.severe("Error no se obtuvo atributo estado del registro de Termino", e);
            }

            if (estado != null) {
                termino.setEstado(estado);
            } else {
                termino.setEstado(true);
            }

            termino.setTipoFechaInicio(tipoFechaInicio);
            termino.setFrecuenciaPlazo(tipoFrecuenciaPlazo);
        } else {
            logger.severe("Registro de Datos de Termino no encontrado");
        }

        return termino;
    }

    /** COMISIIONES APROBACION **/

    /** LINEAS APROBACION **/
    public void agregarLineaAprobacion(String psNumeroLinea, String psDecripcion, BigDecimal pdMonto) {
	logger.warning("Invocación directa de agregarLineaAprobacion sin tipo moneda.");
        //metodo original no tenia tipo moneda, por ello envia nulo
        this.agregarLineaAprobacion(psNumeroLinea, psDecripcion, pdMonto, null);
    }

    /**
     * [KB:13306]
     * LINEAS APROBACION
     * Sobrecarga para recibir tipo moneda.
     */
    public void agregarLineaAprobacion(String psNumeroLinea, String psDecripcion, BigDecimal pdMonto, Integer piIdTipoMoneda) {
        logger.entering(FenixAMImpl.class.getName(), "agregarLineaAprobacion", new Object[]{psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda});
        
        RegistrarLineaCreditoAprobacionVOImpl lineaCreditoAprobacionVO =
            (RegistrarLineaCreditoAprobacionVOImpl) this.getRegistrarLineaCreditoAprobacionVO();
        RegistrarLineaCreditoAprobacionActionsVOImpl lineaCreditoAprobacionActionsVO =
            (RegistrarLineaCreditoAprobacionActionsVOImpl) this.getRegistrarLineaCreditoAprobacionActionsVO();

        Integer id = lineaCreditoAprobacionActionsVO.getNewId();

        lineaCreditoAprobacionVO.agregarLinea(id, psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda);
        lineaCreditoAprobacionActionsVO.actualizarLineaActionVO(id, null, psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda);
        
        logger.exiting(FenixAMImpl.class.getName(), "agregarLineaAprobacion");
    }

    public void eliminarLineaAprobacion(Integer piIdLinea) {
        RegistrarLineaCreditoAprobacionVOImpl lineaCreditoAprobacionVO =
            (RegistrarLineaCreditoAprobacionVOImpl) this.getRegistrarLineaCreditoAprobacionVO();
        RegistrarLineaCreditoAprobacionActionsVOImpl lineaCreditoAprobacionActionsVO =
            (RegistrarLineaCreditoAprobacionActionsVOImpl) this.getRegistrarLineaCreditoAprobacionActionsVO();

        lineaCreditoAprobacionVO.eliminarLinea(piIdLinea);
        lineaCreditoAprobacionActionsVO.eliminarLineaAction(piIdLinea);

    }

    public void modificarLineaAprobacion(Integer piId, String psNumeroLinea, String psDecripcion, BigDecimal pdMonto) {
	logger.warning("Invocación directa de modificarLineaAprobacion sin tipo moneda.");
        //metodo original no tenia tipo moneda, por ello envia nulo
        this.modificarLineaAprobacion(piId, psNumeroLinea, psDecripcion, pdMonto, null);
    }

    /**
     * [KB:13306]
     * LINEAS APROBACION
     * Sobrecarga para recibir tipo moneda.
     */
    public void modificarLineaAprobacion(Integer piId, String psNumeroLinea, String psDecripcion, BigDecimal pdMonto, Integer piIdTipoMoneda) {
        logger.entering(FenixAMImpl.class.getName(), "modificarLineaAprobacion", new Object[]{piId, psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda});
        RegistrarLineaCreditoAprobacionVOImpl lineaCreditoAprobacionVO =
            (RegistrarLineaCreditoAprobacionVOImpl) this.getRegistrarLineaCreditoAprobacionVO();
        RegistrarLineaCreditoAprobacionActionsVOImpl lineaCreditoAprobacionActionsVO =
            (RegistrarLineaCreditoAprobacionActionsVOImpl) this.getRegistrarLineaCreditoAprobacionActionsVO();

        lineaCreditoAprobacionVO.modificarLinea(piId, psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda);
        lineaCreditoAprobacionActionsVO.actualizarLineaActionVO(piId, null, psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda);
        
        logger.exiting(FenixAMImpl.class.getName(), "modificarLineaAprobacion");
    }

    /**
     * Realiza la consulta de datos para la solicitud de aprobacion via Web Services
     * @param plIdOperacion contiene id de operacion
     * @param piIdSolicitudAprobacion contiene id de solicitud de aprobacion
     * @param piIdNivelAprobacion contiene id de nivel de aprobacion
     * @param piTipoSolicitud contiene id de tipo solicitud
     */
    public void consultarAprobacion(Long plIdOperacion, Long piIdSolicitudAprobacion, Integer piIdNivelAprobacion,
                                    Integer piTipoSolicitud) {
        logger.entering(FenixAMImpl.class.getName(), "consultarAprobacion", new Object[] {
                        plIdOperacion, piIdSolicitudAprobacion, piIdNivelAprobacion, piTipoSolicitud
        });

        logger.warning("plIdOperacion: " + plIdOperacion);
        logger.warning("piIdSolicitudAprobacion: " + piIdSolicitudAprobacion);
        logger.warning("piIdNivelAprobacion: " + piIdNivelAprobacion);
        logger.warning("piTipoSolicitud: " + piTipoSolicitud);
        Date horaInicio = null;
        Date horaTermino = null;
        Long tiempoProcesoSegundos;
        SimpleDateFormat dateFormat = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;

        RegistrarDatosAprobacionVOImpl aprobacionVO =
            (RegistrarDatosAprobacionVOImpl) this.getRegistrarDatosAprobacionVO();
        Row newAprobacionRow = aprobacionVO.inicializarRow(piIdNivelAprobacion, piTipoSolicitud);

        try {
            RegistrarLineaCreditoAprobacionVOImpl lineaCreditoAprobacionVO =
                (RegistrarLineaCreditoAprobacionVOImpl) this.getRegistrarLineaCreditoAprobacionVO();
            RegistrarLineaCreditoAprobacionActionsVOImpl lineaCreditoAprobacionActionsVO =
                (RegistrarLineaCreditoAprobacionActionsVOImpl) this.getRegistrarLineaCreditoAprobacionActionsVO();
            lineaCreditoAprobacionVO.clearCache();
            lineaCreditoAprobacionActionsVO.clearCache();

            String wsdl = getWsdl(IWsdlLocation.APROBACION);

            Aprobacion aprobacion = IWsdlLocation.Service.getInstance(Aprobacion.class, wsdl);
            AprobacionPT aprobacionPT = aprobacion.getAprobacion12Bnd();
            ConsultarAprobacionRequestType aprobacionRequest = new ConsultarAprobacionRequestType();
            aprobacionRequest.setIdSolicitudAprobacion(piIdSolicitudAprobacion);
            aprobacionRequest.setIdOperacion(plIdOperacion);

            dateFormat = new SimpleDateFormat("HH:mm:ss");
            horaInicio = new GregorianCalendar().getTime();
            logger.log(ADFLogger.WARNING, ">HNWS" + "Start invocando Servicio - Consultar Aprobacion-");
            logger.log(ADFLogger.WARNING, ">HNWS" + "Hora de inicio: " + dateFormat.format(horaInicio.getTime()));
            xmlEntrada = this.writeXMLRequest(aprobacionRequest, aprobacionRequest.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

            ConsultarAprobacionResponseType aprobacionResponse = aprobacionPT.consultarAprobacion(aprobacionRequest);

            horaTermino = new GregorianCalendar().getTime();
            tiempoProcesoSegundos = (horaTermino.getTime() - horaInicio.getTime()) / CONVERTIR_MILISEGUNDOS_SEGUNDOS;
            logger.log(ADFLogger.WARNING, ">HNWS" + "Tiempo de proceso en segundos: " + tiempoProcesoSegundos);
            logger.log(ADFLogger.WARNING, ">HNWS" + "Respuesta servicio - Consultar Aprobacion -");
            xmlSalida = this.writeXMLRequest(aprobacionResponse, aprobacionResponse.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

            if (null != aprobacionResponse.getResultado().getResult() &&
                aprobacionResponse.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                BigDecimal montoAprob = null;
                montoAprob = aprobacionResponse.getAprobacion().getMontoAprobacion();
                if (montoAprob == null) {
                    logger.warning("El Monto de Aprobacion obtenido por Web Service es null. Id Operacion: " +
                                   plIdOperacion + " Id Solicitud: " + piIdSolicitudAprobacion);
                }

                lineaCreditoAprobacionVO.cargarLineas(aprobacionResponse);
                lineaCreditoAprobacionActionsVO.cargarLineas(aprobacionResponse);

                if (null != aprobacionResponse.getAprobacion() &&
                    aprobacionResponse.getAprobacion().getIdAprobacion() > 0) {
                    aprobacionVO.getCargarAprobacion(aprobacionResponse, newAprobacionRow);
                }

                logger.warning("Termina de cargar los datos de la solicitud de aprobacion que provienen de Web Services");
            } else {
                String msg = "ERROR";

                if (null != aprobacionResponse.getResultado())
                    msg = aprobacionResponse.getResultado().getMessage();

                throw new Exception("WS Aprobacion Error: RESULT " + msg);
            }
        } catch (Exception e) {
            logger.warning("Ha ocurrido una exception ->", e);

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al consultar la Aprobacion, favor de intentar más tarde."));
            throw ex;
        }

        //Realiza la busqueda del Row de Solicitud
        logger.warning("Realiza busqueda de Solicitud de Aprobacion. Id Solicitud: " + piIdSolicitudAprobacion);
        getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorIdVC(new Number(piIdSolicitudAprobacion));

        SolicitudAprobacionVORowImpl solicitudAprobacionRow =
            (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();

        if (solicitudAprobacionRow != null) {
            try {
                UsuarioReunionAprobacionLOVImpl usuarioReunionVO = getUsuarioReunionAprobacionLOV();

                logger.warning("Inicializa la busqueda de Ids de Usuario Reunion Aprobacion");
                getUsuarioReunionAprobacionLOV().consultarUsuarioReunionPorIdSolicitud(piIdSolicitudAprobacion);
                logger.warning("Cantidad de registros encontrados de Usuario Reunion Aprobacion: " +
                               getUsuarioReunionAprobacionLOV().getEstimatedRowCount());

                RowSetIterator rowsUsuarioReunion = usuarioReunionVO.createRowSetIterator(null);
                List<UsuarioReunionAprobacionLOVRowImpl> listaIdUsuarioReunion = new ArrayList<>();

                while (rowsUsuarioReunion.hasNext()) {
                    UsuarioReunionAprobacionLOVRowImpl rowUsuario =
                        (UsuarioReunionAprobacionLOVRowImpl) rowsUsuarioReunion.next();
                    listaIdUsuarioReunion.add(rowUsuario);
                }

                rowsUsuarioReunion.closeRowSetIterator();

                logger.warning("Consulta los votos de la reunion");
                getVotoActualAprobLOV1().obtenerVotosReunion(listaIdUsuarioReunion);
            } catch (Exception e) {
                logger.severe("Error al inicializar los votos de la reunion");
            }

            //Realiza la busqueda de registros de Decision Aprobacion
            getDecisionReunionAprobacionVO().buscarDecisionPorIdSolicitud(solicitudAprobacionRow.getId());
            if (getDecisionReunionAprobacionVO().getEstimatedRowCount() > 0) {
                logger.warning("Cantidad de registros de Decision Aprobacion: " +
                               getDecisionReunionAprobacionVO().getEstimatedRowCount());
            } else {
                logger.severe("No se encontraron registros de Decision Aprobacion");
            }
        }

        logger.exiting(FenixAMImpl.class.getName(), "consultarAprobacion");
    }

    public void generarAprobacion(Long plIdOperacion, Long piIdSolicitudAprobacion) {

        logger.warning("Entra en generarAprobacion.");
        Map<String, Object> map = new HashMap<String, Object>();
        Date horaInicio = null;
        Date horaTermino = null;
        Long tiempoProcesoSegundos;
        SimpleDateFormat dateFormat = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;
        org.bcie.aprobacionbo.UsuarioReunion usuarioReunion = new org.bcie.aprobacionbo.UsuarioReunion();
        String pUsuario = null;
        String nombreUsuario = null;
        try {
            pUsuario = this.getUserPrincipalName();
            logger.warning("pUsuario : " + pUsuario);
            map = consultarAtributosUsuario(pUsuario);
            nombreUsuario = (String) map.get("nombreUsuario");
            logger.warning("nombreUsuario : " + nombreUsuario);
            usuarioReunion.setUsuario(pUsuario);
            usuarioReunion.setNombreUsuario(nombreUsuario);

            String wsdl = getWsdl(IWsdlLocation.APROBACION);

            Aprobacion aprobacion = IWsdlLocation.Service.getInstance(Aprobacion.class, wsdl);
            AprobacionPT aprobacionPT = aprobacion.getAprobacion12Bnd();
            CrearAprobacionRequestType crearOperacionRequest = new CrearAprobacionRequestType();
            org.bcie.aprobacionbo.Aprobacion aprobacionReq = mapearAprobacion(plIdOperacion, piIdSolicitudAprobacion);
            aprobacionReq.setLoginUsuario(usuarioReunion);
            crearOperacionRequest.setAprobacion(aprobacionReq);

            dateFormat = new SimpleDateFormat("HH:mm:ss");
            horaInicio = new GregorianCalendar().getTime();
            logger.log(ADFLogger.WARNING, ">HNWS" + "Start invocando Servicio - Crear Aprobacion-");
            logger.log(ADFLogger.WARNING, ">HNWS" + "Hora de inicio: " + dateFormat.format(horaInicio.getTime()));
            xmlEntrada = this.writeXMLRequest(crearOperacionRequest, crearOperacionRequest.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

            CrearAprobacionResponseType crearAprobacionResponse = aprobacionPT.crearAprobacion(crearOperacionRequest);

            horaTermino = new GregorianCalendar().getTime();
            tiempoProcesoSegundos = (horaTermino.getTime() - horaInicio.getTime()) / CONVERTIR_MILISEGUNDOS_SEGUNDOS;
            logger.log(ADFLogger.WARNING, ">HNWS" + "Tiempo de proceso en segundos: " + tiempoProcesoSegundos);
            logger.log(ADFLogger.WARNING, ">HNWS" + "Respuesta servicio - Crear Aprobacion -");
            xmlSalida = this.writeXMLRequest(crearAprobacionResponse, crearAprobacionResponse.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

            //Limpiar y volver a consultar Datos de Lineas para actualizar Id de lineas
            if (crearAprobacionResponse != null && crearAprobacionResponse.getResultado() != null &&
                null != crearAprobacionResponse.getResultado().getResult() &&
                crearAprobacionResponse.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                consultarAprobacion(plIdOperacion, piIdSolicitudAprobacion, null, null);
            } else {
                String msg = "ERROR";

                if (crearAprobacionResponse != null && null != crearAprobacionResponse.getResultado())
                    msg = crearAprobacionResponse.getResultado().getMessage();

                throw new Exception("WS Aprobacion Error: RESULT " + msg);
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al crear la Aprobacion, favor de intentar más tarde."));
            throw ex;
        }
    }

    public void modificarAprobacion(Long plIdOperacion, Long piIdSolicitudAprobacion) {
        Date horaInicio = null;
        Date horaTermino = null;
        Long tiempoProcesoSegundos;
        SimpleDateFormat dateFormat = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;
        String pUsuario = null;
        String nombreUsuario = null;
        Map<String, Object> map = new HashMap<String, Object>();
        org.bcie.aprobacionbo.UsuarioReunion usuarioReunion = new org.bcie.aprobacionbo.UsuarioReunion();


        try {

            pUsuario = this.getUserPrincipalName();
            logger.warning("pUsuario : " + pUsuario);
            map = consultarAtributosUsuario(pUsuario);
            nombreUsuario = (String) map.get("nombreUsuario");
            logger.warning("nombreUsuario : " + nombreUsuario);
            usuarioReunion.setUsuario(pUsuario);
            usuarioReunion.setNombreUsuario(nombreUsuario);

        } catch (Exception e) {
            logger.warning("Ha ocurrio un error al recuperar los datos del usuario->", e);
        }


        try {
            String wsdl = getWsdl(IWsdlLocation.APROBACION);

            Aprobacion aprobacion = IWsdlLocation.Service.getInstance(Aprobacion.class, wsdl);
            AprobacionPT aprobacionPT = aprobacion.getAprobacion12Bnd();
            ActualizarAprobacionRequestType actualizarAprobacionReq = new ActualizarAprobacionRequestType();
            org.bcie.aprobacionbo.Aprobacion aprobacionReq = mapearAprobacion(plIdOperacion, piIdSolicitudAprobacion);
            aprobacionReq.setLoginUsuario(usuarioReunion);
            actualizarAprobacionReq.setAprobacion(aprobacionReq);

            dateFormat = new SimpleDateFormat("HH:mm:ss");
            horaInicio = new GregorianCalendar().getTime();
            logger.log(ADFLogger.WARNING, ">HNWS" + "Start invocando Servicio - Actualizar Aprobacion-");
            logger.log(ADFLogger.WARNING, ">HNWS" + "Hora de inicio: " + dateFormat.format(horaInicio.getTime()));
            xmlEntrada = this.writeXMLRequest(actualizarAprobacionReq, actualizarAprobacionReq.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());


            ActualizarAprobacionResponseType actualizarAprobacionRes =
                aprobacionPT.actualizarAprobacion(actualizarAprobacionReq);

            horaTermino = new GregorianCalendar().getTime();
            tiempoProcesoSegundos = (horaTermino.getTime() - horaInicio.getTime()) / CONVERTIR_MILISEGUNDOS_SEGUNDOS;
            logger.log(ADFLogger.WARNING, ">HNWS" + "Tiempo de proceso en segundos: " + tiempoProcesoSegundos);
            logger.log(ADFLogger.WARNING, ">HNWS" + "Respuesta servicio - Actualizar Aprobacion -");
            xmlSalida = this.writeXMLRequest(actualizarAprobacionRes, actualizarAprobacionRes.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

            //Limpiar y volver a consultar Datos de Lineas para actualizar Id de lineas
            if (null != actualizarAprobacionRes.getResultado().getResult() &&
                actualizarAprobacionRes.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                consultarAprobacion(plIdOperacion, piIdSolicitudAprobacion, null, null);
            } else {
                String msg = "ERROR";

                if (null != actualizarAprobacionRes.getResultado())
                    msg = actualizarAprobacionRes.getResultado().getMessage();

                throw new Exception("WS Aprobacion Error: RESULT " + msg);

            }

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al actualizar la Aprobacion, favor de intentar más tarde."));
            throw ex;
        }

    }

    private org.bcie.aprobacionbo.Aprobacion mapearAprobacion(Long plIdOperacion, Long piIdSolicitudAprobacion) {
        RegistrarDatosAprobacionVOImpl aprobacionVO =
            (RegistrarDatosAprobacionVOImpl) this.getRegistrarDatosAprobacionVO();
        Row currentRow = aprobacionVO.getCurrentRow();
        org.bcie.aprobacionbo.Aprobacion aprobacionReq = new org.bcie.aprobacionbo.Aprobacion();

        DecisionReunionAprobacionVOImpl decisionAprobacionVO = getDecisionReunionAprobacionVO();
        ViewCriteria decisionReunionVC =
            decisionAprobacionVO.getViewCriteriaManager().getViewCriteria("DecisionReunionAprobacionPorIdSolVC");
        decisionReunionVC.ensureVariableManager().setVariableValue("pIdSolicitudAprob", piIdSolicitudAprobacion);
        decisionAprobacionVO.applyViewCriteria(decisionReunionVC);
        decisionAprobacionVO.executeQuery();

        DecisionReunionAprobacionVORowImpl decisionReunionRow =
            (DecisionReunionAprobacionVORowImpl) decisionAprobacionVO.getRowAtRangeIndex(0);

        aprobacionReq.setIdOperacion(plIdOperacion);
        if (decisionReunionRow != null && decisionReunionRow.getId() != null) {
            aprobacionReq.setIdReunionAprobacion(decisionReunionRow.getId().longValue()); //piIdSolicitudAprobacion - se busca en DecisionReunion el ID
        } else {
            logger.warning("La solicitud de aprobacion no cuenta con una decision reunion");
        }

        RegistrarLineaCreditoAprobacionActionsVOImpl lineaCreditoAprobacionActionsVO =
            (RegistrarLineaCreditoAprobacionActionsVOImpl) this.getRegistrarLineaCreditoAprobacionActionsVO();

        if (null != currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.APROBACIONID)) {
            aprobacionReq.setIdAprobacion((Long) currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.APROBACIONID));
        }

        try {
            aprobacionReq.setMontoAprobacion((BigDecimal) currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.MONTO));
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, ex.getClass() + ":" + ex.getMessage());
        }
		try {
            logger.log(ADFLogger.WARNING, "___Se validara el Id Tipo Moneda Aprobacion ");
            
            Integer idTcaTipoMonedaInteger = (Integer)currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.IDTCATIPOMONEDA);
            
            logger.log(ADFLogger.WARNING, "Id Tipo Moneda Aprobacion " + idTcaTipoMonedaInteger);
            BigInteger idTcaTipoMoneda = BigInteger.valueOf(idTcaTipoMonedaInteger);
            
            logger.log(ADFLogger.WARNING, "Id Tipo Moneda Aprobacion " + idTcaTipoMoneda);
            
            if(idTcaTipoMoneda != null) {
                logger.log(ADFLogger.WARNING, "Id Tipo Moneda Aprobacion " + idTcaTipoMoneda);
                aprobacionReq.setIdTipoMonedaMontoAprobacion(idTcaTipoMoneda);
            } else {
                logger.log(ADFLogger.WARNING, "Null Id Tipo Moneda Aprobacion ");
            }
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR,ex.getClass() + ":" + ex.getMessage());
        }
        try {
            GregorianCalendar cFechaAprobacion = new GregorianCalendar();
            cFechaAprobacion.setTime(((oracle.jbo.domain.Date) currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.FECHAAPROBACION)).getValue());
            aprobacionReq.setFechaAprobacion(DatatypeFactory.newInstance().newXMLGregorianCalendar(cFechaAprobacion));
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, ex.getClass() + ":" + ex.getMessage());
        }
        try {
            aprobacionReq.setNumeroResolucion((String) currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.NUMERORESOLUCION));
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, ex.getClass() + ":" + ex.getMessage());
        }

        try {
            aprobacionReq.setResumen((String) currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.RESUMEN));
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, ex.getClass() + ":" + ex.getMessage());
        }

        try {
            aprobacionReq.setIdContrato((Long) currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.CONTRATOID));
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, ex.getClass() + ":" + ex.getMessage());
        }

        lineaCreditoAprobacionActionsVO.setLineasRequest(aprobacionReq);

        return aprobacionReq;
    }

    /*
       * Se crea metodo para actualizar la accion a seguir para un nivel de aprobacion a Deirectorio
       * Se atiende FNXII-7417
       */
    public Boolean actualizarAccionASeguir(Long piIdSolicitudAprobacion) {

        logger.warning("Entra en actulizarAccionASeguir.");
        Boolean esActualizar = Boolean.FALSE;
        RegistrarDatosAprobacionVOImpl aprobacionVO =
            (RegistrarDatosAprobacionVOImpl) this.getRegistrarDatosAprobacionVO();
        Row currentRow = aprobacionVO.getCurrentRow();

        DecisionReunionAprobacionVOImpl decisionAprobacionVO = getDecisionReunionAprobacionVO();
        ViewCriteria decisionReunionVC =
            decisionAprobacionVO.getViewCriteriaManager().getViewCriteria("DecisionReunionAprobacionPorIdSolVC");
        decisionReunionVC.ensureVariableManager().setVariableValue("pIdSolicitudAprob", piIdSolicitudAprobacion);
        decisionAprobacionVO.applyViewCriteria(decisionReunionVC);
        decisionAprobacionVO.executeQuery();

        DecisionReunionAprobacionVORowImpl decisionReunionRow =
            (DecisionReunionAprobacionVORowImpl) decisionAprobacionVO.getRowAtRangeIndex(0);

        RegistrarLineaCreditoAprobacionActionsVOImpl lineaCreditoAprobacionActionsVO =
            (RegistrarLineaCreditoAprobacionActionsVOImpl) this.getRegistrarLineaCreditoAprobacionActionsVO();
        logger.warning("Valor de la accion a seguir que se actualiza : " +
                       currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.IDACCIONSEGUIR));
        if (null != currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.IDACCIONSEGUIR)) {
            oracle.jbo.domain.Number idTcaAccionSeguir = null;
            try {
                idTcaAccionSeguir =
                    (oracle.jbo.domain.Number) currentRow.getAttribute(RegistrarDatosAprobacionVORowImpl.IDACCIONSEGUIR);
                logger.warning("Valor de la accion a seguir que se actualiza : " + idTcaAccionSeguir);
                decisionReunionRow.setIdTcaAccionASeguir(idTcaAccionSeguir);
                getDBTransaction().commit();
                logger.warning("Se actualiza la accion a seguir correctmente");
                esActualizar = Boolean.TRUE;
            } catch (Exception e) {
                logger.warning("Error en actualizar la accion a seguir." + e);
            }

        }
        logger.warning("Termina actulizarAccionASeguir.");
        return esActualizar;
    }

    /** LINEAS APROBACION **/

    public void crearCalificacionInicialRiesgo(String idOperacion) {
        try {
            ViewObjectImpl calificacionInicialRiesgoVO = getCalificacionInicialRiesgoVO();

            if (null != calificacionInicialRiesgoVO) {
                if (null != calificacionInicialRiesgoVO.getAllRowsInRange() &&
                    calificacionInicialRiesgoVO.getAllRowsInRange().length > 0) {
                }

                logger.log(ADFLogger.WARNING, "EL ID DE OPERACION ES " + idOperacion);

                String wsdl = getWsdl(IWsdlLocation.OPERACION);

                Operacion12BndQSService operacion12BndQSService =
                    IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
                Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
                ConsultarOperacionByIdOperacionRequestType request = new ConsultarOperacionByIdOperacionRequestType();
                request.setIdOperacion(Long.parseLong(idOperacion));

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_CALIFICACION_INICIAL_RIESGO);
                ConsultarOperacionResponseType response = operacion12Port.consultarOperacionByIdOperacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_CALIFICACION_INICIAL_RIESGO,
                                    horaInicio);

                Operacion operacion = response.getOperacion().get(0);

                Row newRow = calificacionInicialRiesgoVO.createRow();

                newRow.setAttribute("Id", INIT_ATTR_ID);

                if (operacion.getSRC() == null) {
                    newRow.setAttribute("SCR", null);
                } else {
                    newRow.setAttribute("SCR", operacion.getSRC().getId());
                    newRow.setAttribute("DescripcionSCR", operacion.getSRC().getDescripcionCorta());
                }

                if (operacion.getTIR() == null) {
                    newRow.setAttribute("TIR", null);
                } else {
                    newRow.setAttribute("TIR", operacion.getTIR());
                }

                if (operacion.getPerspectiva() == null) {
                    newRow.setAttribute("Prespectiva", null);
                } else {
                    newRow.setAttribute("Prespectiva", operacion.getPerspectiva().getId());
                    newRow.setAttribute("DescripcionPerspectiva", operacion.getPerspectiva().getDescripcionCorta());
                }

                calificacionInicialRiesgoVO.insertRow(newRow);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public Row recuperarConfiguracionVisibilidad(Integer idProducto) {
        ConfigVisibilidadVORowImpl configVisibilidadRow = null;
        getConfigVisibilidadVO().clearCache();
        Row[] rowTreVisibilidad = getTreVisibilidadVO().getFilteredRows("IdCatProducto", idProducto);
        configVisibilidadRow = (ConfigVisibilidadVORowImpl) getConfigVisibilidadVO().createRow();
        for (Row row : rowTreVisibilidad) {
            Integer idCampo = Integer.valueOf(row.getAttribute("IdCampo").toString());
            switch (idCampo) {
            case COL_01:
                configVisibilidadRow.setDatosGenerales(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_02:
                configVisibilidadRow.setMontoTotal(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_03:
                configVisibilidadRow.setActividadEconomica(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_04:
                configVisibilidadRow.setIniciativaEstrategica(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_05:
                configVisibilidadRow.setObjetivoEstrategico(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_06:
                configVisibilidadRow.setAreaFocalizacion(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_07:
                configVisibilidadRow.setEjeEstrategico(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_08:
                configVisibilidadRow.setTipoGarantia(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_09:
                configVisibilidadRow.setComponenteConcesionalidad(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_10:
                configVisibilidadRow.setEstructurador(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_11:
                configVisibilidadRow.setBeneficiario(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_12:
                configVisibilidadRow.setPrograma(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_13:
                configVisibilidadRow.setOperacionesAsociadas(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_14:
                configVisibilidadRow.setRespondeCuestionario(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_15:
                configVisibilidadRow.setAnalisisLaft(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            case COL_16:
                configVisibilidadRow.setSectorMercado(PARAM_INIT_CONFIG_VISIBILIDAD);
                break;
            }
        }

        getConfigVisibilidadVO().insertRow(configVisibilidadRow);
        getConfigVisibilidadVO().setCurrentRow(configVisibilidadRow);
        if (getConfigVisibilidadVO().getEstimatedRowCount() > 0) {
            configVisibilidadRow = (ConfigVisibilidadVORowImpl) getConfigVisibilidadVO().getRowAtRangeIndex(0);

        }
        return configVisibilidadRow;
    }

    public Map crearOperacion(String codExterno, long idOficina, Boolean esEjercicioPoa,
                              Boolean esUnidadEjecutoraSecPublico, Boolean esTipoDeGarantiaSecPublico) {
        logger.warning("Inside crearOperacion.");
        HashMap<String, CrearOperacionResponseType> respuestaServicio = null;
        CrearOperacionRequestType request = null;
        CrearOperacionResponseType response = null;
        Date horaInicio = null;
        Date horaTermino = null;
        Long tiempoProcesoSegundos;
        SimpleDateFormat dateFormat = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;
        String mensaje = "";

        try {
            mensaje = "Obtener row en CrearOperacionVO.";
            CrearOperacionVORowImpl crearOperacionRow =
                (CrearOperacionVORowImpl) this.getCrearOperacionVO().getRowAtRangeIndex(0);

            if (null != crearOperacionRow) {

                logger.warning("Nombre de operacion: " + crearOperacionRow.getNombre());
				logger.warning("Id Moneda: " + crearOperacionRow.getIdTcaTipoMoneda());
                String wsdl = getWsdl(IWsdlLocation.OPERACION);

				logger.warning("wsdl: " + wsdl);

                Operacion12BndQSService operacion12BndQSService =
                    IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
                Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
                } catch (Exception ex) {
                }
                request = new CrearOperacionRequestType();
                Operacion operacion = new Operacion();

                mensaje = "Mapeo de datos en CrearOperacionVO";
                operacion =
                    mappingOperacion(crearOperacionRow, codExterno, idOficina, esEjercicioPoa,
                                     esUnidadEjecutoraSecPublico, esTipoDeGarantiaSecPublico);
                request.setOperacion(operacion);

                horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_OPERACION);
                response = operacion12Port.crearOperacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_OPERACION, horaInicio);

                respuestaServicio = new HashMap<String, CrearOperacionResponseType>();
                respuestaServicio.put("response", response);
            } else {
                logger.log(ADFLogger.WARNING, ">HNWS" + "CrearOperacionVO en getRowAtRangeIndex(0) es null");
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception(mensaje + ". Error al crear la operación, favor de intentar más tarde."));
            throw ex;
        }
        logger.warning("termina metodo crear operacion");
        return respuestaServicio;
    }

    public String asociarOperacionesDetalle(Long idOperacion, Long idOperacionAsociada) {
        logger.log(ADFLogger.TRACE, "Inside asociarOperacionesDetalle.");
        HashMap<String, CrearOperacionResponseType> respuestaServicio = null;
        CrearOperacionAsociadaRequestType request = null;
        CrearOperacionAsociadaResponseType response = null;
        Date horaInicio = null;
        String respuesta = null;

        try {

            if (idOperacion != null && idOperacionAsociada != null) {

                String wsdl = getWsdl(IWsdlLocation.OPERACION);

                Operacion12BndQSService operacion12BndQSService =
                    IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
                Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
                } catch (Exception ex) {
                }
                request = new CrearOperacionAsociadaRequestType();

                request.setIdOperacionPadre(idOperacion);
                request.setIdOperacionAsociada(idOperacionAsociada);

                horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_OPERACION);
                response = operacion12Port.crearOperacionAsociada(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_OPERACION, horaInicio);

                respuesta = response.getResultado().getMessage();

            } else {
                logger.log(ADFLogger.WARNING, ">HNWS" + "CrearOperacionVO en getRowAtRangeIndex(0) es null");
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al crear la operación, favor de intentar más tarde."));
            throw ex;
        }

        return respuesta;
    }

    public StringWriter writeXMLRequest(Object request, Class requestClass) throws JAXBException {
        StringWriter writer = new StringWriter();
        JAXBContext context = JAXBContext.newInstance(requestClass);
        Marshaller m = context.createMarshaller();
        m.marshal(new JAXBElement(new QName(requestClass.getName()), requestClass, request), writer);
        return writer;
    }

    public void inicioCancelarOperacion(Long idOperacion, String suspenderTemporalmente, String loginUsuario,
                                        String justificacion, String nombreOperacion) {
        logger.warning("ENTRA INICIOCANCELAROPERACION");
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                String mensaje = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(idOperacion.intValue());
                operacion.setNombreOperacion(nombreOperacion);
                operacion.setResponsableOperacion(loginUsuario);
                header.setOperacion(operacion);
                if (header.getParameterType().size() <= 0) {
                    ParameterType estatus = new ParameterType();
                    estatus.setParameterName(FenixModelConstants.SUSPENDIDO);
                    estatus.setParameterValue(suspenderTemporalmente);
                    header.getParameterType().add(estatus);
                }

                mensaje = "Request servicio - inicioCancelarOperacion";
                xmlSalida = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

                // this.writeXMLRequest(header, header.getClass());
                Resultado response = procesosAlternosPortType.inicioCancelarOperacion(header);

                mensaje = "Respuesta servicio - inicioCancelarOperacion";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

                if (null != response.getResult() && response.getResult().toString().equalsIgnoreCase("OK")) {
                    logger.warning("Respuesta del servicio inicioCancelarOperacion OK");
                    Number idOperacionNumber = new Number(idOperacion);
                    ActualizarOperacionVOImpl actualizarOperacionVO = getActualizarOperacionVO();

                    ViewCriteria actualizarOperacionVC =
                        actualizarOperacionVO.getViewCriteriaManager().getViewCriteria("ActualizarOperacionByIdOperacionCriteria");
                    actualizarOperacionVC.ensureVariableManager().setVariableValue("varIdOperacion", idOperacionNumber);
                    actualizarOperacionVO.applyViewCriteria(actualizarOperacionVC);
                    actualizarOperacionVO.executeQuery();
                    actualizarOperacionVO.setCurrentRow(actualizarOperacionVO.first());

                    ActualizarOperacionVORowImpl actualizarOperacionRow =
                        (ActualizarOperacionVORowImpl) actualizarOperacionVO.getCurrentRow();

                    actualizarOperacionRow.setAttribute(ActualizarOperacionVORowImpl.JUSTIFICACIONCANCELA,
                                                        justificacion);

                    logger.warning("Realizando Commit a BD para guardar justificacion");
                    getDBTransaction().commit();
                }
            } else {
                logger.log(ADFLogger.ERROR, "Error en inicioCancelarOperacion: idOperacion vacio");
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en inicioCancelarOperacion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioCancelarOperacion " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        }
    }

    public void guardarObservacionesCancelarOperacion() {
        logger.log("Inicia guardarObservacionesCancelarOperacion");
        try {
            ActualizarOperacionVOImpl actualizarOperacionVO = getActualizarOperacionVO();
            ActualizarOperacionVORowImpl actualizarOperacionRow =
                (ActualizarOperacionVORowImpl) actualizarOperacionVO.getCurrentRow();

            logger.warning("OBSERVACIONES: " + actualizarOperacionRow.getObservacionCancela());
            getDBTransaction().commit();
        } catch (Exception e) {
            e.printStackTrace();
            logger.log(ADFLogger.ERROR,
                       "Error en guardarObservacionesCancelarOperacion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en guardarObservacionesCancelarOperacion " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        }
    }

    public Boolean validarGerenteResponsable(String responsableOperacion, String loginUsuario) {
        logger.warning("Entra a metodo validarGerenteResponsable");
        Boolean respuesta = Boolean.FALSE;

        if (null != responsableOperacion) {
            String wsdl = getWsdl(IWsdlLocation.USUARIO);
            Usuario12BndQSService datosUsuarioService =
                IWsdlLocation.Service.getInstance(Usuario12BndQSService.class, wsdl);
            UsuarioPT usuariosPT = datosUsuarioService.getUsuario12BndQSPort();

            ConsultarAtributosUsuarioRequestType request = new ConsultarAtributosUsuarioRequestType();

            ListaNombres lista = new ListaNombres();
            lista.getNombreUsuario().add(responsableOperacion);
            request.setListaNombres(lista);

            try {
                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_VALIDAR_GERENTE_RESPONSABLE);
                ConsultarAtributosUsuarioResponseType response = usuariosPT.consultarAtributosUsuario(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_VALIDAR_GERENTE_RESPONSABLE, horaInicio);

                if (null != response.getResultado().getResult() &&
                    response.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                    ListaUsuarios usuarios = response.getListaUsuarios();
                    for (Usuario usuario : usuarios.getUsuario()) {
                        String manager = usuario.getManager();
                        if (null != manager && manager.equalsIgnoreCase(loginUsuario)) {
                            respuesta = Boolean.TRUE;
                        }
                    }
                }
            } catch (Exception e) {
                logger.log(ADFLogger.ERROR,
                           "Error en validarGerenteResponsable " + e.getClass() + ":" + e.getMessage());

                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception("Error en validarGerenteResponsable " + e.getClass() + ":" +
                                                 e.getMessage()));
                throw ex;
            }

        }

        return respuesta;
    }

    /**
     * Invoca el inicio del proceso de Enmiendas
     * @param idOperacion
     * @param loginUsuario
     * @since 02/02/2016
     *
     * 03/23/2016 Se agrega mapeo de parametros  para la correcta invocacion del llamado al servicio
     * 04/07/2016 Se agrega logica de lectura de retornos con ERROR por parte del WS
     */
    public void inicioEnmiendas(Long idOperacion, String loginUsuario) {
        String msgError = null;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                String mensaje = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(idOperacion.intValue());
                operacion.setResponsableOperacion(loginUsuario);

                header.setOperacion(operacion);

                ParameterType parameterTypeTipoEnmienda = new ParameterType();
                parameterTypeTipoEnmienda.setParameterName(PARAM_TIPOENMIENDA);
                parameterTypeTipoEnmienda.setParameterValue(PARAM_DEFAULT_ID);

                ParameterType parameterTypeTipoInicio = new ParameterType();
                parameterTypeTipoInicio.setParameterName(PARAM_TIPOINICIO);
                parameterTypeTipoInicio.setParameterValue(PARAM_DEFAULT_ID);

                header.getParameterType().add(parameterTypeTipoEnmienda);
                header.getParameterType().add(parameterTypeTipoInicio);

                Date horaInicio = ModelUtils.logStartWS(logger, header, FenixModelConstants.WSC_INICIO_ENMIENDA);
                Resultado response = procesosAlternosPortType.inicioEnmiendas(header);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_INICIO_ENMIENDA, horaInicio);

                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }


                    msgError =
                        "No es posible iniciar el proceso de enmiendas. Operacion: " + idOperacion + ". Mensaje: " +
                        mensajeError + ". " + detalleError;
                    throw new Exception();
                }
            } else {
                logger.log(ADFLogger.ERROR, "Error en inicioEnmiendas: idOperacion vacio");
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en inicioEnmiendas " + e.getClass() + ":" + e.getMessage());

            JboException ex;
            if (msgError != null) {
                ex = new JboException(msgError);

            } else {
                ex = new JboException(e);
                ex.addToExceptions(new Exception("Error en inicioEnmiendas " + e.getClass() + ":" + e.getMessage()));
            }
            throw ex;
        }
    }

    /**
     *
     * @param idOperacion
     * @param solicitaAnalista
     * @param loginUsuario
     * @param descripcionOperacion
     * @param codigoCliente
     * @param nombreCliente
     * @param codigoProducto
     * @param nombreProducto
     * @param montoSolicitado
     * @param pais
     * @param cuentaDJ
     * @return
     *
     * 04072016 Se elimina validacion de declaracion jurada para la bandera POR_SEGUIMIENTO, la cual siempre ira con valor True
     */
    public Boolean inicioLAFT(String idOperacion, Boolean solicitaAnalista, String loginUsuario,
                              String descripcionOperacion, String codigoCliente, String nombreCliente,
                              Integer codigoProducto, String nombreProducto, BigDecimal montoSolicitado, String pais,
                              Boolean cuentaDJ) {
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setCodigoCliente(codigoCliente);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreCliente(nombreCliente);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setNombreProducto(nombreProducto);
                operacion.setPais(pais);

                header.setOperacion(operacion);

                ParameterType parameterTypePorSeguimiento = new ParameterType();
                parameterTypePorSeguimiento.setParameterName(PARAM_PORSEGUIMIENTO);
                parameterTypePorSeguimiento.setParameterValue(PARAM_TRUE);

                ParameterType parameterTypeCancelaReformulacion = new ParameterType();
                parameterTypeCancelaReformulacion.setParameterName(PARAM_CANCELAREFORMULACION);
                parameterTypeCancelaReformulacion.setParameterValue(PARAM_FALSE);

                header.getParameterType().add(parameterTypePorSeguimiento);
                header.getParameterType().add(parameterTypeCancelaReformulacion);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - iniciar LAFT-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioLAFT(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioLAFT -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;
                    msgError =
                        "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioLAFT: idOperacion vacio");
                msgError = "Error en inicioLAFT: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioLAFT " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioLAFT " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }


    /**
    *
    * @param idOperacion 
    * @return
    *
    * 1212020
    */ 
    public Boolean inicioAdministrarOperacion(String idOperacion) {
        logger.warning("Inside inicioAdministrarOperacion...");
        logger.warning("idOperacion: " + idOperacion);
        InicioAdministrarOperacion request = null;
        Resultado      response = null;
        FenixAMImpl fenixAM = null;
        Boolean resultado = Boolean.FALSE;
        try 
        {
            Operacion operacion = new Operacion();
            fenixAM = (FenixAMImpl)this.getRootApplicationModule();
            Long id_operacion= Long.valueOf(idOperacion);
            String userName= fenixAM.getUserPrincipalName();

            logger.warning("id_operacion: " + id_operacion);
            logger.warning("userName: " + userName);
            operacion.setIdOperacion(id_operacion);
            operacion.setResponsable(userName);
            
            String wsdl = fenixAM.getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);
            logger.warning("wsdl: " + wsdl);
            ProcesosAlternosBindingQSService procesosAlternosQSService = IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
            ProcesosAlternosPortType procesosPT = procesosAlternosQSService.getProcesosAlternosBindingQSPort();
             
            request = new InicioAdministrarOperacion();
            
            request.setOperacion(operacion);
            request.setCambioDefinitivo(true);
            
            List<ParameterType> lp = new ArrayList<ParameterType>();
            ParameterType       p = new ParameterType();
            lp.add(p);
            
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_INICIO_ADMINISTRAR_OPERACION);
            response = procesosPT.inicioAdministrarOperacion(operacion, true, lp);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_INICIO_ADMINISTRAR_OPERACION, horaInicio);
            
            if(null!=response.getResult()&&response.getResult().value()=="ERROR"){
                logger.log(ADFLogger.ERROR, response.getMessage());
                throw new Exception(response.getMessage());
            }
            else
            {
                resultado = Boolean.TRUE;
            }
        }
        catch (Exception e) {
            logger.warning("Error inicioAdministrarOperacion: " + e); 
            JboException ex = new JboException(e);
            throw ex;
        }
        logger.warning("Fin inicioAdministrarOperacion: "); 
        return resultado;
    }
    /**
    *
    * @param idOperacion
    * @param loginUsuario
    * @param nombreOperacion
    * @param codigoProducto
    * @param nombreProducto
    * @param montoSolicitado
    * @param pais
    * @return
    *
    * 01082016
    */

    public Boolean inicioSupervision(String idOperacion, String loginUsuario, String descripcionOperacion,
                                     Integer codigoProducto, String nombreProducto, BigDecimal montoSolicitado,
                                     String pais) {
        logger.warning("Inside inicioSupervision.");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreProducto(nombreProducto);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setPais(pais);

                header.setOperacion(operacion);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - iniciarSupervision-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioSupervision(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioSupervision -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "") {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }

                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioSupervision: idOperacion vacio");
                msgError = "Error en inicioSupervision: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioSupervision " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioSupervision " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /**
     *
     * @param idOperacion
     * @param loginUsuario
     * @return
     *
     * 20042017
     */

    public Boolean inicioInteresesCobro(String idOperacion, String loginUsuario) {
        logger.warning("Inside inicioInteresesCobro.");
        logger.warning("Inside idOperacion: " + idOperacion);
        logger.warning("Inside loginUsuario: " + loginUsuario);

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);

                header.setOperacion(operacion);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Invocando Servicio - inicioInteresesCobro-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioInteresesCobro(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Respuesta servicio - inicioInteresesCobro -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "") {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioInteresesCobro: idOperacion vacio");
                msgError = "Error en inicioInteresesCobro: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioInteresesCobro " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioInteresesCobro " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /**
     *
     * @param idOperacion
     * @param loginUsuario
     * @return
     *
     * 26042017
     */

    public Boolean inicioEnviarGasto(String idOperacion, String loginUsuario) {
        logger.warning("Inside inicioEnviarGasto.");
        logger.warning("Inside idOperacion: " + idOperacion);
        logger.warning("Inside loginUsuario: " + loginUsuario);

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);

                header.setOperacion(operacion);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - inicioEnviarGasto-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioEnviarGasto(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioEnviarGasto -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }

                    if (null != response.getError()) {
                        if (null != response.getError().getErrorDescription()) {
                            if (response.getError().getErrorDescription().trim().length() > 0) {
                                detalleError = response.getError().getErrorDescription();
                            }
                        }
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "" && detalleError != null) {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }

                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioEnviarGasto: idOperacion vacio");
                msgError = "Error en inicioEnviarGasto: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioEnviarGasto " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioEnviarGasto " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /**
     *
     * @param idOperacion
     * @param loginUsuario
     * @param nombreOperacion
     * @param codigoProducto
     * @param nombreProducto
     * @param montoSolicitado
     * @param pais
     * @return
     *
     * 10042017
     */

    public Boolean inicioImplementacionPct(String idOperacion, String loginUsuario, String descripcionOperacion,
                                           Integer codigoProducto, String nombreProducto, BigDecimal montoSolicitado,
                                           String pais) {
        logger.warning("Inside inicioImplementacionPct.");

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        String tipoInicio = "TIPO_INICIO";
        String valorInicio = "CONTRATACION";

        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreProducto(nombreProducto);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setPais(pais);

                ParameterType parameterType = new ParameterType();
                parameterType.setParameterName(tipoInicio);
                parameterType.setParameterValue(valorInicio);

                header.setOperacion(operacion);
                header.getParameterType().add(parameterType);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Invocando Servicio - InicioImplementacionPCT-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioImplementacionPCT(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Respuesta servicio - InicioImplementacionPCT -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage()) {
                        if (response.getMessage().trim().length() > 0) {
                            mensajeError = response.getMessage();
                        } else {
                            mensajeError = "Error al iniciar el proceso de Implementacion PCT";
                        }
                    } else {
                        if (null != response.getError().getErrorDescription()) {
                            mensajeError = response.getMessage();
                        } else {
                            mensajeError = "Error al iniciar el proceso de Implementacion PCT";
                        }
                    }
                    existeError = Boolean.TRUE;
                    msgError =
                        "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en InicioImplementacionPCT: idOperacion vacio");
                msgError = "Error en InicioImplementacionPCT: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en InicioImplementacionPCT " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en InicioImplementacionPCT " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /**
     *
     * @param idOperacion
     * @param loginUsuario
     * @param rol
     * @param responsableOperacionInicio
     * @param descripcionOperacion
     * @param codigoProducto
     * @param nombreProducto
     * @param montoSolicitado
     * @param pais
     * @return
     *
     * 25102016
     */

    public Boolean inicioPrepago(String idOperacion, String loginUsuario, String rol, String responsableOperacion,
                                 String descripcionOperacion, Integer codigoProducto, String nombreProducto,
                                 BigDecimal montoSolicitado, String pais) {
        logger.warning("Inside inicioPrepago.");

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                org.bcie.xmlns.objetoproceso.comun.proceso.v1.Proceso proceso =
                    new org.bcie.xmlns.objetoproceso.comun.proceso.v1.Proceso();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(responsableOperacion);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreProducto(nombreProducto);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setPais(pais);
                proceso.setRolIniciaProceso(rol);
                proceso.setUsuarioIniciaProceso(loginUsuario);

                header.setOperacion(operacion);
                header.setProceso(proceso);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - iniciooPrepago-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioPrepago(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioPrepago -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage()) {
                        if (response.getMessage().trim().length() > 0) {
                            mensajeError = response.getMessage();
                        } else {
                            mensajeError = "Error al iniciar el proceso de cierre";
                        }
                    } else {
                        if (null != response.getError().getErrorDescription()) {
                            mensajeError = response.getMessage();
                        } else {
                            mensajeError = "Error al iniciar el proceso de cierre";
                        }
                    }
                    existeError = Boolean.TRUE;
                    msgError =
                        "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioPrepago: idOperacion vacio");
                msgError = "Error en inicioPrepago: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioPrepago " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioPrepago " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /**
     *
     * @param idOperacion
     * @param loginUsuario
     * @param nombreOperacion
     * @param codigoProducto
     * @param nombreProducto
     * @param montoSolicitado
     * @param pais
     * @return
     *
     * 27102016
     */

    public Boolean inicioCierreFideicomiso(String idOperacion, String loginUsuario, String descripcionOperacion,
                                           Integer codigoProducto, String nombreProducto, BigDecimal montoSolicitado,
                                           String pais) {
        logger.warning("Inside inicioCierreFideicomiso.");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreProducto(nombreProducto);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setPais(pais);

                header.setOperacion(operacion);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Invocando Servicio - iniciarCierreFideicomiso-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioCierreFideicomiso(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Respuesta servicio - inicioCierreFideicomiso -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "") {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioCierreFideicomiso: idOperacion vacio");
                msgError = "Error en inicioCierreFideicomiso: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioCierreFideicomiso " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioCierreFideicomiso " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /**
     *
     * @param idOperacion
     * @param loginUsuario
     * @param nombreOperacion
     * @param codigoProducto
     * @param nombreProducto
     * @param montoSolicitado
     * @param pais
     * @param idEvaluacion
     * @return
     *
     * 01082016
     */

    public Boolean inicioEvaluacion(String idOperacion, String loginUsuario, String descripcionOperacion,
                                    Integer codigoProducto, String nombreProducto, BigDecimal montoSolicitado,
                                    String pais, String idEvaluacion) {
        logger.warning("Inside inicioEvaluacion.");
        logger.warning("idEvaluacion: " + idEvaluacion);

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        String valorEvaluacion = "TIPO_EVALUACION";

        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosAlternosPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreProducto(nombreProducto);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setPais(pais);

                ParameterType parameterType = new ParameterType();
                parameterType.setParameterName(valorEvaluacion);
                parameterType.setParameterValue(idEvaluacion);

                header.setOperacion(operacion);
                header.getParameterType().add(parameterType);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - inicioEvaluacion-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioEvaluacion(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioEvaluacion -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "") {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioEvaluacion: idOperacion vacio");
                msgError = "Error en inicioEvaluacion: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioEvaluacion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioEvaluacion " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    public Boolean inicioRegistrarComision(String idOperacion, String loginUsuario) {
        logger.warning("Entra en inicioRegistrarComision modelo.");
        logger.warning("idOperacion: " + idOperacion);
        logger.warning("loginUsuario: " + loginUsuario);

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        String tipoInicioComision = "1";

        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);

                header.setOperacion(operacion);

                ParameterType parameterType = new ParameterType();
                parameterType.setParameterName("TIPO_INICIO");
                parameterType.setParameterValue(tipoInicioComision);

                header.getParameterType().add(parameterType);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.warning(">HNWS Invocando Servicio - inicioRegistrarComision-" + xmlEntrada.toString());

                response = procesosAlternosPortType.inicioRegistrarComisiones(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.warning(">HNWS Respuesta servicio - inicioRegistrarComision -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "") {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.warning("Error en inicioRegistrarComision: idOperacion vacio");
                msgError = "Error en inicioRegistrarComision: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.warning("Error en inicioRegistrarComision " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioRegistrarComision " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /*
     * TODO Quitar el parametro Booleano y añadir un parametro Map<String, Object> en el cual tendra los valores:
     * responsableOperacion, codigoCliente, nombreOperacion, nombreCliente, codigoProducto, nombreProducto, pais,
     * codigoProceso y nombreProceso.
     */
    public Boolean inicioCierre(String idOperacion, String loginUsuario, String descripcionOperacion,
                                String codigoCliente, String nombreCliente, Integer codigoProducto,
                                String nombreProducto, BigDecimal montoSolicitado, String pais) {
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                String mensaje = null;
                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setCodigoCliente(codigoCliente);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreCliente(nombreCliente);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setNombreProducto(nombreProducto);
                operacion.setPais(pais);
                header.setOperacion(operacion);
                //header = testProcesosPrincipales();

                Resultado response = procesosPrincipalesPortType.inicioCierre(header);

                mensaje = "Invocando Servicio - iniciar Cierre-";
                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

                mensaje = "Respuesta servicio - inicioCierre -";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "") {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioCierre: idOperacion vacio");
                msgError = "Error en inicioCierre: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioCierre " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioCierre " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /*
     * TODO Quitar el parametro Booleano y añadir un parametro Map<String, Object> en el cual tendra los valores:
     * responsableOperacion, codigoCliente, nombreOperacion, nombreCliente, codigoProducto, nombreProducto, pais,
     * codigoProceso y nombreProceso.
     */
    public Boolean inicioFormalizacion(String idOperacion, String loginUsuario, String descripcionOperacion,
                                       String codigoCliente, String nombreCliente, Integer codigoProducto,
                                       String nombreProducto, String pais) {
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                String mensaje = null;
                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setCodigoCliente(codigoCliente);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreCliente(nombreCliente);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setNombreProducto(nombreProducto);
                operacion.setPais(pais);
                header.setOperacion(operacion);
                //header = testProcesosPrincipales();

                Resultado response = procesosPrincipalesPortType.inicioFormalizacion(header);

                mensaje = "Invocando Servicio - inicioFormalizacion -";
                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

                mensaje = "Respuesta servicio - inicioFormalizacion -";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError() && null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;

                    if (detalleError != "") {
                        msgError =
                            "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    } else {
                        msgError = "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ".";
                    }
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioFormalizacion: idOperacion vacio");
                msgError = "Error en inicioFormalizacion: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioFormalizacion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioFormalizacion " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /*
     * TODO Quitar el parametro Booleano y añadir un parametro Map<String, Object> en el cual tendra los valores:
     * responsableOperacion, codigoCliente, nombreOperacion, nombreCliente, codigoProducto, nombreProducto, pais,
     * codigoProceso y nombreProceso.
     */
    public Boolean inicioAprobacionCliente(Integer idCliente, String loginUsuario) {
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        String parameterTypeName = "ID_TIPO_APROBACION";
        String parameterTypeValue = "4";
        try {
            if (idCliente != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente cliente =
                    new org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente();

                String mensaje = null;
                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                cliente.setIdCliente(idCliente);
                cliente.setResponsableCliente(loginUsuario);

                ParameterType parameterType = new ParameterType();
                parameterType.setParameterName(parameterTypeName);
                parameterType.setParameterValue(parameterTypeValue);

                header.setCliente(cliente);
                header.getParameterType().add(parameterType);

                Resultado response = procesosPrincipalesPortType.inicioAprobacionCliente(header);

                mensaje = "Invocando Servicio - inicioAprobacionCliente-";
                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

                mensaje = "Respuesta servicio - inicioAprobacionCliente -";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;
                    msgError = "El cliente: " + idCliente + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioAprobacionCliente: idCliente vacio");
                msgError = "Error en inicioAprobacionCliente: idCliente vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioAprobacionCliente " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioAprobacionCliente " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    /*
     * TODO Quitar el parametro Booleano y añadir un parametro Map<String, Object> en el cual tendra los valores:
     * responsableOperacion, codigoCliente, nombreOperacion, nombreCliente, codigoProducto, nombreProducto, pais,
     * codigoProceso y nombreProceso.
     */
    public void inicioAnalisis(Long idOperacion, Boolean retornoAprobacion, String loginUsuario) {
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }


                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                String mensaje = null;
                StringWriter xmlSalida = null;

                //operacion.setCodigoOperacion(idOperacion.intValue());
                //header.setOperacion(operacion);
                header = testProcesosPrincipales();

                Resultado response = procesosPrincipalesPortType.inicioAnalisis(header);

                mensaje = "Respuesta servicio - inicioAnalisis -";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());
            } else {
                logger.log(ADFLogger.ERROR, "Error en inicioAnalisis: idOperacion vacio");
            }

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en inicioAnalisis " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioAnalisis " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        }
    }

    /*
     * TODO Quitar el parametro Booleano y añadir un parametro Map<String, Object> en el cual tendra los valores:
     * responsableOperacion, codigoCliente, nombreOperacion, nombreCliente, codigoProducto, nombreProducto, pais,
     * codigoProceso y nombreProceso.
     */
    public void inicioElegibilidad(Long idOperacion, Boolean esReactivacion, String loginUsuario) {
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();
                operacion.setCodigoOperacion(idOperacion.intValue());
                header.setOperacion(operacion);

                String mensaje = null;
                StringWriter xmlSalida = null;

                //operacion.setCodigoOperacion(idOperacion.intValue());
                //header.setOperacion(operacion);
                header = testProcesosPrincipales();

                Resultado response = procesosPrincipalesPortType.inicioElegibilidad(header);

                mensaje = "Respuesta servicio - inicioElegibilidad -";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());
            } else {
                logger.log(ADFLogger.ERROR, "Error en inicioELegibilidad: idOperacion vacio");
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en inicioElegibilidad " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioElegibilidad " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        }
    }

    /*
     * TODO Quitar el parametro Booleano y añadir un parametro Map<String, Object> en el cual tendra los valores:
     * responsableOperacion, codigoCliente, nombreOperacion, nombreCliente, codigoProducto, nombreProducto, pais,
     * codigoProceso y nombreProceso.
     */
    public void inicioPreparacion(Long idOperacion, Boolean retornoAnalisis, String loginUsuario) {
        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                String mensaje = null;
                StringWriter xmlSalida = null;

                //operacion.setCodigoOperacion(idOperacion.intValue());
                //header.setOperacion(operacion);
                header = testProcesosPrincipales();

                Resultado response = procesosPrincipalesPortType.inicioPreparacion(header);

                mensaje = "Respuesta servicio - inicioPreparacion -";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());
            } else {
                logger.log(ADFLogger.ERROR, "Error en inicioPreparacion: idOperacion vacio");
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en inicioPreparacion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioPreparacion " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        }
    }

    /***
     * 01/Nov/2016
     * Ernesto Garcia
     * WS: Procesos_Principales
     * inicioDesembolsoExcepcion
     * @CodigoOperacion
     * @NombreOperacion
     * @idSolicitud
     * ***/
    /*public Boolean inicioDesembolsoExcepcion(String idOperacion, String loginUsuario, String idSolicitud){
        logger.warning("Inside inicioDesembolsoExcepcion.");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        String valueSolicitud = "ID_SOLICITUD";

        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();

                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType parameterType =
                    new org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);

                parameterType.setParameterName(valueSolicitud);
                parameterType.setParameterValue(idSolicitud);

                header.setOperacion(operacion);
                header.getParameterType().add(parameterType);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - inicioDesembolsoExcepcion-" + xmlEntrada.toString());

                response = procesosPrincipalesPortType.inicioDesembolsoExcepcion(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioDesembolsoExcepcion -" + xmlSalida.toString());

                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }
                    if (null != response.getError().getErrorDescription() &&
                        response.getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;
                    msgError =
                        "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en inicioDesembolsoExcepcion: idOperacion vacio");
                msgError = "Error en inicioDesembolsoExcepcion: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioDesembolsoExcepcion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioDesembolsoExcepcion " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }*/

    public Map inicioDesembolsoExcepcion(String idOperacion, String loginUsuario, List<String> reglasParam,
                                         String idSolicitud) {
        logger.warning("Inside inicioDesembolsoExcepcion.");
        logger.warning("idOperacion: " + idOperacion);
        logger.warning("loginUsuario: " + loginUsuario);
        logger.warning("idSolicitud: " + idSolicitud);

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        Map map = new HashMap<String, Object>();

        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                    logger.warning("inicioDesembolsoExcepcion ", ex);
                }

                Header header = new Header();

                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);

                header.setOperacion(operacion);

                org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType parameterType =
                    new org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType();
                parameterType.setParameterName("ID_SOLICITUD");
                parameterType.setParameterValue(idSolicitud);

                header.getParameterType().add(parameterType);

                //Envia reglas encontradas para Solicitud
                if (reglasParam != null) {
                    if (reglasParam.size() > 0) {
                        for (String regla : reglasParam) {
                            logger.warning("paramValue: " + regla);

                            parameterType = new org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType();

                            parameterType.setParameterName("MOTIVO");
                            parameterType.setParameterValue(regla);

                            header.getParameterType().add(parameterType);
                        }
                    }
                }

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Invocando Servicio - inicioDesembolsoExcepcion-" + xmlEntrada.toString());
                logger.warning("Invocando Servicio - inicioDesembolsoExcepcion" + xmlEntrada.toString());

                response = procesosPrincipalesPortType.inicioDesembolsoExcepcion(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Respuesta servicio - inicioDesembolsoExcepcion -" + xmlSalida.toString());
                logger.warning("Respuesta Servicio - inicioDesembolsoExcepcion" + xmlSalida.toString());

                try {
                    if (response.getResult() != null && response.getResult().value() == "OK") {
                        existeError = Boolean.TRUE;
                    }

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        msgError = response.getMessage();
                    }
                } catch (Exception e) {
                    logger.warning("Error en el servicio");
                }
            }
        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioDesembolsoExcepcion.", e);
        }
        map.put("success", existeError);
        map.put("message", msgError);
        return map;
    }

    /*TODO Agregar un parametro String para obtener el usuario de sesion y setear al atributo "responsable"
     * del objeto "Operacion".
     * Dicho dato es requerido para la actualizacion de la operacion.
     */
    public Operacion mappingDetalleOperacion(DetalleOperacionEditableVORowImpl detalleOperacionEditableVORow) {
        Operacion operacion = new Operacion();
        Cliente cliente = new Cliente();
        Producto producto = new Producto();
        MontosOperacion montos = new MontosOperacion();
        MontoOperacion montoTotal = new MontoOperacion();
        MontoOperacion montoSolicitado = new MontoOperacion();
        Catalogo sectorMercado = new Catalogo();
        Catalogo tipoGarantia = new Catalogo();
        Catalogo idCatPais = new Catalogo();
        Catalogo tipoInstitucion = new Catalogo();
        Catalogo pais = new Catalogo();
        Catalogo oficina = new Catalogo();
        //Objects Herramienta de clasificacion estrategica
        Catalogo actividadEconomica = new Catalogo();
        Catalogo actividadEconomicaAsociada = new Catalogo();
        Catalogo areaFocalizacion = new Catalogo();
        Catalogo ejeEstrategico = new Catalogo();
        Catalogo iniciativaEstrategica = new Catalogo();
        Catalogo rangoPaises = new Catalogo();
        Catalogo ejercicioPoa = new Catalogo();
        //LOV Herramienta de clasificacion estrategica
        TiposActividadEconomicaPadreLOVImpl tiposActividadEconomicaPadreVOImpl = getTiposActividadEconomicaPadreLOV();
        TiposActividadEconomicaLOVImpl tiposActividadEconomicaVOImpl = getTiposActividadEconomicaLOV();
        TiposIniciativaEstrategicaLOVImpl tiposIniciativaEstrategicaVOImpl = getTiposIniciativaEstrategicaLOV();
        TiposCantidadPaisesBeneficiadosLOVImpl cantidadPaisesVOImpl = getTiposCantidadPaisesBeneficiadosLOV();
        TiposAreaFocalizacionLOVImpl tiposAreaFocalizacionVOImpl = getTiposAreaFocalizacionLOV();
        TiposEjeEstrategicoLOVImpl tiposEjeEstrategicoVOImpl = getTiposEjeEstrategicoLOV();
        // obligatory values for run services
        operacion.setIdOperacion(detalleOperacionEditableVORow.getIdOperacion());
        operacion.setResponsable(detalleOperacionEditableVORow.getUsuario());
        //this session is  "datos generales" this componente
        if (detalleOperacionEditableVORow.getNombre() != null) {
            operacion.setNombre(detalleOperacionEditableVORow.getNombre());
        } else {
            //No mapping or assignment default value
        }
        if (detalleOperacionEditableVORow.getDescripcion() != null) {
            operacion.setDescripcion(detalleOperacionEditableVORow.getDescripcion());
        } else {
            //No mapping or assignment default value
        }

        //this session is  "Herramienta de clasificacion estrategica" this componente
        //to assign Actividad económica primaria
        if (tiposActividadEconomicaPadreVOImpl.getCurrentRow() != null) {
            Integer idActividadEconomicaPadre =
                (Integer) tiposActividadEconomicaPadreVOImpl.getCurrentRow().getAttribute("Id");
            actividadEconomica.setId(idActividadEconomicaPadre.longValue());
            actividadEconomica.setCodigoExterno((String) tiposActividadEconomicaPadreVOImpl.getCurrentRow().getAttribute("CodExterno"));
            operacion.setActividadEconomica(actividadEconomica);
        }

        //to assign Actividad económica
        if (tiposActividadEconomicaVOImpl.getCurrentRow() != null) {
            Integer idActividadEconomica = (Integer) tiposActividadEconomicaVOImpl.getCurrentRow().getAttribute("Id");
            actividadEconomicaAsociada.setId(idActividadEconomica.longValue());
            actividadEconomicaAsociada.setCodigoExterno((String) tiposActividadEconomicaVOImpl.getCurrentRow().getAttribute("CodExterno"));
            operacion.setActividadEconomicaAsociada(actividadEconomicaAsociada);
        }

        //to assign Iniciativa estratégica
        if (tiposIniciativaEstrategicaVOImpl.getCurrentRow() != null) {
            Integer idIniciativaEstrategica =
                (Integer) tiposIniciativaEstrategicaVOImpl.getCurrentRow().getAttribute("Id");
            iniciativaEstrategica.setId(idIniciativaEstrategica.longValue());
            operacion.setIniciativaEstrategica(iniciativaEstrategica);
        }

        //to assign Cantidad de Países beneficiados
        if (cantidadPaisesVOImpl.getCurrentRow() != null) {
            BigDecimal idCantidadPaises =
                (BigDecimal) cantidadPaisesVOImpl.getCurrentRow().getAttribute("IdRangoPaises");
            rangoPaises.setId(idCantidadPaises.longValue());
            operacion.setCantidadPaises(rangoPaises);
        }

        // Asignamos Área de focalización
        if (tiposAreaFocalizacionVOImpl.getCurrentRow() != null) {
            Integer idAreaFocalizacion = (Integer) tiposAreaFocalizacionVOImpl.getCurrentRow().getAttribute("Id");
            areaFocalizacion.setId(idAreaFocalizacion.longValue());
            operacion.setAreaFocalizacion(areaFocalizacion);
        }

        // Asignamos Eje estratégico
        if (tiposEjeEstrategicoVOImpl.getCurrentRow() != null) {
            Integer idEjeEstrategico = (Integer) tiposEjeEstrategicoVOImpl.getCurrentRow().getAttribute("Id");
            ejeEstrategico.setId(idEjeEstrategico.longValue());
            operacion.setEjeEstrategico(ejeEstrategico);
        }

        //this session is  "datos adicionales" this componente
        if (detalleOperacionEditableVORow.getProgramadoPoa() != null) {
            if (detalleOperacionEditableVORow.getProgramadoPoa() == 1) {
                operacion.setProgramadoPOA(true);
            } else {
                operacion.setProgramadoPOA(false);
            }

        } else {
            //default value is 0 = FALSE
            operacion.setProgramadoPOA(false);
        }
        if (detalleOperacionEditableVORow.getEjercicioPoa() != null &&
            detalleOperacionEditableVORow.getEjercicioPoa() > 0) {
            ejercicioPoa.setId(detalleOperacionEditableVORow.getEjercicioPoa().longValue());
            operacion.setEjercicioPOA(ejercicioPoa);
        } else {
            //No mapping or assignment default value
        }
        if (detalleOperacionEditableVORow.getSectorMercado() != null) {
            sectorMercado.setId(detalleOperacionEditableVORow.getSectorMercado().longValue());
            operacion.setSectorMercado(sectorMercado);
        } else {
            //No mapping or assignment default value
        }
        if (detalleOperacionEditableVORow.getTipoGarantia() != null) {
            tipoGarantia.setId(detalleOperacionEditableVORow.getTipoGarantia().longValue());
            operacion.setTipoGarantia(tipoGarantia);
        } else {
            //No mapping or assignment default value
        }
        //Recuperar valor idCatPais        
        logger.warning("======   Recuperar y establecer valor idCatPais mappingDetalleOperacion =======");
        if (detalleOperacionEditableVORow.getIdCatPais() != null){
            logger.warning("======   idCatPais detalleOperacionEditableVORow: " + detalleOperacionEditableVORow.getIdCatPais() + "  =======");
            //idCatPais.setId(detalleOperacionEditableVORow.getIdCatPais().longValue());
            operacion.setIdCatPais(BigDecimal.valueOf(detalleOperacionEditableVORow.getIdCatPais()));
            logger.warning("======   idCatPais operacion: " + operacion.getIdCatPais() + "  =======");
        } else {
            //No mapping or assignment default value
        }
            
        if (detalleOperacionEditableVORow.getComponenteConcecionalidad() != null) {
            Boolean componenteConcecionalidad = null;
            if (detalleOperacionEditableVORow.getComponenteConcecionalidad() == 1) {
                componenteConcecionalidad = true;
                operacion.setComponenteConcesionalidad(componenteConcecionalidad);
            } else {
                componenteConcecionalidad = false;
                operacion.setComponenteConcesionalidad(componenteConcecionalidad);
            }
        }
        if (detalleOperacionEditableVORow.getUnidadEjecutora() != null) {
            operacion.setUnidadEjecutora(detalleOperacionEditableVORow.getUnidadEjecutora());
        } else {
            //No mapping or assignment default value
        }

        //mapping with service required, ETAPA(HARDCODE)
        //operacion.setEtapa(1);
        
        //JURBINA@20210107 Se agregan campos faltantes al request de actualizar Operacion
        if(detalleOperacionEditableVORow.getIdProducto() != null)
        {
            producto.setIdProducto(detalleOperacionEditableVORow.getIdProducto());   
            operacion.setProducto(producto);
        }
        
        if(detalleOperacionEditableVORow.getIdCliente() != null)
        {
            cliente.setIdCliente(detalleOperacionEditableVORow.getIdCliente());   
            operacion.setCliente(cliente);
        }
        
        if(detalleOperacionEditableVORow.getMontototal() != null)
        {
            montoTotal.setDescripcion("TOTAL");
            montoTotal.setIdTcaTipoMonto(1L);
            montoTotal.setMonto(detalleOperacionEditableVORow.getMontototal());
            montoTotal.setIdOperacion(detalleOperacionEditableVORow.getIdOperacion());
            montos.getMontoOperacion().add(montoTotal);
        }
        
        if(detalleOperacionEditableVORow.getMontosolicitado() != null)
        {
            montoSolicitado.setDescripcion("SOLICITADO");
            montoSolicitado.setIdTcaTipoMonto(2L);
            montoSolicitado.setMonto(detalleOperacionEditableVORow.getMontosolicitado());
            montoSolicitado.setIdOperacion(detalleOperacionEditableVORow.getIdOperacion());
            montos.getMontoOperacion().add(montoSolicitado);
        }
        
        operacion.setMontoOperacion(montos);
        
        if(detalleOperacionEditableVORow.getIdMoneda() != null)
        {
            operacion.setIdTcaTipoMoneda(detalleOperacionEditableVORow.getIdMoneda().intValue());
        }        

        return operacion;
    }

    public Map actualizarDetalleOperacion() {
        logger.warning("====== Inside actualizarDetalleOperacion =======");
        
        HashMap<String, ActualizarOperacionResponseType> respuestaServicio = null;
        String wsdl = getWsdl(IWsdlLocation.OPERACION);

        Operacion12BndQSService operacion12BndQSService =
            IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
        Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
        try {
            logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
        } catch (Exception ex) {
        }
        ActualizarOperacionRequestType request = new ActualizarOperacionRequestType();
        ActualizarOperacionResponseType response = new ActualizarOperacionResponseType();
        Operacion operacion = new Operacion();
        logger.warning("====== Antes de setear el request =======");
        operacion =
            mappingDetalleOperacion((DetalleOperacionEditableVORowImpl) this.getDetalleOperacionEditableVO().getRowAtRangeIndex(0));
        request.setOperacion(operacion);
        logger.warning("====== request: " + request.toString());
        try {
            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_DETALLE_OPERACION);
            logger.warning("====== Antes de enviar el request =======");
            response = operacion12Port.actualizarOperacion(request);
            logger.warning("====== después de enviar el request =======");
            logger.warning("======  response: " + response.toString());
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_DETALLE_OPERACION, horaInicio);
            respuestaServicio = new HashMap<String, ActualizarOperacionResponseType>();
            respuestaServicio.put("response", response);
            logger.warning("====== respuestaServicio " + respuestaServicio.toString());
        } catch (Exception e) {
            e.printStackTrace();
        }
        return respuestaServicio;
    }
    // SPS | 26/11/2019 - Se agrega metodo para actualizar Clasificacion Estrategica Editable

    /**
     * Método que actualiza la informacion de Clasificacion Estrategica en DB.
     * @author : S&P Solutions
     * @param  : ActualizarOperacionRequestType request
     * @return : Map
     * @version: v1.0
     * @Fecha  : 26/11/2019
     */
    public Map actualizarClasificacionEstrategica(ActualizarOperacionRequestType request) {
        logger.warning("\n===  actualizarClasificacionEstrategica | idOperacion:" + request.getOperacion().getIdOperacion());
        double TInicio, TFin, tiempo; 
        HashMap<String, ActualizarOperacionResponseType> respuestaServicio = null;    
        StringWriter xmlRequest = null;
        
        try {
            FenixAMImpl fenixAMImpl = (FenixAMImpl) this.getRootApplicationModule();
            String wsdl = fenixAMImpl.getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            //Request , Response
            ActualizarOperacionResponseType response = new ActualizarOperacionResponseType();
            respuestaServicio = new HashMap<String, ActualizarOperacionResponseType>();
            try {
                TInicio = System.currentTimeMillis();
                xmlRequest = this.writeXMLRequest(request, request.getClass());
                 logger.warning("\n=====> HNWS" + xmlRequest.toString());
                response = operacion12Port.actualizarOperacion(request);
                respuestaServicio.put("response", response);
                
                TFin =
                    System.currentTimeMillis(); //Tomamos la hora en que finalizó el algoritmo y la almacenamos en la variable T
                tiempo = (TFin - TInicio) / 1000; //Calculamos los milisegundos de diferencia
                logger.warning("\n=== Inf, termina metodo actualizarClasificacionEstrategica con una duracion de: " + tiempo +
                               " segundos");
            } catch (Exception e) {
                e.printStackTrace();
            }
        } catch (Exception e) {
            logger.warning("\n=== Error, la definicion del WSDL_OPERACION no esta disponible ->", e);
            throw new JboException("ha ocurrido un error al consultar la definicion del WSDL_OPERACION no esta disponible");
        }
        return respuestaServicio;
    }

    public boolean suspenderCancelarOperacion(long idOperacion) {
        logger.warning("entro al metodo suspenderCancelarOperacion");
        try {
            if (null != this.getCrearOperacionVO().getRowAtRangeIndex(0)) {
                String wsdl = getWsdl(IWsdlLocation.OPERACION);

                Operacion12BndQSService operacion12BndQSService =
                    IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
                Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
                } catch (Exception ex) {
                }
                ActualizarOperacionRequestType request = new ActualizarOperacionRequestType();
                Operacion operacion = new Operacion();

                operacion =
                    mappingOperacionSuspenderCancelar((SuspenderCancelarOperacionVORowImpl) this.getSuspenderCancelarOperacionVO().getRowAtRangeIndex(0));
                request.setOperacion(operacion);

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_SUSPENDER_CANCELAR_OPERACION);
                ActualizarOperacionResponseType response = operacion12Port.actualizarOperacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_SUSPENDER_CANCELAR_OPERACION, horaInicio);

            } else {
                logger.warning("VO is empty");
            }
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    public void reactivarOperacion(Long idOperacion, String loginUsuario) {
        try {
            String wsdl = getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
            } catch (Exception ex) {
            }
            ReactivarOperacionRequestType request = new ReactivarOperacionRequestType();

            request.setIdOperacion(idOperacion);
            //request.setUsuario(loginUsuario); //Modificacion por cambio de esquema de WS. 10/02/2016

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_REACTIVAR_OPERACION);
            ReactivarOperacionResponseType response = operacion12Port.reactivarOperacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_REACTIVAR_OPERACION, horaInicio);

        } catch (Exception e) {
            logger.log(ADFLogger.WARNING,
                       ">HNWS" + "Error en restablecerOperacion " + e.getClass() + " : " + e.getMessage());
        }
    }

    public Header testProcesosPrincipales() {

        Map<String, Object> mapaHeader = new HashMap<>();
        Header header = new Header();
        org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
            new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();
        Tarea tarea = new Tarea();

        operacion.setCodigoOperacion(500246);
        operacion.setNombreOperacion("Prueba Inicio Analisis");
        operacion.setResponsableOperacion("jramirez");
        operacion.setCodigoCliente("0");
        operacion.setNombreCliente("Juan David Ramirez");
        operacion.setCodigoProducto(1);
        operacion.setNombreProducto("Credito");
        operacion.setPais("HN");

        tarea.setCodigoProceso(1);

        header.setOperacion(operacion);
        header.setTarea(tarea);

        return header;
    }

    public Operacion mappingActualizarOperacionReformular(CrearOperacionVORowImpl ActualizarOperacionReformularVORow,
                                                          String codExterno, long idOficina, Boolean esEjercicioPoa,
                                                          Boolean esUnidadEjecutoraSecPublico,
                                                          Boolean esTipoDeGarantiaSecPublico) {
        logger.warning("====== Inside mappingActualizarOperacionReformular");
        Operacion operacion = new Operacion();
        MontosOperacion montoOperacion = new MontosOperacion();
        Cliente cliente = new Cliente();
        Catalogo sectorMercado = new Catalogo();
        Catalogo tipoGarantia = new Catalogo();
        //Objects Herramienta de clasificacion estrategica
        Catalogo actividadEconomica = new Catalogo();
        Catalogo actividadEconomicaAsociada = new Catalogo();
        Catalogo areaFocalizacion = new Catalogo();
        Catalogo ejeEstrategico = new Catalogo();
        Catalogo iniciativaEstrategica = new Catalogo();
        Catalogo rangoPaises = new Catalogo();
        Catalogo ejercicioPoa = new Catalogo();
        Producto producto = new Producto();
        Catalogo oficina = new Catalogo();
        //LOV Herramienta de clasificacion estrategica
        TiposActividadEconomicaPadreLOVImpl tiposActividadEconomicaPadreVOImpl = getTiposActividadEconomicaPadreLOV();
        TiposActividadEconomicaLOVImpl tiposActividadEconomicaVOImpl = getTiposActividadEconomicaLOV();
        TiposIniciativaEstrategicaLOVImpl tiposIniciativaEstrategicaVOImpl = getTiposIniciativaEstrategicaLOV();
        TiposCantidadPaisesBeneficiadosLOVImpl cantidadPaisesVOImpl = getTiposCantidadPaisesBeneficiadosLOV();
        TiposAreaFocalizacionLOVImpl tiposAreaFocalizacionVOImpl = getTiposAreaFocalizacionLOV();
        TiposEjeEstrategicoLOVImpl tiposEjeEstrategicoVOImpl = getTiposEjeEstrategicoLOV();
        //Operaciones asociadas
        AsociadasOperaciones asociadasOperaciones = new AsociadasOperaciones();

        // obligatory values for run services
        if (ActualizarOperacionReformularVORow.getIdOperacion() != null) {
            operacion.setIdOperacion(ActualizarOperacionReformularVORow.getIdOperacion());
        }
        if (ActualizarOperacionReformularVORow.getUsuario() != null) {
            operacion.setResponsable(ActualizarOperacionReformularVORow.getUsuario());
        }
        //mapping values "datos generales"

        if (ActualizarOperacionReformularVORow.getIdProducto() != null) {
            producto.setIdProducto(ActualizarOperacionReformularVORow.getIdProducto().longValue());
            operacion.setProducto(producto);
        }

        if (ActualizarOperacionReformularVORow.getNombre() != null) {
            operacion.setNombre(ActualizarOperacionReformularVORow.getNombre());
        } else {
            //No mapping or assignment default value
        }
        if (ActualizarOperacionReformularVORow.getDescripcion() != null) {
            operacion.setDescripcion(ActualizarOperacionReformularVORow.getDescripcion());
        } else {
            //No mapping or assignment default value
        }
        if (ActualizarOperacionReformularVORow.getMontoTotal() != null) {
            MontoOperacion montoTotal = new MontoOperacion();

            montoTotal.setIdTcaTipoMonto(FenixModelConstants.TIPO_MONTO_TOTAL);
            montoTotal.setMonto(ActualizarOperacionReformularVORow.getMontoTotal());

            montoOperacion.getMontoOperacion().add(montoTotal);
        } else {
            //No mapping or assignment default value
        }
        if (ActualizarOperacionReformularVORow.getMontoSolicitado() != null) {
            MontoOperacion montoSolicitado = new MontoOperacion();

            montoSolicitado.setIdTcaTipoMonto(FenixModelConstants.TIPO_MONTO_SOLICITADO);
            montoSolicitado.setMonto(ActualizarOperacionReformularVORow.getMontoSolicitado());

            montoOperacion.getMontoOperacion().add(montoSolicitado);

        } else {
            //No mapping or assignment default value
        }
        //Mapping idCatPais
        logger.warning("====== Mapping idCatPais");
        if (ActualizarOperacionReformularVORow.getIdCatPais() != null) {
            operacion.setIdCatPais(BigDecimal.valueOf(ActualizarOperacionReformularVORow.getIdCatPais()));
        }
        logger.warning("======  idCatPais: " +operacion.getIdCatPais());
        //mapping "clasificacion estrategica"
        //Actividad económica primaria
        if (tiposActividadEconomicaPadreVOImpl.getCurrentRow() != null) {
            Integer idActividadEconomicaPadre =
                (Integer) tiposActividadEconomicaPadreVOImpl.getCurrentRow().getAttribute("Id");
            actividadEconomica.setId(idActividadEconomicaPadre.longValue());
            actividadEconomica.setCodigoExterno((String) tiposActividadEconomicaPadreVOImpl.getCurrentRow().getAttribute("CodExterno"));
            operacion.setActividadEconomica(actividadEconomica);
        }
        //Actividad económica
        if (tiposActividadEconomicaVOImpl.getCurrentRow() != null) {
            Integer idActividadEconomica = (Integer) tiposActividadEconomicaVOImpl.getCurrentRow().getAttribute("Id");
            actividadEconomicaAsociada.setId(idActividadEconomica.longValue());
            actividadEconomicaAsociada.setCodigoExterno((String) tiposActividadEconomicaVOImpl.getCurrentRow().getAttribute("CodExterno"));
            operacion.setActividadEconomicaAsociada(actividadEconomicaAsociada);
        }
        //Iniciativa estratégica
        if (tiposIniciativaEstrategicaVOImpl.getCurrentRow() != null) {
            Integer idIniciativaEstrategica =
                (Integer) tiposIniciativaEstrategicaVOImpl.getCurrentRow().getAttribute("Id");
            iniciativaEstrategica.setId(idIniciativaEstrategica.longValue());
            operacion.setIniciativaEstrategica(iniciativaEstrategica);
        }
        //Cantidad de Países beneficiados
        if (cantidadPaisesVOImpl.getCurrentRow() != null) {
            BigDecimal idCantidadPaises =
                (BigDecimal) cantidadPaisesVOImpl.getCurrentRow().getAttribute("IdRangoPaises");
            rangoPaises.setId(idCantidadPaises.longValue());
            operacion.setCantidadPaises(rangoPaises);
        }
        //Área de focalización
        if (tiposAreaFocalizacionVOImpl.getCurrentRow() != null) {
            Integer idAreaFocalizacion = (Integer) tiposAreaFocalizacionVOImpl.getCurrentRow().getAttribute("Id");
            areaFocalizacion.setId(idAreaFocalizacion.longValue());
            operacion.setAreaFocalizacion(areaFocalizacion);
        }
        //Eje estratégico
        if (tiposEjeEstrategicoVOImpl.getCurrentRow() != null) {
            Integer idEjeEstrategico = (Integer) tiposEjeEstrategicoVOImpl.getCurrentRow().getAttribute("Id");
            ejeEstrategico.setId(idEjeEstrategico.longValue());
            operacion.setEjeEstrategico(ejeEstrategico);
        }

        //"datos adicionales" this componente

        if (ActualizarOperacionReformularVORow.getProgramadoPoaReformular() != null) {
            Boolean programadoPoa = null;
            if (ActualizarOperacionReformularVORow.getProgramadoPoaReformular() == 1) {
                programadoPoa = true;
                operacion.setProgramadoPOA(programadoPoa);
            } else {
                programadoPoa = false;
                operacion.setProgramadoPOA(programadoPoa);
            }
        }
        //valida que el ejercicio POA no sea null y mayor a cero , no puede ser 0
        if (ActualizarOperacionReformularVORow.getEjercicioPoa() != null &&
            ActualizarOperacionReformularVORow.getEjercicioPoa() > 0) {
            //valida que el campo EjercicioPoa este visible para asignar el valor
            if (esEjercicioPoa) {
                ejercicioPoa.setId(ActualizarOperacionReformularVORow.getEjercicioPoa().longValue());
                operacion.setEjercicioPOA(ejercicioPoa);
            }
        } else {
            //No mapping or assignment default value
        }
        if (ActualizarOperacionReformularVORow.getSectorMercado() != null) {
            sectorMercado.setId(ActualizarOperacionReformularVORow.getSectorMercado().longValue());
            operacion.setSectorMercado(sectorMercado);
        } else {
            //No mapping or assignment default value
        }
        if (ActualizarOperacionReformularVORow.getTipoGarantia() != null &&
            ActualizarOperacionReformularVORow.getTipoGarantia() > 0) // no puede ser 0
        {
            //valida que el campo TiposDeGarantia este visible para asignar el valor
            if (esTipoDeGarantiaSecPublico) {
                tipoGarantia.setId(ActualizarOperacionReformularVORow.getTipoGarantia().longValue());
                operacion.setTipoGarantia(tipoGarantia);
            }
        } else {
            //No mapping or assignment default value
        }
        if (ActualizarOperacionReformularVORow.getComponenteConcecionalidadReformular() != null) {
            Boolean componenteConcecionalidad = null;
            if (ActualizarOperacionReformularVORow.getComponenteConcecionalidadReformular() == 1) {
                componenteConcecionalidad = true;
                operacion.setComponenteConcesionalidad(componenteConcecionalidad);
            } else {
                componenteConcecionalidad = false;
                operacion.setComponenteConcesionalidad(componenteConcecionalidad);
            }
        }
        if (ActualizarOperacionReformularVORow.getEstructurador() != null) {
            operacion.setEstructurador(ActualizarOperacionReformularVORow.getEstructurador());
        }
        if (ActualizarOperacionReformularVORow.getPrograma() != null) {
            operacion.setPrograma(ActualizarOperacionReformularVORow.getPrograma());
        }
        if (ActualizarOperacionReformularVORow.getBeneficiario() != null) {
            operacion.setBeneficiario(ActualizarOperacionReformularVORow.getBeneficiario());
        }

        if (ActualizarOperacionReformularVORow.getUnidadEjecutora() != null) {
            //Validamos que el campo UnidadEjecutora este visible
            if (esUnidadEjecutoraSecPublico) {
                operacion.setUnidadEjecutora(ActualizarOperacionReformularVORow.getUnidadEjecutora());
            }
        }


        //mapping Cliente
        if (ActualizarOperacionReformularVORow.getIdCliente() != null) {
            cliente.setIdCliente(ActualizarOperacionReformularVORow.getIdCliente());
            oficina.setId(idOficina);
            oficina.setCodigoExterno(codExterno);
            cliente.setOficina(oficina);
            operacion.setCliente(cliente);
        } else {
            //No mapping or assignment default value
        }

        //mapping operacion asociada
        getOperacionesAsociadasVO().setRangeSize(-1);
        for (Row row : getOperacionesAsociadasVO().getAllRowsInRange()) { //obtener la lista de valores de los id de operaciones asociadas
            logger.log(ADFLogger.TRACE, "id operacion asociada:" + row.getAttribute("IdOperacion").toString());
            asociadasOperaciones.getOperacion().add(Long.valueOf(row.getAttribute("IdOperacion").toString()));
        }

        operacion.setAsociadas(asociadasOperaciones);
        operacion.setMontoOperacion(montoOperacion);

        return operacion;
    }

    public Map actualizarOperacionReformular(String codExterno, long idOficina, Boolean esEjercicioPoa,
                                             Boolean esUnidadEjecutoraSecPublico, Boolean esTipoDeGarantiaSecPublico) {
        logger.warning("====== Inside actualizarOperacionReformular");
        HashMap<String, ActualizarOperacionResponseType> respuestaServicio = null;
        String wsdl = getWsdl(IWsdlLocation.OPERACION);

        Operacion12BndQSService operacion12BndQSService =
            IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
        Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
        try {
            logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
        } catch (Exception ex) {
        }
        ActualizarOperacionRequestType request = new ActualizarOperacionRequestType();
        ActualizarOperacionResponseType response = new ActualizarOperacionResponseType();
        Operacion operacion = new Operacion();
        operacion =
            mappingActualizarOperacionReformular((CrearOperacionVORowImpl) this.getCrearOperacionVO().getRowAtRangeIndex(0),
                                                 codExterno, idOficina, esEjercicioPoa, esUnidadEjecutoraSecPublico,
                                                 esTipoDeGarantiaSecPublico);
        request.setOperacion(operacion);
        try {
            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_OPERACION_REFORMULAR);
            response = operacion12Port.actualizarOperacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_OPERACION_REFORMULAR, horaInicio);
            respuestaServicio = new HashMap<String, ActualizarOperacionResponseType>();
            respuestaServicio.put("response", response);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return respuestaServicio;
    }

    public Operacion mappingOperacionReformular(Operacion operacion, Integer idProducto) {
        CrearOperacionVORowImpl newConsultaOperacion = (CrearOperacionVORowImpl) getCrearOperacionVO().createRow();
        OperacionesAsociadasVORowImpl newOperacionesAsociadas = null;
        Catalogo ejercicioPoa = new Catalogo();
        //variable clasificación estratégica
        TiposActividadEconomicaLOVImpl tiposActividadEconomicaVOImpl = getTiposActividadEconomicaLOV();
        TiposAreaFocalizacionLOVImpl tiposAreaFocalizacionVOImpl = getTiposAreaFocalizacionLOV();
        TiposEjeEstrategicoLOVImpl tiposEjeEstrategicoLOImpl = getTiposEjeEstrategicoLOV();
        TiposActividadEconomicaPadreLOVImpl tiposActividadEconomicaPadreVOImpl = getTiposActividadEconomicaPadreLOV();
        TiposIniciativaEstrategicaLOVImpl tiposIniciativaEstrategicaVOImpl = getTiposIniciativaEstrategicaLOV();
        TiposCantidadPaisesBeneficiadosLOVImpl tiposCantidadPaisesVOImpl = getTiposCantidadPaisesBeneficiadosLOV();
        Integer idActividadEconomicaPadre;
        Integer idIniciativaEstrategica;
        BigDecimal idRangoPais;
        //to assign Actividad económica primaria
        oracle.jbo.domain.Number idActividadEconomicaNumber = new Number(0);
        oracle.jbo.domain.Number idIniciativaEstrategicaNumber = new Number(0);
        oracle.jbo.domain.Number idRangoPaisNumber = new Number(0);
        oracle.jbo.domain.Number idActividadEconomicaPadreNumber = new Number(0);
        //mapping Datos obligatorios para que funcione el servicio actualizarOperacion
        newConsultaOperacion.setIdOperacion(operacion.getIdOperacion());
        newConsultaOperacion.setUsuario(operacion.getResponsable());
        //mapping Datos generales
        if (operacion.getNombre() != null) {
            newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.NOMBRE, operacion.getNombre());
        }
        if (operacion.getCliente() != null) {
            newConsultaOperacion.setIdCliente(operacion.getCliente().getIdCliente());
        }
        if (operacion.getProducto() != null) {
            Long idOperacion = operacion.getProducto().getIdProducto();
            newConsultaOperacion.setIdProducto(idOperacion.intValue());
        } else {

        }
        if (operacion.getDescripcion() != null) {
            newConsultaOperacion.setDescripcion(operacion.getDescripcion());
        }

        MontosOperacion montosOperacion = operacion.getMontoOperacion();
        if (null != montosOperacion && montosOperacion.getMontoOperacion().size() > 0) {
            for (MontoOperacion monto : montosOperacion.getMontoOperacion()) {
                if (FenixModelConstants.TIPO_MONTO_TOTAL.compareTo(monto.getIdTcaTipoMonto()) == 0) {
                    newConsultaOperacion.setMontoTotal(monto.getMonto());
                }
                if (FenixModelConstants.TIPO_MONTO_SOLICITADO.compareTo(monto.getIdTcaTipoMonto()) == 0) {
                    newConsultaOperacion.setMontoSolicitado(monto.getMonto());
                }
            }
        }

        //mapping Clasificación estratégica

        if (operacion.getActividadEconomica() != null) {
            try {
                idActividadEconomicaNumber =
                    new oracle.jbo.domain.Number(operacion.getActividadEconomica().getId().toString());
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        if (operacion.getIniciativaEstrategica() != null) {
            try {
                idIniciativaEstrategicaNumber =
                    new oracle.jbo.domain.Number(operacion.getIniciativaEstrategica().getId().toString());
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        if (operacion.getCantidadPaises() != null) {
            try {
                idRangoPaisNumber = new oracle.jbo.domain.Number(operacion.getCantidadPaises().getId().toString());
            } catch (Exception e) {
                e.printStackTrace();
            }
        }


        //recovery value Actividad económica
        tiposActividadEconomicaVOImpl.setidActividad(idActividadEconomicaNumber);
        tiposActividadEconomicaVOImpl.executeQuery();
        //recovery value Área de focalización
        tiposAreaFocalizacionVOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposAreaFocalizacionVOImpl.setidRangoPaises(idRangoPaisNumber);
        tiposAreaFocalizacionVOImpl.executeQuery();
        //recovery value Eje estratégico
        tiposEjeEstrategicoLOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposEjeEstrategicoLOImpl.setidRangoPaises(idRangoPaisNumber);
        tiposEjeEstrategicoLOImpl.executeQuery();
        //Ejecutar query de actividad economica padre por id del producto
        tiposActividadEconomicaPadreVOImpl.setidProducto(idProducto);
        tiposActividadEconomicaPadreVOImpl.executeQuery();
        //actividad economica padre
        if (operacion.getActividadEconomica().getId() != null) {
            idActividadEconomicaPadre = operacion.getActividadEconomica().getId().intValue();
            try {
                idActividadEconomicaPadreNumber =
                    new oracle.jbo.domain.Number(operacion.getActividadEconomica().getId().toString());
            } catch (Exception e) {
                e.printStackTrace();
            }
            Row[] rowActividadEconomicaPadre =
                getTiposActividadEconomicaPadreLOV().getFilteredRows("Id", idActividadEconomicaPadre);
            for (Row row : rowActividadEconomicaPadre) {
                getTiposActividadEconomicaPadreLOV().setCurrentRow(row);
            }
        }


        if (operacion.getIniciativaEstrategica().getId() != null) {
            idIniciativaEstrategica = operacion.getIniciativaEstrategica().getId().intValue();
            tiposIniciativaEstrategicaVOImpl.setidPadre(idActividadEconomicaPadreNumber);
            tiposIniciativaEstrategicaVOImpl.executeQuery();
            Row[] rowIniciativaEstrategica =
                getTiposIniciativaEstrategicaLOV().getFilteredRows("Id", idIniciativaEstrategica);
            for (Row row : rowIniciativaEstrategica) {
                getTiposIniciativaEstrategicaLOV().setCurrentRow(row);
            }
        }

        tiposCantidadPaisesVOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposCantidadPaisesVOImpl.executeQuery();

        if (operacion.getCantidadPaises().getId() != null) {
            idRangoPais = BigDecimal.valueOf(operacion.getCantidadPaises().getId());
            Row[] rowTiposCantidadPaises =
                getTiposCantidadPaisesBeneficiadosLOV().getFilteredRows("IdRangoPaises", idRangoPais);
            for (Row row : rowTiposCantidadPaises) {
                getTiposCantidadPaisesBeneficiadosLOV().setCurrentRow(row);
            }
        }


        //mapping Datos adicionales
        if (operacion.getSectorMercado().getId() != null) {
            newConsultaOperacion.setSectorMercado(operacion.getSectorMercado().getId().intValue());
        }
        if (operacion.isProgramadoPOA() != null) {
            Boolean programadoPOA = operacion.isProgramadoPOA();
            if (programadoPOA) {
                newConsultaOperacion.setProgramadoPoaReformular(PARAM_PROGRAMADO_SI);
                //newConsultaOperacion.setProgramadoPoa(1);
            } else {
                newConsultaOperacion.setProgramadoPoaReformular(PARAM_PROGRAMADO_NO);
                //newConsultaOperacion.setProgramadoPoa(0);
            }
        }
        if (operacion.getEjercicioPOA() != null) {
            newConsultaOperacion.setEjercicioPoa(operacion.getEjercicioPOA().getId().intValue());
        }
        if (operacion.isComponenteConcesionalidad() != null) {
            if (operacion.isComponenteConcesionalidad() == true) {
                newConsultaOperacion.setComponenteConcecionalidadReformular(PARAM_COMP_CONCILIADO_SI);
            } else {
                newConsultaOperacion.setComponenteConcecionalidadReformular(PARAM_COMP_CONCILIADO_NO);
            }
        }
        if (operacion.getEstructurador() != null) {
            newConsultaOperacion.setEstructurador(operacion.getEstructurador());
        }
        if (operacion.getPrograma() != null) {
            newConsultaOperacion.setPrograma(operacion.getPrograma());
        }
        if (operacion.getBeneficiario() != null) {
            newConsultaOperacion.setBeneficiario(operacion.getBeneficiario());
        }
        if (operacion.getTipoGarantia() != null) {
            newConsultaOperacion.setTipoGarantia(operacion.getTipoGarantia().getId().intValue());
        }
        //Se agrega unidadEjecutora al mapping
        if (operacion.getUnidadEjecutora() != null) {
            newConsultaOperacion.setUnidadEjecutora(operacion.getUnidadEjecutora());
        }

        //mapping Asociar operación
        Row[] rowOperacionesAsociadas =
            getOperacionesAsociadasLOV().getFilteredRows("Idoperacion", operacion.getIdOperacion());
        for (Row row : rowOperacionesAsociadas) {
            newOperacionesAsociadas = (OperacionesAsociadasVORowImpl) getOperacionesAsociadasVO().createRow();
            newOperacionesAsociadas.setIdOperacion(Long.valueOf(row.getAttribute("Idoperacionasociada").toString()));
            newOperacionesAsociadas.setNombre(row.getAttribute("Nombreoperacionasociada").toString());
            newOperacionesAsociadas.setNombrepais(row.getAttribute("Nombrepaisasociada").toString());
            newOperacionesAsociadas.setRazonsocial(row.getAttribute("Razonsocialasociada").toString());
            getOperacionesAsociadasVO().insertRow(newOperacionesAsociadas);
        }

        getCrearOperacionVO().insertRow(newConsultaOperacion);
        getCrearOperacionVO().setCurrentRow(newConsultaOperacion);

        return operacion;

    }

    public Map consultarOperacionReformular(Long idOperacion, Integer idProducto) {
        HashMap<String, ConsultarOperacionResponseType> respuestaServicio = null;
        String wsdl = getWsdl(IWsdlLocation.OPERACION);

        Operacion12BndQSService operacion12BndQSService =
            IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
        Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
        try {
            logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
        } catch (Exception ex) {
        }
        ConsultarOperacionByIdOperacionRequestType request = new ConsultarOperacionByIdOperacionRequestType();
        //se agrega el valor del idOperacion al request
        request.setIdOperacion(idOperacion);
        try {
            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_OPERACION_REFORMULAR);
            ConsultarOperacionResponseType response = operacion12Port.consultarOperacionByIdOperacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CONSULTAR_OPERACION_REFORMULAR, horaInicio);
            Operacion operacion = mappingOperacionReformular(response.getOperacion().get(0), idProducto);
            respuestaServicio = new HashMap<String, ConsultarOperacionResponseType>();
            respuestaServicio.put("response", response);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return respuestaServicio;
    }

    public void consultarDetalleOperacion(Long idOperacion) {
        logger.log(ADFLogger.NOTIFICATION, "Entro consultarDetalleOperacion");
        CrearOperacionVOImpl consultaOperacionVO = getCrearOperacionVO();
        CrearOperacionVORowImpl newConsultaOperacion = (CrearOperacionVORowImpl) consultaOperacionVO.createRow();
        String wsdl = getWsdl(IWsdlLocation.OPERACION);

        Operacion12BndQSService operacion12BndQSService =
            IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
        Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
        try {
            logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
        } catch (Exception ex) {
        }
        try {
            // Add your code to call the desired methods.
            ConsultarOperacionByIdOperacionRequestType request = new ConsultarOperacionByIdOperacionRequestType();
            request.setIdOperacion(idOperacion);
            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_DETALLE_OPERACION);
            ConsultarOperacionResponseType obtenerOperacion = operacion12Port.consultarOperacionByIdOperacion(request);
            ModelUtils.logEndWS(logger, obtenerOperacion, FenixModelConstants.WSC_CONSULTAR_DETALLE_OPERACION,
                                horaInicio);
            List<Operacion> listaOperacionesObtenidas = obtenerOperacion.getOperacion();
            if (!listaOperacionesObtenidas.isEmpty()) {
                Operacion operacion = listaOperacionesObtenidas.get(0);

                if (operacion.getActividadEconomica() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.ACTIVIDADECONOMICA,
                                                      operacion.getActividadEconomica().getId());
                if (operacion.getNombre() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.NOMBRE, operacion.getNombre());
                if (operacion.getCliente() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.IDCLIENTE,
                                                      operacion.getCliente().getIdCliente());
                if (operacion.getProducto() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.IDPRODUCTO,
                                                      operacion.getProducto().getIdProducto());
                if (operacion.getDescripcion() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.DESCRIPCION, operacion.getDescripcion());
                if (operacion.isProgramadoPOA() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.PROGRAMADOPOA,
                                                      operacion.isProgramadoPOA());
                if (operacion.getTipoGarantia() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.TIPOGARANTIA,
                                                      operacion.getTipoGarantia().getId());
                if (operacion.getEjercicioPOA() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.EJERCICIOPOA,
                                                      operacion.getEjercicioPOA().getId());
                if (operacion.getUnidadEjecutora() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.UNIDADEJECUTORA,
                                                      operacion.getUnidadEjecutora());
                if (operacion.getActividadEconomica() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.ACTIVIDADECONOMICA,
                                                      operacion.getActividadEconomica().getId());
                if (operacion.getIniciativaEstrategica() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.INICIATIVAESTRATEGICA,
                                                      operacion.getIniciativaEstrategica().getId());
                if (operacion.getCantidadPaises() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.IDRANGOPAIS,
                                                      operacion.getCantidadPaises().getId());
                if (operacion.getAreaFocalizacion() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.AREAFOCALIZACION,
                                                      operacion.getAreaFocalizacion().getId());
                if (operacion.getEjeEstrategico() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.EJEESTRATEGICO,
                                                      operacion.getEjeEstrategico().getId());


                MontosOperacion montosOperacion = operacion.getMontoOperacion();
                if (null != montosOperacion && montosOperacion.getMontoOperacion().size() > 0) {
                    for (MontoOperacion monto : montosOperacion.getMontoOperacion()) {
                        if (FenixModelConstants.TIPO_MONTO_TOTAL.compareTo(monto.getIdTcaTipoMonto()) == 0) {
                            newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.MONTOTOTAL, monto.getMonto());
                        }
                        if (FenixModelConstants.TIPO_MONTO_SOLICITADO.compareTo(monto.getIdTcaTipoMonto()) == 0) {
                            newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.MONTOSOLICITADO,
                                                              monto.getMonto());
                        }
                    }
                }


                if (operacion.getEstructurador() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.ESTRUCTURADOR,
                                                      operacion.getEstructurador());
                if (operacion.getBeneficiario() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.BENEFICIARIO,
                                                      operacion.getBeneficiario());
                if (operacion.getPrograma() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.PROGRAMA, operacion.isProgramadoPOA());
                if (operacion.isComponenteConcesionalidad() != null)
                    newConsultaOperacion.setAttribute(CrearOperacionVORowImpl.COMPONENTECONCECIONALIDAD,
                                                      operacion.isComponenteConcesionalidad());
                consultaOperacionVO.insertRow(newConsultaOperacion);
                consultaOperacionVO.setCurrentRow(newConsultaOperacion);

            } else {
                logger.log(ADFLogger.WARNING, "No se recupero ninguna operacion");
            }

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage().toString());
        }
    }


    public Operacion mappingOperacionSuspenderCancelar(SuspenderCancelarOperacionVORowImpl suspenderCancelarOperacionRow) {
        Operacion operacion = new Operacion();
        MontosOperacion montoOperacion = new MontosOperacion();
        Cliente cliente = new Cliente();
        Producto producto = new Producto();
        operacion.setNombre(suspenderCancelarOperacionRow.getNombre());
        operacion.setDescripcion(suspenderCancelarOperacionRow.getDescripcion());
        producto.setIdProducto(suspenderCancelarOperacionRow.getIdProducto().longValue());
        operacion.setProducto(producto);
        cliente.setIdCliente(suspenderCancelarOperacionRow.getIdCliente());

        if (suspenderCancelarOperacionRow.getMontoSolicitado() != null) {
            MontoOperacion montoTotal = new MontoOperacion();

            montoTotal.setIdTcaTipoMonto(FenixModelConstants.TIPO_MONTO_SOLICITADO);
            montoTotal.setMonto(suspenderCancelarOperacionRow.getMontoSolicitado());

            montoOperacion.getMontoOperacion().add(montoTotal);
        }

        operacion.setCliente(cliente);
        operacion.setMontoOperacion(montoOperacion);
        return operacion;
    }

    public Operacion mappingOperacion(CrearOperacionVORowImpl crearOperacionRow, String codExterno, long idOficina,
                                      Boolean esEjercicioPoa, Boolean esUnidadEjecutoraSecPublico,
                                      Boolean esTipoDeGarantiaSecPublico) {
        logger.log(ADFLogger.TRACE, "Inside mappingOperacion.");
        Operacion operacion = new Operacion();
        MontosOperacion montoOperacion = new MontosOperacion();
        Cliente cliente = new Cliente();
        Catalogo actividadEconomica = new Catalogo();
        Catalogo actividadEconomicaAsociada = new Catalogo();
        Catalogo areaFocalizacion = new Catalogo();
        Catalogo ejeEstrategico = new Catalogo();
        Catalogo iniciativaEstrategica = new Catalogo();
        Catalogo rangoPaises = new Catalogo();
        Catalogo sectorMercado = new Catalogo();
        AsociadasOperaciones asociadas = new AsociadasOperaciones();
        Catalogo cantidadPaises = new Catalogo();
        Catalogo estado = new Catalogo();
        Catalogo oficina = new Catalogo();
        Producto producto = new Producto();
        AsociadasOperaciones asociadasOperaciones = new AsociadasOperaciones();
        Catalogo ejercicioPoa = new Catalogo();
        Catalogo tipoGarantia = new Catalogo();
        ClasificacionEstrategicaMultisectorial clasificaionEstrategica = new ClasificacionEstrategicaMultisectorial();
        InsertClasificacionAmbiental insertClasificacionAmbiental = new InsertClasificacionAmbiental();
        List<ComponenteClasificacionEstrategicaType> componentes = new ArrayList<ComponenteClasificacionEstrategicaType>();
        Catalogo sectorIbcie = new Catalogo();
        Catalogo subSectorIbcie = new Catalogo();
        //***************Datos generales***************

        if (crearOperacionRow.getUsuario() != null)
            operacion.setResponsable(crearOperacionRow.getUsuario());

        // if(crearOperacionRow.getOficina()!=null)
        operacion.setOficina(Long.toString(idOficina));

        if (crearOperacionRow.getNombre() != null)
            operacion.setNombre(crearOperacionRow.getNombre());

        if (crearOperacionRow.getIdCliente() != null) {
            cliente.setIdCliente(crearOperacionRow.getIdCliente());
            oficina.setId(idOficina);
            oficina.setCodigoExterno(codExterno);
            cliente.setOficina(oficina);
            operacion.setCliente(cliente);
        }

        if (crearOperacionRow.getIdProducto() != null) {
            producto.setIdProducto(crearOperacionRow.getIdProducto().longValue());
            operacion.setProducto(producto);
        }

        // Mapeos de "Sector Institucional" y "Encargado" - 21/sept/2020
        logger.info("Location operacionbo: " + operacion.getClass().getProtectionDomain().getCodeSource().getLocation());
        logger.info("IdSectorInstitucional: " + crearOperacionRow.getIdSectorInstitucional());
        logger.info("IdEncargado: " + crearOperacionRow.getIdEncargado());
        if (crearOperacionRow.getIdSectorInstitucional() != null)
            operacion.setIdSectorInstitucional(crearOperacionRow.getIdSectorInstitucional().longValue());

        if (crearOperacionRow.getIdEncargado() != null)
            operacion.setIdEncargado(crearOperacionRow.getIdEncargado().longValue());
        

        if (crearOperacionRow.getDescripcion() != null)
            operacion.setDescripcion(crearOperacionRow.getDescripcion());

        // Mapeo de "Ubicación del proyecto" - 11/dic/2020
        logger.info("UbicacionProyecto: " + crearOperacionRow.getUbicacionProyecto());
        if (crearOperacionRow.getUbicacionProyecto() != null)
            operacion.setUbicacionProyecto(crearOperacionRow.getUbicacionProyecto());
        // Mapeo de "IdCatPais" - 31/may/2021
        logger.info("idCatPais: " + crearOperacionRow.getIdCatPais());
        if (crearOperacionRow.getIdCatPais() != null)
            operacion.setIdCatPais(BigDecimal.valueOf(crearOperacionRow.getIdCatPais()));


        if (crearOperacionRow.getMontoTotal() != null) {
            MontoOperacion montoTotal = new MontoOperacion();

            montoTotal.setIdTcaTipoMonto(FenixModelConstants.TIPO_MONTO_TOTAL);
            montoTotal.setMonto(crearOperacionRow.getMontoTotal());
            
            logger.warning("Tipo moneda Monto Total: " + crearOperacionRow.getIdTcaTipoMoneda());
            montoTotal.setIdTcaTipoMonedaMontoOperacion(crearOperacionRow.getIdTcaTipoMoneda());
    
            montoOperacion.getMontoOperacion().add(montoTotal);
        } else {
            //No mapping or assignment default value
        }
        if (crearOperacionRow.getMontoSolicitado() != null) {
            MontoOperacion montoSolicitado = new MontoOperacion();

            montoSolicitado.setIdTcaTipoMonto(FenixModelConstants.TIPO_MONTO_SOLICITADO);
            montoSolicitado.setMonto(crearOperacionRow.getMontoSolicitado());

            logger.warning("Tipo moneda Monto Solicitado: " + crearOperacionRow.getIdTcaTipoMoneda());
            montoSolicitado.setIdTcaTipoMonedaMontoOperacion(crearOperacionRow.getIdTcaTipoMoneda());

            montoOperacion.getMontoOperacion().add(montoSolicitado);

        } else {
            //No mapping or assignment default value
        }

        // Id TCA Tipo Moneda
        if (crearOperacionRow.getIdTcaTipoMoneda() != null) {
            logger.warning("Tipo moneda: " + crearOperacionRow.getIdTcaTipoMoneda());
            operacion.setIdTcaTipoMoneda(crearOperacionRow.getIdTcaTipoMoneda());
        } else {
            //No mapping or assignment default value
        }

        //if (crearOperacionRow.getLineaCredito() != null)
        //    operacion.setLineaCredito(crearOperacionRow.getLineaCredito());

        //S&P | 07/07/2019 | Se anexa mapeo de valor Multisectorial
        if (crearOperacionRow.getEsMultisectorial() != null) {
            boolean multisectorial = false;
            if (crearOperacionRow.getEsMultisectorial() == 1) {
                multisectorial = true;
            }
            operacion.setEsMultisectorial(multisectorial);
        }

        //***************Clasificación estratégica***************

        if (crearOperacionRow.getEsMultisectorial() == 1) {
            //Se mapean los valores hacia arreglo multisectorial
           
            ViewObjectImpl vo = getClasificacionEstrategicaVO1();
            RowSetIterator iter = vo.createRowSetIterator(null);
            while (iter.hasNext()) {
                Row row = iter.next();
                ComponenteClasificacionEstrategicaType componente = new ComponenteClasificacionEstrategicaType();
                Catalogo actividadEconomicaMS = new Catalogo();
                Catalogo actividadEconomicaAsociadaMS = new Catalogo();
                Catalogo areaFocalizacionMS = new Catalogo();
                Catalogo ejeEstrategicoMS = new Catalogo();
                Catalogo iniciativaEstrategicaMS = new Catalogo();
                Catalogo rangoPaisesMS = new Catalogo();
                Catalogo sectorIbcieMS = new Catalogo();
                Catalogo subSectorIbcieMS = new Catalogo();
              
              //Nombre
                componente.setNombreComponente((String) row.getAttribute("nombre"));
                //Descripcion
                componente.setDescripcion((String) row.getAttribute("descripcion"));
                //Porcentaje
                componente.setPorcentaje(new BigDecimal((String) row.getAttribute("porcentaje")));
              //Actividad Economica Primaria
                String actividad = (String) row.getAttribute("actividadEconomica");
                String [] aep = actividad.split("-");
                actividadEconomicaMS.setId(new Long(aep[0]).longValue()); 
                actividadEconomicaMS.setCodigoExterno(aep[1]); 
                componente.setActividadEconomica(actividadEconomicaMS);
                
                
                // Asignamos Actividad económica
                String actividadAs = (String) row.getAttribute("actividadEconomicaAsociada");
                String [] aepas = actividadAs.split("-");
                actividadEconomicaAsociadaMS.setId(new Long(aepas[0]).longValue()); 
                actividadEconomicaAsociadaMS.setCodigoExterno(aepas[1]); 
                componente.setActividadEconomicaAsociada(actividadEconomicaAsociadaMS);
                
                // Asignamos Iniciativa estratégica
                String iniEs = (String) row.getAttribute("iniciativaEstrategica");
                String [] iniEst = iniEs.split("-");
                iniciativaEstrategicaMS.setId(new Long(iniEst[0]).longValue());
                componente.setIniciativaEstrategica(iniciativaEstrategicaMS);
                
                // Asignamos Cantidad de Países beneficiados
                String rangopais = (String) row.getAttribute("cantidadPaises");
                String [] paises = rangopais.split("-");
                rangoPaisesMS.setId(new Long(paises[1]).longValue());
                componente.setCantidadPaises(rangoPaisesMS);
               
                // Asignamos Área de focalización
                areaFocalizacionMS.setId(new Long((String) row.getAttribute("areaFocalizacion")).longValue());
                componente.setAreaFocalizacion(areaFocalizacionMS);
                
                // Asignamos Eje estratégico
                ejeEstrategicoMS.setId(new Long((String) row.getAttribute("ejeEstrategico")).longValue());
                componente.setEjeEstrategico(ejeEstrategicoMS);
                
                 clasificaionEstrategica.getComponenteClasificacionEstrategica().add(componente);
                
                // Asignamos Sector Ibcie
                logger.info("SectorIbcie: " + row.getAttribute("sectorIbcie"));
                if ((row.getAttribute("sectorIbcie") != null) && (row.getAttribute("sectorIbcie").toString().trim().length() > 0)) {
                    sectorIbcieMS.setId(new Long((String) row.getAttribute("sectorIbcie"))); 
                    componente.setSectorIbcie(sectorIbcieMS);
                }
                
                // Asignamos SubSector Ibcie
                logger.info("SubSectorIbcie: " + row.getAttribute("subSectorIbcie"));
                if ((row.getAttribute("subSectorIbcie") != null) && (row.getAttribute("subSectorIbcie").toString().trim().length() > 0)) {
                    subSectorIbcieMS.setId(new Long((String) row.getAttribute("subSectorIbcie"))); 
                    componente.setSubSectorIbcie(subSectorIbcieMS);
                }
            }
            iter.closeRowSetIterator();
            
            // Se hace set de clasificacion multisectorial 
             operacion.setClasificacionEstrategicaMultisectorial(clasificaionEstrategica);
             
            //Workaround - Cuando sea multisectorial pasar lo valores de uno de los componentes a  las variables iniciales de  CE
            // ya que no pueden ir nulos 
             
            Row row = vo.first();
            // Asignamos Actividad económica primaria
            String actividad = (String) row.getAttribute("actividadEconomica");
            String [] aep = actividad.split("-");
            actividadEconomica.setId(new Long(aep[0]).longValue()); //(1000L);
            actividadEconomica.setCodigoExterno(aep[1]); //("G47060400");
            operacion.setActividadEconomica(actividadEconomica);
   
            // Asignamos Actividad económica
            String actividadAs = (String) row.getAttribute("actividadEconomicaAsociada");
            String [] aepas = actividadAs.split("-");
            actividadEconomicaAsociada.setId(new Long(aepas[0]).longValue()); 
            actividadEconomicaAsociada.setCodigoExterno(aepas[1]); 
            operacion.setActividadEconomicaAsociada(actividadEconomicaAsociada);
           

            // Asignamos Iniciativa estratégica
            String iniEs = (String) row.getAttribute("iniciativaEstrategica");
            String [] iniEst = iniEs.split("-");
            iniciativaEstrategica.setId(new Long(iniEst[0]).longValue());
            operacion.setIniciativaEstrategica(iniciativaEstrategica);
               
           

            // Asignamos Cantidad de Países beneficiados
            String rangopais = (String) row.getAttribute("cantidadPaises");
            String [] paises = rangopais.split("-");
            rangoPaises.setId(new Long(paises[1]).longValue());
            operacion.setCantidadPaises(rangoPaises);
               
         

            // Asignamos Área de focalización
            areaFocalizacion.setId(new Long((String) row.getAttribute("areaFocalizacion")).longValue());
            operacion.setAreaFocalizacion(areaFocalizacion);

            // Asignamos Eje estratégico  
            ejeEstrategico.setId(new Long((String) row.getAttribute("ejeEstrategico")).longValue());
            operacion.setEjeEstrategico(ejeEstrategico);
 
        } else {
            ComponenteClasificacionEstrategicaType componente = new ComponenteClasificacionEstrategicaType();
          
            // Asignamos Actividad económica primaria
            actividadEconomica.setId(crearOperacionRow.getActividadEconomica().longValue()); //(1000L);
            actividadEconomica.setCodigoExterno(crearOperacionRow.getCodigoExterno()); //("G47060400");
            operacion.setActividadEconomica(actividadEconomica);
            componente.setActividadEconomica(actividadEconomica);

            // Asignamos Actividad económica
            actividadEconomicaAsociada.setId(crearOperacionRow.getIdActividadEconomicaAsoc().longValue()); //(1000L);
            actividadEconomicaAsociada.setCodigoExterno(crearOperacionRow.getCodigoExternoAsoc()); //("G47060400");
            operacion.setActividadEconomicaAsociada(actividadEconomicaAsociada);
            componente.setActividadEconomicaAsociada(actividadEconomicaAsociada);

            // Asignamos Iniciativa estratégica
            if (crearOperacionRow.getIniciativaEstrategica() != null) {
                iniciativaEstrategica.setId(crearOperacionRow.getIniciativaEstrategica().longValue());
                operacion.setIniciativaEstrategica(iniciativaEstrategica);
                componente.setIniciativaEstrategica(iniciativaEstrategica);
            }

            // Asignamos Cantidad de Países beneficiados
            if (crearOperacionRow.getIdRangoPais() != null) {
                rangoPaises.setId(crearOperacionRow.getIdRangoPais().longValue());
                operacion.setCantidadPaises(rangoPaises);
                componente.setCantidadPaises(rangoPaises);
            }

            // Asignamos Área de focalización
            if (crearOperacionRow.getAreaFocalizacion() != null) {
                areaFocalizacion.setId(crearOperacionRow.getAreaFocalizacion().longValue());
                operacion.setAreaFocalizacion(areaFocalizacion);
                componente.setAreaFocalizacion(areaFocalizacion);
            }

            // Asignamos Eje estratégico
            if (crearOperacionRow.getEjeEstrategico() != null) {
                ejeEstrategico.setId(crearOperacionRow.getEjeEstrategico().longValue());
                operacion.setEjeEstrategico(ejeEstrategico);
                componente.setEjeEstrategico(ejeEstrategico);
            }
            
            // Asignamos "Sector I-BCIE" - 11/dic/2020
            logger.info("IdSectorIbcie: " + crearOperacionRow.getIdSectorIbcie());
            if (crearOperacionRow.getIdSectorIbcie() != null) {
                sectorIbcie.setId(new Long(crearOperacionRow.getIdSectorIbcie()));
                componente.setSectorIbcie(sectorIbcie);
            }
            
            // Asignamos "Sub-sector I-BCIE" - 11/dec/2020
            logger.info("IdSubSectorIbcie: " + crearOperacionRow.getIdSubSectorIbcie());
            if (crearOperacionRow.getIdSubSectorIbcie() != null) {
                subSectorIbcie.setId(new Long(crearOperacionRow.getIdSubSectorIbcie()));
                componente.setSubSectorIbcie(subSectorIbcie);
            }
            
            componente.setNombreComponente(null);
            componente.setDescripcion(null);
            componente.setPorcentaje(new BigDecimal("100"));

            clasificaionEstrategica.getComponenteClasificacionEstrategica().add(componente);
            operacion.setClasificacionEstrategicaMultisectorial(clasificaionEstrategica);
        }
        
        
        // ====  S&P | 19/10/2019 | Clasificacion Ambiental ========= //
        ViewObjectImpl voCA = getClasificacionAmbientalVO1();
        RowSetIterator iterCA = voCA.createRowSetIterator(null);
        while (iterCA.hasNext()) {
            Row rowCA = iterCA.next();
          
           ComponenteClasificacionAmbientalType componenteCA = new ComponenteClasificacionAmbientalType();
          //Sector
            Catalogo sectorAmbiental = new Catalogo();
            sectorAmbiental.setId(new Long((String)rowCA.getAttribute("idSector")).longValue());
            componenteCA.setSectorAmbiental(sectorAmbiental);      
            
            //Aporte
            Catalogo aporteAmbiental = new Catalogo();
              aporteAmbiental.setId(new Long((String)rowCA.getAttribute("idAporte")).longValue());
              componenteCA.setAporteAmbiental(aporteAmbiental);   
            
            //Categoria
            Catalogo categoriaAmbiental = new Catalogo();
              categoriaAmbiental.setId(new Long((String)rowCA.getAttribute("idCategoria")).longValue());
              componenteCA.setCategoriaAmbiental(categoriaAmbiental);  
          
            //SubCategoria
            Catalogo subCategoriaAmbiental = new Catalogo();
              subCategoriaAmbiental.setId(new Long((String)rowCA.getAttribute("idSubcategoria")).longValue());
              componenteCA.setSubCategoriaAmbiental(subCategoriaAmbiental);  
            
             insertClasificacionAmbiental.getComponenteClasificacionAmbiental().add(componenteCA);        
        }
        iterCA.closeRowSetIterator();
        
        // Se hace set de clasificacion
        logger.warning("\n=== setInsertClasificacionAmbiental en operacion ");
         operacion.setInsertClasificacionAmbiental(insertClasificacionAmbiental); 
         
        

        // ============  Fin Clasificacion Ambiental ================ //


        //**********************Datos adicionales**********************

        if (crearOperacionRow.getSectorMercado() != null) {
            sectorMercado.setId(crearOperacionRow.getSectorMercado().longValue());
            operacion.setSectorMercado(sectorMercado);
        }

        if (crearOperacionRow.getProgramadoPoaReformular() != null) {
            Boolean programadoPoa = null;
            if (crearOperacionRow.getProgramadoPoaReformular() == 1) {

                programadoPoa = true;
                operacion.setProgramadoPOA(programadoPoa);
            } else {

                programadoPoa = false;
                operacion.setProgramadoPOA(programadoPoa);
            }
        }

        if (crearOperacionRow.getEjercicioPoa() != null) {
            //valida que el campo EjercicioPoa este visible para asignar el valor
            if (esEjercicioPoa) {
                ejercicioPoa.setId(crearOperacionRow.getEjercicioPoa().longValue());
                operacion.setEjercicioPOA(ejercicioPoa);
            }
        }

        if (crearOperacionRow.getTipoGarantia() != null) {
            //valida que el campo TiposDeGarantia este visible para asignar el valor
            if (esTipoDeGarantiaSecPublico) {
                tipoGarantia.setId(crearOperacionRow.getTipoGarantia().longValue());
                operacion.setTipoGarantia(tipoGarantia);
            }
        } 

        if (crearOperacionRow.getComponenteConcecionalidadReformular() != null) {
            Boolean componenteConcecionalidad = null;
            if (crearOperacionRow.getComponenteConcecionalidadReformular() == 1) {
                componenteConcecionalidad = true;
                operacion.setComponenteConcesionalidad(componenteConcecionalidad);
            } else {
                componenteConcecionalidad = false;
                operacion.setComponenteConcesionalidad(componenteConcecionalidad);
            }
        }
        if (crearOperacionRow.getEstructurador() != null) {
            operacion.setEstructurador(crearOperacionRow.getEstructurador());
        }

        if (crearOperacionRow.getBeneficiario() != null) {
            operacion.setBeneficiario(crearOperacionRow.getBeneficiario());
        }

        if (crearOperacionRow.getPrograma() != null) {
            operacion.setPrograma(crearOperacionRow.getPrograma());
        }

        if (crearOperacionRow.getUnidadEjecutora() != null) {
            //Validamos que el campo UnidadEjecutora este visible
            if (esUnidadEjecutoraSecPublico) {
                operacion.setUnidadEjecutora(crearOperacionRow.getUnidadEjecutora());
            }
        }


        // Asignamos etapa: por default es 1 = Elegibilidad
        operacion.setEtapa(PARAM_ETAPA_ELEGIBILIDAD); // operacion.setEtapa(crearOperacionRow.getEtapa());

        //if(crearOperacionRow.getcalificacionRiesgo()!=null){
        //CalificacionRiesgo no es necesaria al crea Operacion
        //operacion.setCalificacionRiesgo("3");//}

        //if(crearOperacionRow.getIdEstado()!=null){
        estado.setId(PARAM_INIT_ID);
        operacion.setEstado(estado); //}


        // set operacionesAsociadas
        getOperacionesAsociadasVO().setRangeSize(-1);
        for (Row row : getOperacionesAsociadasVO().getAllRowsInRange()) { //obtener la lista de valores de los id de operaciones asociadas
            logger.log(ADFLogger.TRACE, "id operacion asociada:" + row.getAttribute("IdOperacion").toString());
            asociadasOperaciones.getOperacion().add(Long.valueOf(row.getAttribute("IdOperacion").toString()));
        }

        operacion.setAsociadas(asociadasOperaciones);
        operacion.setMontoOperacion(montoOperacion);

        return operacion;
    }

    public Long validarEstadoOperacion(String idOperacion) {
        logger.warning("Operacion entra: " + idOperacion);

        if (idOperacion != null && idOperacion.trim().length() > 0) {
            DetalleOperacionVOImpl detalleOperacionVO = getDetalleOperacionVO();
            DetalleOperacionVORowImpl newDetalleOperacion = (DetalleOperacionVORowImpl) detalleOperacionVO.createRow();

            String wsdl = getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
            } catch (Exception ex) {
            }

            ConsultarOperacionByIdOperacionRequestType request = new ConsultarOperacionByIdOperacionRequestType();

            request.setIdOperacion(Long.parseLong(idOperacion));

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_VALIDAR_ESTADO_OPERACION);
            ConsultarOperacionResponseType obtenerOperacion = operacion12Port.consultarOperacionByIdOperacion(request);
            ModelUtils.logEndWS(logger, obtenerOperacion, FenixModelConstants.WSC_VALIDAR_ESTADO_OPERACION, horaInicio);

            List<Operacion> listaOperqacionesObtenidas = obtenerOperacion.getOperacion();

            Operacion operacionUnica = listaOperqacionesObtenidas.get(0);
            System.out.println("LAFT: " + operacionUnica.getEstado());
            return operacionUnica.getEstado().getId();
        }
        System.out.println("Error al encontrar el proceso LAFT");
        return 0L;
    }

    public Boolean validaProcesos(String operacion, Integer proceso) {
        logger.warning("Inside validaProcesos.");
        logger.warning("operacion: " + operacion);
        logger.warning("proceso: " + proceso);

        ViewObjectImpl treProcesoVO = getTreTareaProcesoBpmVO();
        Long procesoActivo = 0L;
        try {
            ViewCriteria validaProcesoBpm =
                treProcesoVO.getViewCriteriaManager().getViewCriteria("TreTareaProcesoBpmVOCriteria");
            validaProcesoBpm.ensureVariableManager().setVariableValue("operacionId", operacion);
            validaProcesoBpm.ensureVariableManager().setVariableValue("procesoId", proceso);
            treProcesoVO.applyViewCriteria(validaProcesoBpm);
            treProcesoVO.executeQuery();
            procesoActivo = treProcesoVO.getEstimatedRowCount();
        } catch (Exception ex) {
            procesoActivo = 0L;
            logger.log(ADFLogger.ERROR, "Error en validarProceso " + ex.getClass() + ":" + ex.getMessage());
            return false;
        } finally {
            treProcesoVO.getViewCriteriaManager().removeApplyViewCriteriaName("TreTareaProcesoBpmVOCriteria");
        }
        if (procesoActivo > 0) {
            return true;
        }

        logger.warning("Termina validaProcesos.");
        return false;
    }

    public Boolean validaProcesosCliente(Long cliente, Integer proceso) {
        logger.warning("Inside validaProcesosCliente.");
        logger.warning("cliente: " + cliente);
        logger.warning("proceso: " + proceso);

        ViewObjectImpl treClienteProcesoVO = getTreClienteProcesoBpmVO();
        Long procesoActivo = 0L;
        try {
            ViewCriteria validaClienteProcesoBpm =
                treClienteProcesoVO.getViewCriteriaManager().getViewCriteria("TreClienteProcesoBpmVOCriteria");
            validaClienteProcesoBpm.ensureVariableManager().setVariableValue("clienteId", cliente);
            validaClienteProcesoBpm.ensureVariableManager().setVariableValue("procesoId", proceso);
            treClienteProcesoVO.applyViewCriteria(validaClienteProcesoBpm);
            treClienteProcesoVO.executeQuery();
            procesoActivo = treClienteProcesoVO.getEstimatedRowCount();
        } catch (Exception ex) {
            procesoActivo = 0L;
            logger.log(ADFLogger.ERROR, "Error en validarProceso " + ex.getClass() + ":" + ex.getMessage());
            return false;
        } finally {
            treClienteProcesoVO.getViewCriteriaManager().removeApplyViewCriteriaName("TreClienteProcesoBpmVOCriteria");
        }
        if (procesoActivo > 0) {
            return true;
        }

        logger.warning("Termina validaProcesosCliente.");
        return false;
    }

    public oracle.jbo.domain.Timestamp obtenerFechaFlexcube() {
        FechaCalendarioVOImpl fechaCalendarioVo = getFechaCalendarioVO();
        // fechaCalendarioVo.getAllRowFinders();
        Timestamp fechaFlexcube;
        Row row = fechaCalendarioVo.getRowAtRangeIndex(0);
        fechaFlexcube = (Timestamp) row.getAttribute("FechaCalendario");
        oracle.jbo.domain.Timestamp calendario = new oracle.jbo.domain.Timestamp(fechaFlexcube.getTime());
        return calendario;
    }

    public Boolean datosCargo(String idOperacion) {
        CargoVOImpl cargoVO = getCargoVO();

        CargoVORowImpl newCargo = (CargoVORowImpl) cargoVO.createRow();
        //Inicio Fix FNXII-1591 se cambia la secuencia de CARGO_TRAMITE A COMISION
        SequenceImpl sqCargo = new SequenceImpl("COMISION_SEQ", getDBTransaction());
        //Fin Fix FNXII-1591
        Date fechaActual = new Date();
        newCargo.setAttribute(CargoVORowImpl.ID, sqCargo.getSequenceNumber());
        System.out.println("Operacion: " + idOperacion);
        System.out.println("Id cargo : " + newCargo.getAttribute(CargoVORowImpl.ID));
        newCargo.setAttribute(CargoVORowImpl.IDOPERACION, idOperacion);
        newCargo.setAttribute(CargoVORowImpl.BANESTATUS, BANESTATUS_TRUE);
        newCargo.setAttribute(CargoVORowImpl.COMISIONCOMPARTIDA, COMISIONCOMPARTIDA_DEFAULT);
        newCargo.setAttribute(CargoVORowImpl.FECHAREGISTRO, new oracle.jbo.domain.Timestamp(fechaActual.getTime()));
        newCargo.setAttribute(CargoVORowImpl.IDTCAESTADOTCC, IDTCAESTADOTCC_DEFAULT);
        newCargo.setAttribute(CargoVORowImpl.IDTCASUBESTADOTCC, IDTCASUBESTADOTCC_DEFAULT);
        newCargo.setAttribute(CargoVORowImpl.BANSUGERIDA, BANSUGERIDA_DEFAULT);
        cargoVO.insertRow(newCargo);
        cargoVO.setCurrentRow(newCargo);
        return true;
    }

    /*TODO Agregar un parametro String para obtener el usuario de sesion y setear al atributo "responsable"
     * del objeto "Operacion".
     * Dicho dato es requerido para la actualizacion de la operacion.
     */
    public boolean ingresarRAROC(Float RAROC, String idOperacion, String loginUsuario) {
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        try {
            String wsdl = getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();

            if (idOperacion != null && idOperacion.trim().length() > 0) {
                DetalleOperacionVOImpl detalleOperacionVO = getDetalleOperacionVO();
                DetalleOperacionVORowImpl newDetalleOperacion =
                    (DetalleOperacionVORowImpl) detalleOperacionVO.createRow();
                Operacion operacionUnica = new Operacion();


                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
                } catch (Exception ex) {
                }


                operacionUnica.setIdOperacion(Long.parseLong(idOperacion));
                operacionUnica.setRAROC(RAROC);
                operacionUnica.setResponsable(loginUsuario);

                ActualizarOperacionRequestType request = new ActualizarOperacionRequestType();
                request.setOperacion(operacionUnica);

                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_INGRESAR_RAROC);
                ActualizarOperacionResponseType response = operacion12Port.actualizarOperacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_INGRESAR_RAROC, horaInicio);

                String mensajeError = "";
                //String detalleError = "";

                if (response.getResultado().getResult().value().equalsIgnoreCase("ERROR")) {

                    if (null != response.getResultado().getMessage() &&
                        response.getResultado().getMessage().trim().length() > 0) {
                        mensajeError = response.getResultado().getMessage();
                    }
                    /*
                    if (null != response.getResultado().getError().getErrorDescription() &&
                        response.getResultado().getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getResultado().getError().getErrorDescription();
                    }*/

                    existeError = Boolean.TRUE;
                    msgError =
                        "La operación: " + idOperacion + ". Marca lo siguiente: " +
                        mensajeError; //+ ". Detalle: " + detalleError;

                    return false;
                } else {
                    return true;
                }

            } else {
                return false;
            }


        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en ingresarRAROC " + e.getClass() + ":" + e.getMessage());
            msgError = e.getMessage();
            return false;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }

        }

    }

    /*TODO Agregar un parametro String para obtener el usuario de sesion y setear al atributo "responsable"
     * del objeto "Operacion".
     * Dicho dato es requerido para la actualizacion de la operacion.
     */
    public boolean actualizarResponsableOperacion(Long idOperacion, String loginUsuario) {
        logger.warning("Dentro de actualizarResponsableOperacion");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("loginUsuario :" + loginUsuario);
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean actualizarResponsable = Boolean.TRUE;
        try {
            String wsdl = getWsdl(IWsdlLocation.OPERACION);
            logger.warning("wsdl : " + wsdl);
            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();

            if (idOperacion != null) {
                Operacion operacionUnica = new Operacion();


                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
                } catch (Exception ex) {

                }

                operacionUnica.setIdOperacion(idOperacion);
                operacionUnica.setResponsable(loginUsuario);

                ActualizarOperacionRequestType request = new ActualizarOperacionRequestType();
                request.setOperacion(operacionUnica);
                request.setReasignar(actualizarResponsable);

                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_RESPONSABLE_OPERACION);
                ActualizarOperacionResponseType response = operacion12Port.actualizarOperacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_RESPONSABLE_OPERACION, horaInicio);

                String mensajeError = "";

                if (response.getResultado().getResult().value().equalsIgnoreCase("ERROR")) {

                    if (null != response.getResultado().getMessage() &&
                        response.getResultado().getMessage().trim().length() > 0) {
                        mensajeError = response.getResultado().getMessage();
                    }

                    existeError = Boolean.TRUE;
                    msgError =
                        "La operación: " + idOperacion + ". Marca lo siguiente: " +
                        mensajeError; //+ ". Detalle: " + detalleError;

                    return false;
                } else {
                    return true;
                }

            } else {
                return false;
            }


        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR,
                       "Error en Actualizar responsable de operacion " + e.getClass() + ":" + e.getMessage());
            msgError = e.getMessage();
            return false;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }

            logger.warning("Fuera de actualizarResponsableOperacion");
        }

    }

    public boolean cambiarResponsableOperacionBpm(Long idOperacion, String loginUsuario) {
        logger.log(ADFLogger.WARNING, "Entrando en cambiarResponsableOperacionBpm.");
        logger.log(ADFLogger.WARNING, "idOperacion: " + idOperacion);
        logger.log(ADFLogger.WARNING, "loginUsuario: " + loginUsuario);

        boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean actualizarResponsable = Boolean.TRUE;
        try {
            String wsdl = getWsdl(IWsdlLocation.PROCESOS_UTILIDAD);

            ProcesosUtilidadBindingQSService bindingQSService =
                IWsdlLocation.Service.getInstance(ProcesosUtilidadBindingQSService.class, wsdl);

            ProcesosUtilidadPortType bindingQSPort = bindingQSService.getProcesosUtilidadBindingQSPort();

            if (idOperacion != null) {
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacionUnica =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + bindingQSPort.toString());
                } catch (Exception ex) {

                }

                operacionUnica.setCodigoOperacion(idOperacion.intValue());
                operacionUnica.setResponsableOperacion(loginUsuario);

                Header request = new Header();
                request.setOperacion(operacionUnica);

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CAMBIAR_RESPONSABLE_OPERACION);
                Resultado response = bindingQSPort.inicioReasignarRO(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CAMBIAR_RESPONSABLE_OPERACION,
                                    horaInicio);

                String mensajeError = "";

                if (response.getResult().value().equalsIgnoreCase("ERROR")) {

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }

                    existeError = Boolean.TRUE;
                    msgError = "La operación: " + idOperacion + ". Marca lo siguiente: " + mensajeError;
                }

            } else {
                existeError = Boolean.TRUE;
                msgError = "idOperacion nula.";
            }
        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en Actualizar responsable de operacion bpm.", e);
            msgError = e.getMessage();
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return existeError;
    }

    public boolean obtenerDetalleOperacion(String idOperacion) {
        logger.warning("inside obtenerDetalleOperacion");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        long startTime = System.currentTimeMillis();
        startTime = System.currentTimeMillis();
        logger.warning("Tiempo de inicio respuesta del: " + startTime);
        try {
            boolean banderaObtenerDetalleOperacion = false;
            String componenteConcecionalidad = null;
            String programadoPoa = null;
            DatosSupervisionVOImpl datosSupervisionVO = null;

            if (idOperacion != null && idOperacion.trim().length() > 0) {
                DetalleOperacionVOImpl detalleOperacionVO = getDetalleOperacionVO();
                detalleOperacionVO.executeQuery();
                DetalleOperacionVORowImpl newDetalleOperacion =
                    (DetalleOperacionVORowImpl) detalleOperacionVO.createRow();

                String wsdl = getWsdl(IWsdlLocation.OPERACION);

                Operacion12BndQSService operacion12BndQSService =
                    IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
                Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
                } catch (Exception ex) {
                }

                ConsultarOperacionByIdOperacionRequestType request = new ConsultarOperacionByIdOperacionRequestType();

                request.setIdOperacion(Long.parseLong(idOperacion));

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_OBTENER_DETALLE_OPERACION);
                ConsultarOperacionResponseType obtenerOperacion =
                    operacion12Port.consultarOperacionByIdOperacion(request);
                ModelUtils.logEndWS(logger, obtenerOperacion, FenixModelConstants.WSC_OBTENER_DETALLE_OPERACION,
                                    horaInicio);

                try {
                    if (obtenerOperacion.getResultado() != null &&
                        obtenerOperacion.getResultado().getResult().value() == "ERROR") {
                        existeError = Boolean.TRUE;
                    }

                    if (null != obtenerOperacion.getResultado().getMessage() &&
                        obtenerOperacion.getResultado().getMessage().trim().length() > 0) {
                        msgError = obtenerOperacion.getResultado().getMessage();
                    }
                } catch (Exception e) {
                    logger.warning("Error al verificar si el servicio consultarOperacionByIdOperacion devuelve un error para mostrarlo en pantalla");
                }

                if (!existeError) {
                    logger.warning("El servicio retorna OK... se comienzan las validaciones para cargar los campos en DetalleOperacionVO");
                    List<Operacion> listaOperqacionesObtenidas = obtenerOperacion.getOperacion();

                    if (!listaOperqacionesObtenidas.isEmpty()) {
                        banderaObtenerDetalleOperacion = true;
                        Operacion operacionUnica = listaOperqacionesObtenidas.get(0);

                        if (operacionUnica.isComponenteConcesionalidad()) {
                            componenteConcecionalidad = SI_TEXT;
                        } else {
                            componenteConcecionalidad = NO_TEXT;
                        }

                        if (operacionUnica.isProgramadoPOA()) {
                            programadoPoa = SI_TEXT;
                        } else {
                            programadoPoa = NO_TEXT;
                        }

                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.ID, INIT_ATTR_ID);
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.ABREVIATURA,
                                                         operacionUnica.getCliente().getAbreviatura());
														                         
                        // Funcionalidad de Sector Institucional y Encargado - 21/sept/2020
                        if(operacionUnica.getSectorInstitucional() != null)
                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.SECTORINSTITUCIONAL,
                                                             operacionUnica.getSectorInstitucional().getDescripcion());
                        if(operacionUnica.getEncargado() != null)
                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.ENCARGADO,
                                                             operacionUnica.getEncargado().getDescripcion());
                        
                        // Funcionalidad de "Ubicación del proyecto" - 11/dic/2020
                        if(operacionUnica.getUbicacionProyecto() != null)
                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.UBICACIONPROYECTO,
                                                             operacionUnica.getUbicacionProyecto());

                        //Recuperar valor idCatPais
                        logger.warning("======   Recuperar y establecer valor: idCatPais  =======");
                        // Funcionalidad de "idCatPais" - 26/may/2021
                        if(operacionUnica.getIdCatPais() != null){
                            logger.warning("======   idCatPais: " + operacionUnica.getIdCatPais() + "  =======");
                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.IDCATPAIS,
                                                             operacionUnica.getIdCatPais());
                        }
 
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.ACTIVIDADECONOMICA,
                                                         operacionUnica.getActividadEconomica().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.AREAFOCALIZACION,
                                                         operacionUnica.getAreaFocalizacion().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.CANTIDADPAISES,
                                                         operacionUnica.getCantidadPaises().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.COMPONENTECONCECIONALIDAD,
                                                         componenteConcecionalidad);
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.DESCRIPCIONOPERACION,
                                                         operacionUnica.getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.EJEESTRATEGICO,
                                                         operacionUnica.getEjeEstrategico().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.EJERCICIOPOA,
                                                         operacionUnica.getEjercicioPOA().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.GRUPOECONOMICO,
                                                         operacionUnica.getCliente().getGrupoEconomico().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.INICIATIVAESTRATEGICA,
                                                         operacionUnica.getIniciativaEstrategica().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.NUMEROIDENTIFICACION,
                                                         operacionUnica.getCliente().getNumeroIdentificacion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.OFICINA,
                                                         operacionUnica.getCliente().getOficina().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.PAIS,
                                                         operacionUnica.getCliente().getPais().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.PROGRAMADORPOA, programadoPoa);
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.RAZONSOCIAL,
                                                         operacionUnica.getCliente().getRazonSocial());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.SECTOR,
                                                         operacionUnica.getCliente().getSector().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.SECTORMERCADO,
                                                         operacionUnica.getSectorMercado().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.TIPOGARANTIA,
                                                         operacionUnica.getTipoGarantia().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.TIPOIDENTIFICACION,
                                                         operacionUnica.getCliente().getTipoIdentificacion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.TIPOINSTITUCION,
                                                         operacionUnica.getCliente().getTipoInstitucion().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.TIPOPERSONA,
                                                         operacionUnica.getCliente().getTipoPersona().getDescripcion());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.UNIDADEJECUTORA,
                                                         operacionUnica.getUnidadEjecutora());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.PERSPECTIVA,
                                                         operacionUnica.getPerspectiva().getDescripcionCorta());
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.CALIFICACIONINICIALRIESGO,
                                                         operacionUnica.getSRC().getDescripcionCorta());
						logger.warning("Tipo Moneda: " + operacionUnica.getTipoMoneda().getCodigoExterno());
                    
                        if(operacionUnica.getTipoMoneda() != null) {
                            if(operacionUnica.getTipoMoneda().getCodigoExterno() != null) {
                                
                                logger.warning("Tipo Moneda: " + operacionUnica.getTipoMoneda().getCodigoExterno());
                                newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.TIPOMONEDA,
                                                        operacionUnica.getTipoMoneda().getCodigoExterno());
                            } else {
                                logger.warning("No hay codigo de la moneda.");   
                            }
                        } else {
                            logger.warning("No hay moneda.");
                        }

                        logger.warning("======   Continua después de asignar idTcaTipoMoneda  =======");
                        
                        if (operacionUnica.getProducto() != null) {
                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.IDPRODUCTO,
                                                             operacionUnica.getProducto().getIdProducto());
                            logger.warning("======   Se asignó IDPRODUCTO   =======");

                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.LECTURAIFI,
                                                             obtenerCampo((Integer) newDetalleOperacion.getAttribute(DetalleOperacionVORowImpl.IDPRODUCTO),
                                                                          8));                            
                            logger.warning("======   Se asignó LECTURAIFI   =======");
                        } else {
                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.LECTURAIFI, Boolean.FALSE);
                        }

                        logger.warning("======   Se asignó IDPRODUCTO y LECTURAIFI   =======");

                        MontosOperacion montosOperacion = operacionUnica.getMontoOperacion();
                        if (null != montosOperacion && montosOperacion.getMontoOperacion().size() > 0) {
                            for (MontoOperacion monto : montosOperacion.getMontoOperacion()) {
                                if (FenixModelConstants.TIPO_MONTO_TOTAL.compareTo(monto.getIdTcaTipoMonto()) == 0) {
                                    newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.MONTOTOTAL,
                                                                     monto.getMonto());
                                }
                                if (FenixModelConstants.TIPO_MONTO_SOLICITADO.compareTo(monto.getIdTcaTipoMonto()) ==
                                    0) {
                                    newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.MONTOSOLICITADO,
                                                                     monto.getMonto());
                                }
                            }
                        }
                        logger.warning("======   Se asignó MONTOS   =======");

                        if (operacionUnica.getTIR() != null) {
                            newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.TIR,
                                                             operacionUnica.getTIR().floatValue());
                            logger.warning("======   Se asignó TIR   =======");
                        }

                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.TIRESTATUS,
                                                         operacionUnica.getTIREstatus());
                        logger.warning("======   Se asignó TIRESTATUS   =======");
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.SCRESTATUS,
                                                         operacionUnica.getSRC().getDescripcion());
                        logger.warning("======   Se asignó SCRESTATUS   =======");

                        //Inician cambios para Clasificaion Estrategica
                        //Recuperar valor EsMultisectorial
                        logger.warning("======   Recuperar y establecer valor: EsMultisectorial  =======");

                        if(operacionUnica.isEsMultisectorial()){
                        newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.ESMULTISECTORIAL,1);
                                                       
                        }else{ 
                                newDetalleOperacion.setAttribute(DetalleOperacionVORowImpl.ESMULTISECTORIAL,0);
                            
                            }

                        //Componentes de clasificacion
                        logger.warning("====  Recuperar valores de componentes para  Detalle de Clasificacion Estrategica   ====");
                        List<ComponenteClasificacionEstrategicaType> componentes =
                            operacionUnica.getClasificacionEstrategicaMultisectorial().getComponenteClasificacionEstrategica();
                        logger.warning("========   Creacion de instancia de DetalleClasificacionEstrategicaVOImpl ===============");
                        DetalleClasificacionEstrategicaVOImpl clasificacionVO = getDetalleClasificacionEstrategicaVO1();
                        clasificacionVO.executeQuery();
                        int cont = 1;

                        for (ComponenteClasificacionEstrategicaType ce : componentes) {
                            logger.warning("Se crea ROW y se hace set de valores:  DetalleClasificacionEstrategicaVOImpl");
                            DetalleClasificacionEstrategicaVORowImpl row =
                                (DetalleClasificacionEstrategicaVORowImpl) clasificacionVO.createRow();

                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.ID, cont);
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.NOMBRE, ce.getNombreComponente());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.DESCRIPCION, ce.getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.PORCENTAJE,
                                             ce.getPorcentaje().intValue());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.ACTIVIDADECONOMICA,
                                             ce.getActividadEconomica().getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.ACTIVIDADECONOMICAASOCIADA,
                                             ce.getActividadEconomicaAsociada().getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.AREAFOCALIZACION,
                                             ce.getAreaFocalizacion().getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.EJEESTRATEGICO,
                                             ce.getEjeEstrategico().getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.INICIATIVAESTRATEGICA,
                                             ce.getIniciativaEstrategica().getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.CANTIDADPAISES,
                                             ce.getCantidadPaises().getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.SECTORIBCIE,
                                             ce.getSectorIbcie().getDescripcion());
                            row.setAttribute(DetalleClasificacionEstrategicaVORowImpl.SUBSECTORIBCIE,
                                             ce.getSubSectorIbcie().getDescripcion());
                            
                            clasificacionVO.insertRow(row);
                            cont++;
                        }

                        logger.warning("====  Concluye seccion para Detalle Clasificacion Estrategica  =====");
                        //Fin
                        
                        try{
                            logger.warning("Inicio Clasificaion Ambiental");
                            if(operacionUnica.getClasificacionAmbiental() != null){ 
                                //====== SPS | 02/10/2019  | Inician cambios para Clasificacion Ambiental ========= //
                                logger.warning("====  Recuperar valores de componentes para  Detalle de Clasificacion Ambiental   ====");
                                List<ClasificacionAmbiental> componentesCA =
                                    operacionUnica.getClasificacionAmbiental().getClasificacionAmbiental();       
                                logger.warning("========   Creacion de instancia de DetalleClasificacionAmbientalVOImpl ===============");
                                DetalleClasificacionAmbientalVOImpl clasificacionAmbientalVO = getDetalleClasificacionAmbientalVO1();
                                clasificacionAmbientalVO.executeQuery();
                                int contAmb = 1;
                                logger.warning("\n========   componentesCA size:"+componentesCA.size());
                                for (ClasificacionAmbiental ca : componentesCA) {
                                
                                    logger.warning("=== Se crea ROW y se hace set de valores:  DetalleClasificacionAmbientalVOImpl ===");
                                    DetalleClasificacionAmbientalVORowImpl row = 
                                        (DetalleClasificacionAmbientalVORowImpl) clasificacionAmbientalVO.createRow();
                                    
                                    row.setAttribute(DetalleClasificacionAmbientalVORowImpl.ID, ca.getId());
                                    row.setAttribute(DetalleClasificacionAmbientalVORowImpl.SECTOR, ca.getSectorAmbiental().getDescripcion());
                                    row.setAttribute(DetalleClasificacionAmbientalVORowImpl.APORTE, ca.getAporteAmbiental().getDescripcion());
                                    row.setAttribute(DetalleClasificacionAmbientalVORowImpl.CATEGORIA, ca.getCategoriaAmbiental().getDescripcion());
                                    row.setAttribute(DetalleClasificacionAmbientalVORowImpl.SUBCATEGORIA,ca.getSubCategoriaAmbiental().getDescripcion());
                                  
                                    clasificacionAmbientalVO.insertRow(row);
                                    cont++;
                                } 
                                logger.warning("\n====  Concluye seccion para Detalle Clasificacion Ambiental  | clasificacionAmbientalVO size:"+clasificacionAmbientalVO.getRowCount());
                                //=================  Fin cambios para Clasificaion Ambiental ===================== //
                            }
                            else
                            {
                                logger.warning("Clasificaion Ambiental es nulo");
                            }
                            logger.warning("Fin Clasificaion Ambiental");
                        }
                        catch(Exception exp){
                            logger.warning("Error Clasificaion Ambiental: " + exp);
                        }

                        detalleOperacionVO.insertRow(newDetalleOperacion);
                        detalleOperacionVO.setCurrentRow(newDetalleOperacion);

                        datosSupervisionVO = getDatosSupervisionVO();
                        if (null != datosSupervisionVO) {
                            datosSupervisionVO.setvarIdOperacion(idOperacion);
                            try {
                                logger.warning("Ejecutando query datosSupervisionVO");
                                datosSupervisionVO.executeQuery();
                            } catch (Exception e) {
                                logger.warning("Error al ejecutar query");
                            }
                        }

                    } else {
                        banderaObtenerDetalleOperacion = false;
                    }
                } else {
                    logger.warning("El servicio consultarOperacionByIdOperacion devuelve ERROR... no se cargan los valores para DetalleOperacionVO");
                }
            }
            long endTime = System.currentTimeMillis();
            logger.warning("Tiempo de fin respuesta: " + endTime);
            logger.warning("Tiempo de respuesta del metodo Inico metodo de adquisiciones " +
                           (endTime - startTime) / 1000 + " segundos");

            return banderaObtenerDetalleOperacion;

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error al carga detalle de la operacion", e);
        } finally {
            if (existeError) {
                logger.warning("Servicio consultarOperacionByIdOperacion devuelve ERROR >> " + msgError);
                JboException exception =
                    new JboException("Servicio consultarOperacionByIdOperacion devuelve ERROR >> " + msgError);
                throw exception;
            }
        }

        return false;
    }


    public void agregarComentario(String comentario, String idTcaTareaBpm, String idOperacion, String loginUsuario,
                                  String nombreUsusario, String idInstanciaTarea) {
        ViewObjectImpl comentarioOperacionVO = getComentarioOperacionVO();
        Row createRow = comentarioOperacionVO.createRow();

        SequenceImpl seqComentario = new SequenceImpl("COMENTARIO_OPERACION_SEQ", getDBTransaction());

        createRow.setAttribute("Id", seqComentario.getSequenceNumber());
        createRow.setAttribute("IdTcaTarea", Integer.parseInt(idTcaTareaBpm));
        createRow.setAttribute("IdOperacion", Integer.parseInt(idOperacion));
        createRow.setAttribute("FechaRegistro", new Timestamp(System.currentTimeMillis()));
        createRow.setAttribute("LoginUsuario", loginUsuario);
        createRow.setAttribute("NombreUsuario", nombreUsusario);
        createRow.setAttribute("Comentario", comentario);
        createRow.setAttribute("IdInstanciaTarea", idInstanciaTarea);
        createRow.setAttribute("BanEstatus", 1);
        createRow.setAttribute("IdTcaTipoComentario", 1);
        comentarioOperacionVO.insertRow(createRow);

    }

	/**
	* Metodo que agrega una justificacion para el proceso de formalizacion.
	* @param comentario
	* @param idTcaTareaBpm
	* @param idOperacion
	* @param loginUsuario
	* @param nombreUsusario
	* @param idInstanciaTarea
	*/
	public void agregarJustificacionOperacion(String comentario, String idTcaTareaBpm, String idOperacion, String loginUsuario,
	String nombreUsusario, String idInstanciaTarea) {
	final String METHOD_NAME = "agregarJustificacionOperacion";
	logger.entering(CLASS_NAME, METHOD_NAME);

	ViewObjectImpl justificacionOperacionVO = getJustificacionOperacionVO1();
	Row createRow = justificacionOperacionVO.createRow();

	SequenceImpl seqComentario = new SequenceImpl("COMENTARIO_OPERACION_SEQ", getDBTransaction());

	try {
	createRow.setAttribute("Id", seqComentario.getSequenceNumber());
	createRow.setAttribute("IdTcaTarea", Integer.valueOf(idTcaTareaBpm));
	createRow.setAttribute("IdOperacion", Long.parseLong(idOperacion));
	createRow.setAttribute("FechaRegistro", new Timestamp(System.currentTimeMillis()));
	createRow.setAttribute("LoginUsuario", loginUsuario);
	createRow.setAttribute("NombreUsuario", nombreUsusario);
	createRow.setAttribute("Comentario", comentario);
	createRow.setAttribute("IdInstanciaTarea", idInstanciaTarea);
	createRow.setAttribute("BanEstatus", Integer.valueOf(1));
	createRow.setAttribute("IdTcaTipoComentario", Integer.valueOf(2));

	justificacionOperacionVO.insertRow(createRow);

	} catch(Exception e) {
	logger.severe(e.getMessage());
	}
	logger.exiting(CLASS_NAME, METHOD_NAME);

	}

    public void agregarRespuestaComentario(String repuesta, int idComentarioOperacion, String idTcaTareaBpm,
                                           String loginUsuario, String nombreUsusario, String idInstanciaTarea) {
        ViewObjectImpl respuestaComentarioVO = getRespuestaComentarioVO();
        Row createRow = respuestaComentarioVO.createRow();

        SequenceImpl seqRespuestaComentario = new SequenceImpl("RESPUESTA_COMENTARIO_SEQ", getDBTransaction());

        createRow.setAttribute("Id", seqRespuestaComentario.getSequenceNumber());
        createRow.setAttribute("IdComentarioOperacion", idComentarioOperacion);
        createRow.setAttribute("IdTcaTareaBpm", Integer.parseInt(idTcaTareaBpm));
        createRow.setAttribute("FechaRegistro", new Timestamp(System.currentTimeMillis()));
        createRow.setAttribute("LoginUsuario", loginUsuario);
        createRow.setAttribute("NombreUsuario", nombreUsusario);
        createRow.setAttribute("Comentario", repuesta);
        createRow.setAttribute("IdInstanciaTarea", idInstanciaTarea);
        createRow.setAttribute("BanEstatus", 1);

        respuestaComentarioVO.insertRow(createRow);
    }

    public void agregarComentarioCliente(String comentario, String idTcaTareaBpm, String idCliente, String loginUsuario,
                                         String nombreUsusario, String idInstanciaTarea) {
        logger.warning("Dentro de agregarComentarioCliente");
        logger.warning("comentario :" + comentario);
        logger.warning("idTcaTareaBpm :" + idTcaTareaBpm);
        logger.warning("idCliente :" + idCliente);
        logger.warning("loginUsuario :" + loginUsuario);
        logger.warning("nombreUsusario :" + nombreUsusario);
        logger.warning("idInstanciaTarea :" + idInstanciaTarea);

        ViewObjectImpl comentarioClienteVO = getComentarioClienteVO();
        Row newRow = comentarioClienteVO.createRow();

        SequenceImpl seqComentario = new SequenceImpl("COMENTARIO_CLIENTE_SEQ", getDBTransaction());

        newRow.setAttribute("Id", seqComentario.getSequenceNumber());
        newRow.setAttribute("IdTcaTarea", Integer.parseInt(idTcaTareaBpm));
        newRow.setAttribute("IdCliente", Integer.parseInt(idCliente));
        newRow.setAttribute("FechaRegistro", new Timestamp(System.currentTimeMillis()));
        newRow.setAttribute("LoginUsuario", loginUsuario);
        newRow.setAttribute("NombreUsuario", nombreUsusario);
        newRow.setAttribute("Comentario", comentario);
        newRow.setAttribute("IdInstanciaTarea", idInstanciaTarea);
        newRow.setAttribute("BanEstatus", 1);

        comentarioClienteVO.insertRow(newRow);
        try {
            getDBTransaction().commit();
        } catch (Exception e) {
            logger.severe("Error al realizar commit en agregarComentarioCliente", e);
            try {
                logger.warning("Ejecuta segundo commit");
                getDBTransaction().commit();
            } catch (Exception ex) {
                logger.severe("Error al realizar segundo commit en agregarComentarioCliente", ex);
            }
        }

        logger.warning("Fuera de agregarComentarioCliente");
    }

    public void agregarRespuestaComentarioCliente(String repuesta, int idComentarioCliente, String idTcaTareaBpm,
                                                  String loginUsuario, String nombreUsusario, String idInstanciaTarea) {
        logger.warning("Dentro de agregarRespuestaComentarioCliente");

        ViewObjectImpl respuestaComentarioClienteVO = getRespuestaComentarioClienteVO();
        Row newRow = respuestaComentarioClienteVO.createRow();

        SequenceImpl seqRespuestaComentario = new SequenceImpl("RESPUESTA_COMENTARIO_CLI_SEQ", getDBTransaction());

        newRow.setAttribute("Id", seqRespuestaComentario.getSequenceNumber());
        newRow.setAttribute("IdComentarioCliente", idComentarioCliente);
        newRow.setAttribute("IdTcaTareaBpm", Integer.parseInt(idTcaTareaBpm));
        newRow.setAttribute("FechaRegistro", new Timestamp(System.currentTimeMillis()));
        newRow.setAttribute("LoginUsuario", loginUsuario);
        newRow.setAttribute("NombreUsuario", nombreUsusario);
        newRow.setAttribute("Comentario", repuesta);
        newRow.setAttribute("IdInstanciaTarea", idInstanciaTarea);
        newRow.setAttribute("BanEstatus", 1);

        respuestaComentarioClienteVO.insertRow(newRow);

        try {
            getDBTransaction().commit();
        } catch (Exception e) {
            logger.severe("Error al realizar commit en agregarRespuestaComentarioCliente", e);
            try {
                logger.warning("Ejecuta segundo commit");
                getDBTransaction().commit();
            } catch (Exception ex) {
                logger.severe("Error al realizar segundo commit en agregarRespuestaComentarioCliente", ex);
            }
        }

        logger.warning("Fuera de agregarRespuestaComentarioCliente");
    }


    /**
     * Container's getter for ComentarioOperacionView1.
     * @return ComentarioOperacionView1
     */
    public ViewObjectImpl getComentarioOperacionView1() {
        return (ViewObjectImpl) findViewObject("ComentarioOperacionView1");
    }

    public Long adjuntarDocumento(oracle.jbo.domain.Number idOperacion, oracle.jbo.domain.Number idTareaBpm,
                                  Boolean esJustificacion, oracle.jbo.domain.BlobDomain content, String fileName,
                                  String mimeType, String codigo, Date fecha, Integer idTipo, String resumen,
                                  oracle.jbo.domain.Number idAccion, String loginCreadoPor, String nombreCreadoPor,
                                  String idOnbase, oracle.jbo.domain.Number numeroSerieDocumento,
                                  String instanciaProceso) {

        logger.warning("Dentro de adjuntarDocumento");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("idTareaBpm :" + idTareaBpm);
        logger.warning("esJustificacion :" + esJustificacion);
        logger.warning("fileName :" + fileName);
        logger.warning("mimeType :" + mimeType);
        logger.warning("codigo :" + codigo);
        logger.warning("fecha :" + fecha);
        logger.warning("idTipo :" + idTipo);
        logger.warning("resumen :" + resumen);
        logger.warning("idAccion :" + idAccion);
        logger.warning("loginCreadoPor :" + loginCreadoPor);
        logger.warning("nombreCreadoPor :" + nombreCreadoPor);
        logger.warning("idOnbase :" + idOnbase);
        logger.warning("numeroSerieDocumento :" + numeroSerieDocumento);
        logger.warning("instanciaProceso :" + instanciaProceso);

        ViewObjectImpl documentosVO = null;
        ViewObjectImpl documentoVO = null;
        ViewObjectImpl adjuntoVO = null;

        Row documentosRow = null;
        Row documentoRow = null;
        Row adjuntoRow = null;

        Integer justificacion = null;
        oracle.jbo.domain.Number idDocumento = null;
        oracle.jbo.domain.Number idAdjunto = null;

        SequenceImpl seqDocumento = new SequenceImpl("DOCUMENTO_SEQ", getDBTransaction());
        SequenceImpl seqAdjunto = new SequenceImpl("ADJUNTO_SEQ", getDBTransaction());
        NameValuePairs nvpDocumento = null;
        NameValuePairs nvpAdjunto = null;
        NameValuePairs nvpDocumentos = null;

        // Asignación para Documento
        idDocumento = seqDocumento.getSequenceNumber();
        documentoVO = this.getDocumentoVO();

        nvpDocumento = new NameValuePairs();
        nvpDocumento.setAttribute("IdDocumento", idDocumento);
        nvpDocumento.setAttribute("IdTipoDocumento", idTipo);
        nvpDocumento.setAttribute("CodigoDocumento", codigo);
        nvpDocumento.setAttribute("Comentario", resumen);
        nvpDocumento.setAttribute("FechaRegistro", new java.sql.Timestamp(System.currentTimeMillis()));
        //Agrega el atributo "numeroSerieDocumento"
        nvpDocumento.setAttribute("NumSerieDocumento", numeroSerieDocumento);
        //Agrega el atributo "InstanciaProceso"
        nvpDocumento.setAttribute("InstanciaProceso", instanciaProceso);

        if (fecha != null)
            nvpDocumento.setAttribute("FechaDocumento", new java.sql.Timestamp(fecha.getTime()));

        nvpDocumento.setAttribute("IdTcaAccion",
                                  Integer.valueOf(idAccion.intValue())); // Valores en catálogo TCA_ACCION_DOCUMENTO
        nvpDocumento.setAttribute("IdTareaBpm", idTareaBpm);

        if ((esJustificacion != null) && (esJustificacion))
            justificacion = 1;
        else
            justificacion = 0;

        nvpDocumento.setAttribute("EsJustificacion", justificacion);
        nvpDocumento.setAttribute("LoginUsuarioCrea", loginCreadoPor);
        nvpDocumento.setAttribute("NombreUsuarioCrea", nombreCreadoPor);
        nvpDocumento.setAttribute("BanEstatus", BANESTATUS_TRUE); // Estado Activo = 1
        documentoRow = documentoVO.createAndInitRow(nvpDocumento);

        // Asignación para Adjunto (sólo si content/mimeType no es null, ya que en este caso es justificación)
        // Si el idOnbase NO es null entonces estamos insertando un documento del tree
        if (((content != null) && (mimeType != null)) || (idOnbase != null)) {

            idAdjunto = seqAdjunto.getSequenceNumber();
            adjuntoVO = this.getAdjuntoVO();

            nvpAdjunto = new NameValuePairs();
            nvpAdjunto.setAttribute("IdAdjunto", idAdjunto);
            nvpAdjunto.setAttribute("Filename", fileName);
            nvpAdjunto.setAttribute("MimeType", mimeType);
            nvpAdjunto.setAttribute("Content", content);
            nvpAdjunto.setAttribute("FechaRegistro", new java.sql.Timestamp(System.currentTimeMillis()));
            nvpAdjunto.setAttribute("IdDocumento", idDocumento);
            nvpAdjunto.setAttribute("IdOnbase", idOnbase);
            adjuntoRow = adjuntoVO.createAndInitRow(nvpAdjunto);
        }

        // Asignación para Documentos
        documentosVO = this.getDocumentosVO();

        nvpDocumentos = new NameValuePairs();
        nvpDocumentos.setAttribute("IdOperacion", idOperacion);
        nvpDocumentos.setAttribute("IdDocumento", idDocumento);
        documentosRow = documentosVO.createAndInitRow(nvpDocumentos);

        getDBTransaction().commit();

        logger.warning("idDocumento agregado :" + idDocumento);
        logger.warning("idAdjunto agregado :" + idAdjunto);
        logger.warning("Fuera de adjuntarDocumento");
        // Retornamos el Id del nuevo documento creado
        return idDocumento.longValue();
    }

    public Map actualizarDocumentoTree(Long idAdjunto) {
        logger.log(ADFLogger.TRACE, "Inside actualizarDocumentoTree.");
        return actualizarEliminarDocumento(idAdjunto, true);
    }

    public Map eliminarDocumentoTree(Long idAdjunto) {
        logger.log(ADFLogger.TRACE, "Inside eliminarDocumentoTree.");
        return actualizarEliminarDocumento(idAdjunto, false);
    }

    private Map actualizarEliminarDocumento(Long idAdjunto, Boolean esActualizar) {
        logger.log(ADFLogger.TRACE, "Inside actualizarDocumento.");
        HashMap<String, CargarDocumentoResponseType> respuestaServicio = null;
        CargarDocumentoRequestType request = null;
        CargarDocumentoResponseType response = null;
        String operacion = null;

        try {
            String wsdl = getWsdl(IWsdlLocation.DOCUMENTO);

            Documento12BndQSService documento12BndQSService =
                IWsdlLocation.Service.getInstance(Documento12BndQSService.class, wsdl);
            DocumentoPT documentoPT = documento12BndQSService.getDocumento12BndQSPort();
            request = mappingActualizarEliminarDocumento(idAdjunto);
            operacion = esActualizar ? ACTUALIZAR_TEXT : ELIMINAR_TEXT;

            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_ELIMINAR_DOCUMENTO);
            if (esActualizar)
                response = documentoPT.actualizarDocumento(request);
            else
                response = documentoPT.eliminarDocumento(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_ELIMINAR_DOCUMENTO, horaInicio);

            respuestaServicio = new HashMap<String, CargarDocumentoResponseType>();
            respuestaServicio.put("response", response);
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al " + operacion + " el documento, favor de intentar más tarde."));
            throw ex;
        }

        return respuestaServicio;
    }

    private CargarDocumentoRequestType mappingActualizarEliminarDocumento(Long idAdjunto) {
        CargarDocumentoRequestType request = new CargarDocumentoRequestType();
        ListaDocumentos listaDocumentos = new ListaDocumentos();
        Documento documento = new Documento();

        // Asignación de variables
        documento.setIdAdjunto(idAdjunto);
        listaDocumentos.getDocumento().add(documento);
        request.setDocumentos(listaDocumentos);

        return request;
    }

    public Boolean validaRespuestaComentario(String IdInstanciaTarea, String idTcaTareaBpm) {
        Boolean existe = false;
        ViewObjectImpl respuestaComentarioOperacionVO = getRespuestaComentarioOperacionVO();
        try {
            ViewCriteria criteriaByCommType =
                respuestaComentarioOperacionVO.getViewCriteriaManager().getViewCriteria("respuestaComentarioOperacionVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdInstancia", IdInstanciaTarea);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdTarea",
                                                                        Integer.getInteger(idTcaTareaBpm));

            respuestaComentarioOperacionVO.applyViewCriteria(criteriaByCommType);

            respuestaComentarioOperacionVO.executeQuery();
            if (respuestaComentarioOperacionVO.getEstimatedRowCount() > 0) {
                Long r = respuestaComentarioOperacionVO.getEstimatedRowCount();
                existe = Boolean.TRUE;
            }

        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en validarRespuestaComentario " + ex.getClass() + ":" + ex.getMessage());
        } finally {
            //This takes care of removing the applied VC.
            respuestaComentarioOperacionVO.getViewCriteriaManager().removeApplyViewCriteriaName("respuestaComentarioOperacionVOCriteria");
        }
        return existe;
    }

    public boolean validarComentario(String IdInstanciaTarea, String idTcaTareaBpm, Long idOperacion) {
        ViewObjectImpl comentarioOperacionVO = getComentarioOperacionVO();
        try {
            ViewCriteria criteriaByCommType =
                comentarioOperacionVO.getViewCriteriaManager().getViewCriteria("ComentarioOperacionVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdInstanciaTarea", IdInstanciaTarea);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
            criteriaByCommType.ensureVariableManager().setVariableValue("varTarea", idTcaTareaBpm);

            comentarioOperacionVO.applyViewCriteria(criteriaByCommType);

            comentarioOperacionVO.executeQuery();
            if (comentarioOperacionVO.getEstimatedRowCount() > 0) {
                return true;
            }

            return validaRespuestaComentario(IdInstanciaTarea, idTcaTareaBpm);

        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en validarComentario " + ex.getClass() + ":" + ex.getMessage());
            return false;
        } finally {
            //This takes care of removing the applied VC.
            comentarioOperacionVO.getViewCriteriaManager().removeApplyViewCriteriaName("ComentarioOperacionVOCriteria");
            ViewCriteria criteriaByCommType =
                comentarioOperacionVO.getViewCriteriaManager().getViewCriteria("ComentariosByOperacionCriteria");
            comentarioOperacionVO.applyViewCriteria(criteriaByCommType);
            comentarioOperacionVO.executeQuery();
        }
    }

    public boolean validarComentarioCliente(String IdInstanciaTarea, String idTcaTareaBpm, Long idCliente) {
        ViewObjectImpl comentarioClienteVO = getComentarioClienteVO();
        try {
            ViewCriteria criteriaByCommType =
                comentarioClienteVO.getViewCriteriaManager().getViewCriteria("ComentarioClienteVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdInstanciaTarea", IdInstanciaTarea);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdCliente", idCliente);
            criteriaByCommType.ensureVariableManager().setVariableValue("varTarea", idTcaTareaBpm);

            comentarioClienteVO.applyViewCriteria(criteriaByCommType);

            comentarioClienteVO.executeQuery();
            if (comentarioClienteVO.getEstimatedRowCount() > 0) {
                return true;
            }

            return validaRespuestaComentarioCliente(IdInstanciaTarea, idTcaTareaBpm);

        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en validarComentario " + ex.getClass() + ":" + ex.getMessage());
            return false;
        } finally {
            //This takes care of removing the applied VC.
            comentarioClienteVO.getViewCriteriaManager().removeApplyViewCriteriaName("ComentarioClienteVOCriteria");
            ViewCriteria criteriaByCommType =
                comentarioClienteVO.getViewCriteriaManager().getViewCriteria("ComentariosByClienteCriteria");
            comentarioClienteVO.applyViewCriteria(criteriaByCommType);
            comentarioClienteVO.executeQuery();
        }
    }

    public Boolean validaRespuestaComentarioCliente(String IdInstanciaTarea, String idTcaTareaBpm) {
        Boolean existe = false;
        ViewObjectImpl respuestaComentarioClienteValidacionVO = getRespuestaComentarioClienteValidacionVO();
        try {
            ViewCriteria criteriaByCommType =
                respuestaComentarioClienteValidacionVO.getViewCriteriaManager().getViewCriteria("RespuestaComentarioClienteValidacionVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdInstancia", IdInstanciaTarea);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdTarea",
                                                                        Integer.getInteger(idTcaTareaBpm));

            respuestaComentarioClienteValidacionVO.applyViewCriteria(criteriaByCommType);

            respuestaComentarioClienteValidacionVO.executeQuery();
            if (respuestaComentarioClienteValidacionVO.getEstimatedRowCount() > 0) {
                existe = Boolean.TRUE;
            }

        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR,
                       "Error en validaRespuestaComentarioCliente " + ex.getClass() + ":" + ex.getMessage());
        } finally {
            //This takes care of removing the applied VC.
            respuestaComentarioClienteValidacionVO.getViewCriteriaManager().removeApplyViewCriteriaName("respuestaComentarioOperacionVOCriteria");
        }
        return existe;
    }

    public boolean validarDocumento(Long idOperacion, Integer idTipoDocumento) {
        ViewObjectImpl validarOperacionTipoDocumentoVO = getValidarOperacionTipoDocumentoVO();

        try {
            ViewCriteria criteriaByCommType =
                validarOperacionTipoDocumentoVO.getViewCriteriaManager().getViewCriteria("validarOperacionTipoDocumentoVOCriteria");

            criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdTipoDocumento", idTipoDocumento);

            //Solo los activos
            criteriaByCommType.ensureVariableManager().setVariableValue("varBanEstatus",
                                                                        FenixModelConstants.BANESTATUS_TRUE);

            validarOperacionTipoDocumentoVO.applyViewCriteria(criteriaByCommType);

            validarOperacionTipoDocumentoVO.executeQuery();

            if (validarOperacionTipoDocumentoVO.getEstimatedRowCount() > 0) {
                return true;
            }

            return false;
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en validarDocumento " + ex.getClass() + ":" + ex.getMessage());
            return false;
        } finally {
            //This takes care of removing the applied VC.
            validarOperacionTipoDocumentoVO.getViewCriteriaManager().removeApplyViewCriteriaName("validarOperacionTipoDocumentoVOCriteria");
        }
    }

    public boolean validarDocumento(Long idOperacion, Integer idTipoDocumento, Integer idTareaBPM) {
        ViewObjectImpl validarOperacionTipoDocumentoVO = getValidarOperacionTipoDocumentoVO();

        try {
            ViewCriteria criteriaByCommType =
                validarOperacionTipoDocumentoVO.getViewCriteriaManager().getViewCriteria("ValidaPorOperacionTipoDocTareaVC");

            criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdTipoDocumento", idTipoDocumento);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdTarea", idTareaBPM);

            //Solo los activos
            criteriaByCommType.ensureVariableManager().setVariableValue("varBanEstatus",
                                                                        FenixModelConstants.BANESTATUS_TRUE);

            validarOperacionTipoDocumentoVO.applyViewCriteria(criteriaByCommType);

            validarOperacionTipoDocumentoVO.executeQuery();

            if (validarOperacionTipoDocumentoVO.getEstimatedRowCount() > 0) {
                return true;
            }

            return false;
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en validarDocumento " + ex.getClass() + ":" + ex.getMessage());
            return false;
        } finally {
            //This takes care of removing the applied VC.
            validarOperacionTipoDocumentoVO.getViewCriteriaManager().removeApplyViewCriteriaName("ValidaPorOperacionTipoDocTareaVC");
        }
    }

    /** validarDocumentoPorNumeroSerieDocumento"
     * Metodo que regresa true o false , segun el criterio de busqueda
     * @param  idOperacion,idTipoDocumento,numeroSerieDocumento
     * @since 18/08/2016
     * @by Gabriel Niño Rosales
     */
    public boolean validarDocumentoPorNumeroSerieDocumento(Long idOperacion, Integer idTipoDocumento,
                                                           oracle.jbo.domain.Number numeroSerieDocumento) {
        ViewObjectImpl validarOperacionTipoDocumentoVO = getValidarOperacionTipoDocumentoVO();
        if (null != idOperacion && null != idTipoDocumento && null != numeroSerieDocumento) {
            try {
                ViewCriteria criteriaByCommType =
                    validarOperacionTipoDocumentoVO.getViewCriteriaManager().getViewCriteria("validarOperacionTipoDocumentoNumSerieVOCriteria");

                criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
                criteriaByCommType.ensureVariableManager().setVariableValue("varIdTipoDocumento", idTipoDocumento);
                //Solo los activos
                criteriaByCommType.ensureVariableManager().setVariableValue("varBanEstatus",
                                                                            FenixModelConstants.BANESTATUS_TRUE);
                //numero de serie del documento
                criteriaByCommType.ensureVariableManager().setVariableValue("varNumeroSerieDocumento",
                                                                            numeroSerieDocumento);

                validarOperacionTipoDocumentoVO.applyViewCriteria(criteriaByCommType);

                validarOperacionTipoDocumentoVO.executeQuery();

                if (validarOperacionTipoDocumentoVO.getEstimatedRowCount() > 0) {
                    return true;
                }

                return false;
            } catch (Exception ex) {
                logger.log(ADFLogger.ERROR,
                           "Error en validarDocumentoPorNumeroSerieDocumento " + ex.getClass() + ":" + ex.getMessage());
                return false;
            } finally {
                //This takes care of removing the applied VC.
                validarOperacionTipoDocumentoVO.getViewCriteriaManager().removeApplyViewCriteriaName("validarOperacionTipoDocumentoNumSerieVOCriteria");
            }

        } else {
            if (idOperacion == null)
                logger.log(ADFLogger.ERROR,
                           "idOperacion is null in 'validarDocumentoPorNumeroSerieDocumento' method return false.");
            if (idTipoDocumento == null)
                logger.log(ADFLogger.ERROR,
                           "idTipoDocumento is null in 'validarDocumentoPorNumeroSerieDocumento' method return false.");
            if (numeroSerieDocumento == null)
                logger.log(ADFLogger.ERROR,
                           "numeroSerieDocumento is null in 'validarDocumentoPorNumeroSerieDocumento' method return false.");
            return false;
        }
    }

    /** validarDocumentoPorOperacionIdTareaNumeroSerieDocumento"
     * Metodo que regresa true o false , segun el criterio de busqueda
     * @param  idOperacion,idTareaBpm, idTipoDocumento, numeroSerieDocumento
     * @since 28/12/2016
     */
    public boolean validarDocumentoPorOperacionIdTareaNumeroSerieDocumento(Long idOperacion, Integer idTareaBpm,
                                                                           Integer idTipoDocumento,
                                                                           oracle.jbo.domain.Number numeroSerieDocumento) {
        ViewObjectImpl validarOperacionTipoDocumentoVO = getValidarOperacionTipoDocumentoVO();
        if (null != idOperacion && null != idTareaBpm && null != idTipoDocumento && null != numeroSerieDocumento) {
            try {
                ViewCriteria criteriaByCommType =
                    validarOperacionTipoDocumentoVO.getViewCriteriaManager().getViewCriteria("ValidarDocumentoPorOperacionIdTareaNumeroSerieVOCriteria");

                criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
                criteriaByCommType.ensureVariableManager().setVariableValue("varIdTarea", idTareaBpm);
                criteriaByCommType.ensureVariableManager().setVariableValue("varIdTipoDocumento", idTipoDocumento);
                //Solo los activos
                criteriaByCommType.ensureVariableManager().setVariableValue("varBanEstatus",
                                                                            FenixModelConstants.BANESTATUS_TRUE);
                //numero de serie del documento
                criteriaByCommType.ensureVariableManager().setVariableValue("varNumeroSerieDocumento",
                                                                            numeroSerieDocumento);

                validarOperacionTipoDocumentoVO.applyViewCriteria(criteriaByCommType);

                validarOperacionTipoDocumentoVO.executeQuery();

                if (validarOperacionTipoDocumentoVO.getEstimatedRowCount() > 0) {
                    return true;
                }

                return false;
            } catch (Exception ex) {
                logger.log(ADFLogger.ERROR,
                           "Error en validarDocumentoPorOperacionIdTareaNumeroSerieDocumento " + ex.getClass() + ":" +
                           ex.getMessage());
                return false;
            } finally {
                //This takes care of removing the applied VC.
                validarOperacionTipoDocumentoVO.getViewCriteriaManager().removeApplyViewCriteriaName("ValidarDocumentoPorOperacionIdTareaNumeroSerieVOCriteria");
            }

        } else {
            if (null == idOperacion)
                logger.log(ADFLogger.ERROR, "El valor de la operacion es nulo.");
            if (null == idTareaBpm)
                logger.log(ADFLogger.ERROR, "El valor de la tarea es nula.");
            if (null == idTipoDocumento)
                logger.log(ADFLogger.ERROR, "El valor del tipo de dcumento es nulo.");
            if (null == numeroSerieDocumento)
                logger.log(ADFLogger.ERROR, "El valor del numero de serie es nulo.");
            return false;
        }
    }

    /**
     *Método para consultar los cuestionarios mediante un servicio
     * @param idSector
     * @param idSubSector
     * @param idOperacion
     */
    public int consultarCuestionarios(String idSector, String idSubSector, int idOperacion) {
        logger.warning("Entra en consultarCuestionarios.");
        int numeroRows;
        CuestionarioVOImpl cuestionarioVO = getCuestionarioVO();
        CuestionarioVORowImpl newCuestionario;
        String wsdl = getWsdl(IWsdlLocation.EVALUACION);

        Evaluacion12BndQSService evaluacion12BndQSService =
            IWsdlLocation.Service.getInstance(Evaluacion12BndQSService.class, wsdl);
        EvaluacionPT evaluacion = evaluacion12BndQSService.getEvaluacion12BndQSPort();
        ConsultarCuestionarioRequestType request = new ConsultarCuestionarioRequestType();
        request.setIdOperacion(idOperacion);
        request.setSectorIBCIE(idSector);
        request.setSubSectorIBCIE(idSubSector);

        Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_CUESTIONARIOS);
        ConsultarCuestionarioResponseType consultarCuestionario = evaluacion.consultarCuestionario(request);
        ModelUtils.logEndWS(logger, consultarCuestionario, FenixModelConstants.WSC_CONSULTAR_CUESTIONARIOS, horaInicio);

        List<Cuestionario> cuestionario = consultarCuestionario.getCuestionarios().getCuestionario();
        logger.warning("Limpia cuestionarioVO.");
        cuestionarioVO.clearCache();
        if (null != cuestionario && cuestionario.size() > 0) {
            //System.out.println("limpia el VO");
            for (Cuestionario cuest : cuestionario) {
                newCuestionario = (CuestionarioVORowImpl) cuestionarioVO.createRow();

                newCuestionario.setAttribute(CuestionarioVORowImpl.IDCUESTIONARIO, cuest.getIdCuestionario());
                newCuestionario.setAttribute(CuestionarioVORowImpl.NOMBRECUESTIONARIO, cuest.getCuestionario());
                cuestionarioVO.insertRow(newCuestionario);
            }
            //System.out.println("tamaño de rows insertados en el AM:"+cuestionarioVO.getRowCount());
            numeroRows = cuestionarioVO.getRowCount();
        } else {
            numeroRows = 0;
        }
        logger.warning("numeroRows : " + numeroRows);
        return numeroRows;
    }

    /**
     *Metodo que se ejecuta para consultar evaluaciones
     * @param idEvaluacion
     */
    public Map consultarEvaluacion(Long idOperacion, Long idTarea, String tipoEvaluacion, String instanciaProceso,
                                   Long eventoEvaluacion) {
        logger.warning("Dentro de consultarEvaluacion");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("idTarea :" + idTarea);
        logger.warning("tipoEvaluacion :" + tipoEvaluacion);
        logger.warning("instanciaProceso :" + instanciaProceso);
        logger.warning("eventoEvaluacion :" + eventoEvaluacion);

        EvaluacionVOImpl evaluacionVO = getEvaluacionVO();
        Catalogo catalogo = new Catalogo();
        Catalogo catalogoTarea = new Catalogo();
        evaluacionVO.clearCache();
        EvaluacionVORowImpl nuevaEvaluacion;
        HashMap<String, ConsultarEvaluacionResponseType> respuestaServicio = null;
        List<Evaluacion> listaEvaluaciones = new ArrayList<Evaluacion>();
        int incrementarId = 0;
        try {
            String wsdl = getWsdl(IWsdlLocation.EVALUACION);

            Evaluacion12BndQSService evaluacion12BndQSService =
                IWsdlLocation.Service.getInstance(Evaluacion12BndQSService.class, wsdl);
            EvaluacionPT evaluacion = evaluacion12BndQSService.getEvaluacion12BndQSPort();
            ConsultarEvaluacionRequestType request = new ConsultarEvaluacionRequestType();
            ConsultarEvaluacionResponseType response = new ConsultarEvaluacionResponseType();
            Evaluacion evaluacionRequest = new Evaluacion();
            evaluacionRequest.setIdOperacion(idOperacion);
            evaluacionRequest.setDescripcionTipoEvaluacion(tipoEvaluacion);
            catalogo.setId(eventoEvaluacion);
            evaluacionRequest.setCatEvaluacion(catalogo);
            evaluacionRequest.setInstanciaProceso(instanciaProceso);

            //Se agrega La evaluacion al request
            request.setEvaluacion(evaluacionRequest);
            //Se agrega id de tarea en el request
            catalogoTarea.setId(idTarea);
            request.setTarea(catalogoTarea);
            try {
                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_EVALUACION);
                response = evaluacion.consultarEvaluacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CONSULTAR_EVALUACION, horaInicio);
                respuestaServicio = new HashMap<String, ConsultarEvaluacionResponseType>();
                respuestaServicio.put("response", response);
            } catch (Exception e) {
                logger.log(ADFLogger.WARNING, "Erro al ejecutar el servicio");
            }
            if (null != response.getEvaluaciones().getEvaluacion()) {
                listaEvaluaciones = response.getEvaluaciones().getEvaluacion();
            } else {
                logger.log(ADFLogger.WARNING, "No hay respuesta del servicio.");
            }
            Long id = null;
            if (null != listaEvaluaciones) {
                for (Evaluacion evaluaciones : listaEvaluaciones) {

                    for (Cuestionario cuestionarios : evaluaciones.getCuestionarios().getCuestionario()) {
                        incrementarId++;
                        nuevaEvaluacion = (EvaluacionVORowImpl) evaluacionVO.createRow();

                        // Issue FNXII-4508
                        //Se autoincrementa el valor del id de la tabla ya que es programatica
                        //nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID, incrementarId);
                        id = evaluaciones.getId();
                        if (id != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID, id);
                        }
                        ///////////////////

                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDOPERACION, evaluaciones.getIdOperacion());

                        if (evaluaciones.getIdEvaluacion() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDEVALUACION,
                                                         evaluaciones.getIdEvaluacion());
                        }
                        if (evaluaciones.getIdSectorIBCIE() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDSECTOR, evaluaciones.getIdSectorIBCIE());
                        }
                        if (evaluaciones.getSectorIBCIE() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.DESCRIPCIONSECTOR,
                                                         evaluaciones.getSectorIBCIE());
                        }
                        if (evaluaciones.getIdSubSectorIBCIE() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDSUBSECTOR,
                                                         evaluaciones.getIdSubSectorIBCIE());
                        }
                        if (evaluaciones.getSubSectorIBCIE() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.DESCRIPCIONSUBSECTOR,
                                                         evaluaciones.getSubSectorIBCIE());
                        }
                        // Issue FNXII-4508
                        if (evaluaciones.getCalificacionIBCIE() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.CALIFICACION,
                                                         evaluaciones.getCalificacionIBCIE());
                        }
                        if (evaluaciones.getEnAnalisis() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ENANALISIS, evaluaciones.getEnAnalisis());
                        }
                        //Se agrega el titulo de evaluacion relacionado a la incidencia FNXII-6803
                        if (evaluaciones.getTituloEvaluacion() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.TITULOEVALUACION,
                                                         evaluaciones.getTituloEvaluacion());
                        }
                        //////////////////////////////////////////////////////////////////////////
                        if (cuestionarios.getIdCuestionario() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDCUESTIONARIO,
                                                         cuestionarios.getIdCuestionario());
                        }
                        if (cuestionarios.getCodigoExterno() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.CODIGOEXTERNO,
                                                         cuestionarios.getCodigoExterno());
                        }
                        //Issue FNXII-1616
                        if (cuestionarios.getPorcentaje() != null) {
                            DecimalFormat decimales = new DecimalFormat("0.00");
                            Double porcentaje = (cuestionarios.getPorcentaje()) * 100;
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.PORCENTAJEAVANCE,
                                                         decimales.format(porcentaje));
                        }
                        //Agrega al mappeon el estado de la evaluacion
                        if (cuestionarios.getDescripcionEstado() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.PORCENTAJESTATUS,
                                                         cuestionarios.getDescripcionEstado());
                        }

                        if (cuestionarios.getCuestionario() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.NOMBRECUESTIONARIO,
                                                         cuestionarios.getCuestionario());
                        }

                        if (cuestionarios.getEstado() != null) {
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ESTADO, cuestionarios.getEstado());
                        }

                        if (evaluaciones.getCatEvaluacion().getDescripcionCorta() != null) {
                            logger.log(ADFLogger.WARNING,
                                       "Valor de evaluacion :" + evaluaciones.getCatEvaluacion().getDescripcionCorta());
                            nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.EVALUACION,
                                                         evaluaciones.getCatEvaluacion().getDescripcionCorta());
                        }

                        logger.warning("Estableciendo campo valor evaluaciones.getValor()" + evaluaciones.getValor());
                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.VALOR, evaluaciones.getValor());
                        logger.warning("Estableciendo campo version evaluaciones.getVersion()" +
                                       evaluaciones.getVersion());
                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.VERSION, evaluaciones.getVersion());
                        //Inserta el row a la tabla de evaluaciones
                        evaluacionVO.insertRow(nuevaEvaluacion);


                    }
                }
            } else {

            }
            String mensaje = null;
            if (null != response.getResultado().getMessage()) {
                mensaje = response.getResultado().getMessage();
            } else {
                logger.log(ADFLogger.WARNING, "El mensaje del servicio es nulo.");
            }
            if (null != response.getResultado()) {
                if (null != response.getResultado().getResult() &&
                    response.getResultado().getResult().value().equalsIgnoreCase("OK")) {
                    logger.log(ADFLogger.WARNING, "Respuesta del servicio." + mensaje);
                } else {
                    logger.log(ADFLogger.WARNING, "Respuesta del servicio." + mensaje);
                }
            } else {
                logger.log(ADFLogger.WARNING, "No hay Resultado del servicio.");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        //Resolver incidencia , fue la unica manera de que respetara consulta con 1 ROW
        nuevaEvaluacion = (EvaluacionVORowImpl) evaluacionVO.createRow();
        //nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID,5000);
        evaluacionVO.insertRow(nuevaEvaluacion);
        Row row = evaluacionVO.getRowAtRangeIndex(0);
        row.remove();
        logger.warning("Fuera de consultarEvaluacion");
        return respuestaServicio;
    }

    public Map consultarEvaluacionDuplicado(Long idOperacion, Long idTarea, String tipoEvaluacion,
                                            String instanciaProceso, Long eventoEvaluacion) {
        logger.warning("Dentro de consultarEvaluacionDuplicado");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("idTarea :" + idTarea);
        logger.warning("tipoEvaluacion :" + tipoEvaluacion);
        logger.warning("instanciaProceso :" + instanciaProceso);
        logger.warning("eventoEvaluacion :" + eventoEvaluacion);

        ConsultarEvaluacionRequestType request = new ConsultarEvaluacionRequestType();
        ConsultarEvaluacionResponseType response = new ConsultarEvaluacionResponseType();
        Evaluacion evaluacionRequest = new Evaluacion();

        EvaluacionVOImpl evaluacionVO = getEvaluacionVO();
        Catalogo catalogo = new Catalogo();
        Catalogo catalogoTarea = new Catalogo();
        EvaluacionVORowImpl nuevaEvaluacion;

        HashMap<String, ConsultarEvaluacionResponseType> respuestaServicio = null;
        List<Evaluacion> listaEvaluaciones = new ArrayList<Evaluacion>();
        List<Evaluacion> listaEvaluaciones1 = new ArrayList<Evaluacion>();

        BigDecimal idEvaluacion = null;
        int incrementarId = 0;
        try {
            evaluacionVO.clearCache();
            String wsdl = getWsdl(IWsdlLocation.EVALUACION);

            Evaluacion12BndQSService evaluacion12BndQSService =
                IWsdlLocation.Service.getInstance(Evaluacion12BndQSService.class, wsdl);
            EvaluacionPT evaluacion = evaluacion12BndQSService.getEvaluacion12BndQSPort();

            evaluacionRequest.setIdOperacion(idOperacion);
            evaluacionRequest.setDescripcionTipoEvaluacion(tipoEvaluacion);

            catalogo.setId(eventoEvaluacion);
            evaluacionRequest.setCatEvaluacion(catalogo);
            evaluacionRequest.setInstanciaProceso(instanciaProceso);

            //Se agrega La evaluacion al request
            request.setEvaluacion(evaluacionRequest);
            //Se agrega id de tarea en el request
            catalogoTarea.setId(idTarea);
            request.setTarea(catalogoTarea);

            try {
                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_EVALUACION);
                response = evaluacion.consultarEvaluacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CONSULTAR_EVALUACION, horaInicio);
                respuestaServicio = new HashMap<String, ConsultarEvaluacionResponseType>();
                respuestaServicio.put("response", response);
            } catch (Exception e) {
                logger.warning("Erro al ejecutar el servicio");
            }
            if (null != response.getEvaluaciones().getEvaluacion()) {
                listaEvaluaciones = response.getEvaluaciones().getEvaluacion();
                listaEvaluaciones1 = response.getEvaluaciones().getEvaluacion();
            } else {
                logger.warning("No hay respuesta del servicio.");
            }
            Long id = null;
            if (null != listaEvaluaciones) {
                for (Evaluacion evaluaciones : listaEvaluaciones) {
                    Integer i = 0;
                    idEvaluacion = new BigDecimal(evaluaciones.getId());
                    for (Evaluacion evaluaciones1 : listaEvaluaciones1) {
                        if (null != idEvaluacion && null != evaluaciones1.getIdEvaluacionOrigen()) {
                            if (idEvaluacion.compareTo(evaluaciones1.getIdEvaluacionOrigen()) == 0) {
                                i++;
                                for (Cuestionario cuestionarios : evaluaciones.getCuestionarios().getCuestionario()) {
                                    incrementarId++;
                                    nuevaEvaluacion = (EvaluacionVORowImpl) evaluacionVO.createRow();

                                    // Issue FNXII-4508
                                    //Se autoincrementa el valor del id de la tabla ya que es programatica
                                    //nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID, incrementarId);
                                    id = evaluaciones.getId();
                                    logger.warning("Valor de Id Evaluacion Actual : " + id);
                                    logger.warning("Valor de Id Evaluacion Duplicado : " + evaluaciones1.getId());
                                    if (id != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID, id);
                                    }
                                    ///////////////////

                                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDOPERACION,
                                                                 evaluaciones.getIdOperacion());

                                    if (evaluaciones.getIdEvaluacion() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDEVALUACION,
                                                                     evaluaciones.getIdEvaluacion());
                                    }
                                    if (evaluaciones.getIdSectorIBCIE() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDSECTOR,
                                                                     evaluaciones.getIdSectorIBCIE());
                                    }
                                    if (evaluaciones.getSectorIBCIE() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.DESCRIPCIONSECTOR,
                                                                     evaluaciones.getSectorIBCIE());
                                    }
                                    if (evaluaciones.getIdSubSectorIBCIE() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDSUBSECTOR,
                                                                     evaluaciones.getIdSubSectorIBCIE());
                                    }
                                    if (evaluaciones.getSubSectorIBCIE() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.DESCRIPCIONSUBSECTOR,
                                                                     evaluaciones.getSubSectorIBCIE());
                                    }
                                    // Issue FNXII-4508
                                    if (evaluaciones.getCalificacionIBCIE() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.CALIFICACION,
                                                                     evaluaciones.getCalificacionIBCIE());
                                    }
                                    if (evaluaciones.getEnAnalisis() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ENANALISIS,
                                                                     evaluaciones.getEnAnalisis());
                                    }
                                    //////////////////////////////////////////////////////////////////////////
                                    if (cuestionarios.getIdCuestionario() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDCUESTIONARIO,
                                                                     cuestionarios.getIdCuestionario());
                                    }
                                    if (cuestionarios.getCodigoExterno() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.CODIGOEXTERNO,
                                                                     cuestionarios.getCodigoExterno());
                                    }
                                    //Issue FNXII-1616
                                    if (cuestionarios.getPorcentaje() != null) {
                                        DecimalFormat decimales = new DecimalFormat("0.00");
                                        Double porcentaje = (cuestionarios.getPorcentaje()) * 100;
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.PORCENTAJEAVANCE,
                                                                     decimales.format(porcentaje));
                                    }
                                    //Agrega al mappeon el estado de la evaluacion
                                    if (cuestionarios.getDescripcionEstado() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.PORCENTAJESTATUS,
                                                                     cuestionarios.getDescripcionEstado());
                                    }

                                    if (cuestionarios.getCuestionario() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.NOMBRECUESTIONARIO,
                                                                     cuestionarios.getCuestionario());
                                    }

                                    if (cuestionarios.getEstado() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ESTADO,
                                                                     cuestionarios.getEstado());
                                    }

                                    if (evaluaciones.getCatEvaluacion().getDescripcionCorta() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.EVALUACION,
                                                                     evaluaciones.getCatEvaluacion().getDescripcionCorta());
                                    }

                                    if (evaluaciones.getTituloEvaluacion() != null) {
                                        nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.TITULOEVALUACION,
                                                                     evaluaciones.getTituloEvaluacion());
                                    }

                                    logger.warning("Estableciendo campo valor evaluaciones.getValor()" +
                                                   evaluaciones.getValor());
                                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.VALOR, evaluaciones.getValor());

                                    //Inserta el row a la tabla de evaluaciones el cuestionario actual
                                    evaluacionVO.insertRow(nuevaEvaluacion);


                                }
                                //Inserta el row a la tabla de evaluaciones el cuestionario duplicado
                                insertaEvaluacionActual(evaluaciones1);
                            } else {
                                logger.warning("La replica no pertenece a el cuestionario actual :" + idEvaluacion +
                                               "!= " + evaluaciones1.getIdEvaluacionOrigen());
                            }
                        } else {
                            logger.warning("El cuestionario no es una replica" + idEvaluacion +
                                           evaluaciones1.getIdEvaluacionOrigen());
                        }
                    }
                    if (i == 0 && null == evaluaciones.getIdEvaluacionOrigen()) {
                        logger.warning("No hay evaluacion duplicada. Insertamos cuestionario actual.");
                        insertaEvaluacionActual(evaluaciones);
                    } else {
                        logger.warning("La evaluacion ya fue insertada.");
                    }
                }
            }
            String mensaje = null;
            if (null != response.getResultado().getMessage()) {
                mensaje = response.getResultado().getMessage();
            } else {
                logger.warning("El mensaje del servicio es nulo.");
            }
            if (null != response.getResultado()) {
                if (null != response.getResultado().getResult() &&
                    response.getResultado().getResult().value().equalsIgnoreCase("OK")) {
                    logger.warning("Respuesta del servicio." + mensaje);
                } else {
                    logger.warning("Respuesta del servicio." + mensaje);
                }
            } else {
                logger.warning("No hay Resultado del servicio.");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        //Resolver incidencia , fue la unica manera de que respetara consulta con 1 ROW
        nuevaEvaluacion = (EvaluacionVORowImpl) evaluacionVO.createRow();
        //nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID,5000);
        evaluacionVO.insertRow(nuevaEvaluacion);
        Row row = evaluacionVO.getRowAtRangeIndex(0);
        row.remove();

        logger.warning("Fuera de consultarEvaluacionDuplicado");
        return respuestaServicio;
    }

    //Metodo en el cual se reliza el insert del cuestionario duplicado
    public void insertaEvaluacionActual(Evaluacion evaluaciones) {
        logger.warning("Entra en insertaEvaluacionActual");

        EvaluacionVOImpl evaluacionVO = getEvaluacionVO();
        EvaluacionVORowImpl nuevaEvaluacion;

        Long id = null;
        int incrementarId = 0;

        try {
            for (Cuestionario cuestionarios : evaluaciones.getCuestionarios().getCuestionario()) {
                incrementarId++;
                nuevaEvaluacion = (EvaluacionVORowImpl) evaluacionVO.createRow();

                id = evaluaciones.getId();
                logger.warning("Valor de Id Evaluacion Duplicado : " + id);
                logger.warning("Valor de Id Evaluacion Duplicado origen: " + evaluaciones.getIdEvaluacionOrigen());
                if (id != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID, id);
                }

                nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDOPERACION, evaluaciones.getIdOperacion());

                if (evaluaciones.getIdEvaluacion() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDEVALUACION, evaluaciones.getIdEvaluacion());
                }
                if (evaluaciones.getIdSectorIBCIE() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDSECTOR, evaluaciones.getIdSectorIBCIE());
                }
                if (evaluaciones.getSectorIBCIE() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.DESCRIPCIONSECTOR, evaluaciones.getSectorIBCIE());
                }
                if (evaluaciones.getIdSubSectorIBCIE() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDSUBSECTOR, evaluaciones.getIdSubSectorIBCIE());
                }
                if (evaluaciones.getSubSectorIBCIE() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.DESCRIPCIONSUBSECTOR,
                                                 evaluaciones.getSubSectorIBCIE());
                }
                if (evaluaciones.getCalificacionIBCIE() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.CALIFICACION, evaluaciones.getCalificacionIBCIE());
                }
                if (evaluaciones.getEnAnalisis() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ENANALISIS, evaluaciones.getEnAnalisis());
                }
                //////////////////////////////////////////////////////////////////////////
                if (cuestionarios.getIdCuestionario() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDCUESTIONARIO, cuestionarios.getIdCuestionario());
                }
                if (cuestionarios.getCodigoExterno() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.CODIGOEXTERNO, cuestionarios.getCodigoExterno());
                }
                if (cuestionarios.getPorcentaje() != null) {
                    DecimalFormat decimales = new DecimalFormat("0.00");
                    Double porcentaje = (cuestionarios.getPorcentaje()) * 100;
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.PORCENTAJEAVANCE, decimales.format(porcentaje));
                }
                if (cuestionarios.getDescripcionEstado() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.PORCENTAJESTATUS,
                                                 cuestionarios.getDescripcionEstado());
                }
                if (cuestionarios.getCuestionario() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.NOMBRECUESTIONARIO,
                                                 cuestionarios.getCuestionario());
                }
                if (cuestionarios.getEstado() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ESTADO, cuestionarios.getEstado());
                }
                if (evaluaciones.getCatEvaluacion().getDescripcionCorta() != null) {
                    logger.warning("Valor de evaluacion :" + evaluaciones.getCatEvaluacion().getDescripcionCorta());
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.EVALUACION,
                                                 evaluaciones.getCatEvaluacion().getDescripcionCorta());
                }
                if (evaluaciones.getIdEvaluacionOrigen() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.IDEVALUACIONORIGEN,
                                                 evaluaciones.getIdEvaluacionOrigen());
                }

                //Se agrega el titulo de evaluacion relacionado a la incidencia FNXII-6803
                if (evaluaciones.getTituloEvaluacion() != null) {
                    nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.TITULOEVALUACION,
                                                 evaluaciones.getTituloEvaluacion());
                }

                logger.warning("Estableciendo campo valor evaluaciones.getValor()" + evaluaciones.getValor());
                nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.VALOR, evaluaciones.getValor());

                //Inserta el row a la tabla de evaluaciones
                evaluacionVO.insertRow(nuevaEvaluacion);


            }
        } catch (Exception e) {
            logger.warning("Error al insertar el cuestionario duplicado." + e.getClass() + "." + e);
        }
    }

    public BigDecimal duplicarCuestionario(Long idOperacion, Long tipoEvaluacion, String idFlujo, String loginUsuario) {
        logger.log(ADFLogger.WARNING, "Entra en duplicarCuestionario");
        //        EvaluacionVOImpl evaluacionVO = getEvaluacionVO();
        //        evaluacionVO.clearCache();
        HashMap<String, DuplicarEvaluacionResponseType> respuestaServicio = null;
        BigDecimal idEvaluacion = null;
        String mensaje = null;

        DuplicarEvaluacionRequestType request = new DuplicarEvaluacionRequestType();
        DuplicarEvaluacionResponseType response = new DuplicarEvaluacionResponseType();
        EVALType evalRequest = new EVALType();
        Catalogo catalogo = new Catalogo();
        OperacionBasicType operacion = new OperacionBasicType();

        try {
            String wsdl = getWsdl(IWsdlLocation.EVALUACION);

            Evaluacion12BndQSService evaluacion12BndQSService =
                IWsdlLocation.Service.getInstance(Evaluacion12BndQSService.class, wsdl);
            EvaluacionPT evaluacion = evaluacion12BndQSService.getEvaluacion12BndQSPort();

            operacion.setIdOperacion(idOperacion);
            catalogo.setId(tipoEvaluacion);

            evalRequest.setOperacion(operacion);
            evalRequest.setTipoEvaluacion(catalogo);
            evalRequest.setIdFlujo(idFlujo);
            evalRequest.setLoginUsuario(loginUsuario);
            request.setEvaluacion(evalRequest);

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_DUPLICAR_EVALUACION);
            response = evaluacion.duplicarCuestionario(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_DUPLICAR_EVALUACION, horaInicio);
            respuestaServicio = new HashMap<String, DuplicarEvaluacionResponseType>();
            respuestaServicio.put("response", response);
            if (null != response.getIdEvaluacion()) {
                idEvaluacion = response.getIdEvaluacion();
            } else {
                logger.log(ADFLogger.WARNING, "El id del cuestionario duplicado es nulo.");
            }


            if (null != response.getResultado().getMessage()) {
                mensaje = response.getResultado().getMessage();
            } else {
                logger.log(ADFLogger.WARNING, "El mensaje del servicio es nulo.");
            }
            if (null != response.getResultado()) {
                if (null != response.getResultado().getResult() &&
                    response.getResultado().getResult().value().equalsIgnoreCase("OK")) {
                    logger.log(ADFLogger.WARNING, "Respuesta del servicio." + mensaje);
                } else {
                    logger.log(ADFLogger.WARNING, "Respuesta del servicio." + mensaje);
                }
            } else {
                logger.log(ADFLogger.WARNING, "No hay Resultado del servicio.");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        //Resolver incidencia , fue la unica manera de que respetara consulta con 1 ROW
        //        nuevaEvaluacion = (EvaluacionVORowImpl) evaluacionVO.createRow();
        //        //nuevaEvaluacion.setAttribute(EvaluacionVORowImpl.ID,5000);
        //        evaluacionVO.insertRow(nuevaEvaluacion);
        //        Row row = evaluacionVO.getRowAtRangeIndex(0);
        //        row.remove();
        return idEvaluacion;
    }

    /**
     * Metodo que ejecuta el servicio para crear Evaluaciones
     * @param sector
     * @param suSsector
     * @param cuestionarios
     * @return
     */
    public Map crearEvaluacion(Map<String, Object> mapEvaluacion) {

        HashMap<String, CrearEvaluacionResponseType> respuestaServicio = null;
        String wsdl = getWsdl(IWsdlLocation.EVALUACION);
        Long tipoEvaluacion = null;
        Integer tipoEvaluacionAux = null;
        String instanciaProceso = null;

        Evaluacion12BndQSService evaluacion12BndQSService =
            IWsdlLocation.Service.getInstance(Evaluacion12BndQSService.class, wsdl);
        EvaluacionPT evaluacion12Port = evaluacion12BndQSService.getEvaluacion12BndQSPort();
        try {
            logger.log(ADFLogger.WARNING, ">HNWS" + evaluacion12Port.toString());
        } catch (Exception ex) {
        }

        CrearEvaluacionRequestType request = new CrearEvaluacionRequestType();
        CrearEvaluacionResponseType response = new CrearEvaluacionResponseType();
        Evaluaciones evaluaciones = new Evaluaciones();
        Evaluacion evaluacion = new Evaluacion();
        Catalogo catalogo = new Catalogo();
        try {

            Iterator it = mapEvaluacion.entrySet().iterator();
            while (it.hasNext()) {
                Map.Entry e = (Map.Entry) it.next();
            }
            Cuestionarios listaCuestionarios = new Cuestionarios();
            // List<Cuestionario> listaCues = new ArrayList<Cuestionario>();
            evaluacion.setIdOperacion(Integer.valueOf(mapEvaluacion.get("idOperacion").toString()));

            if (mapEvaluacion.get("idSector") != null && !mapEvaluacion.get("idSector").equals(0)) {
                evaluacion.setIdSectorIBCIE(mapEvaluacion.get("idSector").toString());
            }

            if (mapEvaluacion.get("descripcionSector") != null) {
                evaluacion.setSectorIBCIE(mapEvaluacion.get("descripcionSector").toString());
            }

            if (mapEvaluacion.get("idSubsector") != null && !mapEvaluacion.get("idSubsector").equals(0)) {
                evaluacion.setIdSubSectorIBCIE(mapEvaluacion.get("idSubsector").toString());
            }

            if (mapEvaluacion.get("descripcionSubSector") != null) {
                evaluacion.setSubSectorIBCIE(mapEvaluacion.get("descripcionSubSector").toString());
            }
            if (null != mapEvaluacion.get("tipoEvaluacion")) {
                tipoEvaluacionAux = (Integer) mapEvaluacion.get("tipoEvaluacion");
                tipoEvaluacion = new Long(tipoEvaluacionAux);
                logger.log(ADFLogger.WARNING, "Valor tipo Evaluacion :" + tipoEvaluacion);
                catalogo.setId(tipoEvaluacion);
                evaluacion.setCatEvaluacion(catalogo);
            } else {
                logger.log(ADFLogger.WARNING, "El valor del tipo de evaluacion es nulo.");
            }
            if (null != mapEvaluacion.get("instanciaProceso")) {
                instanciaProceso = (String) mapEvaluacion.get("instanciaProceso");
                logger.log(ADFLogger.WARNING, "Valor tipo instanciaProceso :" + instanciaProceso);
                evaluacion.setInstanciaProceso(instanciaProceso);
            } else {
                logger.log(ADFLogger.WARNING, "El valor de la instanciaProceso es nulo.");
            }

            //Agrega la lista de id´s de cuestionarios
            ArrayList lista = (ArrayList) (mapEvaluacion.get("cuestionarios"));

            for (Object idCuest : lista) {
                Cuestionario cuestionario = new Cuestionario();
                cuestionario.setCodigoExterno(idCuest.toString());
                listaCuestionarios.getCuestionario().add(cuestionario);
            }

            evaluacion.setCuestionarios(listaCuestionarios);
            //Termina de agregar la lista de id´s de cuestionario
            //Se solicito que siempre se envie 1 al request de CrearEvaluacion
            evaluacion.setEnAnalisis(EN_ANALISIS_DEFAULT);
            evaluacion.setBanEstatus(BANESTATUS_TRUE);
            evaluacion.setVersion(VERSION_EVALUACION);
            //*************************
            evaluacion.setNombreUsuario((String) mapEvaluacion.get("usuario"));
            evaluaciones.getEvaluacion().add(evaluacion);
            //Se agrega evaluaciones al request
            request.setEvaluaciones(evaluaciones);
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_EVALUACION);
            response = evaluacion12Port.crearEvaluacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_EVALUACION, horaInicio);
            respuestaServicio = new HashMap<String, CrearEvaluacionResponseType>();
            respuestaServicio.put("response", response);
            //consultarEvaluacion(Long.valueOf(mapEvaluacion.get("idOperacion").toString()));

        } catch (Exception e) {
            e.printStackTrace();

        }
        return respuestaServicio;
    }

    public Map eliminarCuestionarioEvaluacion(Long idEvaluacion, String codigoExterno, String nombreUsuario) {
        logger.log(ADFLogger.WARNING, "Entra en eliminarCuestionarioEvaluacion");
        HashMap<String, EliminarCuestionarioResponseType> respuestaServicio = null;
        try {
            //System.out.println("Entra al metodo eliminar cuestionario de evaluacion" + idEvaluacion + " " + codigoExterno);
            String wsdl = getWsdl(IWsdlLocation.EVALUACION);

            Evaluacion12BndQSService evaluacion12BndQSService =
                IWsdlLocation.Service.getInstance(Evaluacion12BndQSService.class, wsdl);
            EvaluacionPT evaluacion = evaluacion12BndQSService.getEvaluacion12BndQSPort();
            EliminarCuestionarioRequestType request = new EliminarCuestionarioRequestType();
            EliminarCuestionarioResponseType response = new EliminarCuestionarioResponseType();
            Catalogo cuestionario = new Catalogo();
            // cuestionario.setId(idCuestionario);
            cuestionario.setCodigoExterno(codigoExterno);
            request.setCuestionario(cuestionario);
            request.setIdEvaluacion(idEvaluacion);
            request.setNombreUsuario(nombreUsuario);
            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ELIMINAR_CUESTIONARIO_EVALUACION);
            response = evaluacion.eliminarCuestionario(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ELIMINAR_CUESTIONARIO_EVALUACION, horaInicio);
            respuestaServicio = new HashMap<String, EliminarCuestionarioResponseType>();
            respuestaServicio.put("response", response);

        } catch (Exception e) {
            e.printStackTrace();
        }
        return respuestaServicio;
    }

    public boolean testCrearEvaluacion() {
        try {
            Map<String, Object> mapEvaluacion = new HashMap<String, Object>();
            List<Long> lista = new ArrayList<Long>();
            long cuest = 29;
            //long cuest2 = 30;
            lista.add(cuest);
            //lista.add(cuest2);

            mapEvaluacion.put("idOperacion", 500471);
            mapEvaluacion.put("idSector", 3);
            mapEvaluacion.put("idSubsector", 14);
            mapEvaluacion.put("cuestionarios", lista);
            mapEvaluacion.put("enAnalisis", 1);
            mapEvaluacion.put("version", 2);
            mapEvaluacion.put("usuario", "ponceg");
            crearEvaluacion(mapEvaluacion);

        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * Metodo que ejecuta el servicio para compensar Evaluaciones
     * @param idFlujo o instanciaProceso
     * @param idOperacion
     * @param idTipoEvaluacion
     * @param LoginUsuario
     * @return
     * */
    public Boolean compensarEvaluacion(String instanciaProceso, String idOperacion, String tipoEvaluacion,
                                       String loginUsuario) {
        logger.warning("Inside compensarEvaluacion.");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        HashMap<String, CompensarEvaluacionRespnseType> respuestaServicio = null;

        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.EVALUACION);

                Evaluacion12BndQSService evaluacion12BndQSService =
                    IWsdlLocation.Service.getInstance(Evaluacion12BndQSService.class, wsdl);
                EvaluacionPT evaluacionPt = evaluacion12BndQSService.getEvaluacion12BndQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + evaluacionPt.toString());
                } catch (Exception ex) {
                }

                CompensarEvaluacionRequestType request = new CompensarEvaluacionRequestType();
                CompensarEvaluacionRespnseType response = new CompensarEvaluacionRespnseType();
                EVALType evaluacion = new EVALType();

                evaluacion.setIdFlujo(instanciaProceso);

                OperacionBasicType operacion = new OperacionBasicType();
                operacion.setIdOperacion(Long.parseLong(idOperacion));
                evaluacion.setOperacion(operacion);

                Catalogo catalogo = new Catalogo();
                catalogo.setId(Long.parseLong(tipoEvaluacion));
                evaluacion.setTipoEvaluacion(catalogo);

                evaluacion.setLoginUsuario(loginUsuario);

                request.setEvaluacion(evaluacion);

                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_COMPENSAR_EVALUACION);
                response = evaluacionPt.compensarEvaluacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_COMPENSAR_EVALUACION, horaInicio);
                respuestaServicio = new HashMap<String, CompensarEvaluacionRespnseType>();
                respuestaServicio.put("response", response);


                if (null != response.getResultado().getError() ||
                    (response.getResultado() != null && response.getResultado().getMessage().toString() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getResultado().getMessage() &&
                        response.getResultado().getMessage().trim().length() > 0) {
                        mensajeError = response.getResultado().getMessage();
                    }
                    if (null != response.getResultado().getError().getErrorDescription() &&
                        response.getResultado().getError().getErrorDescription().trim().length() > 0) {
                        detalleError = response.getResultado().getError().getErrorDescription();
                    }

                    existeError = Boolean.TRUE;
                    msgError =
                        "La operacion: " + idOperacion + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en compensarEvaluacion: idOperacion vacio");
                msgError = "Error en compensarEvaluacion: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en compensarEvaluacion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en compensarEvaluacion " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }

    public Integer getCurrentAnalisisByOperation(String idOperacion) {
        AnalisisVOImpl analisisVO = getAnalisisVO();
        analisisVO.setIdOperacion(idOperacion);
        analisisVO.executeQuery();

        if (null != analisisVO && analisisVO.getRowCount() > 0) {
            Row analisisRow = analisisVO.getRowAtRangeIndex(0);

            analisisVO.setCurrentRow(analisisRow);

            MotivosAnalisisVOImpl analisisVOImpl = getMotivosAnalisisVO();
            analisisVOImpl.setIdAnalisis((Integer) analisisRow.getAttribute(AnalisisVORowImpl.ID));

            analisisVOImpl.executeQuery();

            return (Integer) analisisRow.getAttribute(AnalisisVORowImpl.ID);
        }

        return null;
    }

    public Boolean actualizarOperacionAnalisis(Long idOperacion, Integer src, String perspectiva, Float tir,
                                               String loginUsuario, Boolean aprobar) {
        logger.warning("Entra en actualizarOperacionAnalisis.");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        try {
            String TIR_SCR_PRELIMINAR = PRELIMINAR_TEXT;
            String TIR_SCR_APROBADO = APROBADO_TEXT;
            String wsdl = getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
            } catch (Exception ex) {
            }
            ActualizarOperacionRequestType request = new ActualizarOperacionRequestType();
            Operacion operacion = new Operacion();
            Catalogo catalogo = new Catalogo();
            Catalogo perspectivaObj = new Catalogo();

            operacion.setIdOperacion(idOperacion);
            operacion.setResponsable(loginUsuario);

            if (null != aprobar && aprobar)
                catalogo.setDescripcion(TIR_SCR_APROBADO);


            if (src != null) {
                catalogo.setId(src.longValue());
                if (null != aprobar && !aprobar)
                    catalogo.setDescripcion(TIR_SCR_PRELIMINAR);

                operacion.setSRC(catalogo);
            }

            if (perspectiva != null && !perspectiva.equalsIgnoreCase("")) {
                perspectivaObj.setId(Long.valueOf(perspectiva));
                operacion.setPerspectiva(perspectivaObj);
            }

            if (null != aprobar && aprobar)
                operacion.setTIREstatus(TIR_SCR_APROBADO);

            if (tir != null) {
                operacion.setTIR(tir);
                if (null != aprobar && !aprobar)
                    operacion.setTIREstatus(TIR_SCR_PRELIMINAR);
            }

            request.setOperacion(operacion);

            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_OPERACION_ANALISIS);
            ActualizarOperacionResponseType response = operacion12Port.actualizarOperacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_OPERACION_ANALISIS, horaInicio);

            String mensajeError = "";
            // String detalleError = "";

            if (response.getResultado().getResult().value().equalsIgnoreCase("ERROR")) { //null != response.getResultado().getError() ||(response.getResultado().getResult() != null &&
                logger.warning("El servicio regresa error.");
                if (null != response.getResultado().getMessage() &&
                    response.getResultado().getMessage().trim().length() > 0) {
                    mensajeError = response.getResultado().getMessage();
                }
                /*
                if (null != response.getResultado().getError().getErrorDescription() &&
                    response.getResultado().getError().getErrorDescription().trim().length() > 0) {
                    detalleError = response.getResultado().getError().getErrorDescription();
                }*/
                existeError = Boolean.TRUE;
                msgError =
                    "La operación: " + idOperacion + ". Marca lo siguiente: " +
                    mensajeError; //+ ". Detalle: " + detalleError;

                return false;
            } else {
                logger.warning("La respuesta del servicio es correcta.");
                return true;
            }

        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en actualizarOperacion " + e.getClass() + ":" + e.getMessage());
            msgError = e.getMessage();
            return false;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
    }

    public Map actualizarOperacionEvaluacion(Long idOperacion, String loginUsuario, Map<String, Object> parametrosMap) {
        logger.log(ADFLogger.TRACE, "Inside actualizarOperacionEvaluacion.");

        try {
            HashMap<String, ActualizarOperacionResponseType> respuestaServicio = null;
            String wsdl = getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
            } catch (Exception ex) {
            }
            ActualizarOperacionRequestType request = new ActualizarOperacionRequestType();
            ActualizarOperacionResponseType response = null;
            Operacion operacion = new Operacion();

            operacion.setIdOperacion(idOperacion);
            operacion.setResponsable(loginUsuario);

            operacion.setActividadEconomica(new Catalogo());
            operacion.setActividadEconomicaAsociada(new Catalogo());
            operacion.setAreaFocalizacion(new Catalogo());
            operacion.setEjeEstrategico(new Catalogo());
            operacion.setIniciativaEstrategica(new Catalogo());
            operacion.setCantidadPaises(new Catalogo());

            operacion.getActividadEconomica().setId((Long) parametrosMap.get("idActividadEconomica"));
            operacion.getActividadEconomica().setCodigoExterno((String) parametrosMap.get("codExternoActividadEconomica"));
            operacion.getActividadEconomicaAsociada().setId((Long) parametrosMap.get("idActividadAsociada"));
            operacion.getActividadEconomicaAsociada().setCodigoExterno((String) parametrosMap.get("codExternoActividadAsociada"));
            operacion.getAreaFocalizacion().setId((Long) parametrosMap.get("idAreaFocalizacion"));
            operacion.getEjeEstrategico().setId((Long) parametrosMap.get("idEjeEstrategico"));
            operacion.getIniciativaEstrategica().setId((Long) parametrosMap.get("idIniciativaEstrategica"));
            operacion.getCantidadPaises().setId((Long) parametrosMap.get("idCantidadPaises"));

            request.setOperacion(operacion);

            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_OPERACION_EVALUACION);
            response = operacion12Port.actualizarOperacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_OPERACION_EVALUACION, horaInicio);
            respuestaServicio = new HashMap<String, ActualizarOperacionResponseType>();
            respuestaServicio.put("response", response);
            return respuestaServicio;

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR,
                       "Error en actualizarOperacionEvaluacion " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en actualizarOperacionEvaluacion " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        }
    }

    public Boolean crearComision(Long idComision, String descripcion, String loginUsuario) {
        logger.warning("Inside crearComision.");

        Boolean resultado = Boolean.FALSE;
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        try {
            String wsdl = getWsdl(IWsdlLocation.COMISION);

            Comision comision = IWsdlLocation.Service.getInstance(Comision.class, wsdl);
            ComisionPT comisionPT = comision.getComision12Bnd();
            CrearCargoTramiteRequestType request = new CrearCargoTramiteRequestType();

            request.setIdComision(idComision);

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_COMISION);
            CrearCargoTramiteResponseType crearComisionResponse = comisionPT.crearCargoTramite(request);
            ModelUtils.logEndWS(logger, crearComisionResponse, FenixModelConstants.WSC_CREAR_COMISION, horaInicio);

            if (null != crearComisionResponse.getResultado()) {
                if (null != crearComisionResponse.getResultado().getResult()) {
                    if (crearComisionResponse.getResultado().getResult().value() == "OK") {
                        resultado = Boolean.TRUE;
                    } else {
                        if (null != crearComisionResponse.getResultado().getError()) {
                            if (crearComisionResponse.getResultado().getResult().value() == "ERROR") {
                                String mensajeError = "";
                                String detalleError = "";

                                if (null != crearComisionResponse.getResultado().getMessage() &&
                                    crearComisionResponse.getResultado().getMessage().trim().length() > 0) {
                                    mensajeError = crearComisionResponse.getResultado().getMessage();
                                }

                                if (null != crearComisionResponse.getResultado().getError().getErrorDescription() &&
                                    crearComisionResponse.getResultado().getError().getErrorDescription().trim().length() >
                                    0) {
                                    detalleError =
                                        crearComisionResponse.getResultado().getError().getErrorDescription();
                                }

                                if (null != mensajeError) {
                                    if (null != detalleError) {
                                        existeError = Boolean.TRUE;
                                        msgError =
                                            "La comision: " + idComision + " , " + descripcion +
                                            ". Mensaje de error: " + mensajeError + ". Detalle del error: " +
                                            detalleError;
                                    } else {
                                        existeError = Boolean.TRUE;
                                        msgError =
                                            "La comision: " + idComision + " , " + descripcion +
                                            ". Mensaje de error: " + mensajeError;
                                    }
                                } else {
                                    if (null != detalleError) {
                                        existeError = Boolean.TRUE;
                                        msgError =
                                            "La comision: " + idComision + " , " + descripcion +
                                            ". Detalle del error: " + detalleError;
                                    } else {
                                        existeError = Boolean.FALSE;
                                        resultado = Boolean.TRUE;
                                    }
                                }

                                logger.warning("msgError: " + msgError);

                                throw new Exception(msgError);

                            } else {
                                logger.log(ADFLogger.WARNING,
                                           "Error en crearComision no se obtuvo resultado de tipo error");
                                resultado = Boolean.TRUE;
                            }
                        } else {
                            logger.log(ADFLogger.WARNING, "Error en crearComision no se obtuvo resultado de error");
                            resultado = Boolean.TRUE;
                        }
                    }
                } else {
                    logger.log(ADFLogger.WARNING, "Error en crearComision no se obtuvo resultado");
                }
            } else {
                logger.log(ADFLogger.WARNING, "Error en crearComision no se obtuvo response del servicio");
            }

        } catch (Exception e) {
            logger.log(ADFLogger.WARNING, "Error en crearComision " + e.getClass() + ":" + e.getMessage());
            // logger.log(ADFLogger.ERROR, "Error en crearComision " + e.getClass() + ":" + e.getMessage());
            existeError = Boolean.TRUE;
            resultado = false;
            JboException xe = new JboException(e);
            throw xe;
        }

        return resultado;
    }

    public Map crearComisionProceso(Long idComision, String descripcion, String loginUsuario) {
        logger.warning("Inside crearComisionProceso.");

        Boolean resultado = Boolean.FALSE;
        Boolean existeError = Boolean.FALSE;
        Map<String, Object> retorno = new HashMap<String, Object>();
        String msgError = "";

        try {
            String wsdl = getWsdl(IWsdlLocation.COMISION);

            Comision comision = IWsdlLocation.Service.getInstance(Comision.class, wsdl);
            ComisionPT comisionPT = comision.getComision12Bnd();
            CrearCargoTramiteRequestType request = new CrearCargoTramiteRequestType();

            request.setIdComision(idComision);

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_COMISION);
            CrearCargoTramiteResponseType crearComisionResponse = comisionPT.crearCargoTramite(request);
            ModelUtils.logEndWS(logger, crearComisionResponse, FenixModelConstants.WSC_CREAR_COMISION, horaInicio);

            if (null != crearComisionResponse.getResultado()) {
                if (null != crearComisionResponse.getResultado().getResult()) {
                    if (crearComisionResponse.getResultado().getResult().value() == "OK") {
                        resultado = Boolean.TRUE;
                    } else {
                        if (null != crearComisionResponse.getResultado().getError()) {
                            if (crearComisionResponse.getResultado().getResult().value() == "ERROR") {
                                String mensajeError = "";
                                String detalleError = "";

                                if (null != crearComisionResponse.getResultado().getMessage() &&
                                    crearComisionResponse.getResultado().getMessage().trim().length() > 0) {
                                    mensajeError = crearComisionResponse.getResultado().getMessage();
                                }

                                if (null != crearComisionResponse.getResultado().getError().getErrorDescription() &&
                                    crearComisionResponse.getResultado().getError().getErrorDescription().trim().length() >
                                    0) {
                                    detalleError =
                                        crearComisionResponse.getResultado().getError().getErrorDescription();
                                }

                                if (null != mensajeError) {
                                    if (null != detalleError) {
                                        existeError = Boolean.TRUE;
                                        msgError =
                                            "La comision: " + idComision + " , " + descripcion +
                                            ". Mensaje de error: " + mensajeError + ". Detalle del error: " +
                                            detalleError;
                                    } else {
                                        existeError = Boolean.TRUE;
                                        msgError =
                                            "La comision: " + idComision + " , " + descripcion +
                                            ". Mensaje de error: " + mensajeError;
                                    }
                                } else {
                                    if (null != detalleError) {
                                        existeError = Boolean.TRUE;
                                        msgError =
                                            "La comision: " + idComision + " , " + descripcion +
                                            ". Detalle del error: " + detalleError;
                                    } else {
                                        existeError = Boolean.FALSE;
                                        resultado = Boolean.TRUE;
                                    }
                                }

                                logger.warning("msgError: " + msgError);

                            } else {
                                logger.log(ADFLogger.WARNING,
                                           "Error en crearComision no se obtuvo resultado de tipo error");
                                resultado = Boolean.TRUE;
                            }
                        } else {
                            logger.log(ADFLogger.WARNING, "Error en crearComision no se obtuvo resultado de error");
                            resultado = Boolean.TRUE;
                        }
                    }
                } else {
                    logger.log(ADFLogger.WARNING, "Error en crearComision no se obtuvo resultado");
                }
            } else {
                logger.log(ADFLogger.WARNING, "Error en crearComision no se obtuvo response del servicio");
            }

        } catch (Exception e) {
            logger.log(ADFLogger.WARNING, "Error en crearComision " + e.getClass() + ":" + e.getMessage());
            // logger.log(ADFLogger.ERROR, "Error en crearComision " + e.getClass() + ":" + e.getMessage());
            existeError = Boolean.TRUE;
            resultado = Boolean.FALSE;
            /*
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en crearComision " + e.getClass() + ":" + e.getMessage()));
            throw ex; */
        }

        retorno.put("resultado", resultado);
        retorno.put("error", msgError);

        return retorno;
    }

    public Boolean crearComisionGestor(Long idComision, String descripcion, String loginUsuario) {
        logger.warning("inside crearComisionGestor.");
        logger.warning("idComision : " + idComision);
        logger.warning("loginUsuario : " + loginUsuario);

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        try {
            String wsdl = getWsdl(IWsdlLocation.COMISION);

            Comision comision = IWsdlLocation.Service.getInstance(Comision.class, wsdl);
            ComisionPT comisionPT = comision.getComision12Bnd();
            CrearCargoTramiteRequestType request = new CrearCargoTramiteRequestType();

            request.setIdComision(idComision);

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_COMISION);
            CrearCargoTramiteResponseType crearComisionResponse = comisionPT.crearCargoTramite(request);
            ModelUtils.logEndWS(logger, crearComisionResponse, FenixModelConstants.WSC_CREAR_COMISION, horaInicio);

            if ((crearComisionResponse.getResultado().getResult() != null &&
                 crearComisionResponse.getResultado().getResult().value() == "ERROR")) {
                String mensajeError = "";
                String detalleError = "";

                if (null != crearComisionResponse.getResultado().getMessage() &&
                    crearComisionResponse.getResultado().getMessage().trim().length() > 0) {
                    mensajeError = crearComisionResponse.getResultado().getMessage();
                    logger.warning("mensajeError: " + mensajeError);
                }
                if (null != crearComisionResponse.getResultado().getError().getErrorDescription() &&
                    crearComisionResponse.getResultado().getError().getErrorDescription().trim().length() > 0) {
                    detalleError = crearComisionResponse.getResultado().getError().getErrorDescription();
                    logger.warning("detalleError: " + detalleError);
                }

                existeError = Boolean.TRUE;
                msgError =
                    "La comision: " + idComision + " , " + descripcion + ". Mensaje de error: " + mensajeError +
                    ". Detalle del error: " + detalleError;
                logger.warning("msgError: " + msgError);
                return false;
            } else {
                return true;
            }
        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.warning("Error en crearComision " + e.getClass() + ":" + e.getMessage());
            msgError = e.getMessage();
            return false;
        } finally {
            if (existeError) {
                logger.warning("Error " + msgError);
            }
            logger.warning("Termina crearComisionGestor.");
        }
    }

    //TODO Delete me
    //    public Boolean testActualizarOperacionEvaluacion(){
    //        Long idOperacion = 500097L;
    //        Long idActividadEconomica = 1281L;
    //        Long idActividadAsociada = 1282L;
    //        Long idAreaFocalizacion = 1005L;
    //        Long idEjeEstrategico = 1005L;
    //        Long idIniciativaEstrategica = 1098L;
    //        Long idCantidadPaises = 1L;
    //
    //        String codExternoActividadEconomica = "G47060400";
    //        String codExternoActividadAsociada = "C17000100";
    //        String loginUsuario = "jramirez";
    //
    //        Map<String, Object> parametrosMap = new HashMap<>();
    //        parametrosMap.put("idActividadEconomica", idActividadEconomica);
    //        parametrosMap.put("idActividadAsociada", idActividadAsociada);
    //        parametrosMap.put("idAreaFocalizacion", idAreaFocalizacion);
    //        parametrosMap.put("idEjeEstrategico", idEjeEstrategico);
    //        parametrosMap.put("idIniciativaEstrategica", idIniciativaEstrategica);
    //        parametrosMap.put("idCantidadPaises", idCantidadPaises);
    //        parametrosMap.put("codExternoActividadEconomica", codExternoActividadEconomica);
    //        parametrosMap.put("codExternoActividadAsociada", codExternoActividadAsociada);
    //
    //        Boolean resultado = actualizarOperacionEvaluacion(idOperacion, loginUsuario, parametrosMap);
    //        return resultado;
    //    }

    //TODO Delete me
    public void testCrearAnalisis() {
        Long idOperacion = 500009L;
        Boolean tipoOpinion = false;
        Boolean isValidadoJefatura = true;
        Boolean isValidadoASJUR = true;
        List<Integer> listaMotivos = new ArrayList<Integer>();

        listaMotivos.add(4);
        listaMotivos.add(5);


        Boolean execution = crearAnalisis(idOperacion, tipoOpinion, isValidadoJefatura, isValidadoASJUR, listaMotivos);

        System.out.println(execution);
    }

    public void IniciarClasificacionEstrategicaCuestionarios(Long idOperacion) {
        TiposActividadEconomicaLOVImpl tiposActividadEconomicaVOImpl = getTiposActividadEconomicaLOV();
        TiposAreaFocalizacionLOVImpl tiposAreaFocalizacionVOImpl = getTiposAreaFocalizacionLOV();
        TiposEjeEstrategicoLOVImpl tiposEjeEstrategicoLOImpl = getTiposEjeEstrategicoLOV();

        TiposActividadEconomicaPadreLOVImpl tiposActividadEconomicaPadreVOImpl = getTiposActividadEconomicaPadreLOV();
        TiposIniciativaEstrategicaLOVImpl tiposIniciativaEstrategicaVOImpl = getTiposIniciativaEstrategicaLOV();
        TiposCantidadPaisesBeneficiadosLOVImpl tiposCantidadPaisesVOImpl = getTiposCantidadPaisesBeneficiadosLOV();

        ClasificacionEstrategicaLOVImpl clasificacionEstrategicaVOImpl = getClasificacionEstrategicaLOV();
        clasificacionEstrategicaVOImpl.setidOperacionCuestionario(idOperacion);
        clasificacionEstrategicaVOImpl.executeQuery();

        int idActividadEconomica =
            (Integer) getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("ActividadEconomica");
        int idAreaFocalizacion =
            (Integer) getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("AreaFocalizacion");
        int idEjeEstrategico =
            (Integer) getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("EjeEstrategico");
        int idActividadEconomicaPadre;
        Integer idIniciativaEstrategica =
            (Integer) getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("IniciativaEstrategica");
        Integer idRangoPais =
            (Integer) getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("IdRangoPais");

        oracle.jbo.domain.Number idActividadEconomicaNumber;
        oracle.jbo.domain.Number idIniciativaEstrategicaNumber;
        oracle.jbo.domain.Number idRangoPaisNumber;
        try {
            String actividadEconomicaString =
                getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("ActividadEconomica").toString();
            idActividadEconomicaNumber = new oracle.jbo.domain.Number(actividadEconomicaString);
        } catch (Exception e) {
            e.printStackTrace();
            idActividadEconomicaNumber = new Number(0);
        }
        try {
            String iniciativaEstrategicaString =
                getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("IniciativaEstrategica").toString();
            idIniciativaEstrategicaNumber = new oracle.jbo.domain.Number(iniciativaEstrategicaString);
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error al inicializar IniciativaEstrategica: " + e.getMessage());
            idIniciativaEstrategicaNumber = new Number(0);
        }
        try {
            String idRangoPaisString =
                getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("IdRangoPais").toString();
            idRangoPaisNumber = new oracle.jbo.domain.Number(idRangoPaisString);

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error al inicializar IdRangoPais: " + e.getMessage());
            idRangoPaisNumber = new Number(0);
        }
        oracle.jbo.domain.Number idActividadEconomicaPadreNumber;

        tiposActividadEconomicaVOImpl.setidActividad(idActividadEconomicaNumber);
        tiposActividadEconomicaVOImpl.executeQuery();
        tiposAreaFocalizacionVOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposAreaFocalizacionVOImpl.setidRangoPaises(idRangoPaisNumber);
        tiposAreaFocalizacionVOImpl.executeQuery();
        tiposEjeEstrategicoLOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposEjeEstrategicoLOImpl.setidRangoPaises(idRangoPaisNumber);
        tiposEjeEstrategicoLOImpl.executeQuery();

        Row[] rowTiposActividadEconomica = getTiposActividadEconomicaLOV().getFilteredRows("Id", idActividadEconomica);
        for (Row row : rowTiposActividadEconomica) {
            getTiposActividadEconomicaLOV().setCurrentRow(row);
        }

        Row[] rowTiposAreaFocalizacion = getTiposAreaFocalizacionLOV().getFilteredRows("Id", idAreaFocalizacion);
        for (Row row : rowTiposAreaFocalizacion) {
            getTiposAreaFocalizacionLOV().setCurrentRow(row);
        }

        Row[] rowTiposEjeEstrategico = getTiposEjeEstrategicoLOV().getFilteredRows("Id", idEjeEstrategico);
        for (Row row : rowTiposEjeEstrategico) {
            getTiposEjeEstrategicoLOV().setCurrentRow(row);
        }

        idActividadEconomicaPadre =
            (Integer) getTiposActividadEconomicaLOV().getCurrentRow().getAttribute("IdCatalogoActividadPadre");
        try {
            String idCatalogoActividadesPadre =
                getTiposActividadEconomicaLOV().getCurrentRow().getAttribute("IdCatalogoActividadPadre").toString();
            idActividadEconomicaPadreNumber = new oracle.jbo.domain.Number(idCatalogoActividadesPadre);
        } catch (Exception e) {
            e.printStackTrace();
            idActividadEconomicaPadreNumber = new oracle.jbo.domain.Number(0);
        }
        tiposActividadEconomicaPadreVOImpl.executeQuery();

        Row[] rowActividadEconomicaPadre =
            getTiposActividadEconomicaPadreLOV().getFilteredRows("Id", idActividadEconomicaPadre);
        for (Row row : rowActividadEconomicaPadre) {
            getTiposActividadEconomicaPadreLOV().setCurrentRow(row);
        }

        tiposIniciativaEstrategicaVOImpl.setidPadre(idActividadEconomicaPadreNumber);
        tiposIniciativaEstrategicaVOImpl.executeQuery();
        Row[] rowIniciativaEstrategica =
            getTiposIniciativaEstrategicaLOV().getFilteredRows("Id", idIniciativaEstrategica);
        for (Row row : rowIniciativaEstrategica) {
            getTiposIniciativaEstrategicaLOV().setCurrentRow(row);
        }
        tiposCantidadPaisesVOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposCantidadPaisesVOImpl.executeQuery();

        if (getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("IdRangoPais") != null) {
            BigDecimal idRangoPaisBigDecimal =
                new BigDecimal(getClasificacionEstrategicaLOV().getRowAtRangeIndex(0).getAttribute("IdRangoPais").toString());
            Row[] rowTiposCantidadPaises =
                getTiposCantidadPaisesBeneficiadosLOV().getFilteredRows("IdRangoPaises", idRangoPaisBigDecimal);
            for (Row row : rowTiposCantidadPaises) {
                getTiposCantidadPaisesBeneficiadosLOV().setCurrentRow(row);
            }
        }
    }

    public void IniciarClasificacionEstrategica() {
        TiposActividadEconomicaLOVImpl tiposActividadEconomicaVOImpl = getTiposActividadEconomicaLOV();
        TiposAreaFocalizacionLOVImpl tiposAreaFocalizacionVOImpl = getTiposAreaFocalizacionLOV();
        TiposEjeEstrategicoLOVImpl tiposEjeEstrategicoLOImpl = getTiposEjeEstrategicoLOV();

        TiposActividadEconomicaPadreLOVImpl tiposActividadEconomicaPadreVOImpl = getTiposActividadEconomicaPadreLOV();
        TiposIniciativaEstrategicaLOVImpl tiposIniciativaEstrategicaVOImpl = getTiposIniciativaEstrategicaLOV();
        TiposCantidadPaisesBeneficiadosLOVImpl tiposCantidadPaisesVOImpl = getTiposCantidadPaisesBeneficiadosLOV();

        int idActividadEconomica =
            (Integer) getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("ActividadEconomica");
        int idAreaFocalizacion =
            (Integer) getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("AreaFocalizacion");
        int idEjeEstrategico =
            (Integer) getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("EjeEstrategico");
        int idActividadEconomicaPadre;
        Integer idIniciativaEstrategica =
            (Integer) getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("IniciativaEstrategica");
        Integer idRangoPais =
            (Integer) getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("IdRangoPais");

        oracle.jbo.domain.Number idActividadEconomicaNumber;
        oracle.jbo.domain.Number idIniciativaEstrategicaNumber;
        oracle.jbo.domain.Number idRangoPaisNumber;
        try {
            String actividadEconomicaString =
                getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("ActividadEconomica").toString();
            idActividadEconomicaNumber = new oracle.jbo.domain.Number(actividadEconomicaString);
        } catch (Exception e) {
            e.printStackTrace();
            idActividadEconomicaNumber = new Number(0);
        }
        try {
            String iniciativaEstrategicaString =
                getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("IniciativaEstrategica").toString();
            idIniciativaEstrategicaNumber = new oracle.jbo.domain.Number(iniciativaEstrategicaString);
        } catch (Exception e) {
            e.printStackTrace();
            idIniciativaEstrategicaNumber = new Number(0);
        }
        try {
            String idRangoPaisString =
                getDetalleOperacionEditableVO().getRowAtRangeIndex(0).getAttribute("IdRangoPais").toString();
            idRangoPaisNumber = new oracle.jbo.domain.Number(idRangoPaisString);

        } catch (Exception e) {
            e.printStackTrace();
            idRangoPaisNumber = new Number(0);
        }
        oracle.jbo.domain.Number idActividadEconomicaPadreNumber;

        tiposActividadEconomicaVOImpl.setidActividad(idActividadEconomicaNumber);
        tiposActividadEconomicaVOImpl.executeQuery();
        tiposAreaFocalizacionVOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposAreaFocalizacionVOImpl.setidRangoPaises(idRangoPaisNumber);
        tiposAreaFocalizacionVOImpl.executeQuery();
        tiposEjeEstrategicoLOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposEjeEstrategicoLOImpl.setidRangoPaises(idRangoPaisNumber);
        tiposEjeEstrategicoLOImpl.executeQuery();

        Row[] rowTiposActividadEconomica = getTiposActividadEconomicaLOV().getFilteredRows("Id", idActividadEconomica);
        for (Row row : rowTiposActividadEconomica) {
            getTiposActividadEconomicaLOV().setCurrentRow(row);
        }

        Row[] rowTiposAreaFocalizacion = getTiposAreaFocalizacionLOV().getFilteredRows("Id", idAreaFocalizacion);
        for (Row row : rowTiposAreaFocalizacion) {
            getTiposAreaFocalizacionLOV().setCurrentRow(row);
        }

        Row[] rowTiposEjeEstrategico = getTiposEjeEstrategicoLOV().getFilteredRows("Id", idEjeEstrategico);
        for (Row row : rowTiposEjeEstrategico) {
            getTiposEjeEstrategicoLOV().setCurrentRow(row);
        }

        idActividadEconomicaPadre =
            (Integer) getTiposActividadEconomicaLOV().getCurrentRow().getAttribute("IdCatalogoActividadPadre");
        try {
            String idCatalogoActividadesPadre =
                getTiposActividadEconomicaLOV().getCurrentRow().getAttribute("IdCatalogoActividadPadre").toString();
            idActividadEconomicaPadreNumber = new oracle.jbo.domain.Number(idCatalogoActividadesPadre);
        } catch (Exception e) {
            e.printStackTrace();
            idActividadEconomicaPadreNumber = new oracle.jbo.domain.Number(0);
        }
        tiposActividadEconomicaPadreVOImpl.executeQuery();

        Row[] rowActividadEconomicaPadre =
            getTiposActividadEconomicaPadreLOV().getFilteredRows("Id", idActividadEconomicaPadre);
        for (Row row : rowActividadEconomicaPadre) {
            getTiposActividadEconomicaPadreLOV().setCurrentRow(row);
        }

        tiposIniciativaEstrategicaVOImpl.setidPadre(idActividadEconomicaPadreNumber);
        tiposIniciativaEstrategicaVOImpl.executeQuery();
        Row[] rowIniciativaEstrategica =
            getTiposIniciativaEstrategicaLOV().getFilteredRows("Id", idIniciativaEstrategica);
        for (Row row : rowIniciativaEstrategica) {
            getTiposIniciativaEstrategicaLOV().setCurrentRow(row);
        }
        tiposCantidadPaisesVOImpl.setidIniciativaEstrategica(idIniciativaEstrategicaNumber);
        tiposCantidadPaisesVOImpl.executeQuery();
        BigDecimal idRangoPaisBigDecimal = new BigDecimal(idRangoPais.toString());
        Row[] rowTiposCantidadPaises =
            getTiposCantidadPaisesBeneficiadosLOV().getFilteredRows("IdRangoPaises", idRangoPaisBigDecimal);
        for (Row row : rowTiposCantidadPaises) {
            getTiposCantidadPaisesBeneficiadosLOV().setCurrentRow(row);
        }

    }

    public List<Map> getPreguntasCuestionario() {

        logger.warning("Dentro de getPreguntasCuestionario");
        
        List<Map> preguntasRow = new ArrayList<Map>();
        
        
        ViewObjectImpl qPreguntasVO = this.getQPreguntaVO();
        
        qPreguntasVO.executeQuery();


        RowSetIterator rs = qPreguntasVO.createRowSetIterator(null);
        rs.reset();

        while (rs.hasNext()) {
            QPreguntaVORowImpl r = (QPreguntaVORowImpl) rs.next();
            preguntasRow.add(r.getAttributesMap());
        }

        rs.closeRowSetIterator();
        logger.warning("Fuera de getPreguntasCuestionario");
        return preguntasRow;
    }

    public Boolean validarCuestionarioCompleto() {
        List<Map> preguntasRow = new ArrayList<Map>();
        ViewObjectImpl qPreguntasVO = this.getQPreguntaVO();

        RowSetIterator rs = qPreguntasVO.createRowSetIterator(null);
        rs.reset();

        while (rs.hasNext()) {
            QPreguntaVORowImpl pregunta = (QPreguntaVORowImpl) rs.next();
            String respuesta = (String) pregunta.getAttribute(QPreguntaVORowImpl.RESPUESTA);

            if (null == respuesta || respuesta.trim().length() == 0) //Repuesta es nula o vacia
                return Boolean.FALSE;
        }

        rs.closeRowSetIterator();

        return Boolean.TRUE;
    }

    public Boolean guardarPreguntasCuestionario(List<Map> plPreguntas) {
        
        logger.warning("into guardarPreguntasCuestionario plPreguntas size :"+plPreguntas.size());
        logger.warning("getDBTransaction().isConnected() :"+getDBTransaction().isConnected());
        Boolean preguntarGuardadas = false;
        if(!getDBTransaction().isConnected())
        {
            try
            {
                logger.warning("Base de datos no conectada, intentando reconnect");
                getDBTransaction().reconnect();
                
            } catch (Exception ex) {
                logger.warning("Error al realizar el reconnect ->",ex);
            } 
        }
        
        if(getDBTransaction().isConnected())
        {
            try {
                ViewObjectImpl qPreguntasVO = this.getQPreguntaVO();
                 logger.warning("qPreguntasVO getEstimatedRowCount: "+qPreguntasVO.getEstimatedRowCount());            

                RowSetIterator rs = qPreguntasVO.createRowSetIterator(null);
                rs.reset();
                
                logger.warning("rs.getRowCount() :"+rs.getRowCount());
                logger.warning("rs.hasNext() :"+rs.hasNext());
                
                //Se valida que si el rowcount de VO es mayor que cero y el Rowset cero en ese caso se devuelve false
                if(qPreguntasVO.getEstimatedRowCount() > 0 && rs.getRowCount() == 0)
                {
                    rs.closeRowSetIterator();
                    preguntarGuardadas = Boolean.FALSE;
                }
                else
                {
                    while (rs.hasNext()) {
                        QPreguntaVORowImpl preguntaRow = (QPreguntaVORowImpl) rs.next();
                        Long idPregunta = (Long) preguntaRow.getAttribute(QPreguntaVORowImpl.IDPREGUNTA);
                        logger.warning("idPregunta: "+idPregunta);
                        if (null != idPregunta) {
                            Iterator<Map> i = plPreguntas.iterator();
                            while (i.hasNext()) {
                                Map preguntaMap = i.next();

                                Long idPreguntaMap = (Long) preguntaMap.get("IdPregunta");
                                logger.warning("idPregunta: "+idPregunta+" idPreguntaMap: "+idPreguntaMap);
                                if (idPregunta.compareTo(idPreguntaMap) == 0) {
                                    String respuesta = (String) preguntaMap.get("Respuesta");
                                    String justificacion = (String) preguntaMap.get("Justificacion");
                                    logger.warning("coincidencia encontrada agregando respuesta y justificacion");
                                    if(respuesta != null && !respuesta.isEmpty())
                                    {
                                        preguntaRow.setAttribute(QPreguntaVORowImpl.RESPUESTA, respuesta);
                                    }
                                    if(justificacion != null && !justificacion.isEmpty())
                                    {
                                        preguntaRow.setAttribute(QPreguntaVORowImpl.JUSTIFICACION, justificacion);
                                    }

                                    i.remove();
                                }
                            }
                        }
                    }

                    rs.closeRowSetIterator();
                    getDBTransaction().commit();

                    preguntarGuardadas = Boolean.TRUE;
                }             
            } catch (Exception ex) {
                logger.warning("Error al realizar el commit ->",ex);
                preguntarGuardadas = Boolean.FALSE;
            }   
        }
        else
        {
            logger.warning("Transaction is not connected");
            preguntarGuardadas = Boolean.FALSE; 
        }
        
        return preguntarGuardadas;
    }

    public void inicializarCrearOperacion() {
        CrearOperacionVOImpl crearOperacionVOImpl = getCrearOperacionVO();
        TiposActividadEconomicaPadreLOVImpl actividadEconomicaLOVImpl = getTiposActividadEconomicaPadreLOV();
        TiposIniciativaEstrategicaLOVImpl iniciativaEstrategicaLOVImpl = getTiposIniciativaEstrategicaLOV();
        TiposCantidadPaisesBeneficiadosLOVImpl cantidadPaisesBeneficiadosLOVImpl =
            getTiposCantidadPaisesBeneficiadosLOV();
        TiposActividadEconomicaLOVImpl tiposActividadEconomicaVOImpl = getTiposActividadEconomicaLOV();
        TiposAreaFocalizacionLOVImpl tiposAreaFocalizacionVOImpl = getTiposAreaFocalizacionLOV();
        TiposEjeEstrategicoLOVImpl tiposEjeEstrategicoLOImpl = getTiposEjeEstrategicoLOV();
        //OperacionesAsociadasVO
        OperacionesAsociadasVOImpl operacionesAsociadasVOImpl = getOperacionesAsociadasVO();
        //Limpiar VO OperacionesAsociadasVO
        operacionesAsociadasVOImpl.clearCache();

        crearOperacionVOImpl.crearRowOperacion();
        actividadEconomicaLOVImpl.executeQuery();
        iniciativaEstrategicaLOVImpl.executeQuery();
        cantidadPaisesBeneficiadosLOVImpl.executeQuery();

        tiposActividadEconomicaVOImpl.setidActividad(null);
        tiposActividadEconomicaVOImpl.executeQuery();
        tiposAreaFocalizacionVOImpl.setidIniciativaEstrategica(null);
        tiposAreaFocalizacionVOImpl.setidRangoPaises(null);
        tiposAreaFocalizacionVOImpl.executeQuery();
        tiposEjeEstrategicoLOImpl.setidIniciativaEstrategica(null);
        tiposEjeEstrategicoLOImpl.setidRangoPaises(null);
        tiposEjeEstrategicoLOImpl.executeQuery();

    }

    public Boolean validarRowElegibilidad(Long idOperacion) {
        ViewObjectImpl elegibilidadVO = getElegibilidadVO();
        ViewCriteria criteria =
            elegibilidadVO.getViewCriteriaManager().getViewCriteria("ElegibilidadIdOperaicionCriteria");
        criteria.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
        elegibilidadVO.applyViewCriteria(criteria);
        elegibilidadVO.executeQuery();
        if (elegibilidadVO.getRowCount() > 0) {
            logger.log(ADFLogger.WARNING, "Se encontro el Row en Elegibilidad correctamente.");
            return Boolean.TRUE;
        } else {
            logger.log(ADFLogger.WARNING, "No se encontro el Row en Elegibilidad.");
            return Boolean.FALSE;
        }
    }

    public Boolean guardarElegibilidad(Long idOperacion, Boolean esElegible, String strElegibilidad,
                                       String strDeterminar) {
        ViewObjectImpl elegibilidadVO = getElegibilidadVO();
        try {
            Row elegibilidadRow = null;
            ViewCriteria criteria =
                elegibilidadVO.getViewCriteriaManager().getViewCriteria("ElegibilidadIdOperaicionCriteria");
            criteria.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);

            elegibilidadVO.applyViewCriteria(criteria);
            elegibilidadVO.executeQuery();

            if (elegibilidadVO.getEstimatedRowCount() > 0) {
                elegibilidadRow = elegibilidadVO.getRowAtRangeIndex(0);
            } else {
                elegibilidadRow = elegibilidadVO.createRow();

                elegibilidadVO.insertRow(elegibilidadRow);

                SequenceImpl sqElegibilidad = new SequenceImpl("ELEGIBILIDAD_SEQ", getDBTransaction());
                Number elegibilidadId = sqElegibilidad.getSequenceNumber();

                elegibilidadRow.setAttribute(ElegibilidadVORowImpl.ID, elegibilidadId);
                elegibilidadRow.setAttribute(ElegibilidadVORowImpl.IDOPERACION, idOperacion);
            }

            if (strDeterminar != null && strDeterminar.trim().length() > 0)
                elegibilidadRow.setAttribute(ElegibilidadVORowImpl.COMENTARIODETERMINAR, strDeterminar);

            if (strElegibilidad != null && strElegibilidad.trim().length() > 0)
                elegibilidadRow.setAttribute(ElegibilidadVORowImpl.COMENTARIOELEGIBILIDAD, strElegibilidad);

            if (esElegible != null) {

                Integer intEsElegible = null;
                if (esElegible) {
                    intEsElegible = 1;
                } else {
                    intEsElegible = 0;
                }
                elegibilidadRow.setAttribute(ElegibilidadVORowImpl.ESELEGIBLE, intEsElegible);
            }

            //Se asigna valor de registro activo
            elegibilidadRow.setAttribute(ElegibilidadVORowImpl.BANESTATUS, new Integer(1));

            getDBTransaction().commit();
            //validar row exista
            return validarRowElegibilidad(idOperacion);
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en guardarElegibilidad " + ex.getClass() + ":" + ex.getMessage());
            return false;
        } finally {
            //This takes care of removing the applied VC.
            elegibilidadVO.getViewCriteriaManager().removeApplyViewCriteriaName("ComentarioOperacionVOCriteria");
        }
    }

    public Map validarBanderasReformular(String idOperacion, String idCliente, BigDecimal montoSolicitado,
                                         String unidadEjecutora, String idProducto) {

        logger.warning("Into validarBanderasReformular");
        Map<String, Object> mapaBanderasPayLoad = new HashMap<String, Object>();
        ViewObjectImpl operacionVO = getOperacionVO();
        ViewCriteria OperacionVOCriteria = operacionVO.getViewCriteriaManager().getViewCriteria("OperacionVOCriteria");
        Long montoSolicitadoNuevo = null;
        String idProductoNuevo = null;

        OperacionVOCriteria.ensureVariableManager().setVariableValue("idOperacionElegibilidad", idOperacion);
        operacionVO.applyViewCriteria(OperacionVOCriteria);
        operacionVO.executeQuery();

        if (operacionVO.getEstimatedRowCount() > 0) {
            operacionVO.setCurrentRow(operacionVO.first());

            mapaBanderasPayLoad.put("NombreOperacion", operacionVO.getCurrentRow().getAttribute("Nombre"));
            mapaBanderasPayLoad.put("CodigoCliente", operacionVO.getCurrentRow().getAttribute("IdCliente"));
            mapaBanderasPayLoad.put("NombreCliente", operacionVO.getCurrentRow().getAttribute("DescCliente"));
            mapaBanderasPayLoad.put("CodigoProducto", operacionVO.getCurrentRow().getAttribute("IdProducto"));
            mapaBanderasPayLoad.put("NombreProducto", operacionVO.getCurrentRow().getAttribute("DescProducto"));
            mapaBanderasPayLoad.put("MontoSolicitado", operacionVO.getCurrentRow().getAttribute("MontoSolicitado"));
            mapaBanderasPayLoad.put("UnidadEjecutora", operacionVO.getCurrentRow().getAttribute("UnidadEjecutora"));


            if (null != idProducto &&
                idProducto.equalsIgnoreCase(operacionVO.getCurrentRow().getAttribute("IdProducto").toString())) {
                mapaBanderasPayLoad.put("reformuloProducto", false);
                mapaBanderasPayLoad.put("requiereCuestionario", false);
            } else {
                mapaBanderasPayLoad.put("reformuloProducto", true);
                mapaBanderasPayLoad.put("requiereCuestionario", true);
            }

            if (null != idCliente &&
                idCliente.equalsIgnoreCase(operacionVO.getCurrentRow().getAttribute("IdCliente").toString())) {
                mapaBanderasPayLoad.put("reformuloCliente", false);
            } else {
                mapaBanderasPayLoad.put("reformuloCliente", true);
            }
            //validar que montoSolicitado sea diferente a null
            if (null != operacionVO.getCurrentRow().getAttribute("MontoSolicitado")) {
                if (null == montoSolicitado)
                    montoSolicitado = new BigDecimal(0);

                if (0 ==
                    montoSolicitado.compareTo(new BigDecimal(operacionVO.getCurrentRow().getAttribute("MontoSolicitado").toString()))) {
                    mapaBanderasPayLoad.put("reformuloMontoSolicitadoMasMenos", false);
                    mapaBanderasPayLoad.put("reformuloMontoSolicitadoMenosMas", false);
                    mapaBanderasPayLoad.put("reformuloMontoSolicitado", false);

                } else {
                    montoSolicitadoNuevo =
                        Long.valueOf(operacionVO.getCurrentRow().getAttribute("MontoSolicitado").toString());
                    mapaBanderasPayLoad.put("reformuloMontoSolicitado", true);

                    if (montoSolicitadoNuevo < 20000) {
                        mapaBanderasPayLoad.put("reformuloMontoSolicitadoMasMenos", true);
                    } else {
                        mapaBanderasPayLoad.put("reformuloMontoSolicitadoMasMenos", false);
                    }
                    if (montoSolicitadoNuevo > 20000) {
                        mapaBanderasPayLoad.put("reformuloMontoSolicitadoMenosMas", true);
                    } else {
                        mapaBanderasPayLoad.put("reformuloMontoSolicitadoMenosMas", false);
                    }
                }
            }

            //validar que unidadEjecutora sea diferente a null, ya que no todas las operacion cuenta
            //con una unidadEjecutora
            if (null != operacionVO.getCurrentRow().getAttribute("UnidadEjecutora")) {
                if (null != unidadEjecutora &&
                    true ==
                    unidadEjecutora.equals(operacionVO.getCurrentRow().getAttribute("UnidadEjecutora").toString())) {
                    mapaBanderasPayLoad.put("reformuloUnidadEjecutora", false);
                } else {
                    mapaBanderasPayLoad.put("reformuloUnidadEjecutora", true);
                }
            } else {
                if (null != unidadEjecutora) {
                    mapaBanderasPayLoad.put("reformuloUnidadEjecutora", true);
                } else {
                    mapaBanderasPayLoad.put("reformuloUnidadEjecutora", false);
                }
            }

        }

        return mapaBanderasPayLoad;
    }

    public Map inicializarDarSeguimiento(Long idSolicitud, Long idOperacion) {
        logger.warning("Dentro de inicializarDarSeguimiento");
        logger.warning("idSolicitud :" + idSolicitud);
        logger.warning("idOperacion :" + idOperacion);

        Map<String, Object> mapaAtributosReunion = new HashMap<String, Object>();
        try {

            inicializarDatosReunion(idSolicitud, idOperacion);
            consultarComentariosReunion(idSolicitud);

            SolicitudAprobacionVOImpl solicitudAprovacionVO = getSolicitudAprobacionVO1();
            SolicitudAprobacionVORowImpl solicitudAprobacionRow =
                (SolicitudAprobacionVORowImpl) solicitudAprovacionVO.getCurrentRow();

            if (solicitudAprobacionRow != null) {
                if (1 == solicitudAprobacionRow.getEsReunionVirtual()) {

                    if (solicitudAprobacionRow.getFechaTermino() != null) {
                        mapaAtributosReunion.put("FechaTerminoActual",
                                                 solicitudAprobacionRow.getFechaTermino().toString());
                    } else {
                        logger.warning("La solicitud de aprobacion no tiene fecha de cierre. Id Solicitud: " +
                                       idSolicitud);
                        mapaAtributosReunion.put("FechaTerminoActual", "");
                    }

                    mapaAtributosReunion.put("FechaReunionActual", "");
                    mapaAtributosReunion.put("horaReunionActual", "");
                } else {
                    mapaAtributosReunion.put("FechaTerminoActual", "");

                    if (solicitudAprobacionRow.getFechaInicio() != null) {
                        mapaAtributosReunion.put("FechaReunionActual",
                                                 solicitudAprobacionRow.getFechaInicio().toString());
                    } else {
                        logger.warning("La solicitud de aprobacion no tiene fecha de reunion definida. Id Solicitud: " +
                                       idSolicitud);
                        mapaAtributosReunion.put("FechaReunionActual", "");
                    }

                    if (solicitudAprobacionRow.getHoraReunion() != null) {
                        mapaAtributosReunion.put("horaReunionActual",
                                                 solicitudAprobacionRow.getHoraReunion().toString());
                    } else {
                        logger.warning("La solicitud de aprobacion no tiene Hora de reunion definida. Id Solicitud: " +
                                       idSolicitud);
                        mapaAtributosReunion.put("horaReunionActual", "");
                    }
                }

                UsuarioReunionAprobacionLOVImpl usuarioReunionVO = getUsuarioReunionAprobacionLOV();
                RowSetIterator rowsUsuarioReunion = usuarioReunionVO.createRowSetIterator(null);
                List<UsuarioReunionAprobacionLOVRowImpl> listaIdUsuarioReunion = new ArrayList<>();

                while (rowsUsuarioReunion.hasNext()) {
                    UsuarioReunionAprobacionLOVRowImpl rowUsuario =
                        (UsuarioReunionAprobacionLOVRowImpl) rowsUsuarioReunion.next();
                    listaIdUsuarioReunion.add(rowUsuario);
                }

                rowsUsuarioReunion.closeRowSetIterator();

                VotoActualAprobLOVImpl votoActualAprobLOVImpl = getVotoActualAprobLOV1();
                votoActualAprobLOVImpl.obtenerVotosReunion(listaIdUsuarioReunion);
            }
        } catch (Exception e) {
            e.printStackTrace();
            logger.severe("Error al iniciar el Seguimiento de la Votacion", e);
        }

        logger.warning("Fuera de inicializarDarSeguimiento");
        return mapaAtributosReunion;
    }

    public Map inicializarDarSeguimientoCliente(Long idSolicitud, Long idCliente) {

        Map<String, Object> mapaAtributosReunion = new HashMap<String, Object>();
        try {
            SolicitudAprobacionVOImpl solicitudAprovacionVO = getSolicitudAprobacionVO1();

            inicializarDatosReunionCliente(idSolicitud, idCliente);
            consultarComentariosReunion(idSolicitud);

            SolicitudAprobacionVORowImpl solicitudAprobacionRow =
                (SolicitudAprobacionVORowImpl) solicitudAprovacionVO.getCurrentRow();

            if (solicitudAprobacionRow != null) {
                logger.warning("idSolicitud " + solicitudAprobacionRow.getId());
                logger.warning("idcliente " + solicitudAprobacionRow.getIdCliente());
                if (1 == solicitudAprobacionRow.getEsReunionVirtual()) {

                    if (solicitudAprobacionRow.getFechaTermino() != null) {
                        mapaAtributosReunion.put("FechaTerminoActual",
                                                 solicitudAprobacionRow.getFechaTermino().toString());
                    } else {
                        logger.warning("La solicitud de aprobacion no tiene fecha de cierre. Id Solicitud: " +
                                       idSolicitud);
                        mapaAtributosReunion.put("FechaTerminoActual", "");
                    }

                    mapaAtributosReunion.put("FechaReunionActual", "");
                    mapaAtributosReunion.put("horaReunionActual", "");
                } else {
                    mapaAtributosReunion.put("FechaTerminoActual", "");

                    if (solicitudAprobacionRow.getFechaInicio() != null) {
                        mapaAtributosReunion.put("FechaReunionActual",
                                                 solicitudAprobacionRow.getFechaInicio().toString());
                    } else {
                        logger.warning("La solicitud de aprobacion no tiene fecha de reunion definida. Id Solicitud: " +
                                       idSolicitud);
                        mapaAtributosReunion.put("FechaReunionActual", "");
                    }

                    if (solicitudAprobacionRow.getHoraReunion() != null) {
                        mapaAtributosReunion.put("horaReunionActual",
                                                 solicitudAprobacionRow.getHoraReunion().toString());
                    } else {
                        logger.warning("La solicitud de aprobacion no tiene Hora de reunion definida. Id Solicitud: " +
                                       idSolicitud);
                        mapaAtributosReunion.put("horaReunionActual", "");
                    }
                }

                UsuarioReunionAprobacionLOVImpl usuarioReunionVO = getUsuarioReunionAprobacionLOV();
                RowSetIterator rowsUsuarioReunion = usuarioReunionVO.createRowSetIterator(null);
                List<UsuarioReunionAprobacionLOVRowImpl> listaIdUsuarioReunion = new ArrayList<>();

                while (rowsUsuarioReunion.hasNext()) {
                    UsuarioReunionAprobacionLOVRowImpl rowUsuario =
                        (UsuarioReunionAprobacionLOVRowImpl) rowsUsuarioReunion.next();
                    listaIdUsuarioReunion.add(rowUsuario);
                }

                rowsUsuarioReunion.closeRowSetIterator();

                VotoActualAprobLOVImpl votoActualAprobLOVImpl = getVotoActualAprobLOV1();
                votoActualAprobLOVImpl.obtenerVotosReunion(listaIdUsuarioReunion);
            }
        } catch (Exception e) {
            e.printStackTrace();
            logger.severe("Error al iniciar el Seguimiento de la Votacion", e);
        }

        return mapaAtributosReunion;
    }


    /**
     * Inicializa los bussiness components para la Dar seguimiento a la decision de presidencia
     * @param idSolicitud contiene id de la solicitud de aprobacion
     * @param idOperacion contiene id de la operacion
     * @param tipoSolicitud contiene id del tipo de solicitud
     */
    public void iniDarSeguimientoPresidencia(Long idSolicitud, Long idOperacion, Integer tipoSolicitud) {
        logger.entering(FenixAMImpl.class.getName(), "iniDarSeguimientoPresidencia", new Object[] {
                        idSolicitud, idOperacion, tipoSolicitud
        });

        logger.warning("ID Solicitud: " + idSolicitud);
        logger.warning("ID Operacion: " + idOperacion);
        logger.warning("ID Tipo: " + tipoSolicitud);

        //Realiza la busqueda del Row de Solicitud
        logger.warning("Realiza busqueda de Solicitud de Aprobacion. Id Solicitud: " + idSolicitud);
        getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorIdVC(new Number(idSolicitud));
        SolicitudAprobacionVORowImpl solicitudAprobacionRow =
            (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();

        if (solicitudAprobacionRow != null) {

            try {
                logger.fine("Consulta los comentarios de la reunion");
                consultarComentariosReunion(idSolicitud);
            } catch (Exception e) {
                logger.severe("Error al inicializar los comentarios de la reunion");
            }

            try {
                UsuarioReunionAprobacionLOVImpl usuarioReunionVO = getUsuarioReunionAprobacionLOV();
                RowSetIterator rowsUsuarioReunion = usuarioReunionVO.createRowSetIterator(null);
                List<UsuarioReunionAprobacionLOVRowImpl> listaIdUsuarioReunion = new ArrayList<>();

                while (rowsUsuarioReunion.hasNext()) {
                    UsuarioReunionAprobacionLOVRowImpl rowUsuario =
                        (UsuarioReunionAprobacionLOVRowImpl) rowsUsuarioReunion.next();
                    listaIdUsuarioReunion.add(rowUsuario);
                }
                rowsUsuarioReunion.closeRowSetIterator();

                logger.fine("Consulta los votos de la reunion");
                getVotoActualAprobLOV1().obtenerVotosReunion(listaIdUsuarioReunion);
            } catch (Exception e) {
                logger.severe("Error al inicializar los votos de la reunion");
            }

            //Obtener accion a seguir de la solicitud de aprobacion
            getDecisionReunionAprobacionVO().buscarDecisionPorIdSolicitud(new Number(idSolicitud));
            Long countRows = getDecisionReunionAprobacionVO().getEstimatedRowCount();
            if (countRows > 0) {
                logger.warning("Numero de Registros de Decision Reunion encontrados: " + countRows);

                DecisionReunionAprobacionVORowImpl rowDecision =
                    (DecisionReunionAprobacionVORowImpl) getDecisionReunionAprobacionVO().getCurrentRow();
                Number idAccion = rowDecision.getIdTcaAccionASeguir();

                //Asigna el Nivel de Aprobacion de Presidencia
                rowDecision.setIdNivelAprobacion(NIVEL_APROBACION_PRESIDENCIA_NUM);

                logger.fine("Obtiene Id de Accion a Seguir: " + idAccion);

                //Busca la descripcion de la decision
                getTcaAccionASeguirLOV1().buscarPorId(idAccion);
                if (getTcaAccionASeguirLOV1().getEstimatedRowCount() > 0) {

                    String descAccion = null;
                    String codExterno = null;
                    TcaAccionASeguirLOVRowImpl rowAccion =
                        (TcaAccionASeguirLOVRowImpl) getTcaAccionASeguirLOV1().getCurrentRow();
                    if (rowAccion != null) {
                        descAccion = rowAccion.getDescripcion();
                        logger.fine("Asigna descripcipn de la accion a seguir: " + descAccion);
                        rowDecision.setDescAccionASeguir(descAccion);

                        codExterno = rowAccion.getCodExterno();
                        logger.fine("Asigna codigo externo de la accion a seguir: " + codExterno);
                        rowDecision.setCodigoExtAccionASeguir(codExterno);
                    }
                } else {
                    logger.severe("Error no se encontro registro del catalog de Accion a Seguir para el Id: " +
                                  idAccion);
                }
            } else {
                logger.severe("Error no se encontro ningun registro de decision para el id de solicitud: " +
                              idSolicitud);
            }
        } else {
            logger.severe("Solicitud de Aprobacion no encontrada");
        }
        logger.exiting(FenixAMImpl.class.getName(), "iniDarSeguimientoPresidencia");
    }

    public void asignarDesicionCurrent(Long idSolicitud) {
        logger.warning("Inside asignarDesicionCurrent");

        try {
            DecisionReunionAprobacionVORowImpl rowDecisionCurrent =
                (DecisionReunionAprobacionVORowImpl) getDecisionReunionAprobacionVO().getCurrentRow();

            if (rowDecisionCurrent != null) {

                Number idAccion = rowDecisionCurrent.getIdTcaAccionASeguir();

                //Asigna el Nivel de Aprobacion de Presidencia
                rowDecisionCurrent.setIdNivelAprobacion(NIVEL_APROBACION_PRESIDENCIA_NUM);

                logger.warning("Obtiene Id de Accion a Seguir: " + idAccion);

                //Busca la descripcion de la decision
                getTcaAccionASeguirLOV1().buscarPorId(idAccion);
                if (getTcaAccionASeguirLOV1().getEstimatedRowCount() > 0) {

                    String descAccion = null;
                    String codExterno = null;
                    TcaAccionASeguirLOVRowImpl rowAccion =
                        (TcaAccionASeguirLOVRowImpl) getTcaAccionASeguirLOV1().getCurrentRow();
                    if (rowAccion != null) {
                        descAccion = rowAccion.getDescripcion();
                        logger.warning("Asigna descripcipn de la accion a seguir: " + descAccion);
                        rowDecisionCurrent.setDescAccionASeguir(descAccion);

                        codExterno = rowAccion.getCodExterno();
                        logger.warning("Asigna codigo externo de la accion a seguir: " + codExterno);
                        rowDecisionCurrent.setCodigoExtAccionASeguir(codExterno);
                    }
                } else {
                    logger.warning("Error no se encontro registro del catalog de Accion a Seguir para el Id: " +
                                   idAccion);
                }
            } else {
                //Obtener accion a seguir de la solicitud de aprobacion
                getDecisionReunionAprobacionVO().buscarDecisionPorIdSolicitud(new Number(idSolicitud));
                Long countRows = getDecisionReunionAprobacionVO().getEstimatedRowCount();

                if (countRows > 0) {
                    logger.warning("Numero de Registros de Decision Reunion encontrados: " + countRows);

                    DecisionReunionAprobacionVORowImpl rowDecision =
                        (DecisionReunionAprobacionVORowImpl) getDecisionReunionAprobacionVO().getCurrentRow();
                    Number idAccion = rowDecision.getIdTcaAccionASeguir();

                    //Asigna el Nivel de Aprobacion de Presidencia
                    rowDecision.setIdNivelAprobacion(NIVEL_APROBACION_PRESIDENCIA_NUM);

                    logger.warning("Obtiene Id de Accion a Seguir: " + idAccion);

                    //Busca la descripcion de la decision
                    getTcaAccionASeguirLOV1().buscarPorId(idAccion);
                    if (getTcaAccionASeguirLOV1().getEstimatedRowCount() > 0) {

                        String descAccion = null;
                        String codExterno = null;
                        TcaAccionASeguirLOVRowImpl rowAccion =
                            (TcaAccionASeguirLOVRowImpl) getTcaAccionASeguirLOV1().getCurrentRow();
                        if (rowAccion != null) {
                            descAccion = rowAccion.getDescripcion();
                            logger.warning("Asigna descripcipn de la accion a seguir: " + descAccion);
                            rowDecision.setDescAccionASeguir(descAccion);

                            codExterno = rowAccion.getCodExterno();
                            logger.warning("Asigna codigo externo de la accion a seguir: " + codExterno);
                            rowDecision.setCodigoExtAccionASeguir(codExterno);
                        }
                    } else {
                        logger.warning("Error no se encontro registro del catalog de Accion a Seguir para el Id: " +
                                       idAccion);
                    }
                } else {
                    logger.warning("Error no se encontro ningun registro de decision para el id de solicitud: " +
                                   idSolicitud);
                }
            }
        } catch (Exception e) {
            logger.warning("Error al asignar valores de DecisionAprobacion", e);
        }
    }

    /**
     * Inicializa los bussiness components para Revisar la Solicitud de Presidencia
     * @param idSolicitud contiene id de la solicitud de aprobacion
     * @param idOperacion contiene id de la operacion
     * @param tipoSolicitud contiene id del tipo de solicitud
     */
    public void iniRevisarSolicitudPresidente(Long idSolicitud, Long idOperacion, Integer tipoSolicitud) {
        logger.entering(FenixAMImpl.class.getName(), "iniRevisarSolicitudPresidente", new Object[] {
                        idSolicitud, idOperacion, tipoSolicitud
        });

        //Define el nivel de aprobacion de presidencia
        Number idNivelAprob = NIVEL_APROBACION_PRESIDENCIA_NUM;

        //Se ejecuta servicio para configurar los miembros de votacion, para nivel 2 son de presidencia
        configurarSolicitudAprobacion(idOperacion, idNivelAprob.longValue());

        //Inicializa lista de accion a seguir
        try {
            getTcaAccionASeguirLOV1().buscarPorNivelYTipoSolPresidente(idNivelAprob, tipoSolicitud);
        } catch (Exception e) {
            logger.severe("Error al buscar lista de accion a seguir", e);
        }

        //Verifica datos de solicitud previa a Presidencia (No requerido)
        if (idSolicitud != null) {
            try {
                getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorIdVC(new Number(idSolicitud));
            } catch (Exception e) {
                logger.severe("Error al buscar la solicitud de aprobacion por Id: " + idSolicitud);
            }

            if (getSolicitudAprobacionVO1().getEstimatedRowCount() > 0) {
                Row row = getSolicitudAprobacionVO1().getCurrentRow();
                if (row == null) {
                    logger.severe("Error current row no asignado");
                }
            } else {
                logger.severe("Error Solicitud de aprobacion no encontrada. Id: " + idSolicitud);
            }
        }

        logger.entering(FenixAMImpl.class.getName(), "iniRevisarSolicitudPresidente");
    }

    public void consultarComentariosReunion(Long idSolicitud) {
        try {
            UsuarioReunionAprobacionLOVImpl usuarioReunionAprobacionLOV = getUsuarioReunionAprobacionLOV();
            usuarioReunionAprobacionLOV.consultarUsuarioReunionPorIdSolicitud(idSolicitud);
            RowSetIterator rowsUsuarioReunion = usuarioReunionAprobacionLOV.createRowSetIterator(null);
            List<Long> listaIdUsuarioReunion = new ArrayList<>();

            while (rowsUsuarioReunion.hasNext()) {
                UsuarioReunionAprobacionLOVRowImpl rowUsuario =
                    (UsuarioReunionAprobacionLOVRowImpl) rowsUsuarioReunion.next();
                listaIdUsuarioReunion.add(rowUsuario.getId().longValue());
            }

            rowsUsuarioReunion.closeRowSetIterator();

            ComentarioReunionVOImpl comentarioReunionVO = getComentarioReunionVO();

            comentarioReunionVO.consultarComentariosPorIdSolicitud(listaIdUsuarioReunion);
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en consultarComentariosReunion " + e.getClass() + ":" + e.getMessage());
        }

    }

    public void consultarComentariosVoto(Long idUsuario, Long idVoto) {
        try {
            ViewObjectImpl comentarioReunionVO = getComentarioReunionVO();

            ViewCriteria comentariosReunion =
                comentarioReunionVO.getViewCriteriaManager().getViewCriteria("ComentarioVotacionCriteria");
            comentariosReunion.ensureVariableManager().setVariableValue("idUsuario", idUsuario);
            comentariosReunion.ensureVariableManager().setVariableValue("idVoto", idVoto);
            comentarioReunionVO.applyViewCriteria(comentariosReunion);
            comentarioReunionVO.executeQuery();
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en consultarComentariosVoto " + e.getClass() + ":" + e.getMessage());
        }
    }

    /**
     * Agrega un comentario a la reunion de una solicitud de aprobacion
     * @param comentario contiene descripcion del comentario
     * @param nombreUsuario contiene nombre de usuario en session
     * @param idSolicitud contiene id de solicitud de aprobacion
     * @param idUsuarioReunion contiene id de usuario reunion aprobacion
     * @param esComentarioVoto indica si es un comentario de votacion o de reunion
     * @param idVotoAprobacion contiene id de votacion
     * @param idRolBpm contiene id de rol bpm
     * @return devuelve false si el comentario no es guardado, true si el comentario se guarda correctamente y
     *         null si el id de rol bpm no corresponde a la relacion de usuario reunion aprobacion
     */
    public Boolean guardarComentarios(String comentario, String nombreUsuario, String idSolicitud,
                                      String idUsuarioReunion, Boolean esComentarioVoto, Number idVotoAprobacion,
                                      String idRolBpm) {

        Boolean result = null;
        try {
            logger.log(ADFLogger.ERROR, "ENTRO AL METODO GUARDARCOMENTARIOSREUNION");

            Number comentarioReunionId = null;
            Number idSolicitudNumber = new Number(idSolicitud);
            Number usuarioReunionId = null;
            Number idRolBpmNumber = new Number(idRolBpm);

            UsuarioReunionAprobacionLOVImpl usuarioReunionAprobacionLOV = getUsuarioReunionAprobacionLOV();

            //Asigna criterios de busqueda
            usuarioReunionAprobacionLOV.setidSolicitud(idSolicitudNumber);
            usuarioReunionAprobacionLOV.setidRolBpm(idRolBpmNumber);

            //Define view criteria a utilizar
            ViewCriteria vc =
                usuarioReunionAprobacionLOV.getViewCriteriaManager().getViewCriteria("UsuarioReunionAprobacionByIdSolicitudRolBPMCriteria");
            usuarioReunionAprobacionLOV.applyViewCriteria(vc);
            usuarioReunionAprobacionLOV.executeQuery();

            //Asigna current row
            usuarioReunionAprobacionLOV.setCurrentRow(usuarioReunionAprobacionLOV.first());

            //Obtiene current row
            UsuarioReunionAprobacionLOVRowImpl usuarioReunionLOVRow =
                (UsuarioReunionAprobacionLOVRowImpl) usuarioReunionAprobacionLOV.getCurrentRow();

            //Verifica si existe registro de usuario reunion aprobacion correspondiente al id de solicitud y id de rol bpm
            if (null != usuarioReunionLOVRow) {
                result = true;
                usuarioReunionId = usuarioReunionLOVRow.getId();
            } else {
                result = null;
            }

            if (result != null) {

                SequenceImpl sqComentarioReunion = new SequenceImpl("COMENTARIO_REUNION_SEQ", getDBTransaction());
                comentarioReunionId = new Number(sqComentarioReunion.getSequenceNumber());

                ComentarioReunionVOImpl comentarioReunionVO = getComentarioReunionVO();
                ComentarioReunionVORowImpl comentarioRow = (ComentarioReunionVORowImpl) comentarioReunionVO.createRow();

                comentarioRow.setIdVotoAprobacion(idVotoAprobacion);

                comentarioRow.setId(comentarioReunionId);
                comentarioRow.setIdUsuarioReunion(usuarioReunionId);
                comentarioRow.setFechaHora(new Timestamp(System.currentTimeMillis()));
                comentarioRow.setComentario(comentario);
                comentarioRow.setNombreUsuario(nombreUsuario);

                comentarioReunionVO.insertRow(comentarioRow);
            }
        } catch (Exception e) {
            logger.severe("Error en guardarComentariosReunion", e);
            e.printStackTrace();
            result = false;
        }

        if (result != null) {

            if (result.equals(Boolean.TRUE)) {
                try {
                    getDBTransaction().commit();
                } catch (Exception e) {
                    logger.severe("Error al realizar Commit", e);
                    result = false;
                }
            }
            if (result.equals(Boolean.FALSE)) {
                try {
                    getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback", ex);
                }
            }
        }

        return result;
    }

    public void configurarSolicitudAprobacion(Long idOperacion, Long nivelAprobacion) {

        logger.warning("Inicia configurarSolicitudAprobacion");

        try {
            String wsdl = getWsdl(IWsdlLocation.SOLICITUD_APROBACION);

            SolicitudAprobacion12BndQSService solicitudAprobacion12BndQSService =
                IWsdlLocation.Service.getInstance(SolicitudAprobacion12BndQSService.class, wsdl);
            SolicitudAprobacionPT solicitudAprobacionPT =
                solicitudAprobacion12BndQSService.getSolicitudAprobacion12BndQSPort();
            ConfigurarSolicitudAprobacionRequestType request = new ConfigurarSolicitudAprobacionRequestType();

            request.setIdOperacion(idOperacion);
            request.setNivelAprobacion(nivelAprobacion);

            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONFIGURAR_SOLICITUD_OPERACION);
            ConfigurarSolicitudAprobacionResponseType response =
                solicitudAprobacionPT.configurarSolicitudAprobacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CONFIGURAR_SOLICITUD_OPERACION, horaInicio);
        } catch (Exception e) {
            logger.severe("Error al consumir servicio de configurarSolicitudAprobacion", e);
        }
        logger.warning("Finaliza configurarSolicitudAprobacion");
    }

    public void crearSolicitudAprobacion() {

        try {
            String wsdl = getWsdl(IWsdlLocation.SOLICITUD_APROBACION);

            SolicitudAprobacion12BndQSService solicitudAprobacion12BndQSService =
                IWsdlLocation.Service.getInstance(SolicitudAprobacion12BndQSService.class, wsdl);
            SolicitudAprobacionPT solicitudAprobacionPT =
                solicitudAprobacion12BndQSService.getSolicitudAprobacion12BndQSPort();
            CrearSolicitudAprobacionRequestType request = new CrearSolicitudAprobacionRequestType();

            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_SOLICITUD_APROBACION);
            CrearSolicitudAprobacionResponseType response = solicitudAprobacionPT.crearSolicitudAprobacion(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_SOLICITUD_APROBACION, horaInicio);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public void inicializarAgregarVotoFueraSistema(String usuarioLogin, String idSolicitud, String idRolBpm) {

        try {

            logger.warning("Inicializa Agregar Voto fuera de Sistema");
            logger.warning("ID Solicitud: " + idSolicitud);
            logger.warning("ID Rol BPM: " + idRolBpm);
            logger.warning("Usuario: " + usuarioLogin);

            ComentarioReunionVOImpl comentarioReunion = getComentarioReunionVO();
            VotoAprobacionVOImpl votoAprobacion = getVotoAprobacionVO1();

            SequenceImpl sqVotoAprobacion = new SequenceImpl("VOTO_APROBACION_SEQ", getDBTransaction());
            Number votoAprobacionId = sqVotoAprobacion.getSequenceNumber();

            SequenceImpl sqComentarioReunion = new SequenceImpl("COMENTARIO_REUNION_SEQ", getDBTransaction());
            Number comentarioReunionId = sqComentarioReunion.getSequenceNumber();

            Timestamp fechaHora = new Timestamp(System.currentTimeMillis());
            Integer banEstatus = BANESTATUS_TRUE;
            Integer esFueraSistema = ES_FUERA_SISTEMA;
            Number idSolicitudNumber = new Number(idSolicitud);
            Number idRolBpmNumber = new Number(idRolBpm);

            UsuarioReunionAprobacionLOVImpl usuarioReunionAprobacionLOV = getUsuarioReunionAprobacionLOV();
            usuarioReunionAprobacionLOV.setidSolicitud(idSolicitudNumber);
            usuarioReunionAprobacionLOV.setidRolBpm(idRolBpmNumber);
            ViewCriteria vc =
                usuarioReunionAprobacionLOV.getViewCriteriaManager().getViewCriteria("UsuarioReunionAprobacionByIdSolicitudRolBPMCriteria");
            usuarioReunionAprobacionLOV.applyViewCriteria(vc);
            usuarioReunionAprobacionLOV.executeQuery();

            UsuarioReunionAprobacionLOVRowImpl usuarioReunionLOVRow =
                (UsuarioReunionAprobacionLOVRowImpl) usuarioReunionAprobacionLOV.getRowAtRangeIndex(0);
            Number usuarioReunionId = new Number();

            //Valida si el usuario está registrado en la Reunión, en caso contrario setea id de Secretario CC
            if (null != usuarioReunionLOVRow) {
                usuarioReunionId = usuarioReunionLOVRow.getId();
            } else {
                usuarioReunionId = new Number(FenixModelConstants.ID_USUARIO_REUNION_CC);
            }

            //Obtiene el Id Nivel de la solicitud de aprobacion
            Number idNivelAprobacion = null;
            SolicitudAprobacionVORowImpl rowSolAprob =
                (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();
            if (rowSolAprob != null) {
                idNivelAprobacion = rowSolAprob.getIdTcaNivelAprobacion();
                logger.warning("Id de Nivel Aprobacion: " + idNivelAprobacion);
            }

            Row rowComentarioReunion = comentarioReunion.createRow();
            Row rowVotoAprobacion = votoAprobacion.createRow();

            rowVotoAprobacion.setAttribute("Id", votoAprobacionId);
            rowVotoAprobacion.setAttribute("IdUsuarioReunion", FenixModelConstants.ID_USUARIO_REUNION_CC);
            rowVotoAprobacion.setAttribute("FechaHora", fechaHora);
            rowVotoAprobacion.setAttribute("LoginUsuarioEmite", usuarioLogin);
            rowVotoAprobacion.setAttribute("BanEstatus", banEstatus);
            rowVotoAprobacion.setAttribute("EsFueraDeSistema", esFueraSistema);
            rowVotoAprobacion.setAttribute("IdNivelAprobacion", idNivelAprobacion);

            rowComentarioReunion.setAttribute("Id", comentarioReunionId);
            rowComentarioReunion.setAttribute("IdUsuarioReunion", usuarioReunionId);
            rowComentarioReunion.setAttribute("FechaHora", fechaHora);
            rowComentarioReunion.setAttribute("NombreUsuario", usuarioLogin);
            rowComentarioReunion.setAttribute("Comentario", "comentario");

            comentarioReunion.insertRow(rowComentarioReunion);
            logger.warning("Registro de comentario insertado en memoria");
            votoAprobacion.insertRow(rowVotoAprobacion);
            logger.warning("Registro de votacion insertado en memoria");
        } catch (Exception e) {
            logger.severe("Error al inicializar voto fuera de sistema", e);
        }
    }

    public Boolean agregarVotoFueraSistema(String idSolicitud, String idUsuarioReunion) {
        logger.entering(FenixAMImpl.class.getName(), "agregarVotoFueraSistema", new Object[] {
                        idSolicitud, idUsuarioReunion });

        boolean result = false;
        try {

            VotoAprobacionVOImpl votoAprobacionVOImpl = getVotoAprobacionVO1();
            ComentarioReunionVOImpl comentarioVO = getComentarioReunionVO();

            ComentarioReunionVORowImpl comentarioRow = (ComentarioReunionVORowImpl) comentarioVO.getCurrentRow();
            if (comentarioRow == null) {
                logger.severe("Registro de comentario no encontrado");
            }
            VotoAprobacionVORowImpl votoAprobacionRow = (VotoAprobacionVORowImpl) votoAprobacionVOImpl.getCurrentRow();
            if (votoAprobacionRow == null) {
                logger.severe("Registro de voto no encontrado");
            }

            if (comentarioRow != null && votoAprobacionRow != null) {
                String comentarioFueraSistema = comentarioRow.getComentarioFueraSistema();
                //String usuarioLogin = votoAprobacionROw.getLoginUsuarioEmite();

                Number idUsuarioReunionNumber = new Number(idUsuarioReunion);
                Number idVoto = new Number(votoAprobacionRow.getId());

                logger.warning("Asigna Id Usuario Reunion a Voto: " + idUsuarioReunionNumber.toString());
                votoAprobacionRow.setIdUsuarioReunion(idUsuarioReunionNumber);

                votoAprobacionRow.setEsFueraDeSistema(ES_FUERA_SISTEMA);
                votoAprobacionRow.setFechaHora(new Timestamp(System.currentTimeMillis()));
                votoAprobacionRow.setBanEstatus(BANESTATUS_TRUE);

                logger.warning("Asigna Id Usuario Reunion a Comentario: " + idUsuarioReunionNumber.toString());
                comentarioRow.setIdUsuarioReunion(idUsuarioReunionNumber);

                logger.warning("Asigna Id de Votacion a Comentario: " + idVoto);
                comentarioRow.setIdVotoAprobacion(idVoto);


                try {
                    if (null == comentarioFueraSistema || comentarioFueraSistema.equals("")) {
                        logger.warning("Entro a if de comentario vacio");
                        logger.warning("El row es: " + comentarioRow);
                        comentarioVO.removeCurrentRow();
                    } else {
                        logger.warning("Entro a else de comentario vacio");
                        comentarioRow.setComentario(comentarioFueraSistema);
                    }
                    getDBTransaction().commit();
                    logger.warning("La votacion y su comentario fueron guardados correctamente");
                    result = true;
                } catch (Exception e) {
                    logger.severe("Error al realizar Commit", e);
                }
            }
        } catch (Exception e) {
            logger.severe("Error al guardar el voto fuera de sistema", e);
            try {
                getDBTransaction().rollback();
            } catch (Exception ex) {
                logger.severe("Error al realizar Rollback", ex);
            }
        }
        logger.exiting(FenixAMImpl.class.getName(), "agregarVotoFueraSistema", result);
        return result;
    }

    public void cancelarVotoFueraSistema() {
        logger.entering(FenixAMImpl.class.getName(), "cancelarVotoFueraSistema");
        try {
            ComentarioReunionVOImpl comentarioReunionVOImpl = getComentarioReunionVO();
            VotoAprobacionVOImpl votoAprobacionVOImpl = getVotoAprobacionVO1();

            VotoAprobacionVORowImpl votoAprobRow = (VotoAprobacionVORowImpl) votoAprobacionVOImpl.getCurrentRow();
            if (votoAprobRow == null) {
                logger.severe("Error no se encontro registro de votacion");
            }

            ComentarioReunionVORowImpl comentarioRow =
                (ComentarioReunionVORowImpl) comentarioReunionVOImpl.getCurrentRow();
            if (comentarioRow == null) {
                logger.severe("Error no se encontro registro de comentario");
            }
            getDBTransaction().rollback();
            logger.warning("El voto fuera de sistema y su comentario fueron cancelados");
        } catch (Exception e) {
            logger.severe("Error al cancelar voto fuera de sistema", e);
        }
        logger.exiting(FenixAMImpl.class.getName(), "cancelarVotoFueraSistema");
    }

    /**
     * Verifica si el voto mas reciente de Presidencia o Comite de Credito es positivo o negativo
     * @return devuelve valor booleano, true si el voto es positivo o false en caso contrario, si devuelve null
     *         es porque no se pudo determinar el indicador del voto
     */
    public Boolean esPositivoUltimoVotoPresidente() {

        logger.entering(FenixAMImpl.class.getName(), "esPositivoUltimoVotoPresidente");

        Boolean esPositivo = false;
        Integer intPositivo = 0;

        VotoActualAprobLOVRowImpl votoRow = null;
        Timestamp fechaActual = null;
        Number idActual = null;

        //Reinicia la consulta de votos actuales
        SolicitudAprobacionVORowImpl rowSol =
            (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();
        if (rowSol != null && rowSol.getId() != null) {
            try {
                UsuarioReunionAprobacionLOVImpl usuarioReunionVO = getUsuarioReunionAprobacionLOV();
                usuarioReunionVO.consultarUsuarioReunionPorIdSolicitud(rowSol.getId().longValue());

                RowSetIterator rowsUsuarioReunion = usuarioReunionVO.createRowSetIterator(null);
                List<UsuarioReunionAprobacionLOVRowImpl> listaIdUsuarioReunion = new ArrayList<>();

                while (rowsUsuarioReunion.hasNext()) {
                    UsuarioReunionAprobacionLOVRowImpl rowUsuario =
                        (UsuarioReunionAprobacionLOVRowImpl) rowsUsuarioReunion.next();
                    listaIdUsuarioReunion.add(rowUsuario);
                }

                rowsUsuarioReunion.closeRowSetIterator();

                logger.warning("Consulta los registros de votos de la reunion");
                getVotoActualAprobLOV1().obtenerVotosReunion(listaIdUsuarioReunion);
            } catch (Exception e) {
                logger.severe("Error al inicializar los votos de la reunion");
            }
        }

        logger.warning("Cantidad de Registros de Votos Actuales: " + getVotoActualAprobLOV1().getEstimatedRowCount());

        if (getVotoActualAprobLOV1().getEstimatedRowCount() > 0) {

            RowSetIterator iter = getVotoActualAprobLOV1().createRowSetIterator(null);
            while (iter.hasNext()) {
                votoRow = (VotoActualAprobLOVRowImpl) iter.next();
                if (votoRow.getVaFechaHora() != null) {
                    if (fechaActual == null) {
                        fechaActual = votoRow.getVaFechaHora();
                        idActual = votoRow.getVaId();
                        intPositivo = votoRow.getTtdEsDecisionPositiva();
                    } else {
                        if (fechaActual.compareTo(votoRow.getVaFechaHora()) < 0) {
                            if (idActual != null) {
                                if (idActual.compareTo(votoRow.getVaId()) < 0) {
                                    fechaActual = votoRow.getVaFechaHora();
                                    idActual = votoRow.getVaId();
                                    intPositivo = votoRow.getTtdEsDecisionPositiva();
                                }
                            } else {
                                fechaActual = votoRow.getVaFechaHora();
                                idActual = votoRow.getVaId();
                                intPositivo = votoRow.getTtdEsDecisionPositiva();
                            }
                        }
                    }

                    if (intPositivo == null) {
                        logger.severe("Error indicador de voto positivo vacio. Id de Voto: " + idActual);
                    }
                } else {
                    idActual = votoRow.getVaId();
                    logger.severe("Error se encontro una fecha de votacion vacia. Id de Voto: " + idActual);
                }
            }
            iter.closeRowSetIterator();

            if (fechaActual != null && intPositivo != null) {
                if (intPositivo.equals(1)) {
                    logger.warning("El voto es positivo");
                    esPositivo = true;
                } else {
                    if (intPositivo.equals(0)) {
                        logger.warning("El voto es negativo");
                        esPositivo = false;
                    } else {
                        logger.severe("Error no se puede determinar si el voto es positivo o negativo");
                        esPositivo = null;
                    }
                }
            }
        } else {
            //Por defecto si aun no existen votos, la accion sera negativa
            esPositivo = false;
        }

        logger.exiting(FenixAMImpl.class.getName(), "esPositivoUltimoVotoPresidente", esPositivo);
        return esPositivo;
    }

    /**
     * Actualiza el registro actual de Accion a Seguir y asigna Id de Accion Negativa
     * @param idNivelAprobacion contiene el id de nivel de aprobacion
     * @param idTipoSolicitudAprob contiene el id de tipo de solicitud
     * @return devuelve valor booleano, true si la actualizacion se realizo correctamente o false
     *         en caso contrario
     */
    public boolean actualizarDecisionAprobAccionNegativa(Number idNivelAprobacion, Integer idTipoSolicitudAprob) {

        logger.entering(FenixAMImpl.class.getName(), "actualizarDecisionAprobAccionNegativa", new Object[] {
                        idNivelAprobacion, idTipoSolicitudAprob
        });

        boolean exito = false;

        if (idNivelAprobacion == null || idTipoSolicitudAprob == null) {
            logger.severe("Valores requeridos no recibidos");
        } else {

            DecisionReunionAprobacionVORowImpl decisionRow =
                (DecisionReunionAprobacionVORowImpl) getDecisionReunionAprobacionVO().getCurrentRow();

            logger.warning("Verifica Registro actual de Decision: " + decisionRow);
            if (decisionRow != null) {
                logger.warning("Ejecuta busqueda de Registros de catalogo para Accion a Seguir. Id Nivel: " +
                               idNivelAprobacion.toString() + " Id de Tipo Solicitud: " + idTipoSolicitudAprob);

                getTcaAccionASeguirLOV1().buscarPorNivelYTipoSol(idNivelAprobacion, idTipoSolicitudAprob);

                logger.warning("Verifica Cantidad de Registros de Accion encontrados: " +
                               getTcaAccionASeguirLOV1().getEstimatedRowCount());

                if (getTcaAccionASeguirLOV1().getEstimatedRowCount() > 0) {
                    TcaAccionASeguirLOVRowImpl accionRow = null;
                    RowSetIterator iter = getTcaAccionASeguirLOV1().createRowSetIterator(null);
                    while (iter.hasNext()) {
                        accionRow = (TcaAccionASeguirLOVRowImpl) iter.next();
                        if (accionRow.getEsDecisionPositiva() != null) {
                            if (accionRow.getEsDecisionPositiva().equals(0)) {
                                break;
                            }
                        }
                    }
                    iter.closeRowSetIterator();

                    logger.warning("Valida Registro de Accion Negativa: " + accionRow);
                    if (accionRow != null) {

                        logger.warning("Asigna Id de Accion Negativa: " + accionRow.getId());
                        decisionRow.setIdTcaAccionASeguir(accionRow.getId());
                        decisionRow.setCodigoExtAccionASeguir(accionRow.getCodExterno());

                        try {
                            logger.warning("Ejecuta Commit");
                            getDBTransaction().commit();
                            exito = true;
                        } catch (Exception e) {
                            logger.severe("Error al realizar Commit", e);
                            try {
                                logger.warning("Ejecuta Rollback");
                                getDBTransaction().rollback();
                            } catch (Exception ex) {
                                logger.severe("Error al realizar Rollback", ex);
                            }
                        }
                    } else {
                        logger.severe("Registro de accion negativa no encontrado");
                    }
                } else {
                    logger.severe("Registros de catalogo para Accion a Seguir no encontrados");
                }
            } else {
                logger.severe("Registro de Decision no obtenido");
            }
        }

        logger.exiting(FenixAMImpl.class.getName(), "actualizarDecisionAprobAccionNegativa", exito);
        return exito;
    }

    /**
     * Asigna observaciones al registro actual de Decision de Aprobacion
     * @param observacion contiene cadena con descripcion de observaciones
     * @return devuelve valor booleano, true si se guardo con exito o false en caso contrario
     */
    public boolean guardarObservacionPresidente(String observacion) {

        logger.entering(FenixAMImpl.class.getName(), "guardarObservacionPresidente", observacion);

        boolean exito = false;

        if (observacion != null) {

            DecisionReunionAprobacionVORowImpl decisionRow =
                (DecisionReunionAprobacionVORowImpl) getDecisionReunionAprobacionVO().getCurrentRow();
            if (decisionRow != null) {

                logger.warning("Se asigna valor de observaciones a registro decision: Id: " + decisionRow.getId() +
                               ". Observaciones: " + observacion);
                decisionRow.setAcuerdo(observacion);
                try {
                    logger.warning("Ejecuta Commit");
                    getDBTransaction().commit();
                    exito = true;
                } catch (Exception e) {
                    logger.severe("Error al realizar Commit", e);
                    try {
                        logger.warning("Ejecuta Rollback");
                        getDBTransaction().rollback();
                    } catch (Exception ex) {
                        logger.severe("Error al realizar Rollback", ex);
                    }
                }
            } else {
                logger.severe("Error no se obtuvo registro de Decision");
            }
        } else {
            logger.severe("Error no se obtuvo observaciones que guardar");
        }

        logger.exiting(FenixAMImpl.class.getName(), "guardarObservacionPresidente", exito);
        return exito;
    }

    public void inicializarDatosReunionCliente(Long idSolicitud, Long idCliente) {
        logger.warning("idSolicitud " + idSolicitud);
        logger.warning("idCliente " + idCliente);
        try {
            SolicitudAprobacionVOImpl solicitudAprobacionVO = getSolicitudAprobacionVO1();

            Number idSolicitudNumber = new Number(idSolicitud);
            // Number idOperacionNumber = new Number(idCliente);

            ViewCriteria viewCriteria =
                solicitudAprobacionVO.getViewCriteria("SolicitudAprobacionByIdAndIdClienteVOCriteria");
            if (viewCriteria == null) {
                logger.severe("View criteria no encontrado");
            }

            solicitudAprobacionVO.setpId(idSolicitudNumber);
            solicitudAprobacionVO.setpIdCliente(idCliente);
            solicitudAprobacionVO.applyViewCriteria(viewCriteria);
            solicitudAprobacionVO.executeQuery();

            if (solicitudAprobacionVO.getEstimatedRowCount() > 0) {
                solicitudAprobacionVO.setCurrentRow(solicitudAprobacionVO.first());
            } else {
                logger.severe("Error Registro de Solicitud de Aprobacion no encontrado. Id: " + idSolicitud);
            }
        } catch (Exception e) {
            e.printStackTrace();
            logger.severe("Error al inicializar datos reunion y busqueda de la solicitud", e);
        }
    }

    public void inicializarDatosReunion(Long idSolicitud, Long idOperacion) {
        try {
            SolicitudAprobacionVOImpl solicitudAprobacionVO = getSolicitudAprobacionVO1();

            Number idSolicitudNumber = new Number(idSolicitud);
            Number idOperacionNumber = new Number(idOperacion);

            ViewCriteria viewCriteria = solicitudAprobacionVO.getViewCriteria("SolicitudAprobacionPorIdVOCriteria");
            if (viewCriteria == null) {
                logger.severe("View criteria no encontrado");
            }

            solicitudAprobacionVO.setpId(idSolicitudNumber);
            solicitudAprobacionVO.setpIdOperacion(idOperacionNumber);
            solicitudAprobacionVO.applyViewCriteria(viewCriteria);
            solicitudAprobacionVO.executeQuery();

            if (solicitudAprobacionVO.getEstimatedRowCount() > 0) {
                solicitudAprobacionVO.setCurrentRow(solicitudAprobacionVO.first());
            } else {
                logger.severe("Error Registro de Solicitud de Aprobacion no encontrado. Id: " + idSolicitud);
            }
        } catch (Exception e) {
            e.printStackTrace();
            logger.severe("Error al inicializar datos reunion y busqueda de la solicitud", e);
        }
    }

    public Boolean guardarNuevaFechaTerminoReunion(Long idSolicitud, Long idOperacion, String fechaTermino,
                                                   String loginUsuario) {

        SolicitudAprobacionVOImpl solicitudAprobacionVO = null;
        boolean exito = false;
        try {
            solicitudAprobacionVO = getSolicitudAprobacionVO1();
            SolicitudAprobacionVORowImpl solicitudAprobacionRow =
                (SolicitudAprobacionVORowImpl) solicitudAprobacionVO.getCurrentRow();

            Timestamp fechaTerminoNueva = Timestamp.valueOf(fechaTermino);

            solicitudAprobacionRow.setFechaTermino(fechaTerminoNueva);
            solicitudAprobacionRow.setLoginUsuarioCierre(loginUsuario);
            exito = true;
        } catch (Exception e) {
            logger.severe("Error al guardar fecha cierre", e);
            exito = false;
        }

        if (exito) {
            try {
                solicitudAprobacionVO.getDBTransaction().commit();
            } catch (Exception e) {
                logger.severe("Error al realizar Commmit", e);
                try {
                    solicitudAprobacionVO.getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback", ex);
                }
                exito = false;
            }
        }

        return exito;
    }

    public Boolean guardarNuevaFechaTerminoReunionCliente(Long idSolicitud, Long idCliente, String fechaTermino,
                                                          String loginUsuario) {

        SolicitudAprobacionVOImpl solicitudAprobacionVO = null;
        boolean exito = false;
        try {
            solicitudAprobacionVO = getSolicitudAprobacionVO1();
            SolicitudAprobacionVORowImpl solicitudAprobacionRow =
                (SolicitudAprobacionVORowImpl) solicitudAprobacionVO.getCurrentRow();

            Timestamp fechaTerminoNueva = Timestamp.valueOf(fechaTermino);

            solicitudAprobacionRow.setFechaTermino(fechaTerminoNueva);
            solicitudAprobacionRow.setLoginUsuarioCierre(loginUsuario);
            exito = true;
        } catch (Exception e) {
            logger.severe("Error al guardar fecha cierre", e);
            exito = false;
        }

        if (exito) {
            try {
                solicitudAprobacionVO.getDBTransaction().commit();
            } catch (Exception e) {
                logger.severe("Error al realizar Commmit", e);
                try {
                    solicitudAprobacionVO.getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback", ex);
                }
                exito = false;
            }
        }

        return exito;
    }

    /**
     * Realizar el guardado de los cambios del registro actual de solicitud de aprobacion
     */
    public void actualizarDatosReunionPresencial() {
        SolicitudAprobacionVOImpl solicitudAprobacionVO = getSolicitudAprobacionVO1();
        SolicitudAprobacionVORowImpl solicitudAprobacionRow =
            (SolicitudAprobacionVORowImpl) solicitudAprobacionVO.getCurrentRow();

        if (solicitudAprobacionRow != null) {
            try {
                solicitudAprobacionVO.getDBTransaction().commit();
            } catch (Exception e) {
                logger.severe("Error al realizar Commit", e);
                try {

                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback", e);
                }
                //Propaga la Exception al guardar datos
                throw new JboException(e);
            }
        }
    }


    /**
     * Container's getter for ValidarOperacionTipoDocumentoVO.
     * @return ValidarOperacionTipoDocumentoVO
     */
    public ViewObjectImpl getValidarOperacionTipoDocumentoVO() {
        return (ViewObjectImpl) findViewObject("ValidarOperacionTipoDocumentoVO");
    }


    /**
     * Container's getter for DetalleOperacionVO1.
     * @return DetalleOperacionVO1
     */
    public DetalleOperacionVOImpl getDetalleOperacionVO() {
        return (DetalleOperacionVOImpl) findViewObject("DetalleOperacionVO");
    }

    /**
     * Container's getter for DocumentoVO1.
     * @return DocumentoVO1
     */
    public DocumentoVOImpl getDocumentoVO() {
        return (DocumentoVOImpl) findViewObject("DocumentoVO");
    }

    /**
     * Container's getter for AdjuntoVO1.
     * @return AdjuntoVO1
     */
    public AdjuntoVOImpl getAdjuntoVO() {
        return (AdjuntoVOImpl) findViewObject("AdjuntoVO");
    }

    /**
     * Container's getter for DocumentoAndAdjuntoVL1.
     * @return DocumentoAndAdjuntoVL1
     */
    public ViewLinkImpl getDocumentoAndAdjuntoVL() {
        return (ViewLinkImpl) findViewLink("DocumentoAndAdjuntoVL");
    }

    /**
     * Container's getter for DocumentosVO1.
     * @return DocumentosVO1
     */
    public ViewObjectImpl getDocumentosVO() {
        return (ViewObjectImpl) findViewObject("DocumentosVO");
    }

    /**
     * Container's getter for DocumentoAndDocumentosVL1.
     * @return DocumentoAndDocumentosVL1
     */
    public ViewLinkImpl getDocumentoAndDocumentosVL() {
        return (ViewLinkImpl) findViewLink("DocumentoAndDocumentosVL");
    }

    /**
     * Container's getter for DocumentosAdjuntadosVO1.
     * @return DocumentosAdjuntadosVO1
     */
    public DocumentosAdjuntadosVOImpl getDocumentosAdjuntadosVO() {
        return (DocumentosAdjuntadosVOImpl) findViewObject("DocumentosAdjuntadosVO");
    }

    /**
     * Container's getter for TiposDocumentoLOV1.
     * @return TiposDocumentoLOV1
     */
    public TiposDocumentoLOVImpl getTiposDocumentoLOV() {
        return (TiposDocumentoLOVImpl) findViewObject("TiposDocumentoLOV");
    }


    /**
     * Container's getter for CargoVO1.
     * @return CargoVO1
     */
    public CargoVOImpl getCargoVO() {
        return (CargoVOImpl) findViewObject("CargoVO");
    }

    /**
     * Container's getter for TareaProcesoBpmVO1.
     * @return TareaProcesoBpmVO1
     */
    public TareaProcesoBpmVOImpl getTareaProcesoBpmVO() {
        return (TareaProcesoBpmVOImpl) findViewObject("TareaProcesoBpmVO");
    }

    /**
     * Container's getter for SuspenderCancelarOperacionVO1.
     * @return SuspenderCancelarOperacionVO1
     */
    public SuspenderCancelarOperacionVOImpl getSuspenderCancelarOperacionVO() {
        return (SuspenderCancelarOperacionVOImpl) findViewObject("SuspenderCancelarOperacionVO");
    }


    /**
     * Container's getter for ConfigVisibilidadVO.
     * @return ConfigVisibilidadVO
     */
    public ConfigVisibilidadVOImpl getConfigVisibilidadVO() {
        return (ConfigVisibilidadVOImpl) findViewObject("ConfigVisibilidadVO");
    }

    /**
     * Container's getter for EvaluacionVO1.
     * @return EvaluacionVO1
     */
    public EvaluacionVOImpl getEvaluacionVO() {
        return (EvaluacionVOImpl) findViewObject("EvaluacionVO");
    }

    /**
     * Container's getter for CuestionarioVO1.
     * @return CuestionarioVO1
     */
    public CuestionarioVOImpl getCuestionarioVO() {
        return (CuestionarioVOImpl) findViewObject("CuestionarioVO");
    }

    /**
     * Container's getter for CrearClienteVO1.
     * @return CrearClienteVO
     */
    public CrearClienteVOImpl getCrearClienteVO() {
        return (CrearClienteVOImpl) findViewObject("CrearClienteVO");
    }

    /**
     * Container's getter for BuscarClienteVO1.
     * @return BuscarClienteVO
     */
    public BuscarClienteVOImpl getBuscarClienteVO() {
        return (BuscarClienteVOImpl) findViewObject("BuscarClienteVO");
    }

    /**
     * Container's getter for OperacionesAsociadasVO1.
     * @return OperacionesAsociadasVO1
     */
    public OperacionesAsociadasVOImpl getOperacionesAsociadasVO() {
        return (OperacionesAsociadasVOImpl) findViewObject("OperacionesAsociadasVO");
    }

    /**
     * Container's getter for TiposActividadEconomicaPadreLOV.
     * @return TiposActividadEconomicaPadreLOV
     */
    public TiposActividadEconomicaPadreLOVImpl getTiposActividadEconomicaPadreLOV() {
        return (TiposActividadEconomicaPadreLOVImpl) findViewObject("TiposActividadEconomicaPadreLOV");
    }

    /**
     * Container's getter for TiposIniciativaEstrategicaLOV.
     * @return TiposIniciativaEstrategicaLOV
     */
    public TiposIniciativaEstrategicaLOVImpl getTiposIniciativaEstrategicaLOV() {
        return (TiposIniciativaEstrategicaLOVImpl) findViewObject("TiposIniciativaEstrategicaLOV");
    }

    /**
     * Container's getter for TiposCantidadPaisesBeneficiadosLOV.
     * @return TiposCantidadPaisesBeneficiadosLOV
     */
    public TiposCantidadPaisesBeneficiadosLOVImpl getTiposCantidadPaisesBeneficiadosLOV() {
        return (TiposCantidadPaisesBeneficiadosLOVImpl) findViewObject("TiposCantidadPaisesBeneficiadosLOV");
    }

    /**
     * Container's getter for TiposAreaFocalizacionLOV.
     * @return TiposAreaFocalizacionLOV
     */
    public TiposAreaFocalizacionLOVImpl getTiposAreaFocalizacionLOV() {
        return (TiposAreaFocalizacionLOVImpl) findViewObject("TiposAreaFocalizacionLOV");
    }

    /**
     * Container's getter for TiposEjeEstrategicoLOV.
     * @return TiposEjeEstrategicoLOV
     */
    public TiposEjeEstrategicoLOVImpl getTiposEjeEstrategicoLOV() {
        return (TiposEjeEstrategicoLOVImpl) findViewObject("TiposEjeEstrategicoLOV");
    }

    /**
     * Container's getter for ConformarEquiposVO1.
     * @return ConformarEquiposVO1
     */
    public ViewObjectImpl getConformarEquiposVO() {
        return (ViewObjectImpl) findViewObject("ConformarEquiposVO");
    }

    /**
     * Container's getter for CatSectorEvaluacionVO1.
     * @return CatSectorEvaluacionVO1
     */
    public ViewObjectImpl getCatSectorEvaluacionVO() {
        return (ViewObjectImpl) findViewObject("CatSectorEvaluacionVO");
    }

    /**
     * Container's getter for CatSubSectorEvaluacionVO1.
     * @return CatSubSectorEvaluacionVO1
     */
    public ViewObjectImpl getCatSubSectorEvaluacionVO() {
        return (ViewObjectImpl) findViewObject("CatSubSectorEvaluacionVO");
    }

    /**
     * Container's getter for CatEstadoBusquedaLaftVO1.
     * @return CatEstadoBusquedaLaftVO1
     */
    public ViewObjectImpl getCatEstadoBusquedaLaftVO() {
        return (ViewObjectImpl) findViewObject("CatEstadoBusquedaLaftVO");
    }

    /**
     * Container's getter for CatEstadoDeclaracionLaftVO1.
     * @return CatEstadoDeclaracionLaftVO1
     */
    public ViewObjectImpl getCatEstadoDeclaracionLaftVO() {
        return (ViewObjectImpl) findViewObject("CatEstadoDeclaracionLaftVO");
    }

    /**
     * Container's getter for CatRiesgoLaftVO1.
     * @return CatRiesgoLaftVO1
     */
    public ViewObjectImpl getCatRiesgoLaftVO() {
        return (ViewObjectImpl) findViewObject("CatRiesgoLaftVO");
    }

    /**
     * Container's getter for DeclaracionJuradaLaftVO1.
     * @return DeclaracionJuradaLaftVO1
     */
    public DeclaracionJuradaLaftVOImpl getDeclaracionJuradaLaftVO() {
        return (DeclaracionJuradaLaftVOImpl) findViewObject("DeclaracionJuradaLaftVO");
    }

    /**
     * Container's getter for TiposActividadEconomicaLOV1.
     * @return TiposActividadEconomicaLOV1
     */
    public TiposActividadEconomicaLOVImpl getTiposActividadEconomicaLOV() {
        return (TiposActividadEconomicaLOVImpl) findViewObject("TiposActividadEconomicaLOV");
    }

    /**
     * Container's getter for CatGrupoEconomicoVO1.
     * @return CatGrupoEconomicoVO1
     */
    public CatGrupoEconomicoVOImpl getCatGrupoEconomicoVO() {
        return (CatGrupoEconomicoVOImpl) findViewObject("CatGrupoEconomicoVO");
    }

    /**
     * Container's getter for ClienteLVO1.
     * @return ClienteLVO1
     */
    public ClienteLVOImpl getClienteLVO() {
        return (ClienteLVOImpl) findViewObject("ClienteLVO");
    }

    /**
     * Container's getter for CatOficinaVO1.
     * @return CatOficinaVO1
     */
    public CatOficinaVOImpl getCatOficinaVO() {
        return (CatOficinaVOImpl) findViewObject("CatOficinaVO");
    }

    /**
     * Container's getter for AnalisisVO1.
     * @return AnalisisVO1
     */
    public AnalisisVOImpl getAnalisisVO() {
        return (AnalisisVOImpl) findViewObject("AnalisisVO");
    }

    /**
     * Container's getter for MotivosAnalisisVO1.
     * @return MotivosAnalisisVO1
     */
    public MotivosAnalisisVOImpl getMotivosAnalisisVO() {
        return (MotivosAnalisisVOImpl) findViewObject("MotivosAnalisisVO");
    }


    /**
     * Container's getter for TcaMotivo.
     * @return TcaMotivo
     */
    public ViewObjectImpl getTcaMotivo() {
        return (ViewObjectImpl) findViewObject("TcaMotivo");
    }


    /**
     * Container's getter for CalificacionInicialRiesgoVO1.
     * @return CalificacionInicialRiesgoVO1
     */
    public ViewObjectImpl getCalificacionInicialRiesgoVO() {
        return (ViewObjectImpl) findViewObject("CalificacionInicialRiesgoVO");
    }

    /**
     * Container's getter for FechaCalendarioVO1.
     * @return FechaCalendarioVO1
     */
    public FechaCalendarioVOImpl getFechaCalendarioVO() {
        return (FechaCalendarioVOImpl) findViewObject("FechaCalendarioVO");
    }


    /**
     * Container's getter for DetalleOperacionEditableVO1.
     * @return DetalleOperacionEditableVO1
     */
    // public DetalleOperacionEditableVOImpl getDetalleOperacionEditableVO() {
    //     return (DetalleOperacionEditableVOImpl) findViewObject("DetalleOperacionEditableVO");
    // }


    /**
     * Container's getter for TreTareaProcesoBpmVO1.
     * @return TreTareaProcesoBpmVO1
     */
    public TreTareaProcesoBpmVOImpl getTreTareaProcesoBpmVO() {
        return (TreTareaProcesoBpmVOImpl) findViewObject("TreTareaProcesoBpmVO");
    }

    /**
     * Container's getter for TrazabilidadOperacionVO1.
     * @return TrazabilidadOperacionVO1
     */
    public ViewObjectImpl getTrazabilidadOperacionVO() {
        return (ViewObjectImpl) findViewObject("TrazabilidadOperacionVO");
    }


    /**
     * Container's getter for OperacionesAsociadasLOV1.
     * @return OperacionesAsociadasLOV1
     */
    public OperacionesAsociadasLOVImpl getOperacionesAsociadasLOV() {
        return (OperacionesAsociadasLOVImpl) findViewObject("OperacionesAsociadasLOV");
    }


    /**
     * Container's getter for ClasificacionEstrategicaLOV1.
     * @return ClasificacionEstrategicaLOV1
     */
    public ClasificacionEstrategicaLOVImpl getClasificacionEstrategicaLOV() {
        return (ClasificacionEstrategicaLOVImpl) findViewObject("ClasificacionEstrategicaLOV");
    }

    /**
     * Container's getter for ElegibilidadVO1.
     * @return ElegibilidadVO1
     */
    public ElegibilidadVOImpl getElegibilidadVO() {
        return (ElegibilidadVOImpl) findViewObject("ElegibilidadVO");
    }

    /**
     *
     * Container's getter for TreVisibilidadVO1.
     * @return TreVisibilidadVO1
     */
    public TreVisibilidadVOImpl getTreVisibilidadVO() {
        return (TreVisibilidadVOImpl) findViewObject("TreVisibilidadVO");
    }


    /**
     * Delete document associate at the operation
     * @param idOperacion
     * @param idTipoDocumento
     * @return Boolean - true if delete documents
     */
    public Boolean eliminarDocumento(Long idOperacion, Integer idTipoDocumento) {
        Long idDocumento;
        idDocumento = 0L;
        ViewObjectImpl validarOperacionTipoDocumentoVO;
        validarOperacionTipoDocumentoVO = getValidarOperacionTipoDocumentoVO();
        Boolean eliminado = false;
        try {
            ViewCriteria criteriaByCommType;
            criteriaByCommType =
                validarOperacionTipoDocumentoVO.getViewCriteriaManager().getViewCriteria("validarOperacionTipoDocumentoVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdTipoDocumento", idTipoDocumento);
            validarOperacionTipoDocumentoVO.applyViewCriteria(criteriaByCommType);
            validarOperacionTipoDocumentoVO.executeQuery();
            if (validarOperacionTipoDocumentoVO.getEstimatedRowCount() > 0) {
                Row[] documentosEnOperacion;
                documentosEnOperacion = validarOperacionTipoDocumentoVO.getAllRowsInRange();
                for (Row row : documentosEnOperacion) {
                    idDocumento = (Long) row.getAttribute("IdDocumento");
                    ViewObjectImpl documentoVO;
                    documentoVO = getDocumentoVO();
                    ViewCriteria criteriaByIdDocumento;
                    criteriaByIdDocumento =
                        documentoVO.getViewCriteriaManager().getViewCriteria("DocumentoVOCriteriaByIdDocumento");
                    criteriaByIdDocumento.ensureVariableManager().setVariableValue("varIdDocumento", idDocumento);
                    documentoVO.applyViewCriteria(criteriaByIdDocumento);
                    documentoVO.executeQuery();
                    if (documentoVO.getEstimatedRowCount() > 0) {
                        DocumentoVORowImpl documentoRow;
                        documentoRow = (DocumentoVORowImpl) documentoVO.getRowAtRangeIndex(0);
                        documentoRow.remove();
                        eliminado = true;
                    }
                }
            }
            if (eliminado) {
                this.getDBTransaction().commit();
                DocumentosAdjuntadosVOImpl documentosAdjuntosVO;
                documentosAdjuntosVO = getDocumentosAdjuntadosVO();
                documentosAdjuntosVO.executeQuery();
                logger.log(ADFLogger.WARNING,
                           "Se elimina documento: " + idDocumento + " asociado a la operacion: " + idOperacion);
            } else {
                logger.log(ADFLogger.ERROR,
                           "No hay documentos a eliminar del tipo:" + idTipoDocumento + ", para la operación:" +
                           idOperacion);
            }
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en eliminarDocumento " + ex.getClass() + ":" + ex.getMessage());
        } finally {
            //This takes care of removing the applied VC.
            validarOperacionTipoDocumentoVO.getViewCriteriaManager().removeApplyViewCriteriaName("validarOperacionTipoDocumentoVOCriteria");
        }
        return eliminado;
    }

    /**
     * Container's getter for CatProductoVO.
     * @return CatProductoVO
     */
    public CatProductoVOImpl getCatProductoVO() {
        return (CatProductoVOImpl) findViewObject("CatProductoVO");
    }

    /**
     * Container's getter for TareasActivasOperacionVO1.
     * @return TareasActivasOperacionVO1
     */
    public TareasActivasOperacionVOImpl getTareasActivasOperacionVO() {
        return (TareasActivasOperacionVOImpl) findViewObject("TareasActivasOperacionVO");
    }


    /**
     * Container's getter for UsuarioReunionAprobacionVO1.
     * @return UsuarioReunionAprobacionVO1
     */
    public UsuarioReunionAprobacionVOImpl getUsuarioReunionAprobacionVO() {
        return (UsuarioReunionAprobacionVOImpl) findViewObject("UsuarioReunionAprobacionVO");
    }

    /**
     * Container's getter for UsuarioReunionAprobacionLOV2.
     * @return UsuarioReunionAprobacionLOV2
     */
    public UsuarioReunionAprobacionLOVImpl getUsuarioReunionAprobacionLOV() {
        return (UsuarioReunionAprobacionLOVImpl) findViewObject("UsuarioReunionAprobacionLOV");
    }

    /**
     * Container's getter for ComentarioReunionVO2.
     * @return ComentarioReunionVO2
     */
    public ComentarioReunionVOImpl getComentarioReunionVO() {
        return (ComentarioReunionVOImpl) findViewObject("ComentarioReunionVO");
    }

    /**
     * Container's getter for TipoReunionLOV1.
     * @return TipoReunionLOV1
     */
    public ViewObjectImpl getTipoReunionLOV1() {
        return (ViewObjectImpl) findViewObject("TipoReunionLOV1");
    }

    /**
     * Configura las instancias de VO para la Revision de Solicitud de Comite de Credito
     * @param idOperacion contiene id de operacion
     */
    public void asignaMiembrosComiteAprobacion(Long idOperacion, oracle.jbo.domain.Number idSolicitud) {
        logger.warning("Dentro de asignaMiembrosComiteAprobacion");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("idSolicitud :" + idSolicitud);

        logger.entering(FenixAMImpl.class.getName(), "asignaMiembrosComiteAprobacion", new Object[] { idOperacion });
        Long pIdSolicitud = null;
        if (null != idSolicitud) {
            pIdSolicitud = idSolicitud.longValue();
        }
        if (idOperacion == null) {
            return;
        }

        Integer idNivelAprobacion = NIVEL_APROBACION_COMITE_CREDITO_INT;
        asignaMiembrosAprobacion(idOperacion, pIdSolicitud, idNivelAprobacion);

        logger.exiting(FenixAMImpl.class.getName(), "asignaMiembrosComiteAprobacion");

        logger.warning("Fuera de asignaMiembrosComiteAprobacion");
    }

    /**
     * Configura las instancias de VO para la Revision de Solicitud de Presidencia
     * @param idOperacion contiene id de operacion
     */
    public void asignaMiembrosPresidenciaAprobacion(Long idOperacion, oracle.jbo.domain.Number idSolicitud) {

        logger.entering(FenixAMImpl.class.getName(), "asignaMiembrosPresidenciaAprobacion", new Object[] {
                        idOperacion });

        Long pIdSolicitud = null;
        if (null != idSolicitud) {
            pIdSolicitud = idSolicitud.longValue();
        }

        if (idOperacion == null) {
            return;
        }

        Integer idNivelAprobacion = NIVEL_APROBACION_PRESIDENCIA_INT;
        asignaMiembrosAprobacion(idOperacion, pIdSolicitud, idNivelAprobacion);

        logger.exiting(FenixAMImpl.class.getName(), "asignaMiembrosPresidenciaAprobacion");
    }

    /**
     * Asigna miembros de Aprobacion via WS
     * @param idOperacion contiene id de Operacion
     * @param idNivelAprobacion define el nivel de aprobacion
     */
    public void asignaMiembrosAprobacion(Long idOperacion, Long idSolicitud, Integer idNivelAprobacion) {

        logger.warning("Entrando en asignaMiembrosAprobacion.");
        logger.warning("idOperacion : " + idOperacion);
        logger.warning("IdSolicitud : " + idSolicitud);
        logger.warning("idNivelAprobacion : " + idNivelAprobacion);
        Number idSolicitudAprob = null;
        Number numIdOperacion = null;
        String descNivelAprobacion = null;
        //Long idSolicitud = null;
        List<GrupoRolAprobacionVORowImpl> rowsGrupoComite = null;
        List<MiembrosAprobacionVORowImpl> rowsComiteCredito = null;
        List<MiembrosAprobacionVORowImpl> rowsNotificacion = null;
        List<MiembrosAprobacionVORowImpl> rowsEquipoTrabajo = null;

        //Instancia del Cliente WS
        ConfigurarSolicitudAprobacionResponseType response = null;
        if (null == idSolicitud) {
            logger.warning("IDSOLICITUD ES NULL");
            response = getConfiguracionSolAprobWS(idOperacion, idNivelAprobacion);
        } else {
            logger.warning("IDSOLICITUD NO ES NULL");
            response = consultarComiteCredito(idSolicitud, idOperacion, idNivelAprobacion);
        }
        try {
            ModelUtils.logEndWS(logger, response, "Response consultar comite de credito", new Date());
        } catch (Exception e) {
            logger.warning("Error al imprimir el response.");
        }

        //Valida objetos para obtener informacion de la Solicitud de Aprobacion
        if (response != null && response.getSolicitudAprobacion() != null) {
            List<SolicitudAprobacion> solAprobList = response.getSolicitudAprobacion();

            if (solAprobList != null && solAprobList.size() > 0) {

                logger.warning("Cantidad de Solicitudes de Aprobacion Recibidas: " + solAprobList.size());

                SolicitudAprobacion solAprob = solAprobList.get(0);

                //Obtiene id de Solicitud de Aprobacion
                if (solAprob.getIdSolicitudAprobacion() != null) {
                    idSolicitudAprob = new Number(solAprob.getIdSolicitudAprobacion());

                    logger.warning("Id de Solicitud de Aprobacion: " + idSolicitudAprob);
                }

                //Obtiene id de Operacion
                if (solAprob.getIdOperacion() != null) {
                    numIdOperacion = new Number(solAprob.getIdOperacion());
                }

                //Obtiene Descripcion del Nivel de Aprobacion
                Catalogo catalogo = solAprob.getNivelAprobacion();
                if (catalogo != null) {
                    descNivelAprobacion = catalogo.getDescripcion();
                }
            }
        }

        //Obtiene Grupo de Roles
        try {
            rowsGrupoComite = obtenerGruposComiteCreditoWS(response, new Number(idNivelAprobacion));
        } catch (Exception e) {
            logger.severe("Error al obtener los grupos de comite de credito", e);
        }

        //Obtiene lista de miembros comite de credito
        try {
            rowsComiteCredito = obtenerMiembrosComiteCreditoWS(response);
        } catch (Exception e) {
            logger.severe("Error al obtener los miembros de comite de credito", e);
        }

        //Obtiene lista de miembros notificacion
        try {
            rowsNotificacion = obtenerMiembrosNotificacionWS(response);
        } catch (Exception e) {
            logger.severe("Error al obtener los miembros de notificacion", e);
        }

        //Obtiene lista de miembros de Equipo de Trabajo
        try {
            if (null == idSolicitud) {
                rowsEquipoTrabajo = obtienerMiembrosEquipoTrabajoWS(response);
            }
        } catch (Exception e) {
            logger.severe("Error al obtener los miembros del equipo de trabajo", e);
        }

        //Inicializa las VO de Miembros Comite de Aprobacion

        //Asigna descripcion del Nivel de Aprobacion recibido por WS
        if (idSolicitudAprob != null && numIdOperacion != null) {
            getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorId(idSolicitudAprob, numIdOperacion);
            getSolicitudAprobacionVO1().setDescNivelAprobacion(descNivelAprobacion);
        }

        if (rowsComiteCredito != null) {
            logger.warning("CANTIDAD COMITE CREDITO: " + rowsComiteCredito.size());
            //Asigna Miembros de comite de credito
            getMiembrosAprobacionComiteCreditoVO1().setMiembrosComite(rowsComiteCredito);
        }

        if (rowsGrupoComite != null) {
            logger.warning("CANTIDAD GRUPO: " + rowsGrupoComite.size());
            //Asigna Grupo de roles de comite de credito
            try {
                getGrupoRolAprobacionVO1().setRows(rowsGrupoComite, new Number(idNivelAprobacion));
                getGrupoRolAprobacionVO1().setMiembroGrupoPorDefecto(rowsComiteCredito);
            } catch (SQLException e) {
                logger.severe("Error al asignar grupos con Id Nivel de Aprobacion", e);
            }
        }

        if (rowsNotificacion != null) {
            logger.warning("CANTIDAD NOTIFICACION: " + rowsNotificacion.size());
            //Asigna Miembro Con Notificacion
            getMiembrosAprobacionNotificacionVO1().setMiembrosConNotificacion(rowsNotificacion);

            if (null != idSolicitud) {
                ConsultarUsuarioReunionAprobacionVOImpl usuarioAprobacion;
                usuarioAprobacion = getConsultarUsuarioReunionAprobacionVO();

                // carga de columna es con consulta de base de datos
                RowSetIterator miembrosAprobacionIterator =
                    getMiembrosAprobacionNotificacionVO1().createRowSetIterator(null);
                miembrosAprobacionIterator.reset();

                RowSetIterator usuarioReunionIterator =
                    getConsultarUsuarioReunionAprobacionVO().createRowSetIterator(null);

                while (miembrosAprobacionIterator.hasNext()) {
                    MiembrosAprobacionVORowImpl rowMiembroAprobacion =
                        (MiembrosAprobacionVORowImpl) miembrosAprobacionIterator.next();

                    usuarioReunionIterator.reset();
                    while (usuarioReunionIterator.hasNext()) {
                        ConsultarUsuarioReunionAprobacionVORowImpl rowUsuarioReunion =
                            (ConsultarUsuarioReunionAprobacionVORowImpl) usuarioReunionIterator.next();

                        if (null != rowUsuarioReunion &&
                            rowUsuarioReunion.getIdTcaTipoUsuario().compareTo(FenixModelConstants.TIPO_MIEMBRO_NOTIFICACION) ==
                            0) {
                            if (null != rowMiembroAprobacion && null != rowUsuarioReunion &&
                                rowMiembroAprobacion.getUsuario().equals(rowUsuarioReunion.getLoginUsuario())) {

                                if (null != rowUsuarioReunion.getConNotificacion()) {

                                    logger.warning(rowMiembroAprobacion.getUsuario() + " - setEsConConsulta: " +
                                                   rowUsuarioReunion.getConNotificacion());
                                    rowMiembroAprobacion.setEsConConsulta(rowUsuarioReunion.getConNotificacion().toString());
                                    rowMiembroAprobacion.setConNotificacion((rowUsuarioReunion.getConNotificacion().compareTo(1) ==
                                                                             0 ? true : false));
                                }

                            }
                        }
                    }
                }

                usuarioReunionIterator.closeRowSetIterator();

                miembrosAprobacionIterator.closeRowSetIterator();
            }
        }

        if (rowsEquipoTrabajo != null) {
            logger.warning("CANTIDAD EQUIPO TRABAJO: " + rowsEquipoTrabajo.size());
            //Asigna Miembros de Equipo de Trabajo
            getMiembrosAprobacionEquipoTrabajoVO1().setMiembrosEquipoTrabajo(rowsEquipoTrabajo);
        }

        logger.exiting(FenixAMImpl.class.getName(), "asignaMiembrosAprobacion");
    }

    /**
     * Obtiene los grupos de roles BPM de los miembros de aprobacion
     * @param response contiene respuesta de WS
     * @return devuelve lista de Miembros
     */
    private List<GrupoRolAprobacionVORowImpl> obtenerGruposComiteCreditoWS(ConfigurarSolicitudAprobacionResponseType response,
                                                                           Number idNivelAprob) {

        logger.entering(FenixAMImpl.class.getName(), "obtenerGruposComiteCreditoWS", new Object[] {
                        response, idNivelAprob });
        logger.warning("Entra en obtenerGruposComiteCreditoWS.");
        logger.warning("dNivelAprob : " + idNivelAprob);
        List<GrupoRolAprobacionVORowImpl> grupos = null;

        GrupoRolAprobacionVORowImpl grupoComite = null;
        Number idGrupo = null; //Valor unico de grupo, puede ser un indice o contador de elementos
        Number orden = null; //Valor que puede ser el orden en que los datos son recibidos por el WS
        Number idTcaRolBpm = null; //Id de catalogo de Roles BPM
        String cveRolBpm = null; //Descripcion corta de Rol BPM
        String descRolBpm = null; //Descripcion para mostrar del Rol BPM
        Boolean emiteVoto = false;

        int index = 0;

        if (response != null && response.getListadoEmitirVoto() != null && response.getListadoEmitirVoto().size() > 0 &&
            response.getListadoEmitirVoto().get(0).getMiembroReunion() != null &&
            response.getListadoEmitirVoto().get(0).getMiembroReunion().size() > 0) {
            logger.warning("Toma valores del response.");
            List<MiembroReunion> miembroReunionList = response.getListadoEmitirVoto().get(0).getMiembroReunion();
            logger.warning("Tamaño miembroReunionList : " + miembroReunionList.size());
            for (MiembroReunion miembroReunion : miembroReunionList) {

                if (miembroReunion.getRol() != null) {
                    idTcaRolBpm = new Number(miembroReunion.getRol().getId());
                    cveRolBpm = miembroReunion.getRol().getDescripcionCorta();
                    descRolBpm = miembroReunion.getRol().getDescripcion();
                } else {
                    logger.warning("El objeto miembroReunion.getRol() es nulo.");
                }
                logger.warning("idTcaRolBpm : " + idTcaRolBpm);
                logger.warning(" cveRolBpm : " + cveRolBpm);
                logger.warning("descRolBpm : " + descRolBpm);
                //Valida Rol que no votan
                emiteVoto = getGrupoRolAprobacionVO1().emitirVoto(miembroReunion);

                if (idTcaRolBpm != null && cveRolBpm != null && descRolBpm != null) {

                    index = index + 1;
                    idGrupo = new Number(index);

                    if (orden == null) {
                        //Si no se asigna orden de grupo, por defecto se determina conforme se crean los grupos
                        orden = idGrupo;
                    }
                    grupoComite =
                        getGrupoRolAprobacionVO1().createRow(idGrupo, orden, idTcaRolBpm, cveRolBpm, descRolBpm,
                                                             emiteVoto, idNivelAprob);

                    if (grupoComite != null) {

                        if (grupos == null) {
                            grupos = new ArrayList<GrupoRolAprobacionVORowImpl>();
                        }
                        grupos.add(grupoComite);
                    }
                } else {
                    logger.warning("Valores del re");
                }
            }
            logger.warning("Numero de rows creados : " + getGrupoRolAprobacionVO1().getRowCount());
        } else {
            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
            String msg = rb.getString("org.bcie.fenix.common.model.vo.MiembrosAprobacionVO.ws.comite.credito.vacio");
            throw new JboException(msg);
        }

        logger.exiting(FenixAMImpl.class.getName(), "obtenerGruposComiteCreditoWS", grupos);
        return grupos;
    }

    /**
     * Obtiene lista de Miembros de Aprobacion de Comite de Credito
     * @param response contiene objeto respuesta de WS
     * @return devuelve lista de miembros
     */
    private List<MiembrosAprobacionVORowImpl> obtenerMiembrosComiteCreditoWS(ConfigurarSolicitudAprobacionResponseType response) {
        logger.warning("Entra en obtenerMiembrosComiteCreditoWS.");
        List<MiembrosAprobacionVORowImpl> miembros = null;
        miembros = getMiembrosAprobacionComiteCreditoVO1().obtenerMiembrosWS(response, TIPO_MIEMBRO_COMITE_CREDITO);
        return miembros;
    }

    /**
     * Obtiene lista de Miembros de Notificacion
     * @param response contiene objeto respuesta de WS
     * @return devuelve lista de Miembros
     */
    private List<MiembrosAprobacionVORowImpl> obtenerMiembrosNotificacionWS(ConfigurarSolicitudAprobacionResponseType response) {

        List<MiembrosAprobacionVORowImpl> miembros = null;
        miembros = getMiembrosAprobacionNotificacionVO1().obtenerMiembrosWS(response, TIPO_MIEMBRO_NOTIFICACION);
        return miembros;
    }

    /**
     * Obtiene lista de Miembros de Equipo de Trabajo
     * @param response contiene objeto respuesta de WS
     * @return devuelve lista de Miembros
     */
    private List<MiembrosAprobacionVORowImpl> obtienerMiembrosEquipoTrabajoWS(ConfigurarSolicitudAprobacionResponseType response) {

        List<MiembrosAprobacionVORowImpl> miembros = null;
        miembros = getMiembrosAprobacionEquipoTrabajoVO1().obtenerMiembrosWS(response, TIPO_MIEMBRO_EQUIPO_TRABAJO);
        return miembros;
    }

    /**
     * Obtiene y envia los valores requeridos para la creacion de una solicitud de aprobacion en la operacion de WS
     * @param params contiene parametros del ViewController. Tipo <class>java.util.Map</class>
     *        Definicion de Mapa de parametros:
     *          Clave Mapa        -> Tipo de Dato
     *          tipoReunion       -> java.lang.Integer
     *          idOperacion       -> java.lang.Long
     *          loginUsuario      -> java.lang.String
     *          tipoSolicitud     -> java.lang.Integer
     *          fecha             -> java.util.Date
     *          hora              -> java.sql.Timestamp
     *          lugar             -> java.lang.String
     *          fechaApertura     -> java.util.Date
     *          fechaTermino      -> java.util.Date
     *          idNivelAprobacion -> java.lang.Integer
     * @return devuelve valor booleano, true si se creo la solicitud y false en caso contrario
     */
    public boolean crearSolicitudAprobacionWS(Map params) {

        logger.entering(FenixAMImpl.class.getName(), "crearSolicitudAprobacionWS", new Object[] { params });

        boolean exito = false;
        if (params == null) {
            return exito;
        }

        //Obtiene los parametros de ViewController
        Integer tipoReunion = (Integer) params.get("tipoReunion");
        Long idOperacion = (Long) params.get("idOperacion");
        String loginUsuario = (String) params.get("loginUsuario");
        Integer tipoSolicitud = (Integer) params.get("tipoSolicitud");
        Date fecha = (Date) params.get("fecha");
        oracle.jbo.domain.Timestamp hora = (oracle.jbo.domain.Timestamp) params.get("hora");
        String lugar = (String) params.get("lugar");
        Date fechaApertura = (Date) params.get("fechaApertura");
        Date fechaTermino = (Date) params.get("fechaTermino");
        Integer nivelAprob = (Integer) params.get("idNivelAprobacion");

        List<SolicitudAprobacion> solAprobList = null;
        List<MiembroReunion> comiteCredList = null;
        List<MiembroReunion> notificacionList = null;
        List<MiembroReunion> equipoTraList = null;

        Number numIdSol = null;
        boolean newSolAprob = false;

        SolicitudAprobacion solAprob =
            getSolicitudAprobacionVO1().getSolicitudAprobWSNode(idOperacion, loginUsuario, tipoSolicitud, tipoReunion,
                                                                fecha, hora, lugar, fechaApertura, fechaTermino,
                                                                nivelAprob);

        logger.warning("Nodo de Solicitud de Aprobacion: " + solAprob);

        if (solAprob != null) {
            solAprobList = new ArrayList<SolicitudAprobacion>();
            solAprobList.add(solAprob);
        } else {
            logger.severe("Error no se obtuvo Nodo de Solicitud de Aprobacion");
            throw new JboException("Error no se obtuvo Nodo de Solicitud de Aprobacion");
        }

        comiteCredList = getMiembrosAprobacionComiteCreditoVO1().getSolAprobComiteCredWSNodeList();
        notificacionList = getMiembrosAprobacionNotificacionVO1().getSolAprobNotificacionWSNodeList(nivelAprob);
        equipoTraList = getMiembrosAprobacionEquipoTrabajoVO1().getSolAprobEquipoTrabajoWSNodeList();

        //Instancia del Cliente WS
        SolicitudAprobacionPT solicitudAprobacionPT = getInstanciaSolicitudAprobacionWS();

        CrearSolicitudAprobacionRequestType request = null;
        CrearSolicitudAprobacionResponseType response = null;

        request = new CrearSolicitudAprobacionRequestType();

        if (solAprobList != null) {
            logger.warning("Cantidad de Elementos de Solicitud Aprobacion: " + solAprobList.size());
            request.getSolicitudAprobacion().addAll(solAprobList);
        } else {
            logger.severe("No se genero elementos de datos generales de solicitud de aprobacion");
        }
        if (comiteCredList != null) {
            logger.warning("Cantidad de Elementos de Comite de Credito: " + comiteCredList.size());
            request.getListadoEmitirVoto().addAll(comiteCredList);
        } else {
            logger.severe("No se genero elementos de Comite de Credito");
        }
        if (notificacionList != null) {
            logger.warning("Cantidad de Elementos de Notificacion: " + notificacionList.size());
            request.getListadoConNotificacion().addAll(notificacionList);
        }
        if (equipoTraList != null) {
            logger.warning("Cantidad de Elementos de Equipo de Trabajo: " + equipoTraList.size());
            request.getListadoEquipoTrabajo().addAll(equipoTraList);
        }

        if (request != null && solAprob != null) {

            try {
                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_SOLICITUD_APROBACION_WS);
                response = solicitudAprobacionPT.crearSolicitudAprobacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_SOLICITUD_APROBACION_WS,
                                    horaInicio);

                if (response.getResultado() != null) {
                    SuccessType success = response.getResultado().getResult();
                    String msg = response.getResultado().getMessage();
                    Error error = response.getResultado().getError();
                    if (error != null && !"".equals(error.getErrorCode())) {
                        msg =
                            "Error Solicitud de aprobacion no creada. Mensaje resultado de WS: Code: " +
                            error.getErrorCode() + " - Desc: " + error.getErrorDescription() + " - Type: " +
                            error.getErrorType();

                        logger.severe(msg);
                        throw new JboException(msg);
                    } else {
                        if (success != null && !"".equals(success.value())) {

                            if (success.value().toUpperCase().contains("ERROR")) {
                                exito = false;
                                logger.severe("El servicio devuelve error. Mensaje de WS: " + msg);
                                throw new JboException(msg);
                            } else {
                                exito = true;
                                logger.warning("Solicitud de Aprobacion creada con exito. Mensaje de WS: " + msg);
                            }
                        } else {
                            exito = false;
                            logger.severe("Objecto success no recibido");
                            throw new JboException("Resultado del servicio no recibido");
                        }

                        //Obtiene Id de Solicitud de aprobacion creada
                        String[] values = msg.split("Id:");
                        String strIdSol = null;

                        if (values != null && values.length > 0) {
                            strIdSol = values[values.length - 1];
                            if (strIdSol != null) {
                                strIdSol.trim();
                                try {
                                    numIdSol = new Number(strIdSol);
                                } catch (Exception e) {
                                    logger.severe("Error al convertir Id de solicitud creada a Number", e);
                                }
                            }
                        }

                        if (numIdSol == null) {
                            throw new JboException("Id de solicitud no obtenido");
                        } else {
                            //Asigna Id de Solicitud al registro actual de la VO
                            getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorIdVC(numIdSol);
                            if (getSolicitudAprobacionVO1().getEstimatedRowCount() > 0) {
                                logger.warning("Solicitud de Aprobacion creada");
                                newSolAprob = true;
                            } else {
                                logger.warning("Solicitud de Aprobacion no creada");
                                newSolAprob = false;
                            }
                        }
                    }
                }
            } catch (Exception e) {
                logger.severe("Error al consumir operacion Crear Solicitud", e);
                throw new JboException(e);
            }
        }

        if (nivelAprob != null) {
            if (nivelAprob.equals(NIVEL_APROBACION_PRESIDENCIA_INT) && newSolAprob) {

                Number idTipoAccion = null;
                String numActa = null;
                String numAcuerdo = null;
                String acuerdo = null;

                idTipoAccion = (Number) params.get("idAccion");
                if (idTipoAccion == null) {
                    logger.severe("Id de Accion a Seguir no recibido");
                }

                logger.warning("Ejecuta la creacion de Decision de Presidente. Id Solicitud: " + numIdSol.toString() +
                               ". Id Accion a Seguir: " + String.valueOf(idTipoAccion));

                exito = guardarConsolidarDecision(numIdSol, idTipoAccion, numActa, numAcuerdo, acuerdo, loginUsuario);

                if (exito) {
                    logger.warning("Decision de Presidente Creado correctamente");
                } else {
                    logger.severe("Error al crear la Decision de Presidente para la nueva Solicitud");
                }
            }
        }

        logger.exiting(FenixAMImpl.class.getName(), "crearSolicitudAprobacionWS", exito);
        return exito;
    }

    /**
     * Instancia WS y consume metodo de Configuracion de Solicitud de Aprobacion de Comite de Credito
     * @param idOperacion contiene id de operacion
     * @param nivelAprob contiene id del nivel de aprobacion
     * @return devuelve response del WS
     */
    public ConfigurarSolicitudAprobacionResponseType getConfiguracionSolAprobWS(Long idOperacion, Integer nivelAprob) {
        logger.entering(FenixAMImpl.class.getName(), "getConfiguracionSolAprobWS", new Object[] {
                        idOperacion, nivelAprob });

        ConfigurarSolicitudAprobacionRequestType confRequest = null;
        ConfigurarSolicitudAprobacionResponseType confResponse = null;

        SolicitudAprobacionPT solicitudAprobacionPT = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;

        try {
            solicitudAprobacionPT = getInstanciaSolicitudAprobacionWS();

            confRequest = new ConfigurarSolicitudAprobacionRequestType();

            logger.warning("Ejecutando Operacion de WS: configurarSolicitudAprobacion");
            logger.warning("Id de Operacion: " + idOperacion);

            confRequest.setIdOperacion(idOperacion);
            confRequest.setNivelAprobacion(nivelAprob);

            xmlEntrada = this.writeXMLRequest(confRequest, confRequest.getClass());
            logger.warning("Request XML: \n" + xmlEntrada);

            confResponse = solicitudAprobacionPT.configurarSolicitudAprobacion(confRequest);

            xmlSalida = this.writeXMLRequest(confResponse, confResponse.getClass());
            logger.warning("Response XML: \n" + xmlSalida);

        } catch (Exception e) {
            logger.severe("Error al instanciar el servicio", e);
            throw new JboException(new Exception("Error al consumir el servicio. " + e.getMessage()));
        }

        logger.exiting(FenixAMImpl.class.getName(), "getConfiguracionSolAprobWS", new Object[] { confResponse });
        return confResponse;
    }

    /**
     * Crea instancia del WS de Solicitud de Aprobacion
     * @return devuelve objeto Client Port
     */
    public SolicitudAprobacionPT getInstanciaSolicitudAprobacionWS() {

        logger.entering(FenixAMImpl.class.getName(), "getInstanciaSolicitudAprobacionWS");

        SolicitudAprobacion12BndQSService solicitudAprobacion12BndQSService = null;
        SolicitudAprobacionPT solicitudAprobacionPT = null;

        try {
            String wsdl = getWsdl(IWsdlLocation.SOLICITUD_APROBACION);

            solicitudAprobacion12BndQSService =
                IWsdlLocation.Service.getInstance(SolicitudAprobacion12BndQSService.class, wsdl);
            solicitudAprobacionPT = solicitudAprobacion12BndQSService.getSolicitudAprobacion12BndQSPort();
            logger.warning("Instancia WS: " + solicitudAprobacionPT);
        } catch (Exception e) {
            logger.severe("Error al instanciar el servicio", e);
        }

        logger.exiting(FenixAMImpl.class.getName(), "getInstanciaSolicitudAprobacionWS", new Object[] {
                       solicitudAprobacionPT });
        return solicitudAprobacionPT;
    }

    /**
     * Inicializa las VO del Seguimiento de Votacion Virtual
     */
    public void initSeguimientoVotacionVirtual(Long idSolicitudAprobacion, Long idOperacion) {

        logger.entering(FenixAMImpl.class.getName(), "initSeguimientoVotacionVirtual", new Object[] {
                        idSolicitudAprobacion, idOperacion
        });

        List<UsuarioReunionAprobacionLOVRowImpl> rowsIdUsuReunion = null;

        logger.warning("Obtiene Id Solicitu de Aprobacion: " + idSolicitudAprobacion);
        logger.warning("Obtiene Id Operacion: " + idOperacion);

        //Inicializar VO de Solicitud Aprobacion
        if (idSolicitudAprobacion != null && idOperacion != null) {

            if (getSolicitudAprobacionVO1().getEstimatedRowCount() <= 0) {
                logger.warning("Realiza la busqueda de la Solicitud de Aprobacion");
                getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorId(new Number(idSolicitudAprobacion),
                                                                           new Number(idOperacion));
            }

            SolicitudAprobacionVORowImpl rowSolicitud = null;
            if (getSolicitudAprobacionVO1().getEstimatedRowCount() > 0) {

                rowSolicitud = (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();

                if (rowSolicitud != null) {
                    logger.warning("Solicitud de aprobacion encontrada. Id: " + rowSolicitud.getId());
                }
            }

            if (rowSolicitud != null) {
                //Ejecuta la consulta de miembros de la reunion por Id de Solicitud Aprobacion
                getUsuarioReunionAprobacionLOV().consultarUsuarioReunionPorIdSolicitud(idSolicitudAprobacion);

                if (getUsuarioReunionAprobacionLOV().getEstimatedRowCount() > 0) {
                    logger.warning("Cantidad de Registros de Usuario Reunion Aprobacion encontrados: " +
                                   getUsuarioReunionAprobacionLOV().getEstimatedRowCount());
                }

                //Obtiene miembros votantes
                rowsIdUsuReunion = obtenerIdMiembrosVotantes();

                if (rowsIdUsuReunion != null) {
                    logger.warning("Cantidad de Id de Usuario Reunion Aprobacion para obtener votos: " +
                                   rowsIdUsuReunion.size());
                }

                //Busca los votos de los miembros
                //getVotoActualAprobLOV1().obtenerVotosReunion(rowsIdUsuReunion);
                getVotoActualAprobLOV1().buscarPorIdSolicitud(new Number(idSolicitudAprobacion));
                if (getVotoActualAprobLOV1().getEstimatedRowCount() > 0) {
                    logger.warning("Cantidad de Registros de Votos Actuales: " +
                                   getVotoActualAprobLOV1().getEstimatedRowCount());
                } else {
                    logger.warning("No se encontraron registros de votos actuales");
                }
            } else {
                logger.severe("No se encontro registro de Solicitud Aprobacion para el Id Operacion: " + idOperacion +
                              " y Id Solicitud Aprobacion: " + idSolicitudAprobacion);
            }
        } else {
            logger.severe("No se recibio Id Solicitud Aprobacion y Id de Operacion para la inicializacion de consultas");
        }

        logger.exiting(FenixAMImpl.class.getName(), "initSeguimientoVotacionVirtual");
    }

    /**
     * Inicializa las VO del Seguimiento de Votacion Presencial
     * @param idSolicitudAprobacion contiene el id de solicitud de aprobacion
     */
    public void initSeguimientoVotacionPresencial(Long idSolicitudAprobacion, Long idOperacion) {

        logger.entering(FenixAMImpl.class.getName(), "initSeguimientoVotacionPresencial", new Object[] {
                        idSolicitudAprobacion, idOperacion
        });

        List<UsuarioReunionAprobacionLOVRowImpl> rowsIdUsuReunion = null;

        //Inicializar VO de Solicitud Aprobacion
        getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorId(new Number(idSolicitudAprobacion),
                                                                   new Number(idOperacion));
        SolicitudAprobacionVORowImpl rowSolicitud = null;
        if (getSolicitudAprobacionVO1().getEstimatedRowCount() > 0) {
            rowSolicitud = (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();
        }

        //Ejecuta la consulta de miembros de la reunion por Id de Solicitud Aprobacion
        getUsuarioReunionAprobacionLOV().consultarUsuarioReunionPorIdSolicitud(idSolicitudAprobacion);

        //Obtiene miembros votantes
        rowsIdUsuReunion = obtenerIdMiembrosVotantes();

        //Busca los votos de los miembros
        //getVotoActualAprobLOV1().obtenerVotosReunion(rowsIdUsuReunion); //Solo aplica para votos de reunion virtual

        logger.exiting(FenixAMImpl.class.getName(), "initSeguimientoVotacionPresencial");
    }

    /**
     * Guarda la fecha de cierre de una solicitud de aprobacion, asignando la fecha actual
     * @return devuelve valor booleano, true si el guardado es correcto o false en caso contrario
     */
    public boolean guardarFechaCierreSolicitudAprob() {

        logger.entering(FenixAMImpl.class.getName(), "guardarFechaCierreSolicitudAprob");

        boolean exito = false;
        try {
            exito = getSolicitudAprobacionVO1().asignaFechaCierreConFechaActual();
        } catch (Exception e) {
            logger.severe("Error al asignar fecha cierre a la solicitud de aprobacion", e);
        }

        if (exito) {
            try {
                exito = getSolicitudAprobacionVO1().asignaUsuarioCierre();
            } catch (Exception e) {
                logger.severe("Error al asigna el usuario de cierre de la solicitud de aprobacion", e);
            }
        }

        if (exito) {
            try {
                getDBTransaction().commit();

                logger.warning("Fecha cierre guardada correctamente");
            } catch (Exception e) {
                logger.severe("Error al realizar Commit", e);
                exito = false;
            }

            if (!exito) {
                try {
                    getDBTransaction().rollback();
                    logger.warning("Fecha cierre no guardada");
                } catch (Exception e) {
                    logger.severe("Error al realizar Rollback", e);
                }
            }
        }

        logger.exiting(FenixAMImpl.class.getName(), "guardarFechaCierreSolicitudAprob", exito);
        return exito;
    }

    /**
     * Obtiene los registros de miembros de una reunion que pueden votar una solicitud de aprobacion
     * @param idSolicitudAprobacion contiene el id de solicitud de aprobacion
     * @return devuelve lista de id de miembros de la reunion
     */
    public List<UsuarioReunionAprobacionLOVRowImpl> obtenerIdMiembrosVotantes() {

        logger.entering(FenixAMImpl.class.getName(), "obtenerIdMiembrosVotantes");

        List<UsuarioReunionAprobacionLOVRowImpl> rows = null;

        RowSetIterator rsi = null;
        rsi = getUsuarioReunionAprobacionLOV().createRowSetIterator(null);
        while (rsi.hasNext()) {
            UsuarioReunionAprobacionLOVRowImpl row = null;
            row = (UsuarioReunionAprobacionLOVRowImpl) rsi.next();
            if (EMITE_VOTO.equals(row.getEmiteVoto())) {
                if (rows == null) {
                    rows = new ArrayList<UsuarioReunionAprobacionLOVRowImpl>();
                }
                rows.add(row);
            }
        }
        rsi.closeRowSetIterator();

        if (rows != null) {
            logger.warning("Cantidad de miembros votantes: " + rows.size());
        }

        logger.exiting(FenixAMImpl.class.getName(), "obtenerIdMiembrosVotantes", rows);
        return rows;
    }

    /**
     * Valida la existencia de un comentario de operacion realizado por el usuario en session y en la fecha actual
     * @param idOperacion contiene id de la operacion
     * @param intTarea contiene id de tarea
     * @return devuelve valor booleano, true si ha agregado comentario o false en caso contrario
     */
    public boolean valComentarioOperUsuFchActual(Number idOperacion, Integer intTarea) {

        logger.warning("valComentarioOperUsuFchActual.");
        logger.warning("idOperacion: " + idOperacion);
        logger.warning("intTarea: " + intTarea);

        boolean esComentario = false;
        String loginSession = null;
        Row row = null;
        Row rowActual = null;
        java.sql.Timestamp fechaActual = null;
        Long idOperacionLong = null;

        if (null != idOperacion) {
            idOperacionLong = idOperacion.longValue();
        }

        loginSession = ADFContext.getCurrent().getSecurityContext().getUserName();
        logger.warning("loginSession: " + loginSession);

        if (getComentarioOperacionVO() != null && idOperacion != null) {
            RowSetIterator iter = getComentarioOperacionVO().createRowSetIterator(null);

            iter.reset();
            while (iter.hasNext()) {
                row = iter.next();
                if (row.getAttribute("IdTcaTarea") != null && row.getAttribute("LoginUsuario") != null &&
                    row.getAttribute("IdOperacion") != null && row.getAttribute("FechaRegistro") != null) {

                    Long idOperRow = null;
                    String loginRow = null;
                    Integer tareaRow = null;
                    java.sql.Timestamp fechaRow = null;

                    try {
                        idOperRow = new Long(row.getAttribute("IdOperacion").toString());
                    } catch (Exception e) {
                        logger.severe("Error al obtener Id de Operacion del Row de Comentario Operacion", e);
                        row = null;
                        break;
                    }

                    try {
                        loginRow = (String) row.getAttribute("LoginUsuario");
                    } catch (Exception e) {
                        logger.severe("Error al obtener Login de Usuario del Row de Comentario Operacion", e);
                        row = null;
                        break;
                    }

                    try {
                        tareaRow = new Integer(row.getAttribute("IdTcaTarea").toString());
                    } catch (Exception e) {
                        logger.severe("Error al obtener Id de Tarea del Row de Comentario Operacion", e);
                    }

                    try {
                        fechaRow = (java.sql.Timestamp) row.getAttribute("FechaRegistro");
                    } catch (Exception e) {
                        logger.severe("Error al obtener fecha de registro del Row de Comentario Operacion", e);
                    }

                    logger.warning("tareaRow: " + tareaRow);
                    logger.warning("idOperRow: " + idOperRow);
                    logger.warning("loginRow: " + loginRow);
                    logger.warning("fechaRow: " + fechaRow);

                    if (null != intTarea && intTarea.compareTo(tareaRow) == 0 && null != idOperacionLong &&
                        idOperacionLong.compareTo(idOperRow) == 0 && loginSession.equals(loginRow)) {

                        if (fechaActual == null) {
                            fechaActual = fechaRow;
                            rowActual = row;
                        } else {

                            if (fechaActual.compareTo(fechaRow) < 0) {
                                fechaActual = fechaRow;
                                rowActual = row;
                            }
                        }
                    }
                }
            }
            iter.closeRowSetIterator();
        }

        logger.warning("Verifica fecha a validar: " + fechaActual);
        if (fechaActual != null && rowActual != null) {

            Calendar cal = Calendar.getInstance();
            cal.set(Calendar.HOUR_OF_DAY, 0);
            cal.set(Calendar.MINUTE, 0);
            cal.set(Calendar.SECOND, 0);
            cal.set(Calendar.MILLISECOND, 0);

            Date fechaHoy = cal.getTime();
            logger.warning("Se obtiene fecha actual: " + fechaHoy);
            try {
                Date tmp = new Date(fechaActual.getTime());
                if (fechaHoy.compareTo(tmp) <= 0) {

                    if (rowActual.getAttribute("Comentario") != null) {
                        logger.warning("Existe comentario con fecha actual para el usuario en session");
                        esComentario = true;
                    }
                }
            } catch (Exception e) {
                logger.severe("Error al comparar la fecha de comentario con la fecha actual", e);
            }
        }

        logger.warning("Resultado devuelto por la validacion: " + esComentario);

        logger.exiting(FenixAMImpl.class.getName(), "valComentarioOperUsuFchActual", esComentario);
        return esComentario;
    }

    /**
     * Container's getter for EnvioDatosReuAproVO1.
     * @return EnvioDatosReuAproVO1
     */
    public EnvioDatosReuAproVOImpl getEnvioDatosReuAproVO1() {
        return (EnvioDatosReuAproVOImpl) findViewObject("EnvioDatosReuAproVO1");
    }

    /**
     * Container's getter for VotoAprobacionVO1.
     * @return VotoAprobacionVO1
     */
    public VotoAprobacionVOImpl getVotoAprobacionVO1() {
        return (VotoAprobacionVOImpl) findViewObject("VotoAprobacionVO1");
    }


    /**
     * Container's getter for TcaRolBpmLOV1.
     * @return TcaRolBpmLOV1
     */
    public TcaRolBpmLOVImpl getTcaRolBpmLOV1() {
        return (TcaRolBpmLOVImpl) findViewObject("TcaRolBpmLOV1");
    }

    /**
     * Container's getter for SolicitudAprobacionVO1.
     * @return SolicitudAprobacionVO1
     */
    public SolicitudAprobacionVOImpl getSolicitudAprobacionVO1() {
        return (SolicitudAprobacionVOImpl) findViewObject("SolicitudAprobacionVO1");
    }

    /**
     * Container's getter for VotoActualAprobLOV1.
     * @return VotoActualAprobLOV1
     */
    public VotoActualAprobLOVImpl getVotoActualAprobLOV1() {
        return (VotoActualAprobLOVImpl) findViewObject("VotoActualAprobLOV1");
    }

    /**
     * Container's getter for HistoricoVotoAprobacionLOV1.
     * @return HistoricoVotoAprobacionLOV1
     */
    public HistoricoVotoAprobacionLOVImpl getHistoricoVotoAprobacionLOV1() {
        return (HistoricoVotoAprobacionLOVImpl) findViewObject("HistoricoVotoAprobacionLOV1");
    }


    /**
     * Container's getter for MiembrosAprobacionVO1.
     * @return MiembrosAprobacionVO1
     */
    public MiembrosAprobacionVOImpl getMiembrosAprobacionComiteCreditoVO1() {
        return (MiembrosAprobacionVOImpl) findViewObject("MiembrosAprobacionComiteCreditoVO1");
    }

    /**
     * Container's getter for MiembrosAprobacionVO2.
     * @return MiembrosAprobacionVO2
     */
    public MiembrosAprobacionVOImpl getMiembrosAprobacionNotificacionVO1() {
        return (MiembrosAprobacionVOImpl) findViewObject("MiembrosAprobacionNotificacionVO1");
    }

    /**
     * Container's getter for MiembrosAprobacionVO1.
     * @return MiembrosAprobacionVO1
     */
    public MiembrosAprobacionVOImpl getMiembrosAprobacionEquipoTrabajoVO1() {
        return (MiembrosAprobacionVOImpl) findViewObject("MiembrosAprobacionEquipoTrabajoVO1");
    }

    /**
     * Container's getter for HistoricoVotoAprobacionLOV2.
     * @return HistoricoVotoAprobacionLOV2
     */
    public HistoricoVotoAprobacionLOVImpl getHistoricoVotoAprobacionLOV2() {
        return (HistoricoVotoAprobacionLOVImpl) findViewObject("HistoricoVotoAprobacionLOV2");
    }

    /**
     * Container's getter for HistoricoVotoAprobAndVotoActualVL1.
     * @return HistoricoVotoAprobAndVotoActualVL1
     */
    public ViewLinkImpl getHistoricoVotoAprobAndVotoActualVL1() {
        return (ViewLinkImpl) findViewLink("HistoricoVotoAprobAndVotoActualVL1");
    }

    /**
     * Container's getter for ContratoVO1.
     * @return ContratoVO1
     */
    public ContratoVOImpl getContratoVO() {
        return (ContratoVOImpl) findViewObject("ContratoVO");
    }

    /**
     * Container's getter for AgregarFuenteVO1.
     * @return AgregarFuenteVO1
     */
    public AgregarFuenteVOImpl getAgregarFuenteVO() {
        return (AgregarFuenteVOImpl) findViewObject("AgregarFuenteVO");
    }

    /**
     * Container's getter for FuenteVO1.
     * @return FuenteVO1
     */
    public FuenteVOImpl getFuenteVO() {
        return (FuenteVOImpl) findViewObject("FuenteVO");
    }

    /**
     * Container's getter for FuentesExternasVO1.
     * @return FuentesExternasVO1
     */
    public FuentesExternasVOImpl getFuentesExternasVO() {
        return (FuentesExternasVOImpl) findViewObject("FuentesExternasVO");
    }

    /**
     * Container's getter for GrupoRolAprobacionVO1.
     * @return GrupoRolAprobacionVO1
     */
    public GrupoRolAprobacionVOImpl getGrupoRolAprobacionVO1() {
        return (GrupoRolAprobacionVOImpl) findViewObject("GrupoRolAprobacionVO1");
    }

    public void activarComisionesValidadas(String idOperacion) {

        Integer dispensado = 5;
        Integer porPagar = 4;
        Integer pagado = 6;
        Integer estatusActivo = 1;
        Integer estatus = 0;
        Integer estadoTcc = 0;
        Long claveComision = 0L;
        ViewObjectImpl comisionesActualesVO = getCargoVO();
        Row[] row = comisionesActualesVO.getFilteredRows("IdOperacion", Long.parseLong(idOperacion));
        for (Row row1 : row) {
            claveComision = (Long) row1.getAttribute("Id");
            estatus = (Integer) row1.getAttribute("BanEstatus");
            estadoTcc = (Integer) row1.getAttribute("IdTcaEstadoTcc");
            logger.log(ADFLogger.WARNING, "Id " + claveComision);
            if (estatusActivo.compareTo(estatusActivo) == 0) {
                logger.log(ADFLogger.WARNING, "Comision Activa " + estadoTcc);
                if (estadoTcc.compareTo(pagado) == 0 || estadoTcc.compareTo(porPagar) == 0 ||
                    estadoTcc.compareTo(dispensado) == 0) {
                    logger.log(ADFLogger.WARNING, "se activa validar");
                    row1.setAttribute("Validar", Boolean.TRUE);
                    row1.setAttribute("DesactivaValidar", Boolean.TRUE);
                    logger.log(ADFLogger.WARNING, "validar" + (Boolean) row1.getAttribute("Validar"));
                    logger.log(ADFLogger.WARNING, "DesactivaValidar" + (Boolean) row1.getAttribute("DesactivaValidar"));
                } else {
                    row1.setAttribute("Validar", Boolean.FALSE);
                    row1.setAttribute("DesactivaValidar", Boolean.FALSE);
                }

            }
        }
    }

    public boolean validarComisionesDispensadasPagadas(String idOperacion, Integer estadoPagado,
                                                       Integer estadoDispensado, Integer momentoActual) {
        logger.log(ADFLogger.WARNING, ">idOperacion " + idOperacion);
        logger.log(ADFLogger.WARNING, ">Estado Pagado " + estadoPagado);
        logger.log(ADFLogger.WARNING, ">Estado dispensado " + estadoDispensado);
        logger.log(ADFLogger.WARNING, ">Momento cobro " + momentoActual);
        ViewObjectImpl cargoVOPagadoDispensado = getCargoVO();
        Boolean retorna = Boolean.TRUE;
        Long comisionesActivas = 0L;
        Long comisionesDispensadasPagadas = 0L;
        Integer comisionesMomento = contadorComisionesMomento(idOperacion, momentoActual);
        logger.log(ADFLogger.WARNING, ">Comisiones momento total " + comisionesMomento);
        if (comisionesMomento > 0) {
            String cuentaComision = Integer.toString(comisionesMomento);
            comisionesActivas = Long.parseLong(cuentaComision);

            try {
                ViewCriteria criteriaByPagDisp =
                    cargoVOPagadoDispensado.getViewCriteriaManager().getViewCriteria("CargoVOCriteriaDispensadoPagado");
                criteriaByPagDisp.ensureVariableManager().setVariableValue("OperacionId", idOperacion);
                criteriaByPagDisp.ensureVariableManager().setVariableValue("estadoPagado", estadoPagado);
                criteriaByPagDisp.ensureVariableManager().setVariableValue("estadoDispensado", estadoDispensado);
                criteriaByPagDisp.ensureVariableManager().setVariableValue("momentoCobroActual", momentoActual);

                cargoVOPagadoDispensado.applyViewCriteria(criteriaByPagDisp);
                cargoVOPagadoDispensado.executeQuery();
                comisionesDispensadasPagadas = cargoVOPagadoDispensado.getEstimatedRowCount();
            } catch (Exception ex) {
                comisionesDispensadasPagadas = 0L;
                logger.log(ADFLogger.ERROR, "Error en validarComisiones " + ex.getClass() + ":" + ex.getMessage());
                retorna = Boolean.FALSE;
            } finally {
                //This takes care of removing the applied VC.
                cargoVOPagadoDispensado.getViewCriteriaManager().removeApplyViewCriteriaName("CargoVOCriteriaDispensadoPagado");
            }
            logger.log(ADFLogger.WARNING, ">Comisiones pagadas/dispensadas " + comisionesDispensadasPagadas);
            if ((comisionesDispensadasPagadas >= 0 || comisionesActivas > 0) &&
                comisionesDispensadasPagadas != comisionesActivas) {
                retorna = Boolean.FALSE;
            }
        } else {
            logger.log(ADFLogger.WARNING, ">No existen comisiones finaliza correctamente");
        }
        return retorna;
    }



    public boolean verificarSectorGarantiaByOperacion(Long idOperacion, Long idSector, Long idGarantia){ 
        logger.log(ADFLogger.WARNING,"Inicio verificarSectorGarantiaByOperacion");  
        logger.log(ADFLogger.WARNING,"idOperacion: " + idOperacion);  
        logger.log(ADFLogger.WARNING,"idSector: " + idSector);  
        logger.log(ADFLogger.WARNING,"idGarantia: " + idGarantia);  
        boolean vb_SectorGarantiaCoinciden = false;
        
        Long operacion_idSector = 0L;    
        Long operacion_idGarantia = 0L;    
        Long operacion_idCliente = 0L;    

        String wsdlOperacion = getWsdl(IWsdlLocation.OPERACION);
        String wsdlCliente = getWsdl(IWsdlLocation.CLIENTE);

        try{        
            Operacion12BndQSService operacion12BndQSService = IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdlOperacion);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            ConsultarOperacionByIdOperacionRequestType requestOperacion = new ConsultarOperacionByIdOperacionRequestType();
            requestOperacion.setIdOperacion(idOperacion);
            
            Date horaInicioOperacion = ModelUtils.logStartWS(logger, requestOperacion, FenixModelConstants.WSC_CONSULTAR_OPERACION_DESEMBOLSOS);
            ConsultarOperacionResponseType responseOperacion = operacion12Port.consultarOperacionByIdOperacion(requestOperacion);
            ModelUtils.logEndWS(logger, responseOperacion, FenixModelConstants.WSC_CONSULTAR_OPERACION_DESEMBOLSOS, horaInicioOperacion);
            
            Operacion operacion = responseOperacion.getOperacion().get(0);
            
            operacion_idGarantia = operacion.getTipoGarantia().getId();        
            logger.log(ADFLogger.WARNING,"operacion_idGarantia: " + operacion_idGarantia);  
            operacion_idCliente = operacion.getCliente().getIdCliente();
            logger.log(ADFLogger.WARNING,"operacion_idCliente:" + operacion_idCliente);  
            
            //--------------------------------------------------------------------------------------------------------------
            
            Cliente12BndQSService cliente12BndQSService = IWsdlLocation.Service.getInstance(Cliente12BndQSService.class, wsdlCliente);
            
            ConsultarClientesByIdClienteRequestType requestCliente = new ConsultarClientesByIdClienteRequestType();
            requestCliente.setIdCliente(operacion_idCliente); 
            
            Date horaInicioCliente = ModelUtils.logStartWS(logger, requestCliente, FenixModelConstants.WSC_CONSULTAR_CLIENTE);
            ConsultarClienteResponseType responseCliente = cliente12BndQSService.getCliente12BndQSPort().consultarByIdCliente(requestCliente);
            ModelUtils.logEndWS(logger, responseCliente, FenixModelConstants.WSC_CONSULTAR_CLIENTE, horaInicioCliente);       
            
            Cliente cliente = responseCliente.getCliente().get(0);
            
            operacion_idSector = cliente.getSector().getId();
            logger.log(ADFLogger.WARNING,"operacion_idSector: " + operacion_idSector);  
            
            if( operacion_idSector.compareTo(idSector) == 0 && operacion_idGarantia.compareTo(idGarantia) == 0 )
            {
                logger.log(ADFLogger.WARNING,"Validacion correcta");  
                vb_SectorGarantiaCoinciden = true;
            }
            else
            {
                logger.log(ADFLogger.WARNING,"Validacion incorrecta");  
                vb_SectorGarantiaCoinciden = false;
            }
            
        }catch(Exception e){
            logger.log(ADFLogger.WARNING,"Fail exception vb_SectorGarantiaCoinciden: " + e.getMessage());   
            vb_SectorGarantiaCoinciden = false;
        } 

        logger.log(ADFLogger.WARNING,"Final verificarSectorGarantiaByOperacion, return " + vb_SectorGarantiaCoinciden);  
        return vb_SectorGarantiaCoinciden;
    }
    
    public void setConformarEquipoValues(Boolean reqRAROC, Boolean reqOpinion, Boolean requHojaPCT,
                                         Boolean reqAdquisicion, Integer idProducto, String codigoTarea,
                                         Boolean solRAROC, Boolean solOpinion, Boolean soluHojaPCT,
                                         Boolean solAdquisicion, Long idOperacion, Boolean reqElabDocTecOPD, 
                                         Boolean reqGenPlanMonOPD, Boolean reqRevEvidCumpOPD, Boolean solElabDocTecOPD,
                                         Boolean solGenPlanMonOPD, Boolean solRevEvidCumpOPD) 
    {
        //Preparacion
        logger.log(ADFLogger.WARNING,"setConformarEquipoValues con idOperacion");
        Integer TAREA_RAROC = TAREA_RAROC_C;
        Integer TAREA_HOJAPCT = TAREA_HOJAPCT_C;
        Integer TAREA_OPINION = TAREA_OPINION_C;
        Integer TAREA_ADQUISION = TAREA_ADQUISION_C;
        Integer TAREA_REVCOMISION = TAREA_REVCOMISION_C;
        Integer TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD = TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD_C;
        Integer TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD = TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD_C;
        Integer TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD = TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD_C;
        Integer RAROC = RAROC_C;
        Integer OPINION_TECNICA = OPINION_TECNICA_C;
        Integer HOJA_PCT = HOJA_PCT_C;
        Integer ADQUISICIONES = ADQUISICIONES_C;
        String tareaEquipos = TAREA_EQUIPOS_C;
        String tareaEnviarAnalisis = TAREA_ENVIAR_ANALISIS_C;
        Boolean validaRAROC = obtenerCampo(idProducto, RAROC);
        Boolean validaHOJAPCT = obtenerCampo(idProducto, HOJA_PCT);
        Boolean validaADQUISICIONES = obtenerCampo(idProducto, ADQUISICIONES);
        Boolean validaEMITIROPINION = obtenerCampo(idProducto, OPINION_TECNICA);
        Boolean validaElabDocTecOPD = reqElabDocTecOPD != null ? reqElabDocTecOPD : false;
        Boolean validaGenPlanMonOPD = reqGenPlanMonOPD != null ? reqGenPlanMonOPD : false;
        Boolean validaRevEvidCumpOPD = reqRevEvidCumpOPD != null ? reqRevEvidCumpOPD : false;

        logger.log(ADFLogger.WARNING,
                   ">HNWS" + " Dentro del metodo antes de setear la tabla,  RequiereRAROC " + reqRAROC +
                   ", RequiereHojaPCT " + requHojaPCT + ", RequiereOpinionTexnica " + reqOpinion +
                   ", RequiereAnalizarAdq " + reqAdquisicion + ", SolicitaRAROC " + solRAROC + ", SolicitaHojaPCT " +
                   soluHojaPCT + ", SolicitaOpinionTexnica " + solOpinion + ", SolicitaAnalizarAdq " + solAdquisicion
                   + ", reqElabDocTecOPD " + reqElabDocTecOPD + ", reqGenPlanMonOPD " + reqGenPlanMonOPD
                   + ", reqRevEvidCumpOPD " + reqRevEvidCumpOPD + ", solElabDocTecOPD " + solElabDocTecOPD
                   + ", solGenPlanMonOPD " + solGenPlanMonOPD + ", solRevEvidCumpOPD " + solRevEvidCumpOPD);

        ViewObjectImpl conformarEquiposVO = getConformarEquiposVO();

        conformarEquiposVO.setRangeSize(-1);
        if (codigoTarea.equalsIgnoreCase(tareaEquipos)) {
    
            //Verfica si la operacion es del Sector publico - No Soberano
            boolean vb_SectorCategoriaCoinciden = verificarSectorGarantiaByOperacion(idOperacion,1L,2L); 
            Row row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_RAROC }));
            if(vb_SectorCategoriaCoinciden){
                logger.log(ADFLogger.WARNING,"Si es del sector publico-no soberano");
                row.setAttribute("Desactiva_Participa", false);
                row.setAttribute("Participa", false); 
            }
            else
            {
                logger.log(ADFLogger.WARNING,"No es del sector publico-soberano");
                logger.log(ADFLogger.WARNING,"validaRAROC: " + validaRAROC);
                row.setAttribute("Desactiva_Participa", validaRAROC);
                if (reqRAROC != null && reqRAROC) {
                   row.setAttribute("Participa", true);
                } else {
                   row.setAttribute("Participa", validaRAROC);
                }
           }

            logger.log(ADFLogger.WARNING,"validaHOJAPCT: " + validaHOJAPCT);
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_HOJAPCT }));
            row.setAttribute("Desactiva_Participa", validaHOJAPCT);
            if (requHojaPCT != null && requHojaPCT) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaHOJAPCT);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_OPINION }));
            row.setAttribute("Desactiva_Participa", validaEMITIROPINION);
            if (reqOpinion != null && reqOpinion) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaEMITIROPINION);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ADQUISION }));
            row.setAttribute("Desactiva_Participa", validaADQUISICIONES);
            if (reqAdquisicion != null && reqAdquisicion) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaADQUISICIONES);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD }));
            row.setAttribute("Desactiva_Participa", validaElabDocTecOPD);
            if (reqElabDocTecOPD != null && reqElabDocTecOPD) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaElabDocTecOPD);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD }));
            row.setAttribute("Desactiva_Participa", validaGenPlanMonOPD);
            if (reqGenPlanMonOPD != null && reqGenPlanMonOPD) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaGenPlanMonOPD);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD }));
            row.setAttribute("Desactiva_Participa", validaRevEvidCumpOPD);
            if (reqRevEvidCumpOPD != null && reqRevEvidCumpOPD) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaRevEvidCumpOPD);
            }            
        }

        if (codigoTarea.equalsIgnoreCase(tareaEnviarAnalisis)) {
             
            //Verfica si la operacion es del Sector publico - No Soberano
            boolean vb_SectorCategoriaCoinciden = verificarSectorGarantiaByOperacion(idOperacion,1L,2L); 
            Row row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_RAROC }));
            if(vb_SectorCategoriaCoinciden){
                logger.log(ADFLogger.WARNING,"Si es del sector publico-soberano");
                row.setAttribute("Desactiva_Participa", false);
                row.setAttribute("Participa", false); 
            }
            else
            {
                logger.log(ADFLogger.WARNING,"No es del sector publico-no soberano");
                logger.log(ADFLogger.WARNING,"validaRAROC: " + validaRAROC);
                row.setAttribute("Desactiva_Participa", validaRAROC);
                if (reqRAROC != null && reqRAROC) {
                   row.setAttribute("Participa", true);
                } else {
                   row.setAttribute("Participa", validaRAROC);
                }
            }

            if (solRAROC != null && solRAROC) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }


            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_HOJAPCT }));

            if (validaHOJAPCT) {
                row.setAttribute("Participa", true);
            } else {
                if (requHojaPCT != null && requHojaPCT) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (soluHojaPCT != null && soluHojaPCT) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_OPINION }));
            if (validaEMITIROPINION) {
                row.setAttribute("Participa", true);
            } else {
                if (reqOpinion != null && reqOpinion) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solOpinion != null && solOpinion) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ADQUISION }));
            if (validaADQUISICIONES) {
                row.setAttribute("Participa", true);
            } else {
                if (reqAdquisicion != null && reqAdquisicion) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solAdquisicion != null && solAdquisicion) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD }));
            if (validaElabDocTecOPD) {
                row.setAttribute("Participa", true);
            } else {
                if (reqElabDocTecOPD != null && reqElabDocTecOPD) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solElabDocTecOPD != null && solElabDocTecOPD) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD }));
            if (validaGenPlanMonOPD) {
                row.setAttribute("Participa", true);
            } else {
                if (reqGenPlanMonOPD != null && reqGenPlanMonOPD) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solGenPlanMonOPD != null && solGenPlanMonOPD) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD }));
            if (validaRevEvidCumpOPD) {
                row.setAttribute("Participa", true);
            } else {
                if (reqRevEvidCumpOPD != null && reqRevEvidCumpOPD) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solRevEvidCumpOPD != null && solRevEvidCumpOPD) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
        }

        logger.log(ADFLogger.WARNING, ">HNWS " + "Estado final de los Equipos");
        Row[] equiposPreseleccionados = conformarEquiposVO.getAllRowsInRange();
        for (Row rowEq : equiposPreseleccionados) {
            Boolean Participa;
            String tareaActiva;
            tareaActiva = (String) rowEq.getAttribute("Tarea");
            Participa = (Boolean) rowEq.getAttribute("Participa");
            logger.log(ADFLogger.WARNING, ">HNWS " + tareaActiva + " Final " + Participa);
        }

    }
    
    public void setConformarEquipoValues(Boolean reqRAROC, Boolean reqOpinion, Boolean requHojaPCT,
                                         Boolean reqAdquisicion, Integer idProducto, String codigoTarea,
                                         Boolean solRAROC, Boolean solOpinion, Boolean soluHojaPCT,
                                         Boolean solAdquisicion, Boolean reqElabDocTecOPD, 
                                         Boolean reqGenPlanMonOPD, Boolean reqRevEvidCumpOPD, Boolean solElabDocTecOPD,
                                         Boolean solGenPlanMonOPD, Boolean solRevEvidCumpOPD) {
        logger.log(ADFLogger.WARNING,"setConformarEquipoValues sin idOperacion");
        //Preparacion
        Integer TAREA_RAROC = TAREA_RAROC_C;
        Integer TAREA_HOJAPCT = TAREA_HOJAPCT_C;
        Integer TAREA_OPINION = TAREA_OPINION_C;
        Integer TAREA_ADQUISION = TAREA_ADQUISION_C;
        Integer TAREA_REVCOMISION = TAREA_REVCOMISION_C;
        Integer TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD = TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD_C;
        Integer TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD = TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD_C;
        Integer TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD = TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD_C;
        Integer RAROC = RAROC_C;
        Integer OPINION_TECNICA = OPINION_TECNICA_C;
        Integer HOJA_PCT = HOJA_PCT_C;
        Integer ADQUISICIONES = ADQUISICIONES_C;
        String tareaEquipos = TAREA_EQUIPOS_C;
        String tareaEnviarAnalisis = TAREA_ENVIAR_ANALISIS_C;
        Boolean validaRAROC = obtenerCampo(idProducto, RAROC);
        Boolean validaHOJAPCT = obtenerCampo(idProducto, HOJA_PCT);
        Boolean validaADQUISICIONES = obtenerCampo(idProducto, ADQUISICIONES);
        Boolean validaEMITIROPINION = obtenerCampo(idProducto, OPINION_TECNICA);
        Boolean validaElabDocTecOPD = reqElabDocTecOPD != null ? reqElabDocTecOPD : false;
        Boolean validaGenPlanMonOPD = reqGenPlanMonOPD != null ? reqGenPlanMonOPD : false;
        Boolean validaRevEvidCumpOPD = reqRevEvidCumpOPD != null ? reqRevEvidCumpOPD : false;

        logger.log(ADFLogger.WARNING,
                   ">HNWS" + " Dentro del metodo antes de setear la tabla,  RequiereRAROC " + reqRAROC +
                   ", RequiereHojaPCT " + requHojaPCT + ", RequiereOpinionTexnica " + reqOpinion +
                   ", RequiereAnalizarAdq " + reqAdquisicion + ", SolicitaRAROC " + solRAROC + ", SolicitaHojaPCT " +
                   soluHojaPCT + ", SolicitaOpinionTexnica " + solOpinion + ", SolicitaAnalizarAdq " + solAdquisicion
                 + ", reqElabDocTecOPD " + reqElabDocTecOPD + ", reqGenPlanMonOPD " + reqGenPlanMonOPD
                 + ", reqRevEvidCumpOPD " + reqRevEvidCumpOPD + ", solElabDocTecOPD " + solElabDocTecOPD
                 + ", solGenPlanMonOPD " + solGenPlanMonOPD + ", solRevEvidCumpOPD " + solRevEvidCumpOPD);

        ViewObjectImpl conformarEquiposVO = getConformarEquiposVO();

        conformarEquiposVO.setRangeSize(-1);
        if (codigoTarea.equalsIgnoreCase(tareaEquipos)) {
            Row row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_RAROC }));

            row.setAttribute("Desactiva_Participa", validaRAROC);
            if (reqRAROC != null && reqRAROC) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaRAROC);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_HOJAPCT }));
            row.setAttribute("Desactiva_Participa", validaHOJAPCT);
            if (requHojaPCT != null && requHojaPCT) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaHOJAPCT);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_OPINION }));
            row.setAttribute("Desactiva_Participa", validaEMITIROPINION);
            if (reqOpinion != null && reqOpinion) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaEMITIROPINION);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ADQUISION }));
            row.setAttribute("Desactiva_Participa", validaADQUISICIONES);
            if (reqAdquisicion != null && reqAdquisicion) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaADQUISICIONES);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD }));
            row.setAttribute("Desactiva_Participa", validaElabDocTecOPD);
            if (reqElabDocTecOPD != null && reqElabDocTecOPD) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaElabDocTecOPD);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD }));
            row.setAttribute("Desactiva_Participa", validaGenPlanMonOPD);
            if (reqGenPlanMonOPD != null && reqGenPlanMonOPD) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaGenPlanMonOPD);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD }));
            row.setAttribute("Desactiva_Participa", validaRevEvidCumpOPD);
            if (reqRevEvidCumpOPD != null && reqRevEvidCumpOPD) {
                row.setAttribute("Participa", true);
            } else {
                row.setAttribute("Participa", validaRevEvidCumpOPD);
            }
        }

        if (codigoTarea.equalsIgnoreCase(tareaEnviarAnalisis)) {
            Row row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_RAROC }));

            if (validaRAROC) {
                row.setAttribute("Participa", true);
            } else {
                if (reqRAROC != null && reqRAROC) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }


            if (solRAROC != null && solRAROC) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }


            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_HOJAPCT }));

            if (validaHOJAPCT) {
                row.setAttribute("Participa", true);
            } else {
                if (requHojaPCT != null && requHojaPCT) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (soluHojaPCT != null && soluHojaPCT) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }

            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_OPINION }));
            if (validaEMITIROPINION) {
                row.setAttribute("Participa", true);
            } else {
                if (reqOpinion != null && reqOpinion) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solOpinion != null && solOpinion) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ADQUISION }));
            if (validaADQUISICIONES) {
                row.setAttribute("Participa", true);
            } else {
                if (reqAdquisicion != null && reqAdquisicion) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solAdquisicion != null && solAdquisicion) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_ELABORAR_DOCUMENTO_TECNICO_OPD }));
            if (validaElabDocTecOPD) {
                row.setAttribute("Participa", true);
            } else {
                if (reqElabDocTecOPD != null && reqElabDocTecOPD) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solElabDocTecOPD != null && solElabDocTecOPD) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_GENERAR_PLAN_MONITOREO_EVALUACION_OPD }));
            if (validaGenPlanMonOPD) {
                row.setAttribute("Participa", true);
            } else {
                if (reqGenPlanMonOPD != null && reqGenPlanMonOPD) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solGenPlanMonOPD != null && solGenPlanMonOPD) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
            
            row = conformarEquiposVO.getRow(new Key(new Object[] { TAREA_REVISAR_EVIDENCIA_CUMPLIMIENTO_OPD }));
            if (validaRevEvidCumpOPD) {
                row.setAttribute("Participa", true);
            } else {
                if (reqRevEvidCumpOPD != null && reqRevEvidCumpOPD) {
                    row.setAttribute("Participa", true);
                } else {
                    row.setAttribute("Participa", false);
                }
            }
            if (solRevEvidCumpOPD != null && solRevEvidCumpOPD) {
                row.setAttribute("Documento", true);
            } else {
                row.setAttribute("Documento", false);
            }
        }

        logger.log(ADFLogger.WARNING, ">HNWS " + "Estado final de los Equipos");
        Row[] equiposPreseleccionados = conformarEquiposVO.getAllRowsInRange();
        for (Row rowEq : equiposPreseleccionados) {
            Boolean Participa;
            String tareaActiva;
            tareaActiva = (String) rowEq.getAttribute("Tarea");
            Participa = (Boolean) rowEq.getAttribute("Participa");
            logger.log(ADFLogger.WARNING, ">HNWS " + tareaActiva + " Final " + Participa);
        }

    }

    public Boolean obtenerCampo(Integer idProducto, Integer columna) {

        ViewObjectImpl catProductoVO = getCatProductoVO();
        catProductoVO.setRangeSize(-1);
        Integer retorno = null;
        Integer instrumento = null;
        String intermediario = null;
        if (idProducto != null) {
            Row row = catProductoVO.getRow(new Key(new Object[] { idProducto }));
            switch (columna) {
            case COL_01:
                retorno = (Integer) row.getAttribute("RequiereIbcie");
                break;
            case COL_02:
                retorno = (Integer) row.getAttribute("RequiereSiemas");
                break;
            case COL_03:
                retorno = (Integer) row.getAttribute("RequiereLaft");
                break;
            case COL_04:
                retorno = (Integer) row.getAttribute("RequiereRaroc");
                break;
            case COL_05:
                retorno = (Integer) row.getAttribute("RequiereOpinionTecnica");
                break;
            case COL_06:
                retorno = (Integer) row.getAttribute("RequiereHojaTerminosPct");
                break;
            case COL_07:
                retorno = (Integer) row.getAttribute("RequiereAdquisiciones");
                break;
            case COL_08:
                retorno = (Integer) row.getAttribute("EsIfi");
                break;
            case COL_09:
                intermediario = (String) row.getAttribute("CodigoExterno1");
                logger.warning("cod: " + intermediario);
                if (null != intermediario || intermediario.length() > 0) {
                    if (intermediario.equalsIgnoreCase(FenixModelConstants.OPERACION_INTERMEDIARIO)) {
                        logger.warning("Inf, method obtenerCampo case COL_09 define es intermediario = true ");
                        retorno = 1;
                    } else {
                        retorno = 0;
                    }
                } else {
                    retorno = 0;
                }
                break;
            case COL_10:
                instrumento = (Integer) row.getAttribute("IdInstrumentoFinanciero");

                logger.warning("instrumento: " + instrumento);
                if (null != instrumento || instrumento > 0) {
                    if (instrumento.compareTo(FenixModelConstants.INTRUMENTO_FINANCIERO_6) == 0) {
                        logger.warning("Inf, method obtenerCampo case COL_10 define es intermediario = true ");
                        retorno = 1;
                    } else {
                        retorno = 0;
                    }
                } else {
                    retorno = 0;
                }
                break;
            case COL_11:
                instrumento = (Integer) row.getAttribute("IdInstrumentoFinanciero");

                logger.warning("instrumento: " + instrumento);
                if (null != instrumento || instrumento > 0) {
                    if (instrumento.compareTo(FenixModelConstants.INTRUMENTO_FINANCIERO_7) == 0 ||
                        instrumento.compareTo(FenixModelConstants.INTRUMENTO_FINANCIERO_4) == 0) {
                        logger.warning("Inf, method obtenerCampo case COL_10 define es APE = true ");
                        retorno = 1;
                    } else {
                        logger.warning("Inf, method obtenerCampo case COL_10 define es APE = false" +
                                       " por lo tanto el programa que pertenece es un OR");
                        retorno = 0;
                    }
                } else {
                    retorno = 0;
                }
                break;
            }
        }
        if (retorno != null && retorno.compareTo(BAN_RETORNO) == 0) {
            logger.warning("Inf, se retorna un true");
            return true;
        } else {
            if (retorno == null) {
                logger.log(ADFLogger.WARNING, ">HNWS" + "No existe clave de producto");

            }
            return false;
        }
    }

    public Integer contadorComisiones(String idOperacion) {
        Long total = 0L;
        ViewObjectImpl cargoVOActivos = getCargoVO();
        try {
            ViewCriteria criteriaByActivos = cargoVOActivos.getViewCriteriaManager().getViewCriteria("CargoVOCriteria");
            criteriaByActivos.ensureVariableManager().setVariableValue("OperacionId", idOperacion);
            cargoVOActivos.applyViewCriteria(criteriaByActivos);
            cargoVOActivos.executeQuery();
            total = cargoVOActivos.getEstimatedRowCount();
        } catch (Exception ex) {
            total = 0L;
            //           comisionesDispensadasPagadas=0L;
            logger.log(ADFLogger.ERROR, "Error en validarComision " + ex.getClass() + ":" + ex.getMessage());
        } finally {
            cargoVOActivos.getViewCriteriaManager().removeApplyViewCriteriaName("CargoVOCriteria");
            //       cargoVOPagadoDispensado.getViewCriteriaManager().removeApplyViewCriteriaName("CargoVOCriteriaDispensadoPagado");
        }
        String valorRetornado = Long.toString(total);
        Integer retornar = Integer.parseInt(valorRetornado);
        return retornar;
    }

    public Integer contadorComisionesMomento(String idOperacion, Integer momentoCobro) {
        Long total = 0L;
        ViewObjectImpl cargoVOActivos = getCargoVO();
        try {
            ViewCriteria criteriaByActivos =
                cargoVOActivos.getViewCriteriaManager().getViewCriteria("CargoVOMomentoCriteria");
            criteriaByActivos.ensureVariableManager().setVariableValue("OperacionId", idOperacion);
            criteriaByActivos.ensureVariableManager().setVariableValue("momentoCobroActual", momentoCobro);
            cargoVOActivos.applyViewCriteria(criteriaByActivos);
            cargoVOActivos.executeQuery();
            total = cargoVOActivos.getEstimatedRowCount();
        } catch (Exception ex) {
            total = 0L;
            //           comisionesDispensadasPagadas=0L;
            logger.log(ADFLogger.ERROR,
                       "Error en contarComisiones segun el momentoCobro " + ex.getClass() + ":" + ex.getMessage());
        } finally {
            cargoVOActivos.getViewCriteriaManager().removeApplyViewCriteriaName("CargoVOMomentoCriteria");
            //       cargoVOPagadoDispensado.getViewCriteriaManager().removeApplyViewCriteriaName("CargoVOCriteriaDispensadoPagado");
        }
        String valorRetornado = Long.toString(total);
        Integer retornar = Integer.parseInt(valorRetornado);
        return retornar;
    }

    public String crearOpinion(String idOperacion) {
        Integer opinion = null;
        String opinionRetornada = null;
        ViewObjectImpl analisisVO = getAnalisisVO();
        Row row;
        try {
            ViewCriteria criteriaByCommType;
            criteriaByCommType = analisisVO.getViewCriteriaManager().getViewCriteria("AnalisisVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);

            analisisVO.applyViewCriteria(criteriaByCommType);
            analisisVO.executeQuery();

            if (analisisVO.getEstimatedRowCount() > 0) {
                row = analisisVO.getRowAtRangeIndex(0);
                opinion = (Integer) row.getAttribute("TipoOpinion");
                opinionRetornada = Integer.toString(opinion);
            }
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en encontrar en la lista " + ex.getClass() + ":" + ex.getMessage());

        } finally {
            //This takes care of removing the applied VC.
            analisisVO.getViewCriteriaManager().removeApplyViewCriteriaName("AnalisisVOCriteria");
        }
        logger.log(ADFLogger.WARNING, ">HNWS Opinion" + opinionRetornada);
        return opinionRetornada;
    }

    public Integer obteneridAnalisis(String idOperacion) {
        Integer opinion = 0;
        Boolean opinionTipo = null;
        ViewObjectImpl analisisVO = getAnalisisVO();
        Row row;
        try {
            ViewCriteria criteriaByCommType;
            criteriaByCommType = analisisVO.getViewCriteriaManager().getViewCriteria("AnalisisVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);
            analisisVO.applyViewCriteria(criteriaByCommType);
            analisisVO.executeQuery();

            if (analisisVO.getEstimatedRowCount() > 0) {
                row = analisisVO.getRowAtRangeIndex(0);
                opinion = (Integer) row.getAttribute("Id");
            }

        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en encontrar en la lista " + ex.getClass() + ":" + ex.getMessage());

        } finally {
            //This takes care of removing the applied VC.
            analisisVO.getViewCriteriaManager().removeApplyViewCriteriaName("AnalisisVOCriteria");
        }
        return opinion;
    }

    public Boolean obtenerJefatura(String idOperacion) {
        Boolean laJefatura = Boolean.FALSE;
        Integer jefatura = 0;
        ViewObjectImpl analisisVO = getAnalisisVO();
        Row row;
        try {
            ViewCriteria criteriaByCommType;
            criteriaByCommType = analisisVO.getViewCriteriaManager().getViewCriteria("AnalisisVOCriteria");
            criteriaByCommType.ensureVariableManager().setVariableValue("varIdOperacion", idOperacion);

            analisisVO.applyViewCriteria(criteriaByCommType);
            analisisVO.executeQuery();

            if (analisisVO.getEstimatedRowCount() > 0) {
                row = analisisVO.getRowAtRangeIndex(0);
                jefatura = (Integer) row.getAttribute("BanValidadoJefatura");
                if (jefatura == BANVALIDADOJEFATURA) {
                    laJefatura = Boolean.TRUE;
                }
            }
        } catch (Exception ex) {
            logger.log(ADFLogger.ERROR, "Error en encontrar en la lista " + ex.getClass() + ":" + ex.getMessage());
        } finally {
            //This takes care of removing the applied VC.
            analisisVO.getViewCriteriaManager().removeApplyViewCriteriaName("AnalisisVOCriteria");
        }
        logger.log(ADFLogger.WARNING, ">HNWS Jefatura" + laJefatura);
        return laJefatura;
    }

    public void llenarMotivos(String idOperacion) {
        Boolean seleccionado = Boolean.FALSE;
        Integer claveDAnalisis = obteneridAnalisis(idOperacion);
        if (claveDAnalisis != 0) {
            ViewObjectImpl tcaMotivos = getTcaMotivo();

            ViewObjectImpl motivosAnalisisVO = getMotivosAnalisisVO();
            try {
                ViewCriteria criteriaByCommType2;
                criteriaByCommType2 =
                    motivosAnalisisVO.getViewCriteriaManager().getViewCriteria("MotivosAnalisisVOCriteria");
                criteriaByCommType2.ensureVariableManager().setVariableValue("varIdAnalisis", claveDAnalisis);

                motivosAnalisisVO.applyViewCriteria(criteriaByCommType2);
                motivosAnalisisVO.executeQuery();
                if (motivosAnalisisVO.getEstimatedRowCount() > 0) {
                    Integer claveTcaMotivo;

                    Row[] motivoSeleccionado = motivosAnalisisVO.getFilteredRows("IdAnalisis", claveDAnalisis);
                    for (Row motivoActual : motivoSeleccionado) {
                        claveTcaMotivo = 0;
                        claveTcaMotivo = (Integer) motivoActual.getAttribute("IdTcaMotivo");
                        Row rowMotivos = tcaMotivos.getRow(new Key(new Object[] { claveTcaMotivo }));
                        rowMotivos.setAttribute("selected", Boolean.TRUE);
                    }
                }
            } catch (Exception ex1) {
                logger.log(ADFLogger.ERROR,
                           "Error en encontrar en la lista " + ex1.getClass() + ":" + ex1.getMessage());
            } finally {
                //This takes care of removing the applied VC.
                motivosAnalisisVO.getViewCriteriaManager().removeApplyViewCriteriaName("AnalisisVOCriteria");
            }

        }
    }

    public Boolean crearAnalisis(Long idOperacion, Boolean tipoOpinion, Boolean isValidadoJefatura,
                                 Boolean isValidadoASJUR, List<Integer> listaMotivos) {
        logger.warning("Operacion " + idOperacion);
        logger.warning("Opinion " + tipoOpinion);
        logger.warning("OperJeacion " + isValidadoJefatura);
        logger.warning("Operacion " + isValidadoASJUR);
        Integer claveDAnalisis = obteneridAnalisis(Long.toString(idOperacion));
        if (claveDAnalisis == 0) {
            ViewObjectImpl analisisVO = getAnalisisVO();

            Row analisisRow = analisisVO.createRow();

            SequenceImpl sqAnalisis = new SequenceImpl("ANALISIS_SEQ", getDBTransaction());
            Number analisisId = sqAnalisis.getSequenceNumber();

            analisisRow.setAttribute(AnalisisVORowImpl.ID, analisisId);
            analisisRow.setAttribute(AnalisisVORowImpl.BANVALIDADOJEFATURA, isValidadoJefatura);
            analisisRow.setAttribute(AnalisisVORowImpl.BANVALIDADOPROYECTOASJUR, isValidadoASJUR);
            analisisRow.setAttribute(AnalisisVORowImpl.TIPOOPINION, tipoOpinion);
            analisisRow.setAttribute(AnalisisVORowImpl.IDOPERACION, idOperacion);

            analisisVO.insertRow(analisisRow);

            if (null != listaMotivos && listaMotivos.size() > 0) {
                ViewObjectImpl motivosAnalisisVO = getMotivosAnalisisVO();
                SequenceImpl sqMotivosAnalisis;

                for (Integer idMotivo : listaMotivos) {
                    Row motivoAnalisisRow = motivosAnalisisVO.createRow();
                    sqMotivosAnalisis = new SequenceImpl("TRE_TCA_MOTIVO_ANALISIS_SEQ", getDBTransaction());
                    Number motivoId = sqMotivosAnalisis.getSequenceNumber();

                    motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.ID, motivoId);
                    motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.IDANALISIS, analisisId);
                    motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.IDTCAMOTIVO, idMotivo);

                    motivosAnalisisVO.insertRow(motivoAnalisisRow);
                }
            }

            getDBTransaction().commit();
            return Boolean.TRUE;
        } else {
            ViewObjectImpl analisisVO = getAnalisisVO();
            Row rowActualizar = analisisVO.getRow(new Key(new Object[] { claveDAnalisis }));
            //rowActualizar.setAttribute("Id", claveDAnalisis);
            rowActualizar.setAttribute("TipoOpinion", tipoOpinion);
            rowActualizar.setAttribute("BanValidadoJefatura", isValidadoJefatura);
            rowActualizar.setAttribute("BanValidadoProyectoAsjur", isValidadoASJUR);
            rowActualizar.setAttribute("IdOperacion", idOperacion);
            analisisVO.setCurrentRow(rowActualizar);
            List<Integer> listaMotivosActuales = new ArrayList<Integer>();

            ViewObjectImpl motivosAnalisisVO = getMotivosAnalisisVO();
            try {
                ViewCriteria criteriaByCommType2;
                criteriaByCommType2 =
                    motivosAnalisisVO.getViewCriteriaManager().getViewCriteria("MotivosAnalisisVOCriteria");
                criteriaByCommType2.ensureVariableManager().setVariableValue("varIdAnalisis", claveDAnalisis);

                motivosAnalisisVO.applyViewCriteria(criteriaByCommType2);
                motivosAnalisisVO.executeQuery();
                if (motivosAnalisisVO.getEstimatedRowCount() > 0) {
                    Integer claveTcaMotivo;
                    Boolean borrarMotivo;
                    Row[] motivoSeleccionado = motivosAnalisisVO.getFilteredRows("IdAnalisis", claveDAnalisis);
                    for (Row motivoActual : motivoSeleccionado) {
                        claveTcaMotivo = 0;
                        borrarMotivo = Boolean.FALSE;
                        claveTcaMotivo = (Integer) motivoActual.getAttribute("IdTcaMotivo");
                        listaMotivosActuales.add(claveTcaMotivo);
                        if (!tipoOpinion) {
                            motivoActual.remove();
                        } else {
                            if (listaMotivos.size() > 0) {
                                for (Integer listaInterna : listaMotivos) {
                                    if (listaInterna == claveTcaMotivo) {
                                        borrarMotivo = Boolean.TRUE;
                                    }
                                }
                                if (!borrarMotivo) {
                                    motivoActual.remove();
                                }
                            }
                        }
                    }
                }
            } catch (Exception ex1) {
                logger.log(ADFLogger.ERROR,
                           "Error en encontrar en la lista " + ex1.getClass() + ":" + ex1.getMessage());
            } finally {
                //This takes care of removing the applied VC.
                motivosAnalisisVO.getViewCriteriaManager().removeApplyViewCriteriaName("AnalisisVOCriteria");
            }
            if (listaMotivosActuales.size() > 0) {
                Boolean agregar;
                for (Integer valorMotivo : listaMotivos) {
                    agregar = Boolean.TRUE;
                    for (Integer listaACtual : listaMotivosActuales) {
                        if (valorMotivo == listaACtual) {
                            agregar = Boolean.FALSE;
                        }
                    }
                    if (agregar) {
                        Row motivoAnalisisRow = motivosAnalisisVO.createRow();
                        SequenceImpl sqMotivosAnalisis;
                        sqMotivosAnalisis = new SequenceImpl("TRE_TCA_MOTIVO_ANALISIS_SEQ", getDBTransaction());
                        Number motivoId = sqMotivosAnalisis.getSequenceNumber();

                        motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.ID, motivoId);
                        motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.IDANALISIS, claveDAnalisis);
                        motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.IDTCAMOTIVO, valorMotivo);

                        motivosAnalisisVO.insertRow(motivoAnalisisRow);
                    }
                }
            } else {
                if (listaMotivos.size() > 0) {
                    for (Integer idMotivo : listaMotivos) {
                        SequenceImpl sqMotivosAnalisis;
                        Row motivoAnalisisRow = motivosAnalisisVO.createRow();
                        sqMotivosAnalisis = new SequenceImpl("TRE_TCA_MOTIVO_ANALISIS_SEQ", getDBTransaction());
                        Number motivoId = sqMotivosAnalisis.getSequenceNumber();

                        motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.ID, motivoId);
                        motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.IDANALISIS, claveDAnalisis);
                        motivoAnalisisRow.setAttribute(MotivosAnalisisVORowImpl.IDTCAMOTIVO, idMotivo);

                        motivosAnalisisVO.insertRow(motivoAnalisisRow);
                    }
                }
            }
            getDBTransaction().commit();
            return Boolean.TRUE;
        }
    }
    
    public Map validarCondicionesFormalizacion(Long idOperacion) {
        return validarCondicionesFormalizacion(idOperacion,null);
        
        
        }
    public Map validarCondicionesFormalizacion(Long idOperacion,Long idContrato) {
      Long  idContratoOP;
        HashMap<String, ValidarTCCResponseType> respuestaServicio = null;
        ValidarTCCRequestType request = null;
        ValidarTCCResponseType response = null;

        try {
            String wsdl = getWsdl(IWsdlLocation.MATRIZ);

            MatrizTCC12BndQSService matrizTCC12BndQSService =
                IWsdlLocation.Service.getInstance(MatrizTCC12BndQSService.class, wsdl);
            MatrizTCCPT matrizTccPT = matrizTCC12BndQSService.getMatrizTCC12BndQSPort();
            request = new ValidarTCCRequestType();


            request.setIdOperacion(idOperacion);
            logger.warning("Try validarCondicionesFormalizacion idOperacion: "+idOperacion);
            request.setIdEvento(1);
            request.setIdProceso(5);
            /*
             * jenamorado 09/09/2020
             * se agrego idcontrato 
             * */
            idContratoOP =( null==idContrato? new Long(0) : idContrato);
            request.setIdContrato(idContratoOP.intValue());
            logger.warning("Try validarCondicionesFormalizacion idContrato : "+idContratoOP.intValue());
            Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.VALIDAR_CONDICIONES_FORMALIZACION);
            response = matrizTccPT.validarTCC(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.VALIDAR_CONDICIONES_FORMALIZACION, horaInicio);

            respuestaServicio = new HashMap<String, ValidarTCCResponseType>();
            respuestaServicio.put("response", response);
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al validar las condiciones de formalización, favor de intentar más tarde."));
            throw ex;
        }

        return respuestaServicio;
    }

    /**
     * Container's getter for AdjuntarContratoFirmadoVO1.
     * @return AdjuntarContratoFirmadoVO1
     */
    public AdjuntarContratoFirmadoVOImpl getAdjuntarContratoFirmadoVO() {
        return (AdjuntarContratoFirmadoVOImpl) findViewObject("AdjuntarContratoFirmadoVO");
    }

    /**
     * Container's getter for TcaAccionASeguirLOV1.
     * @return TcaAccionASeguirLOV1
     */
    public TcaAccionASeguirLOVImpl getTcaAccionASeguirLOV1() {
        return (TcaAccionASeguirLOVImpl) findViewObject("TcaAccionASeguirLOV1");
    }

    /**
     * Container's getter for TipoDecisionOperacionLOV1.
     * @return TipoDecisionOperacionLOV1
     */
    public ViewObjectImpl getTipoDecisionOperacionLOV1() {
        return (ViewObjectImpl) findViewObject("TipoDecisionOperacionLOV1");
    }

    /**
     * Inicia las consultas para la consolidacion de decision
     * @param idOperacion contiene id de operacion
     * @param idSolicitudAprob cotiene id de solicitud aprobacion
     * @param idNivelAprob contiene id de nivel de aprobacion
     * @param tipoSolicitud contiene id del tipo de solicitud
     * @param tipoReunion contiene id del tipo de reunion
     */
    public void iniciaConsolidarDecision(Long idOperacion, Long idSolicitudAprob, Integer idNivelAprob,
                                         Integer tipoSolicitud, Integer tipoReunion) {

        //Inicializa lista de accion a seguir
        try {
            getTcaAccionASeguirLOV1().buscarPorNivelYTipoSol(new Number(idNivelAprob), tipoSolicitud);
        } catch (SQLException e) {
            logger.severe("Error al buscar lista de accion a seguir", e);
        }

        //Inicializa VO de Solicitud Aprobacion

        if (idSolicitudAprob != null && idOperacion != null) {

            getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorId(new Number(idSolicitudAprob),
                                                                       new Number(idOperacion));

            SolicitudAprobacionVORowImpl solRow =
                (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();
            if (solRow != null) {
                logger.warning("Busca registros de Decision para la Solicitud de Aprobacion");
                getDecisionReunionAprobacionVO().buscarDecisionPorIdSolicitud(solRow.getId());
                DecisionReunionAprobacionVORowImpl decRow =
                    (DecisionReunionAprobacionVORowImpl) getDecisionReunionAprobacionVO().getCurrentRow();
                if (decRow != null) {

                    Number idTcaAccion = decRow.getIdTcaAccionASeguir();
                    logger.warning("Existe registro de Decision para la Solicitud de Aprobacion");

                    if (idTcaAccion != null) {

                        logger.warning("Id de Accion de la Decision: " + idTcaAccion);

                        //Asigna current row de la lista de acciones
                        if (getTcaAccionASeguirLOV1().getEstimatedRowCount() > 0) {

                            logger.warning("Configura Lista de Acciones con el Id de Accion de la Decision");
                            TcaAccionASeguirLOVRowImpl rowLov = null;
                            RowSetIterator iter = getTcaAccionASeguirLOV1().createRowSetIterator(null);
                            iter.reset();
                            while (iter.hasNext()) {
                                rowLov = (TcaAccionASeguirLOVRowImpl) iter.next();
                                if (rowLov.getId().equals(idTcaAccion)) {
                                    logger.warning("Asigna current row de la Lista del catalogo de Acciones");
                                    getTcaAccionASeguirLOV1().setCurrentRow(rowLov);
                                    break;
                                }
                            }
                            iter.closeRowSetIterator();
                        }
                    } else {
                        logger.warning("El registro de Decision no tiene Id de Accion que configurar");
                    }
                }
            } else {
                logger.severe("Error registro de Solicitud de Aprobacion no encontrado");
            }
        }

        if (tipoReunion != null) {
            if (tipoReunion.equals(TIPO_REUNION_VIRTUAL)) {

                //Inicializa consulta para votos actuales de aprobacion
                initSeguimientoVotacionVirtual(idSolicitudAprob, idOperacion);
            }
        }
    }

    /**
     * Inicia las consultas para la consolidacion de decision por cliente
     * @param idCliente contiene id de cliente
     * @param idSolicitudAprob cotiene id de solicitud aprobacion
     * @param idNivelAprob contiene id de nivel de aprobacion
     * @param tipoSolicitud contiene id del tipo de solicitud
     * @param tipoReunion contiene id del tipo de reunion
     */
    public void iniciaConsolidarDecisionCliente(Long idCliente, Long idSolicitudAprob, Integer idNivelAprob,
                                                Integer tipoSolicitud, Integer tipoReunion) {

        //Inicializa lista de accion a seguir
        try {
            getTcaAccionASeguirLOV1().buscarPorNivelYTipoSol(new Number(idNivelAprob), tipoSolicitud);
        } catch (SQLException e) {
            logger.severe("Error al buscar lista de accion a seguir", e);
        }

        //Inicializa VO de Solicitud Aprobacion

        if (idSolicitudAprob != null && idCliente != null) {

            inicializarDatosReunionCliente(idSolicitudAprob, idCliente);

            SolicitudAprobacionVORowImpl solRow =
                (SolicitudAprobacionVORowImpl) getSolicitudAprobacionVO1().getCurrentRow();
            if (solRow != null) {
                logger.warning("Busca registros de Decision para la Solicitud de Aprobacion");
                getDecisionReunionAprobacionVO().buscarDecisionPorIdSolicitud(solRow.getId());
                DecisionReunionAprobacionVORowImpl decRow =
                    (DecisionReunionAprobacionVORowImpl) getDecisionReunionAprobacionVO().getCurrentRow();
                if (decRow != null) {

                    Number idTcaAccion = decRow.getIdTcaAccionASeguir();
                    logger.warning("Existe registro de Decision para la Solicitud de Aprobacion");

                    if (idTcaAccion != null) {

                        logger.warning("Id de Accion de la Decision: " + idTcaAccion);

                        //Asigna current row de la lista de acciones
                        if (getTcaAccionASeguirLOV1().getEstimatedRowCount() > 0) {

                            logger.warning("Configura Lista de Acciones con el Id de Accion de la Decision");
                            TcaAccionASeguirLOVRowImpl rowLov = null;
                            RowSetIterator iter = getTcaAccionASeguirLOV1().createRowSetIterator(null);
                            iter.reset();
                            while (iter.hasNext()) {
                                rowLov = (TcaAccionASeguirLOVRowImpl) iter.next();
                                if (rowLov.getId().equals(idTcaAccion)) {
                                    logger.warning("Asigna current row de la Lista del catalogo de Acciones");
                                    getTcaAccionASeguirLOV1().setCurrentRow(rowLov);
                                    break;
                                }
                            }
                            iter.closeRowSetIterator();
                        }
                    } else {
                        logger.warning("El registro de Decision no tiene Id de Accion que configurar");
                    }
                }
            } else {
                logger.severe("Error registro de Solicitud de Aprobacion no encontrado");
            }
        }

        if (tipoReunion != null) {
            if (tipoReunion.equals(TIPO_REUNION_VIRTUAL)) {

                //Ejecuta la consulta de miembros de la reunion por Id de Solicitud Aprobacion
                getUsuarioReunionAprobacionLOV().consultarUsuarioReunionPorIdSolicitud(idSolicitudAprob);

                if (getUsuarioReunionAprobacionLOV().getEstimatedRowCount() > 0) {
                    logger.warning("Cantidad de Registros de Usuario Reunion Aprobacion encontrados: " +
                                   getUsuarioReunionAprobacionLOV().getEstimatedRowCount());
                }

                //Obtiene miembros votantes
                List<UsuarioReunionAprobacionLOVRowImpl> rowsIdUsuReunion = null;
                rowsIdUsuReunion = obtenerIdMiembrosVotantes();

                if (rowsIdUsuReunion != null) {
                    logger.warning("Cantidad de Id de Usuario Reunion Aprobacion para obtener votos: " +
                                   rowsIdUsuReunion.size());
                }

                //Busca los votos de los miembros
                //getVotoActualAprobLOV1().obtenerVotosReunion(rowsIdUsuReunion);
                getVotoActualAprobLOV1().buscarPorIdSolicitud(new Number(idSolicitudAprob));
                if (getVotoActualAprobLOV1().getEstimatedRowCount() > 0) {
                    logger.warning("Cantidad de Registros de Votos Actuales: " +
                                   getVotoActualAprobLOV1().getEstimatedRowCount());
                } else {
                    logger.warning("No se encontraron registros de votos actuales");
                }
            }
        }
    }

    /**
     * Guarda los datos de Consolidar Decision
     * @param idSolicitudAprob contiene id de solicitud de aprobacion
     * @param idTipoAccion contiene id de accion a seguir
     * @param numActa contiene numero de acta
     * @param numAcuerdo contiene numero de acuerdo
     * @param acuerdo contiene descripcion de acuerdo
     * @param userName contiene nombre de usuario en session
     * @return devuelve valor booleano, true si el guardado fue exitoso o false en caso
     *         contrario
     */
    public boolean guardarConsolidarDecision(Number idSolicitudAprob, Number idTipoAccion, String numActa,
                                             String numAcuerdo, String acuerdo, String userName) {

        logger.warning("Inicia metodo guardarConsolidarDecision");

        logger.entering(FenixAMImpl.class.getName(), "guardarConsolidarDecision", new Object[] {
                        idSolicitudAprob, idTipoAccion, numActa, numAcuerdo, acuerdo
        });

        boolean esExito = false;

        if (getDecisionReunionAprobacionVO() != null) {
            DecisionReunionAprobacionVORowImpl row =
                getDecisionReunionAprobacionVO().crearRegistro(idSolicitudAprob, idTipoAccion, numActa, numAcuerdo,
                                                               acuerdo, userName);
            //Valida registro
            if (row != null) {
                try {
                    getTransaction().commit();
                    esExito = true;
                } catch (Exception e) {
                    logger.severe("Error al realizar Commit", e);
                }

                if (!esExito) {
                    try {
                        getTransaction().rollback();
                    } catch (Exception e) {
                        logger.severe("Error al realizar Rollback", e);
                    }
                }
            } else {
                logger.severe("Registro no creado");
            }
        } else {
            logger.severe("Error al obtener Instancia de VO Decision Reunion Aprobacion");
        }

        logger.entering(FenixAMImpl.class.getName(), "guardarConsolidarDecision", new Object[] { esExito });

        logger.warning("termina metodo guardarConsolidarDecision");
        return esExito;
    }


    /**
     * Comienza - PC05Formalizacion - Registrar datos de linea de credito
     **/
    public void consultarLineaCredito(String idOperacion, String instanciaProceso, Integer idProducto,
                                      Boolean solicitudContratacion) {
        logger.warning("Inside consultarLineaCredito.");
        logger.warning("idOperacion: " + idOperacion);
        logger.warning("instanciaProceso: " + instanciaProceso);
        logger.warning("idProducto: " + idProducto);
        logger.warning("solicitudContratacion: " + solicitudContratacion);
        List<String> listaCuentaCliente = new ArrayList<String>();
        List<String> listaCuentaClienteAux = new ArrayList<String>();

        String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);

        com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito12BndQSService =
            IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
        com.bcie.xmlns.lineacreditoservice.LineaCreditoPT lineaCreditoPT =
            lineaCredito12BndQSService.getLineaCredito12Bnd();

        try {
            logger.log(ADFLogger.WARNING, ">HNWS lineaCreditoPT.toString()" + lineaCreditoPT.toString());
            org.bcie.lineacreditomo.ConsultarLineaCreditoRequestType request =
                new org.bcie.lineacreditomo.ConsultarLineaCreditoRequestType();
            //se agrega los parametros al request idOperacion e instanciaProceso
            request.setIdOperacion(Long.parseLong(idOperacion));


            //Recupera el contrato por idOperacion e InstanciaProceso
            ContratoVORowImpl contratoRow =
                getContratoVO().getContratoByOperacionInstanciaProceso(Long.parseLong(idOperacion), instanciaProceso);

            if (null != contratoRow) {
                logger.warning("contratoRow diferente de nulo");

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_LINEA_CREDITO);
                org.bcie.lineacreditomo.ConsultarLineaCreditoResponseType response =
                    lineaCreditoPT.consultarLineaCredito(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CONSULTAR_LINEA_CREDITO, horaInicio);

                // Se limpia CatCuentaClienteLOV antes de ser llenarla, para FNXII-6178
                getCatCuentaClienteLOV().executeQuery();

                for (Contrato contrato : response.getClienteContrato()) {
                    logger.warning("idContratoRow : " + contratoRow.getId());
                    logger.warning("idContratoRespone : " + contrato.getIdContrato());
                    if (contrato.getIdContrato() == contratoRow.getId()) {
                        logger.warning("idContrato: " + contrato.getIdContrato() + " es igual a  idContrato : " +
                                       contratoRow.getId());
                        listaCuentaClienteAux = mappingEncabezadoRegistrarDatosLineaCredito(contrato);
                        listaCuentaCliente.addAll(listaCuentaClienteAux);
                        break;
                    }
                }
                logger.warning("numero de cuentas : " + listaCuentaCliente.size());
                if (listaCuentaCliente.size() > 0) {
                    agregarCuentaClienteNoRepetida(listaCuentaCliente);
                } else {
                    logger.warning("No se recuperaron cuentas del cliente.");
                }
                mappingConsultarLineaCredito(response.getClienteContrato(), response.getLineaCreditoAsociada(),
                                             idProducto);

                logger.log(ADFLogger.TRACE,
                           "Resultado de ConsultarLineaCredito :" + response.getResultado().getResult().toString());
                logger.log(ADFLogger.TRACE,
                           "Mensaje de ConsultarLineaCredito :" + response.getResultado().getMessage().toString());

            } else {
                logger.severe("No se encontro un contrato con idOperacion : " + idOperacion + " instanciaProceso : " +
                              instanciaProceso);
            }
        } catch (Exception e) {
            logger.warning("Ocurrio un error en consultarLineaCredito", e);
        }

    }

    public List<String> mappingEncabezadoRegistrarDatosLineaCredito(Contrato contrato) {
        EncabezadoRegistrarDatosLineaCreditoVORowImpl encabezadoRegistrarDatosLineaCreditoVO =
            (EncabezadoRegistrarDatosLineaCreditoVORowImpl) getEncabezadoRegistrarDatosLineaCreditoVO().createRow();
        //CuentaClienteVO
        CatCuentaClienteLOVRowImpl catCuentaCliente = null;
        List<String> listaCuentaCliente = new ArrayList<String>();
        try {
            /*****Datos del cliente*****/
            //Catalogo de cuentas del cliente
            //Se comenta codigo ya que se crea metodo para validar que no existan cuentas de cliente repetidas
            if (contrato.getCuentaCliente() != null) {
                listaCuentaCliente = contrato.getCuentaCliente().getCuentaCliente();
            }

            /*****Datos de escrituración*****/
            //Fecha de escrituración
            if (contrato.getFechaFirma() != null) {
                GregorianCalendar fechaEscrituracion = contrato.getFechaFirma().toGregorianCalendar();
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.FECHAESCRITURACION,
                                                                    new java.sql.Timestamp(fechaEscrituracion.getTimeInMillis()));
            }
			//Id Tipo Moneda
            if(contrato.getIdTipoMonedaMontoEscriturado()!=null){
                Integer idTipoMoneda = contrato.getIdTipoMonedaMontoEscriturado().intValue();
                logger.warning("IdTipoMonedaMontoEscriturado: " + idTipoMoneda);
                idTipoMoneda = idTipoMoneda - 1;
                logger.warning("IdTipoMonedaMontoEscriturado IdTipoMonedaMontoEscriturado: " + idTipoMoneda);
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(
                    EncabezadoRegistrarDatosLineaCreditoVORowImpl.IDTIPOMONEDA,
                        idTipoMoneda);
            }
            //Monto escriturado
            if (contrato.getMontoEscriturado() != null) {
                logger.warning("[CONTRATO.ID_OPERACION (I)]: " + contrato.getIdOperacion());
                BigDecimal montoEscrituradoTmp=modificaMontoAmpliacion(contrato.getIdOperacion());
                if(montoEscrituradoTmp!=null){//Unicamente cuando la operacion es ampliacion de la anterior
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.MONTOESCRITURADO,
                                                                    montoEscrituradoTmp);
                }else{
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.MONTOESCRITURADO,
                                                                    contrato.getMontoEscriturado());
                }
            }
            //IdContrato
            if (contrato.getIdContrato() > 0) {
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.IDCONTRATO,
                                                                    contrato.getIdContrato());
            } else {
                logger.warning("IDCONTRATO con valor 0 en respuesta de servicio.");
            }
            //[KB:14513] Fecha Valor
            if (contrato.getFechaValor() != null) {
                GregorianCalendar fechaValor = contrato.getFechaValor().toGregorianCalendar();
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.FECHAVALOR,
                                                                    new java.sql.Timestamp(fechaValor.getTimeInMillis()));
            }
            //Agrega el Row del encabezado
            getEncabezadoRegistrarDatosLineaCreditoVO().insertRow(encabezadoRegistrarDatosLineaCreditoVO);
            getEncabezadoRegistrarDatosLineaCreditoVO().setCurrentRow(encabezadoRegistrarDatosLineaCreditoVO);
        } catch (Exception e) {
            logger.warning("Ocurio un error en mappingEncabezadoRegistrarDatosLineaCredito", e);
        }
        return listaCuentaCliente;
    }

    private Boolean agregarCuentaClienteNoRepetida(List<String> listaCuentaCliente) {
        logger.warning("Entra en agregarCuentaClienteNoRepetida");
        List<String> listaCuentaMayuscula = new ArrayList<String>();
        CatCuentaClienteLOVRowImpl catCuentaCliente = null;
        Boolean esDatosCorrectos = Boolean.TRUE;
        try {
            //Convierte las cadenas a mayusculas en caso de que llegue alguna con minusculas
            logger.warning("Convierte las cadenas a mayusculas en caso de que llegue alguna con minusculas.");
            for (String cuentaMayuscula : listaCuentaCliente) {
                cuentaMayuscula = cuentaMayuscula.toUpperCase();
                listaCuentaMayuscula.add(cuentaMayuscula);
            }
            //Se limpia la lista de cuentas de cliente para ignorar los elementos repetidos,se atiende incidencia
            //FNXII-6542.
            Set<String> listaCuentaSinRepetir = new HashSet<>();
            logger.warning("Tamaño de la lista sin limpiar : " + listaCuentaMayuscula.size());
            listaCuentaSinRepetir.addAll(listaCuentaMayuscula);
            listaCuentaMayuscula.clear();
            listaCuentaMayuscula.addAll(listaCuentaSinRepetir);
            logger.warning("Nuevo tamaño de la lista limpiando repetidas : " + listaCuentaMayuscula.size());
            //Se inserta los rows una vez que se ha limpiado la lista de cuentas repetidas.
            for (String cuentaCliente : listaCuentaMayuscula) {
                catCuentaCliente = null;
                catCuentaCliente = (CatCuentaClienteLOVRowImpl) getCatCuentaClienteLOV().createRow();
                catCuentaCliente.setAttribute(CatCuentaClienteLOVRowImpl.CUENTACLIENTE, cuentaCliente);
                getCatCuentaClienteLOV().insertRow(catCuentaCliente);
                getCatCuentaClienteLOV().setCurrentRow(catCuentaCliente);
            }
        } catch (Exception e) {
            logger.warning("Error al convertir las cuentas a mayusculas.", e);
        }
        return esDatosCorrectos;
    }

    public void mappingConsultarLineaCredito(List<Contrato> listaContrato, List<LineaCredito> listaLineaCreditoAsociada,
                                             Integer idProducto) {
        logger.warning("Inside mappingConsultarLineaCredito.");
        DatosLineaCreditoVORowImpl datosLineaCreditoVO = null;
        try {
            //Recoremos la lista de contratos
            for (Contrato contrato : listaContrato) {
                //Recoremos la lista de lineas de credito
                if (contrato.getLineaCredito() != null) {
                    List<LineaCredito> listaLineaCredito = contrato.getLineaCredito();
                    Boolean lineaCreditoIfi = Boolean.FALSE;
                    logger.warning(">>> Se recuperaron " + listaLineaCredito.size() + " linea(s) de credito");
                    for (LineaCredito lineaCredito : listaLineaCredito) {
                        datosLineaCreditoVO = null;
                        datosLineaCreditoVO = (DatosLineaCreditoVORowImpl) getDatosLineaCreditoVO().createRow();

                        // Se agrega por FNXII-6675
                        datosLineaCreditoVO.setNewRowState(Row.STATUS_INITIALIZED);

                        //Id de linea de credito
                        if (lineaCredito.getIdLineaCredito() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.ID,
                                                             lineaCredito.getIdLineaCredito());
                        }
                        //Numero de linea de credito
                        if (lineaCredito.getNumeroLineaCredito() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.NUMEROLINEACREDITO,
                                                             lineaCredito.getNumeroLineaCredito());
                        }
                        //Fondo contable
                        if (lineaCredito.getFondo() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.FONDO, lineaCredito.getFondo());
                        }
                        //id tipo moneda de Monto de la linea
                        //id tipo moneda de Monto Total
                        if(lineaCredito.getIdTipoMonedaMontoLinea() != null){
                            Integer idTipoMoneda = lineaCredito.getIdTipoMonedaMontoLinea().intValue();
                            
                            logger.warning("Id Tipo de Moneda Monto Linea: " + idTipoMoneda);
                            logger.warning("Id Tipo de Moneda Total: " + idTipoMoneda);
                            
                             idTipoMoneda = idTipoMoneda - 1;
                            
                            logger.warning("Id Tipo de Moneda Monto Linea: " + idTipoMoneda);
                            logger.warning("Id Tipo de Moneda Total: " + idTipoMoneda);
                            
                            datosLineaCreditoVO.setAttribute(
                                DatosLineaCreditoVORowImpl.IDTIPOMONEDAMONTOLINEA, idTipoMoneda);
                            
                            datosLineaCreditoVO.setAttribute(
                                DatosLineaCreditoVORowImpl.IDTIPOMONEDAMONTOTOTAL, idTipoMoneda);
                        }
                        //Monto de la linea
                        if (lineaCredito.getMontoLinea() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.MONTOLINEA,
                                                             lineaCredito.getMontoLinea());
                        }
                        //Id flexcube
                        if (lineaCredito.getFlexcube().getId() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.IDFLEXCUBE,
                                                             lineaCredito.getFlexcube().getId());
                        }
                        //Descripcion de linea de credito
                        //Se agrega la descripcion de la linea de credito por FNXII-3145
                        if (lineaCredito.getDescripcion() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.DESCRIPCION,
                                                             lineaCredito.getDescripcion());
                        }

                        //Se agrega valor a LineaGlobalIfi
                        datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.LINEAGLOBALIFI, lineaCreditoIfi);

                        //agregar row de datosLineaCreditoVO
                        getDatosLineaCreditoVO().insertRow(datosLineaCreditoVO);
                    }
                } else {
                    logger.warning(">>> No se recuperaron lineas de credito");
                }

            } //for(Contrato contrato : listaContrato)

            /*****Linea de credito asociada*****/

            //if (idProducto.compareTo(FenixModelConstants.AMPLIACION_LGC_IFI) == 0) { <-- Se comenta por FNXII-5569
            Boolean lineaAsociadaIfi = Boolean.TRUE;
            if (listaLineaCreditoAsociada != null) {
                logger.warning(">>> Se recuperaron " + listaLineaCreditoAsociada.size() +
                               " linea(s) de credito asociadas");
                for (LineaCredito lineaCreditoAsociada : listaLineaCreditoAsociada) {
                    if (lineaCreditoAsociada.getIdContrato() != null) {
                        datosLineaCreditoVO = null;
                        datosLineaCreditoVO = (DatosLineaCreditoVORowImpl) getDatosLineaCreditoVO().createRow();
                        //Id de linea de credito
                        if (lineaCreditoAsociada.getIdLineaCredito() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.ID,
                                                             lineaCreditoAsociada.getIdLineaCredito());
                        }
                        //Numero de linea de credito
                        if (lineaCreditoAsociada.getNumeroLineaCredito() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.NUMEROLINEACREDITO,
                                                             lineaCreditoAsociada.getNumeroLineaCredito());
                        }
                        //Fondo contable
                        if (lineaCreditoAsociada.getFondo() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.FONDO,
                                                             lineaCreditoAsociada.getFondo());
                        }
                        //Monto de la linea
                        if (lineaCreditoAsociada.getMontoLinea() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.MONTOLINEA,
                                                             lineaCreditoAsociada.getMontoLinea());
                        }
                        //Id flexcube
                        if (lineaCreditoAsociada.getFlexcube() != null) {
                            if (lineaCreditoAsociada.getFlexcube().getId() != null) {
                                datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.IDFLEXCUBE,
                                                                 lineaCreditoAsociada.getFlexcube().getId());
                            }
                        }

                        //Descripcion de linea de credito
                        //Se agrega la descripcion de la linea de credito por FNXII-3145
                        if (lineaCreditoAsociada.getDescripcion() != null) {
                            datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.DESCRIPCION,
                                                             lineaCreditoAsociada.getDescripcion());
                        }

                        //Se agrega el id de contrato para FNXII-6654
                        datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.IDCONTRATO,
                                                         lineaCreditoAsociada.getIdContrato());
                        datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.IDOPERACION,
                                                         lineaCreditoAsociada.getIdOperacion());

                        //Se agrega valor a LineaGlobalIfi
                        datosLineaCreditoVO.setAttribute(DatosLineaCreditoVORowImpl.LINEAGLOBALIFI, lineaAsociadaIfi);

                        //agregar row de datosLineaCreditoVO
                        getDatosLineaCreditoVO().insertRow(datosLineaCreditoVO);
                    } else {
                        logger.warning("Linea Asociada sin Id - Vacia.");
                    }
                }
            } else {
                logger.warning(">>> No se recuperaron lineas de credito asociadas");
            }

            //} <-- Se comenta por FNXII-5569
        } catch (Exception e) {
            logger.warning("Ocurio un error en mappingConsultarLineaCredito", e);
        }
    }

    public void consultarLineaCreditoByIdLineaCredito(String idOperacion, String instanciaProceso, Long idLineaCredito,
                                                      Integer idProducto, String idTarea,
                                                      Boolean solicitudContratacion) {
        logger.warning("Inside consultarLineaCreditoByIdLineaCredito.");
        logger.warning("idOperacion : " + idOperacion);
        logger.warning("instanciaProceso : " + instanciaProceso);
        logger.warning("idLineaCredito : " + idLineaCredito);
        logger.warning("idProducto : " + idProducto);
        logger.warning("idTarea : " + idTarea);
        logger.warning("solicitudContratacion: " + solicitudContratacion);

        String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);

        com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito12BndQSService =
            IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
        com.bcie.xmlns.lineacreditoservice.LineaCreditoPT lineaCreditoPT =
            lineaCredito12BndQSService.getLineaCredito12Bnd();
        try {
            logger.log(ADFLogger.WARNING, ">HNWS" + lineaCreditoPT.toString());
        } catch (Exception ex) {
        }
        org.bcie.lineacreditomo.ConsultarLineaCreditoRequestType request =
            new org.bcie.lineacreditomo.ConsultarLineaCreditoRequestType();
        //se agrega los parametros al request idOperacion e instanciaProceso
        //idOperacion
        request.setIdOperacion(Long.parseLong(idOperacion));


        try {

            //Recupera el contrato por idOperacion e InstanciaProceso
            ContratoVORowImpl contratoRow =
                getContratoVO().getContratoByOperacionInstanciaProceso(Long.parseLong(idOperacion), instanciaProceso);

            if (null != contratoRow) {
                Date horaInicio =
                    ModelUtils.logStartWS(logger, request,
                                          FenixModelConstants.WSC_CONSULTAR_LINEA_CREDITO_BY_ID_LINEA_CREDITO);
                org.bcie.lineacreditomo.ConsultarLineaCreditoResponseType response =
                    lineaCreditoPT.consultarLineaCredito(request);
                ModelUtils.logEndWS(logger, response,
                                    FenixModelConstants.WSC_CONSULTAR_LINEA_CREDITO_BY_ID_LINEA_CREDITO, horaInicio);
                //Recupera la lista de lineas de credito,Se envia el idLineaCredito para filtrar y
                //recuperar solo los datos de la lineaCredito que se selecciono en la vista.
                //Manda idProducto para ejecutar el query de CatProductoFlexcubeLOV
                //Invoca el metodo mappingConsultarLineaCredito
                for (Contrato contrato : response.getClienteContrato()) {
                    logger.warning("idContratoRow : " + contratoRow.getId());
                    logger.warning("idContratoRespone : " + contrato.getIdContrato());
                    logger.warning("idContrato: " + contrato.getIdContrato() + " es igual a  idContrato : " +
                                   contratoRow.getId());
                    mappingConsultarLineaCredito(response.getClienteContrato(), idLineaCredito, idProducto,
                                                 contrato.getFechaVigencia(), idTarea,
                                                 response.getLineaCreditoAsociada());
                }

            } else {

                logger.severe("No se encontro un contrato con idOperacion : " + idOperacion + " instanciaProceso : " + 
                              instanciaProceso);
            }
            logger.log(ADFLogger.WARNING, "*****LLAMADO_CUANDO_GUARDA****");
            logger.warning("i-> : " + contratoRow.getId());
            //mappingComplementoLineaCredito(contratoRow.getId());
            logger.log(ADFLogger.WARNING, "*****LLAMADO_CUANDO_GUARDA_FIN****");
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    public void mappingConsultarLineaCredito(List<Contrato> listaContrato, Long idLineaCredito, Integer idProducto,
                                             XMLGregorianCalendar fechaVigencia, String idTarea,
                                             List<LineaCredito> listaLineaCreditoAsociada) {
        logger.log(ADFLogger.WARNING, "Into mappingConsultarLineaCredito");
        //VO de datosLineaCredito
        //Limpiar VO
        getRegistrarDatosLineaCreditoVO().executeQuery();
        //Inicialisar VO
        RegistrarDatosLineaCreditoVORowImpl registrarDatosLineaCreditoVO = null;
        //Inicialisar VO vencimientos
        VencimientoPlazoVORowImpl vencimientoPlazoVO = null;
        //Inicialisar VO comisiones
        ComisionVORowImpl comisionVO = null;
        //Variable para generar "id" dentro de vencimientos y comisiones
        Integer idAux = null;

        //Recorrer todos los contratos
        for (Contrato contrato : listaContrato) {

            //Validar que la listaLineaCredito no venga "null"
            if (contrato.getLineaCredito() != null) {

                //Recorrer las linea de credito
                //Iterar los objetos de lineaCredito que se encuentran en listaLineaCredito
                for (LineaCredito lineaCredito :
                     contrato.getLineaCredito()) {
                    //Validar que idLineaCredito sea el mismo al del objecto lineaCredito
                    //para recuperar sus valores.
                    if (lineaCredito.getIdLineaCredito().equals(idLineaCredito)) {
                        //Crear el Row de registrarDatosLineaCreditoVO
                        registrarDatosLineaCreditoVO =
(RegistrarDatosLineaCreditoVORowImpl) getRegistrarDatosLineaCreditoVO().createRow();

                        // Se agrega por FNXII-6675
                        registrarDatosLineaCreditoVO.setNewRowState(Row.STATUS_INITIALIZED);

                        //CatFondoContableVO
                        CatFondoContableVOImpl catFondoContableVOImpl = getCatFondoContableVO();
                        //CatProductoFLexcubeLOV
                        CatProductoFlexcubeLOVImpl catProductoFlexcubeLOVImpl = getCatProductoFlexcubeLOV();
                        /*****IdLineaCredito*****/
                        //Recupera el id de la linea de credito
                        if (lineaCredito.getIdLineaCredito() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ID,
                                                                      lineaCredito.getIdLineaCredito());
                            
                        }


                        /*****Información general*****/
                        //Numero de linea
                        if (lineaCredito.getNumeroLineaCredito() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.NUMEROLINEACREDITO,
                                                                      lineaCredito.getNumeroLineaCredito());
                        }
                        //Fondo contable
                        if (lineaCredito.getFondo() !=
                            null) {
                            //Recuperar el Row apartir de "CodeDesc" == lineaCredito.getFondo()
                            Row[] rowCatFondoContable =
     getCatFondoContableVO().getFilteredRows("CodeDesc", lineaCredito.getFondo());
 //Iterar el Row, Siempre va ser 1 Row
 for (Row row : rowCatFondoContable) {
     //Hacer el row filtrado el CurrentRow en vista
     getCatFondoContableVO().setCurrentRow(row);
                            }

                        }
                        //Es revolvente
                        if (lineaCredito.isEsRevolvente() != null) {
                            logger.log(ADFLogger.WARNING, "valor isRevolvente:" + lineaCredito.isEsRevolvente());
                            logger.log(ADFLogger.WARNING, "valor idProducto:" + idProducto);
                            //Ejecutar query de CatProductoFlexcubeLOV
                            //Se asigna el valor del idProducto(Parametro de entrada del taskFlow)

                            if (idTarea.equals(FenixModelConstants.ID_TAREA_VALIDAR_LINEA_CREDITO) ||
                                idTarea.equals(FenixModelConstants.ID_TAREA_REGISTRAR_LINEA_CREDITO)) {

                                catProductoFlexcubeLOVImpl.setidProducto(idProducto);
                                catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
                            } else {
                                if (!lineaCredito.getFlexcube().getIdProductoFlexcube().isEmpty()) {
                                    logger.log(ADFLogger.WARNING,
                                               "valor IdProductoFlexcube:" +
                                               lineaCredito.getFlexcube().getIdProductoFlexcube());
                                    catProductoFlexcubeLOVImpl.setidProductoFlexcube(lineaCredito.getFlexcube().getIdProductoFlexcube());
                                    catProductoFlexcubeLOVImpl.setidProducto(null);
                                } else {
                                    catProductoFlexcubeLOVImpl.setidProducto(idProducto);
                                    catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
                                }
                            }

                            //Revolvente púede ser 'Y' o 'N'
                            //Si isEsRevolvente == true --> 'Y'
                            if (lineaCredito.isEsRevolvente()) {
                                catProductoFlexcubeLOVImpl.setisRevolvente(FenixModelConstants.ES_REVOLVENTE_TRUE);
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESREVOLVENTE,
                                                                          FenixModelConstants.ES_REVOLVENTE_TRUE_INT);
                            } else {
                                //Si isEsRevolvente ==false --> 'N'
                                catProductoFlexcubeLOVImpl.setisRevolvente(FenixModelConstants.ES_REVOLVENTE_FALSE);
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESREVOLVENTE,
                                                                          FenixModelConstants.ES_REVOLVENTE_FALSE_INT);
                            }
                            //Ejecuta el query de productoFlexcubeLOV
                            if (idTarea.equals(FenixModelConstants.ID_TAREA_VALIDAR_LINEA_CREDITO) &&
                                lineaCredito.getFlexcube().getIdProductoFlexcube().isEmpty()) {
                                //Si la tarea es validar linea de credito y idProductoFlexcube es null



                                //No mostra valores
                                logger.log(ADFLogger.WARNING, "No ejecuta query catProductoFlexcubeLOV");
                                catProductoFlexcubeLOVImpl.setidProducto(null);
                                catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
                                catProductoFlexcubeLOVImpl.setisRevolvente(null);
                                catProductoFlexcubeLOVImpl.executeQuery();
                            } else {
                                logger.log(ADFLogger.WARNING, "Ejecuta query catProductoFlexcubeLOV");
                                catProductoFlexcubeLOVImpl.executeQuery();
                            }
                        }

                        // Mover entre meses
                        if (lineaCredito.getMoverEntreMeses() != null) {

                            // Si moverEntreMeses == 1
                            if (lineaCredito.getMoverEntreMeses().intValue() > 0) {
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MOVERENTREMESES,
                                                                          FenixModelConstants.ES_REVOLVENTE_TRUE_INT);
                            } else {
                                //Si moverEntreMeses == 0
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MOVERENTREMESES,
                                                                          FenixModelConstants.ES_REVOLVENTE_FALSE_INT);
                            }
                        } else {
                            logger.log(ADFLogger.WARNING, "Mover entre meses es null.");

                            //Si moverEntreMeses == 0
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MOVERENTREMESES,
                                                                      FenixModelConstants.ES_REVOLVENTE_FALSE_INT);
                        }

                        //Recursos ordinarios (recursosExternos)
                        if (lineaCredito.isRecursosExternos()) {
                            logger.log(ADFLogger.WARNING,
                                       "valor isRecursosExternos:" + lineaCredito.isRecursosExternos());
                            //recurso externo es true,recursos ordinario es false
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESRECURSOSEXTERNOS,
                                                                      FenixModelConstants.ES_RECURSOS_ORDINARIOS_TRUE);
                        } else {
                            //recurso externo es false,recurso ordinario es true
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESRECURSOSEXTERNOS,
                                                                      FenixModelConstants.ES_RECURSOS_ORDINARIOS_FALSE);
                        }
                        //Producto
                        if (lineaCredito.getFlexcube().getIdProductoFlexcube() != null) {
                            Row[] rowCatProductoFlexcube =
                                getCatProductoFlexcubeLOV().getFilteredRows("Id",
                                                                            lineaCredito.getFlexcube().getIdProductoFlexcube());
                            for (Row row : rowCatProductoFlexcube) {
                                getCatProductoFlexcubeLOV().setCurrentRow(row);
                            }
                        }
                        /*****Condiciones financieras*****/
                        //FNXII-2570
                        //Pruebas-PC05-Formalización-RegistrarDatosLineaCred-Fecha de apertura
                        //NI06
                        //El valor de este campo aparecerá de conforme a lo guardado en el campo Fecha de vigencia
                        //de la tarea Registrar Fecha Vigencia.
                        //Fecha de apertura (fechaVigencia)
                        if (null != lineaCredito.getFechaValor()) {
                            GregorianCalendar fechaValorCalendar = lineaCredito.getFechaValor().toGregorianCalendar();
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.FECHAVALOR,
                                                                      new java.sql.Timestamp(fechaValorCalendar.getTimeInMillis()));
                            fechaVigencia = lineaCredito.getFechaValor();
                        } else {
                            //Valida que la fechaVigencia no sea null
                            if (null != fechaVigencia) {
                                GregorianCalendar fechaVigenciaCalendar = fechaVigencia.toGregorianCalendar();
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.FECHAVALOR,
                                                                          new java.sql.Timestamp(fechaVigenciaCalendar.getTimeInMillis()));
                            }
                        }
                        //Plazo de financiamiento
                        if (lineaCredito.getPlazoFinanciamiento() >= 0) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.PLAZOFINANCIAMIENTO,
                                                                      new Integer(lineaCredito.getPlazoFinanciamiento()));
                        }
                        //Se recupera el id de CatPlazoFinanciamientoLOV, viene en
                        //lineaCredito.getFrecuenciaFinanciamiento()
                        if (lineaCredito.getFrecuenciaFinanciamiento() >= 0) {
                            Row[] rowCatPlazoFinanciamiento =
                                getCatPlazoFinanciamientoLOV().getFilteredRows("Id",
                                                                               new Integer(lineaCredito.getFrecuenciaFinanciamiento()));
                            for (Row row : rowCatPlazoFinanciamiento) {
                                getCatPlazoFinanciamientoLOV().setCurrentRow(row);
                            }
                        }
                        //Periodo de gracia
                        if (lineaCredito.getPlazoGracia() >= 0) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.PLAZOGRACIA,
                                                                      new Integer(lineaCredito.getPlazoGracia()));
                        }
                        if (lineaCredito.getFrecuenciaGracia() >= 0) {
                            Row[] rowCatPeriodoGracia =
                                getCatPeriodoGraciaLOV().getFilteredRows("Id",
                                                                         new Integer(lineaCredito.getFrecuenciaGracia()));
                            for (Row row : rowCatPeriodoGracia) {
                                getCatPeriodoGraciaLOV().setCurrentRow(row);
                            }
                        }
                        //fecha vencimiento (fecha calculada apartir de fechaApertura(fechaVigencia),plazoFinanciamiento y plazoGracia)
                        //Validar que fecha de apertura no este null
                        if (fechaVigencia !=
                            null) {
                            //Invocar metodo que calcular la fecha de vencimiento
                            java.sql.Timestamp fechaVencimiento =
               calcularFechaDeVencimiento(fechaVigencia, lineaCredito.getPlazoFinanciamiento(),
                                          lineaCredito.getFrecuenciaFinanciamiento(), lineaCredito.getPlazoGracia(),
                                          lineaCredito.getFrecuenciaGracia());
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.FECHAVENCIMIENTO,
                                                                      fechaVencimiento);
                        }
                        if (lineaCredito.getTratamientoDiasFeriados() != null) {
                            Row[] rowCatDiasFeriados =
                                getCatDiasFeriadosVO().getFilteredRows("CodigoExterno",
                                                                       lineaCredito.getTratamientoDiasFeriados());
                            for (Row row : rowCatDiasFeriados) {
                                getCatDiasFeriadosVO().setCurrentRow(row);
                            }

                        }
                        // Id Tipo Moneda de Monto de la linea
                        if(lineaCredito.getIdTipoMonedaMontoLinea() != null)
                        {
                            Integer idTipoMoneda = lineaCredito.getIdTipoMonedaMontoLinea().intValue();
                            logger.warning("Id tipo de moneda Monto linea: " + idTipoMoneda);
                            idTipoMoneda = idTipoMoneda - 1;
                            logger.warning("Id tipo de moneda Monto linea: " + idTipoMoneda);
                            
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.IDTIPOMONEDAMONTOLINEA,
                                                    idTipoMoneda);
                        }
                        //Monto de la linea
                        if (lineaCredito.getMontoLinea() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MONTOLINEA,
                                                                      lineaCredito.getMontoLinea());
                        }

                        /*****Restricciones*****/
                        //Tasa minima
                        if (lineaCredito.getTasaMinima() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.TASAMINIMA,
                                                                      new Double(lineaCredito.getTasaMinima().getValue()));
                        }
                        //Tasa maxima
                        if (lineaCredito.getTasaMaxima() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.TASAMAXIMA,
                                                                      new Double(lineaCredito.getTasaMaxima().getValue()));
                        }
                        //Monto minimo
                        if (lineaCredito.getMontoMinimo() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MONTOMINIMO,
                                                                      new Double(lineaCredito.getMontoMinimo().getValue()));
                        }
                        //Monto maximo
                        if (lineaCredito.getMontoMaximo() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MONTOMAXIMO,
                                                                      new Double(lineaCredito.getMontoMaximo().getValue()));
                        }
                        /*****Condiciones especiales*****/
                        //Condicion financiera especial
                        if (lineaCredito.isCondicionEspecial() != null) {
                            Boolean condicionEspecial = lineaCredito.isCondicionEspecial();
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.CONDICIONESPECIAL,
                                                                      lineaCredito.isCondicionEspecial());
                        }
                        //Descripcion de la condision financiera
                        if (lineaCredito.getDescCondEspecial() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.DESCRIPCIONCONDESPECIAL,
                                                                      lineaCredito.getDescCondEspecial());
                        }
                        logger.log(ADFLogger.WARNING,"numero a enviar "+lineaCredito.getNumeroLineaCredito());
                        logger.log(ADFLogger.WARNING, "ID_CONTRATO ANTES DE QUERY "+lineaCredito.getIdContrato());
                        LineaCreditoActivaVORowImpl sql= consultaLineaContrato(lineaCredito.getIdContrato(),lineaCredito.getNumeroLineaCredito());
                        logger.log(ADFLogger.WARNING, "SERVICIO CONSULTADATOS");
                        logger.log(ADFLogger.WARNING, "CANTIDADDECIMALES "+lineaCredito.getCantidadDecimales());
                        logger.log(ADFLogger.WARNING, "SPREADTASA "+lineaCredito.getSpreadTasa());
                        logger.log(ADFLogger.WARNING, "VALORTASA "+lineaCredito.getValorTasa());
                        logger.log(ADFLogger.WARNING, "CODIGOTASAREFERENCIA "+lineaCredito.getCodigoTasaReferencia());
                        logger.log(ADFLogger.WARNING, "FRECUENCIA "+lineaCredito.getFrecuencia());
                        logger.log(ADFLogger.WARNING, "CANTIDAD DECIMALES "+lineaCredito.getFrecuencia());
                        logger.log(ADFLogger.WARNING, "MORA "+lineaCredito.getIdTcaTipoMora());
                        logger.log(ADFLogger.WARNING, "FRECUANCIACBO "+lineaCredito.getIdTcaTipoFrecuencia());
                        logger.log(ADFLogger.WARNING, "ROUNDING "+lineaCredito.getIdTcaTipoRedondeo());
                        logger.log(ADFLogger.WARNING, "Se agrega el mapping con los demas********** ");
                        mappingComplementoLineaCredito(lineaCredito.getIdContrato(), lineaCredito.getNumeroLineaCredito());
                        if(sql!=null&&sql.getIdTcaTipoRedondeo()!=null){
                            if(sql.getIdTcaTipoRedondeo()==0){
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.CANTIDADDECIMALES, null);
                            }else{
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.CANTIDADDECIMALES, sql.getCantidadDecimales());
                            }
                        }
                        if(sql!=null&&sql.getSpreadTasa()!=null){
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.SPREADTASA,sql.getSpreadTasa().intValue()!=0?sql.getSpreadTasa():null);
                        }
                        if(sql!=null&&sql.getValorTasa()!=null){
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.VALORTASA,sql.getValorTasa().intValue()!=0?sql.getValorTasa():null);
                        }
                        registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.CODIGOTASAREFERENCIA,sql!=null&&sql.getCodigoTasaReferencia()!=null?sql.getCodigoTasaReferencia():null);
                        if(sql!=null&&sql.getFrecuencia()!=null){
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.FRECUENCIA,sql.getFrecuencia()!=0?sql.getFrecuencia():null);   
                        } 
                        /*****Mapping vencimiento de plazos*****/
                        //Limpia el VO de VencimientoPlazoVO
                        getVencimientoPlazoVO().executeQuery();
                        //getVencimientoPlazoVO().clearCache();
                        if (lineaCredito.getTermino() != null) {
                            List<Termino> listaVencimiento = lineaCredito.getTermino();
                            idAux = new Integer(0);
                            logger.log(ADFLogger.WARNING, "Cantidad de vencimientos : " + listaVencimiento.size());
                            for (Termino vencimiento : listaVencimiento) {
                                vencimientoPlazoVO = null;
                                idAux++;

                                vencimientoPlazoVO = (VencimientoPlazoVORowImpl) getVencimientoPlazoVO().createRow();

                                // Id de VO
                                vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.ID, idAux);

                                //id de evaluacion
                                if (vencimiento.getIdTermino() >= 0) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDVENCIMIENTO,
                                                                    vencimiento.getIdTermino());
                                }
                                //Tipo de vencimiento
                                if (vencimiento.getTipoTermino().getDescripcion() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.TIPODEVENCIMIENTO,
                                                                    vencimiento.getTipoTermino().getDescripcion());
                                }
                                //IdTipoDeVencimiento
                                if (vencimiento.getTipoTermino().getIdCatTermino() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDTIPODEVENCIMIENTO,
                                                                    vencimiento.getTipoTermino().getIdCatTermino());
                                }
                                //Tipo de fecha
                                if (vencimiento.getTipoFechaInicio().getDescripcion() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.TIPODEFECHA,
                                                                    vencimiento.getTipoFechaInicio().getDescripcion());
                                }
                                //IdTipoDeFecha
                                if (vencimiento.getTipoFechaInicio().getId() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDTIPODEFECHA,
                                                                    vencimiento.getTipoFechaInicio().getId());
                                }
                                //Fecha Inicio
                                if (vencimiento.getFechaInicio() != null) {
                                    GregorianCalendar fechaInicio = vencimiento.getFechaInicio().toGregorianCalendar();
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.FECHAINICIO,
                                                                    new java.sql.Timestamp(fechaInicio.getTimeInMillis()));
                                }
                                //Plazo
                                if (vencimiento.getPlazo() >= 0) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.PLAZO,
                                                                    vencimiento.getPlazo());
                                }
                                //idPlazo
                                if (vencimiento.getFrecuenciaPlazo().getId() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDPLAZO,
                                                                    vencimiento.getFrecuenciaPlazo().getId());
                                }
                                //tipoPlazo(dias,meses,años)
                                if (vencimiento.getFrecuenciaPlazo().getDescripcion() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.TIPOPLAZO,
                                                                    vencimiento.getFrecuenciaPlazo().getDescripcion());
                                }
                                //Fecha vencimiento
                                if (vencimiento.getFechaVencimiento() != null) {
                                    GregorianCalendar fechaVencimiento =
                                        vencimiento.getFechaVencimiento().toGregorianCalendar();
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.FECHAVENCIMIENTO,
                                                                    new java.sql.Timestamp(fechaVencimiento.getTimeInMillis()));
                                }
                                //Estado
                                //Por default poner TRUE en el estado de los vencimientos, ya que el servicio no regresa el
                                //estado y el servicio tiene que regresar solo los vencimientos activos
                                vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.ESTADO, Boolean.TRUE);
                                //agregar row de VencimientoPlazoVO
                                getVencimientoPlazoVO().insertRow(vencimientoPlazoVO);

                            } //termina for(Termino vencimiento : listaVencimiento )
                        } //termina if(lineaCredito.getTermino() != null)

                        /*****Mapping comisiones*****/
                        //Limpia el VO de ComisionVO
                        getComisionVO().executeQuery();
                        //getComisionVO().clearCache();
                        if (lineaCredito.getComision() != null) {
                            List<org.bcie.comisionbo.Comision> listaComisiones = lineaCredito.getComision();
                            idAux = new Integer(0);
                            logger.log(ADFLogger.WARNING, "Cantidad de comisiones : " + listaComisiones.size());
                            for (org.bcie.comisionbo.Comision comision : listaComisiones) {
                                comisionVO = null;
                                idAux++;

                                comisionVO = (ComisionVORowImpl) getComisionVO().createRow();

                                // Id de VO
                                comisionVO.setAttribute("Id", idAux);

                                //IdComision
                                if (comision.getIdComision() >= 0) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDCOMISION, comision.getIdComision());
                                }
                                //IdTipoComision
                                if (comision.getTipoComision().getIdTipoComision().getId() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDTIPOCOMISION,
                                                            comision.getTipoComision().getIdTipoComision().getId());
                                }
                                //TipoComision
                                if (comision.getTipoComision().getDescripcion() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.TIPOCOMISION,
                                                            comision.getTipoComision().getDescripcion());
                                }
                                //Porcentaje
                                if (comision.getMontoBase().getPorcentajeMontoBase() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.PORCENTAJE,
                                                            (comision.getMontoBase().getPorcentajeMontoBase() + "%"));
                                }
                                //IdFrecuencia
                                if (comision.getTipoFrecuencia().getId() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDFRECUENCIA,
                                                            comision.getTipoFrecuencia().getId());
                                }
                                //Frecuencia
                                if (comision.getFrecuenciaPago() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.FRECUENCIA, comision.getFrecuenciaPago());
                                }
                                //TipoFrecuencia
                                if (comision.getTipoFrecuencia().getDescripcion() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.TIPOFRECUENCIA,
                                                            comision.getTipoFrecuencia().getDescripcion());
                                }
                                //IdBaseCalculo
                                if (comision.getBaseCalculo().getId() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDBASECALCULO,
                                                            comision.getBaseCalculo().getId());
                                }
                                //BaseCalculo
                                if (comision.getBaseCalculo().getDescripcion() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.BASECALCULO,
                                                            comision.getBaseCalculo().getDescripcion());
                                }
                                //Estado
                                //Agrega por default true,servicio solo tiene que traer las comisiones activas
                                comisionVO.setAttribute(ComisionVORowImpl.ESTADO, Boolean.TRUE);
                                //Agrega el row a ComisionVO()
                                getComisionVO().insertRow(comisionVO);

                            }

                        }

                        //agregar row de RegistrarDatosLineaCreditoVO
                        logger.log(ADFLogger.WARNING, "Inserta el row a RegistrarDatosLineaCreditoVO");
                        getRegistrarDatosLineaCreditoVO().insertRow(registrarDatosLineaCreditoVO);


                    } // cierra if(lineaCredito.getIdLineaCredito() == idLineaCredito)
                } // cierra  for(LineaCredito lineaCredito : listaLineaCredito )
            } //cierra if(listaLineaCredito!=null)
        } //cierra for(Contrato contrato : listaContrato)

        //Validar que el producto sea "Ampliacion de Linea global de credito a IFI".
        //if (idProducto.compareTo(FenixModelConstants.AMPLIACION_LGC_IFI) == 0) { // <-- Se comenta por FNXII-5569
        /*****Linea de credito asociada*****/
        //Validar que la listaLineaCreditoAsociada no venga "null"
        if (listaLineaCreditoAsociada != null) {
            //Iterar los objetos de lineaCredito que se encuentran en listaLineaCredito
            for (LineaCredito lineaCreditoAsociada : listaLineaCreditoAsociada) {
                //Validar que idLineaCredito sea el mismo al del objecto lineaCredito
                //para recuperar sus valores.
                if (lineaCreditoAsociada.getIdLineaCredito() != null) {
                    if (lineaCreditoAsociada.getIdLineaCredito().equals(idLineaCredito)) {
                        //Crear el Row de registrarDatosLineaCreditoVO
                        registrarDatosLineaCreditoVO =
                            (RegistrarDatosLineaCreditoVORowImpl) getRegistrarDatosLineaCreditoVO().createRow();
                        //CatFondoContableVO
                        CatFondoContableVOImpl catFondoContableVOImpl = getCatFondoContableVO();
                        //CatProductoFLexcubeLOV
                        CatProductoFlexcubeLOVImpl catProductoFlexcubeLOVImpl = getCatProductoFlexcubeLOV();
                        /*****IdLineaCredito*****/
                        //Recupera el id de la linea de credito
                        if (lineaCreditoAsociada.getIdLineaCredito() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ID,
                                                                      lineaCreditoAsociada.getIdLineaCredito());
                        }


                        /*****Información general*****/
                        //Numero de linea
                        if (lineaCreditoAsociada.getNumeroLineaCredito() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.NUMEROLINEACREDITO,
                                                                      lineaCreditoAsociada.getNumeroLineaCredito());
                        }
                        //Fondo contable
                        if (lineaCreditoAsociada.getFondo() !=
                            null) {
                            //Recuperar el Row apartir de "CodeDesc" == lineaCredito.getFondo()
                            Row[] rowCatFondoContable =
                                                              getCatFondoContableVO().getFilteredRows("CodeDesc",
                                                                                                      lineaCreditoAsociada.getFondo());
                                                          //Iterar el Row, Siempre va ser 1 Row
                                                          for (Row row : rowCatFondoContable) {
                                                              //Hacer el row filtrado el CurrentRow en vista
                                                              getCatFondoContableVO().setCurrentRow(row);
                            }

                        }
                        //Es revolvente
                        if (lineaCreditoAsociada.isEsRevolvente() != null) {
                            logger.log(ADFLogger.WARNING,
                                       "valor isRevolvente:" + lineaCreditoAsociada.isEsRevolvente());
                            logger.log(ADFLogger.WARNING, "valor idProducto:" + idProducto);
                            //Ejecutar query de CatProductoFlexcubeLOV
                            //Se asigna el valor del idProducto(Parametro de entrada del taskFlow)

                            if (idTarea.equals(FenixModelConstants.ID_TAREA_VALIDAR_LINEA_CREDITO) ||
                                idTarea.equals(FenixModelConstants.ID_TAREA_REGISTRAR_LINEA_CREDITO)) {

                                catProductoFlexcubeLOVImpl.setidProducto(idProducto);
                                catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
                            } else {
                                if (lineaCreditoAsociada.getFlexcube().getId() != null) {
                                    if (lineaCreditoAsociada.getFlexcube().getIdProductoFlexcube() != null) {
                                        logger.log(ADFLogger.WARNING,
                                                   "valor IdProductoFlexcube:" +
                                                   lineaCreditoAsociada.getFlexcube().getIdProductoFlexcube());
                                        catProductoFlexcubeLOVImpl.setidProductoFlexcube(lineaCreditoAsociada.getFlexcube().getIdProductoFlexcube());
                                        catProductoFlexcubeLOVImpl.setidProducto(null);
                                    } else {
                                        catProductoFlexcubeLOVImpl.setidProducto(idProducto);
                                        catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
                                    }
                                } else {
                                    catProductoFlexcubeLOVImpl.setidProducto(idProducto);
                                    catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
                                }
                            }

                            //Revolvente púede ser 'Y' o 'N'
                            //Si isEsRevolvente == true --> 'Y'
                            if (lineaCreditoAsociada.isEsRevolvente()) {
                                catProductoFlexcubeLOVImpl.setisRevolvente(FenixModelConstants.ES_REVOLVENTE_TRUE);
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESREVOLVENTE,
                                                                          FenixModelConstants.ES_REVOLVENTE_TRUE_INT);
                            } else {
                                //Si isEsRevolvente ==false --> 'N'
                                catProductoFlexcubeLOVImpl.setisRevolvente(FenixModelConstants.ES_REVOLVENTE_FALSE);
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESREVOLVENTE,
                                                                          FenixModelConstants.ES_REVOLVENTE_FALSE_INT);
                            }
                            //Ejecuta el query de productoFlexcubeLOV
                            if (idTarea.equals(FenixModelConstants.ID_TAREA_VALIDAR_LINEA_CREDITO) &&
                                lineaCreditoAsociada.getFlexcube().getIdProductoFlexcube().isEmpty()) {
                                //Si la tarea es validar linea de credito y idProductoFlexcube es null



                                //No mostra valores
                                logger.log(ADFLogger.WARNING, "No ejecuta query catProductoFlexcubeLOV");
                                catProductoFlexcubeLOVImpl.setidProducto(null);
                                catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
                                catProductoFlexcubeLOVImpl.setisRevolvente(null);
                                catProductoFlexcubeLOVImpl.executeQuery();
                            } else {
                                logger.log(ADFLogger.WARNING, "Ejecuta query catProductoFlexcubeLOV");
                                catProductoFlexcubeLOVImpl.executeQuery();
                            }
                        }

                        // Mover entre meses
                        if (lineaCreditoAsociada.getMoverEntreMeses() != null) {

                            // Si moverEntreMeses == 1
                            if (lineaCreditoAsociada.getMoverEntreMeses().intValue() > 0) {
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MOVERENTREMESES,
                                                                          FenixModelConstants.ES_REVOLVENTE_TRUE_INT);
                            } else {
                                //Si moverEntreMeses == 0
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MOVERENTREMESES,
                                                                          FenixModelConstants.ES_REVOLVENTE_FALSE_INT);
                            }
                        } else {
                            logger.log(ADFLogger.WARNING, "Mover entre meses es null.");

                            //Si moverEntreMeses == 0
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MOVERENTREMESES,
                                                                      FenixModelConstants.ES_REVOLVENTE_FALSE_INT);
                        }

                        //Recursos ordinarios (recursosExternos)
                        if (lineaCreditoAsociada.isRecursosExternos()) {
                            logger.log(ADFLogger.WARNING,
                                       "valor isRecursosExternos:" + lineaCreditoAsociada.isRecursosExternos());
                            //recurso externo es true,recursos ordinario es false
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESRECURSOSEXTERNOS,
                                                                      FenixModelConstants.ES_RECURSOS_ORDINARIOS_TRUE);
                        } else {
                            //recurso externo es false,recurso ordinario es true
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.ESRECURSOSEXTERNOS,
                                                                      FenixModelConstants.ES_RECURSOS_ORDINARIOS_FALSE);
                        }
                        //Producto
                        if (lineaCreditoAsociada.getFlexcube().getIdProductoFlexcube() != null) {
                            Row[] rowCatProductoFlexcube =
                                getCatProductoFlexcubeLOV().getFilteredRows("Id",
                                                                            lineaCreditoAsociada.getFlexcube().getIdProductoFlexcube());
                            for (Row row : rowCatProductoFlexcube) {
                                getCatProductoFlexcubeLOV().setCurrentRow(row);
                            }
                        }
                        /*****Condiciones financieras*****/
                        //FNXII-2570
                        //Pruebas-PC05-Formalización-RegistrarDatosLineaCred-Fecha de apertura
                        //NI06
                        //El valor de este campo aparecerá de conforme a lo guardado en el campo Fecha de vigencia
                        //de la tarea Registrar Fecha Vigencia.
                        //Fecha de apertura (fechaVigencia)
                        if (null != lineaCreditoAsociada.getFechaValor()) {
                            GregorianCalendar fechaValorCalendar =
                                lineaCreditoAsociada.getFechaValor().toGregorianCalendar();
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.FECHAVALOR,
                                                                      new java.sql.Timestamp(fechaValorCalendar.getTimeInMillis()));
                            fechaVigencia = lineaCreditoAsociada.getFechaValor();
                        } else {
                            //Valida que la fechaVigencia no sea null
                            if (null != fechaVigencia) {
                                GregorianCalendar fechaVigenciaCalendar = fechaVigencia.toGregorianCalendar();
                                registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.FECHAVALOR,
                                                                          new java.sql.Timestamp(fechaVigenciaCalendar.getTimeInMillis()));
                            }
                        }
                        //Plazo de financiamiento
                        if (lineaCreditoAsociada.getPlazoFinanciamiento() >= 0) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.PLAZOFINANCIAMIENTO,
                                                                      new Integer(lineaCreditoAsociada.getPlazoFinanciamiento()));
                        }
                        //Se recupera el id de CatPlazoFinanciamientoLOV, viene en
                        //lineaCredito.getFrecuenciaFinanciamiento()
                        if (lineaCreditoAsociada.getFrecuenciaFinanciamiento() >= 0) {
                            Row[] rowCatPlazoFinanciamiento =
                                getCatPlazoFinanciamientoLOV().getFilteredRows("Id",
                                                                               new Integer(lineaCreditoAsociada.getFrecuenciaFinanciamiento()));
                            for (Row row : rowCatPlazoFinanciamiento) {
                                getCatPlazoFinanciamientoLOV().setCurrentRow(row);
                            }
                        }
                        //Periodo de gracia
                        if (lineaCreditoAsociada.getPlazoGracia() >= 0) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.PLAZOGRACIA,
                                                                      new Integer(lineaCreditoAsociada.getPlazoGracia()));
                        }
                        if (lineaCreditoAsociada.getFrecuenciaGracia() >= 0) {
                            Row[] rowCatPeriodoGracia =
                                getCatPeriodoGraciaLOV().getFilteredRows("Id",
                                                                         new Integer(lineaCreditoAsociada.getFrecuenciaGracia()));
                            for (Row row : rowCatPeriodoGracia) {
                                getCatPeriodoGraciaLOV().setCurrentRow(row);
                            }
                        }
                        //fecha vencimiento (fecha calculada apartir de fechaApertura(fechaVigencia),plazoFinanciamiento y plazoGracia)
                        //Validar que fecha de apertura no este null
                        if (fechaVigencia !=
                            null) {
                            //Invocar metodo que calcular la fecha de vencimiento
                            java.sql.Timestamp fechaVencimiento =
               calcularFechaDeVencimiento(fechaVigencia, lineaCreditoAsociada.getPlazoFinanciamiento(),
                                          lineaCreditoAsociada.getFrecuenciaFinanciamiento(),
                                          lineaCreditoAsociada.getPlazoGracia(),
                                          lineaCreditoAsociada.getFrecuenciaGracia());
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.FECHAVENCIMIENTO,
                                                                      fechaVencimiento);
                        }
                        if (lineaCreditoAsociada.getTratamientoDiasFeriados() != null) {
                            Row[] rowCatDiasFeriados =
                                getCatDiasFeriadosVO().getFilteredRows("CodigoExterno",
                                                                       lineaCreditoAsociada.getTratamientoDiasFeriados());
                            for (Row row : rowCatDiasFeriados) {
                                getCatDiasFeriadosVO().setCurrentRow(row);
                            }

                        }
                        //Monto de la linea
                        if (lineaCreditoAsociada.getMontoLinea() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MONTOLINEA,
                                                                      lineaCreditoAsociada.getMontoLinea());
                        }

                        /*****Restricciones*****/
                        //Tasa minima
                        if (lineaCreditoAsociada.getTasaMinima() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.TASAMINIMA,
                                                                      new Double(lineaCreditoAsociada.getTasaMinima().getValue()));
                        }
                        //Tasa maxima
                        if (lineaCreditoAsociada.getTasaMaxima() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.TASAMAXIMA,
                                                                      new Double(lineaCreditoAsociada.getTasaMaxima().getValue()));
                        }
                        //Monto minimo
                        if (lineaCreditoAsociada.getMontoMinimo() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MONTOMINIMO,
                                                                      new Double(lineaCreditoAsociada.getMontoMinimo().getValue()));
                        }
                        //Monto maximo
                        if (lineaCreditoAsociada.getMontoMaximo() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.MONTOMAXIMO,
                                                                      new Double(lineaCreditoAsociada.getMontoMaximo().getValue()));
                        }
                        /*****Condiciones especiales*****/
                        //Condicion financiera especial
                        if (lineaCreditoAsociada.isCondicionEspecial() != null) {
                            Boolean condicionEspecial = lineaCreditoAsociada.isCondicionEspecial();
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.CONDICIONESPECIAL,
                                                                      lineaCreditoAsociada.isCondicionEspecial());
                        }
                        //Descripcion de la condision financiera
                        if (lineaCreditoAsociada.getDescCondEspecial() != null) {
                            registrarDatosLineaCreditoVO.setAttribute(RegistrarDatosLineaCreditoVORowImpl.DESCRIPCIONCONDESPECIAL,
                                                                      lineaCreditoAsociada.getDescCondEspecial());
                        }
                        /*****Mapping vencimiento de plazos*****/
                        //Limpia el VO de VencimientoPlazoVO
                        getVencimientoPlazoVO().executeQuery();
                        //getVencimientoPlazoVO().clearCache();
                        if (lineaCreditoAsociada.getTermino() != null) {
                            List<Termino> listaVencimiento = lineaCreditoAsociada.getTermino();
                            idAux = new Integer(0);
                            logger.log(ADFLogger.WARNING, "Cantidad de vencimientos : " + listaVencimiento.size());
                            for (Termino vencimiento : listaVencimiento) {
                                vencimientoPlazoVO = null;
                                idAux++;

                                vencimientoPlazoVO = (VencimientoPlazoVORowImpl) getVencimientoPlazoVO().createRow();

                                // Id de VO
                                vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.ID, idAux);

                                //id de evaluacion
                                if (vencimiento.getIdTermino() >= 0) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDVENCIMIENTO,
                                                                    vencimiento.getIdTermino());
                                }
                                //Tipo de vencimiento
                                if (vencimiento.getTipoTermino().getDescripcion() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.TIPODEVENCIMIENTO,
                                                                    vencimiento.getTipoTermino().getDescripcion());
                                }
                                //IdTipoDeVencimiento
                                if (vencimiento.getTipoTermino().getIdCatTermino() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDTIPODEVENCIMIENTO,
                                                                    vencimiento.getTipoTermino().getIdCatTermino());
                                }
                                //Tipo de fecha
                                if (vencimiento.getTipoFechaInicio().getDescripcion() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.TIPODEFECHA,
                                                                    vencimiento.getTipoFechaInicio().getDescripcion());
                                }
                                //IdTipoDeFecha
                                if (vencimiento.getTipoFechaInicio().getId() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDTIPODEFECHA,
                                                                    vencimiento.getTipoFechaInicio().getId());
                                }
                                //Fecha Inicio
                                if (vencimiento.getFechaInicio() != null) {
                                    GregorianCalendar fechaInicio = vencimiento.getFechaInicio().toGregorianCalendar();
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.FECHAINICIO,
                                                                    new java.sql.Timestamp(fechaInicio.getTimeInMillis()));
                                }
                                //Plazo
                                if (vencimiento.getPlazo() >= 0) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.PLAZO,
                                                                    vencimiento.getPlazo());
                                }
                                //idPlazo
                                if (vencimiento.getFrecuenciaPlazo().getId() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.IDPLAZO,
                                                                    vencimiento.getFrecuenciaPlazo().getId());
                                }
                                //tipoPlazo(dias,meses,años)
                                if (vencimiento.getFrecuenciaPlazo().getDescripcion() != null) {
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.TIPOPLAZO,
                                                                    vencimiento.getFrecuenciaPlazo().getDescripcion());
                                }
                                //Fecha vencimiento
                                if (vencimiento.getFechaVencimiento() != null) {
                                    GregorianCalendar fechaVencimiento =
                                        vencimiento.getFechaVencimiento().toGregorianCalendar();
                                    vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.FECHAVENCIMIENTO,
                                                                    new java.sql.Timestamp(fechaVencimiento.getTimeInMillis()));
                                }
                                //Estado
                                //Por default poner TRUE en el estado de los vencimientos, ya que el servicio no regresa el
                                //estado y el servicio tiene que regresar solo los vencimientos activos
                                vencimientoPlazoVO.setAttribute(VencimientoPlazoVORowImpl.ESTADO, Boolean.TRUE);
                                //agregar row de VencimientoPlazoVO
                                getVencimientoPlazoVO().insertRow(vencimientoPlazoVO);

                            } //termina for(Termino vencimiento : listaVencimiento )
                        } //termina if(lineaCredito.getTermino() != null)

                        /*****Mapping comisiones*****/
                        //Limpia el VO de ComisionVO
                        getComisionVO().executeQuery();
                        //getComisionVO().clearCache();
                        if (lineaCreditoAsociada.getComision() != null) {
                            List<org.bcie.comisionbo.Comision> listaComisiones = lineaCreditoAsociada.getComision();
                            idAux = new Integer(0);
                            logger.log(ADFLogger.WARNING, "Cantidad de comisiones : " + listaComisiones.size());
                            for (org.bcie.comisionbo.Comision comision : listaComisiones) {
                                comisionVO = null;
                                idAux++;

                                comisionVO = (ComisionVORowImpl) getComisionVO().createRow();

                                // Id de VO
                                comisionVO.setAttribute("Id", idAux);

                                //IdComision
                                if (comision.getIdComision() >= 0) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDCOMISION, comision.getIdComision());
                                }
                                //IdTipoComision
                                if (comision.getTipoComision().getIdTipoComision().getId() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDTIPOCOMISION,
                                                            comision.getTipoComision().getIdTipoComision().getId());
                                }
                                //TipoComision
                                if (comision.getTipoComision().getDescripcion() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.TIPOCOMISION,
                                                            comision.getTipoComision().getDescripcion());
                                }
                                //Porcentaje
                                if (comision.getMontoBase().getPorcentajeMontoBase() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.PORCENTAJE,
                                                            (comision.getMontoBase().getPorcentajeMontoBase() + "%"));
                                }
                                //IdFrecuencia
                                if (comision.getTipoFrecuencia().getId() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDFRECUENCIA,
                                                            comision.getTipoFrecuencia().getId());
                                }
                                //Frecuencia
                                if (comision.getFrecuenciaPago() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.FRECUENCIA, comision.getFrecuenciaPago());
                                }
                                //TipoFrecuencia
                                if (comision.getTipoFrecuencia().getDescripcion() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.TIPOFRECUENCIA,
                                                            comision.getTipoFrecuencia().getDescripcion());
                                }
                                //IdBaseCalculo
                                if (comision.getBaseCalculo().getId() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.IDBASECALCULO,
                                                            comision.getBaseCalculo().getId());
                                }
                                //BaseCalculo
                                if (comision.getBaseCalculo().getDescripcion() != null) {
                                    comisionVO.setAttribute(ComisionVORowImpl.BASECALCULO,
                                                            comision.getBaseCalculo().getDescripcion());
                                }
                                //Estado
                                //Agrega por default true,servicio solo tiene que traer las comisiones activas
                                comisionVO.setAttribute(ComisionVORowImpl.ESTADO, Boolean.TRUE);
                                //Agrega el row a ComisionVO()
                                getComisionVO().insertRow(comisionVO);

                            }

                        }

                        //agregar row de RegistrarDatosLineaCreditoVO
                        logger.log(ADFLogger.WARNING, "Inserta el row a RegistrarDatosLineaCreditoVO");
                        getRegistrarDatosLineaCreditoVO().insertRow(registrarDatosLineaCreditoVO);

                    } // cierra if(lineaCredito.getIdLineaCredito() == idLineaCredito)
                } // cierra if(lineaCredito.getIdLineaCredito() != null)
            } // cierra  for(LineaCredito lineaCredito : listaLineaCredito )
        } //cierra if(listaLineaCredito!=null)
        //} // <-- Se comenta por FNXII-5569

    } //cierra mappingConsultarLineaCredito

    public void inicializarRegistrarDatosLineaCredito() {
        RegistrarDatosLineaCreditoVOImpl registrarDatosLineaCreditoVOImpl = getRegistrarDatosLineaCreditoVO();
        registrarDatosLineaCreditoVOImpl.crearRowRegistrarDatosLineaCredito();
    }

    public void filtrarProducto(Integer idProducto, String isRevolvente) {
        logger.log(ADFLogger.TRACE, "Into method filtrarProducto");
        logger.log(ADFLogger.TRACE, "value idProducto:" + idProducto);
        logger.log(ADFLogger.TRACE, "value isRevolvente:" + isRevolvente);
        //CatProductoFLexcubeLOV
        CatProductoFlexcubeLOVImpl catProductoFlexcubeLOVImpl = getCatProductoFlexcubeLOV();
        catProductoFlexcubeLOVImpl.setidProducto(idProducto);
        catProductoFlexcubeLOVImpl.setisRevolvente(isRevolvente);
        catProductoFlexcubeLOVImpl.setidProductoFlexcube(null);
        catProductoFlexcubeLOVImpl.executeQuery();
        catProductoFlexcubeLOVImpl.getAllRowsInRange();
        logger.log(ADFLogger.TRACE, "La cantidad de row obtenido es :" + catProductoFlexcubeLOVImpl.getRowCount());
    }

    /**
     * Actualiza datos de las lineas de credito.
     * [KB:14513] Refactoriza este metodo para que se pueda evitar la validación del cambio en el monto de la línea.
     */
    public void actualizarLineaCredito(String idOperacion) {
        //[KB:14513] Refactoriza. Por defecto se solicita validación del cambio de monto.
        this.actualizarLineaCredito(idOperacion, true);
    }
    
    public void actualizarLineaCredito(String idOperacion, boolean validarCambioMonto) {
        logger.warning("Ejecuta consumo del servicio de actualizarContratoLineaCredito");
        try {
            //Se valida si es una linea de credito asociada
            RegistrarDatosLineaCreditoVORowImpl lineaCredito =
                (RegistrarDatosLineaCreditoVORowImpl) getRegistrarDatosLineaCreditoVO().getCurrentRow();

            // Actualizacion de lineas propias de la operacion
            String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);

            com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito12BndQSService =
                IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
            LineaCreditoPT lineaCredito12Port = lineaCredito12BndQSService.getLineaCredito12Bnd();
            logger.log(ADFLogger.WARNING, ">HNWS" + lineaCredito12Port.toString());
            ActualizarContratoLineaCreditoRequestType request = new ActualizarContratoLineaCreditoRequestType();
            ActualizarContratoLineaCreditoResponseType response = new ActualizarContratoLineaCreditoResponseType();
            Contrato contrato = new Contrato();
            contrato =
                mappingActualizarLineaCredito((EncabezadoRegistrarDatosLineaCreditoVORowImpl) this.getEncabezadoRegistrarDatosLineaCreditoVO().getRowAtRangeIndex(0),
                                              (RegistrarDatosLineaCreditoVORowImpl) this.getRegistrarDatosLineaCreditoVO().getCurrentRow(),
                                              idOperacion, validarCambioMonto);

            if (esLineaCreditoAsociada(lineaCredito)) {
                // Actualizamos la linea de credito de la operacion asociada
                Long idOperacionAsociada = obtenerIdOperacionLineaCreditoAsociada(lineaCredito);
                Integer idContratoAsociada = obtenerIdContratoLineaCreditoAsociada(lineaCredito);

                logger.warning("Se actualizan los datos del contrato para la linea asociada.");
                logger.warning("idOperacionAsociada: " + idOperacionAsociada);
                logger.warning("idContratoAsociada: " + idContratoAsociada);

                contrato.setIdOperacion(idOperacionAsociada);
                contrato.setIdContrato(idContratoAsociada);
                contrato.setFechaVigencia(null);
                contrato.setCuentaCliente(null);
                //[KB:14513]
                contrato.setFechaValor(null);
            }

            request.setContrato(contrato);

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_LINEA_CREDITO);
            response = lineaCredito12Port.actualizarContratoLineaCredito(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_LINEA_CREDITO, horaInicio);
            logger.log(ADFLogger.TRACE, "Resultado: " + response.getResultado().getResult());
            logger.log(ADFLogger.TRACE, "Mensaje: " + response.getResultado().getMessage());
            if (null != response.getResultado() &&
                response.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                //Actualizo correctamente



            } else {
                String msg = "ERROR";

                if (null != response.getResultado())
                    msg = response.getResultado().getMessage();

                logger.severe("WS Aprobacion Error: RESULT " + msg);
                throw new Exception("WS Aprobacion Error: RESULT " + msg);
            }
        } catch (Exception e) {
            //logger.log(ADFLogger.ERROR, e.getMessage());
            logger.severe("Ocurre Exception al actualizar linea de credito", e);
            JboException ex =
                new JboException("Error en la actualizacion de Lineas de credito,favor de intentar más tarde. " + e);
            throw ex;

        }
    }

    private boolean esLineaCreditoAsociada(RegistrarDatosLineaCreditoVORowImpl lineaCreditoRow) {
            boolean esAsociada = Boolean.FALSE;
            RowSetIterator rowSetIterator = getDatosLineaCreditoVO().createRowSetIterator(null);
            rowSetIterator.reset();
            logger.warning("lineaCreditoRow is null " + (lineaCreditoRow == null));
            logger.warning("Cantidad de registros getDatosLineaCreditoVO().createRowSetIterator(null)" + rowSetIterator.getRowCount());
            
            while (rowSetIterator.hasNext()) {
                DatosLineaCreditoVORowImpl datosLineaCreditoRow = (DatosLineaCreditoVORowImpl) rowSetIterator.next();
                logger.warning("datosLineaCreditoRow is null " + (datosLineaCreditoRow == null));

                try {
                    if (null != datosLineaCreditoRow && null != lineaCreditoRow) {
                        logger.warning("datosLineaCreditoRow.getId() " + datosLineaCreditoRow.getId());
                        logger.warning("lineaCreditoRow.getId() " + lineaCreditoRow.getId());
                        logger.warning("datosLineaCreditoRow.getLineaGlobalIfi() " + datosLineaCreditoRow.getLineaGlobalIfi());
                        if (datosLineaCreditoRow.getId().compareTo(lineaCreditoRow.getId()) == 0 &&
                            datosLineaCreditoRow.getLineaGlobalIfi()) {
                            esAsociada = Boolean.TRUE;
                            break;
                        }
                    }
                } catch (Exception ex) {
                    logger.warning(ex.getMessage());
                }
            }

            rowSetIterator.closeRowSetIterator();
            logger.warning("esAsociada " + esAsociada);
            return esAsociada;
        }

    private Long obtenerIdOperacionLineaCreditoAsociada(RegistrarDatosLineaCreditoVORowImpl lineaCreditoRow) {
        Long idOperacion = null;
        RowSetIterator rowSetIterator = getDatosLineaCreditoVO().createRowSetIterator(null);
        rowSetIterator.reset();

        while (rowSetIterator.hasNext()) {
            DatosLineaCreditoVORowImpl datosLineaCreditoRow = (DatosLineaCreditoVORowImpl) rowSetIterator.next();

            if (null != datosLineaCreditoRow && null != lineaCreditoRow &&
                datosLineaCreditoRow.getId().compareTo(lineaCreditoRow.getId()) == 0) {
                idOperacion = datosLineaCreditoRow.getIdOperacion();
                break;
            }
        }

        rowSetIterator.closeRowSetIterator();

        return idOperacion;
    }

    private Integer obtenerIdContratoLineaCreditoAsociada(RegistrarDatosLineaCreditoVORowImpl lineaCreditoRow) {
        Integer idContrato = null;
        RowSetIterator rowSetIterator = getDatosLineaCreditoVO().createRowSetIterator(null);
        rowSetIterator.reset();

        while (rowSetIterator.hasNext()) {
            DatosLineaCreditoVORowImpl datosLineaCreditoRow = (DatosLineaCreditoVORowImpl) rowSetIterator.next();

            if (null != datosLineaCreditoRow && null != lineaCreditoRow &&
                datosLineaCreditoRow.getId().compareTo(lineaCreditoRow.getId()) == 0) {
                idContrato = datosLineaCreditoRow.getIdContrato();
                break;
            }
        }

        rowSetIterator.closeRowSetIterator();

        return idContrato;
    }

    private boolean esMontoLineaCreditoModificado(RegistrarDatosLineaCreditoVORowImpl lineaCreditoRow) {
        boolean esAsociada = Boolean.FALSE;
        RowSetIterator rowSetIterator = getDatosLineaCreditoVO().createRowSetIterator(null);
        rowSetIterator.reset();

        while (rowSetIterator.hasNext()) {
            DatosLineaCreditoVORowImpl datosLineaCreditoRow = (DatosLineaCreditoVORowImpl) rowSetIterator.next();

            if (null != datosLineaCreditoRow && null != lineaCreditoRow &&
                datosLineaCreditoRow.getId().compareTo(lineaCreditoRow.getId()) == 0 &&
                datosLineaCreditoRow.getMontoLinea().compareTo(lineaCreditoRow.getMontoLinea()) != 0
                /* Se solicito aplique para ambas lineas */
                /*&& datosLineaCreditoRow.getLineaGlobalIfi()*/) {
                esAsociada = Boolean.TRUE;
                break;
            }
        }

        rowSetIterator.closeRowSetIterator();

        return esAsociada;
    }

    private void actualizarLineaCreditoAsociada(String idOperacion) {
        logger.warning("Entrando en actualizarLineaCreditoAsociada.");
        logger.warning("idOperacion: " + idOperacion);

        EncabezadoRegistrarDatosLineaCreditoVORowImpl encabezadoDatosLineaCreditoVO = null;
        try {
            encabezadoDatosLineaCreditoVO = consultarEncabezadoLineaCreditoAsociada(idOperacion);

            if (null != encabezadoDatosLineaCreditoVO) {
                String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);

                com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito12BndQSService =
                    IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
                LineaCreditoPT lineaCredito12Port = lineaCredito12BndQSService.getLineaCredito12Bnd();
                logger.log(ADFLogger.WARNING, ">HNWS" + lineaCredito12Port.toString());
                ActualizarContratoLineaCreditoRequestType request = new ActualizarContratoLineaCreditoRequestType();
                ActualizarContratoLineaCreditoResponseType response = new ActualizarContratoLineaCreditoResponseType();
                Contrato contrato = new Contrato();
                //[KB:14513] Se envia bandera validarCambioMonto en true dado que es el comportamiento por defecto y no
                //se desea cambiar el comportamiento de este metodo.
                contrato =
                    mappingActualizarLineaCredito(encabezadoDatosLineaCreditoVO,
                                                  (RegistrarDatosLineaCreditoVORowImpl) this.getRegistrarDatosLineaCreditoVO().getCurrentRow(),
                                                  idOperacion, true);
                request.setContrato(contrato);

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_LINEA_CREDITO);
                response = lineaCredito12Port.actualizarContratoLineaCredito(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_LINEA_CREDITO, horaInicio);
                logger.warning("Resultado: " + response.getResultado().getResult());
                logger.warning("Mensaje: " + response.getResultado().getMessage());
                if (null != response.getResultado() &&
                    response.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                    //Actualizo correctamente



                } else {
                    String msg = "ERROR";

                    if (null != response.getResultado())
                        msg = response.getResultado().getMessage();

                    logger.warning("WS Aprobacion Error: RESULT " + msg);
                    throw new Exception("WS Aprobacion Error: RESULT " + msg);
                }
            } else {
                JboException ex = new JboException("Error al consultar el encabezado de la línea de crédito asociada");
                throw ex;
            }
        } catch (Exception e) {
            logger.warning("Error al actualizar linea de credito asociada", e);
            JboException ex =
                new JboException("Error en la actualizacion de Líneas de crédito,favor de intentar más tarde. " + e);
            throw ex;

        }
    }

    private EncabezadoRegistrarDatosLineaCreditoVORowImpl consultarEncabezadoLineaCreditoAsociada(String idOperacion) {
        logger.warning("Inside consultarLineaCreditoByIdLineaCredito.");
        logger.warning("idOperacion : " + idOperacion);

        EncabezadoRegistrarDatosLineaCreditoVORowImpl encabezadoDatosLineaCreditoVO = null;

        String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);

        com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito12BndQSService =
            IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
        com.bcie.xmlns.lineacreditoservice.LineaCreditoPT lineaCreditoPT =
            lineaCredito12BndQSService.getLineaCredito12Bnd();
        try {
            logger.log(ADFLogger.WARNING, ">HNWS" + lineaCreditoPT.toString());
        } catch (Exception ex) {
        }
        org.bcie.lineacreditomo.ConsultarLineaCreditoRequestType request =
            new org.bcie.lineacreditomo.ConsultarLineaCreditoRequestType();
        //se agrega los parametros al request idOperacion e instanciaProceso
        //idOperacion
        request.setIdOperacion(Long.parseLong(idOperacion));

        try {
            Date horaInicio =
                ModelUtils.logStartWS(logger, request,
                                      FenixModelConstants.WSC_CONSULTAR_LINEA_CREDITO_BY_ID_LINEA_CREDITO);
            org.bcie.lineacreditomo.ConsultarLineaCreditoResponseType response =
                lineaCreditoPT.consultarLineaCredito(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CONSULTAR_LINEA_CREDITO_BY_ID_LINEA_CREDITO,
                                horaInicio);

            encabezadoDatosLineaCreditoVO =
                mappingEncabezadoRegistrarDatosLineaCreditoAsociada(response.getClienteContrato().get(0));
        } catch (Exception e) {
            logger.warning("Error al consultar el encabezado de la linea de credito asociada.", e);
        }

        return encabezadoDatosLineaCreditoVO;
    }

    private EncabezadoRegistrarDatosLineaCreditoVORowImpl mappingEncabezadoRegistrarDatosLineaCreditoAsociada(Contrato contrato) {
        EncabezadoRegistrarDatosLineaCreditoVORowImpl encabezadoRegistrarDatosLineaCreditoVO =
            (EncabezadoRegistrarDatosLineaCreditoVORowImpl) getEncabezadoRegistrarDatosLineaCreditoVO().createRow();
        try {
            /*****Datos del cliente*****/
            /*****Datos de escrituración*****/
            //Fecha de escrituración
            if (contrato.getFechaFirma() != null) {
                GregorianCalendar fechaEscrituracion = contrato.getFechaFirma().toGregorianCalendar();
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.FECHAESCRITURACION,
                                                                    new java.sql.Timestamp(fechaEscrituracion.getTimeInMillis()));
            }
            //Monto escriturado
            if (contrato.getMontoEscriturado() != null) {
            logger.warning("[CONTRATO.ID_OPERACION (II)]: " + contrato.getIdOperacion());
                BigDecimal montoEscrituradoTmp=modificaMontoAmpliacion(contrato.getIdOperacion());
                if(montoEscrituradoTmp!=null){
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.MONTOESCRITURADO,
                                                                    montoEscrituradoTmp);
                }else{
                    encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.MONTOESCRITURADO,
                                                                        contrato.getMontoEscriturado());    
                }
            }
            //IdContrato
            if (contrato.getIdContrato() > 0) {
                encabezadoRegistrarDatosLineaCreditoVO.setAttribute(EncabezadoRegistrarDatosLineaCreditoVORowImpl.IDCONTRATO,
                                                                    contrato.getIdContrato());
            } else {
                logger.warning("IDCONTRATO con valor 0 en respuesta de servicio.");
            }
        } catch (Exception e) {
            logger.warning("Ocurio un error en mappingEncabezadoRegistrarDatosLineaCredito", e);
        }
        return encabezadoRegistrarDatosLineaCreditoVO;
    }

    //[KB:14513] Se adiciona bandera validarCambioMonto para saber si se valida el cambio en el monto de la linea o no.
    //Esto debido a que para formalizacion de enmiendas se ha solicitado que no se haga dicha validacion.
    public Contrato mappingActualizarLineaCredito(EncabezadoRegistrarDatosLineaCreditoVORowImpl encabezadoResgitrarDatosLineaCreditoVORow,
                                                  RegistrarDatosLineaCreditoVORowImpl registrarDatosLineaCreditoVORow,
                                                  String idOperacion, boolean validarCambioMonto) {

        Contrato contrato = new Contrato();
        CatCuentaClienteLOVImpl catCuentaClienteLOV = getCatCuentaClienteLOV();
        CatFondoContableVOImpl catFondoContableLOV = getCatFondoContableVO();
        CatProductoFlexcubeLOVImpl catProductoLOV = getCatProductoFlexcubeLOV();
        CatPlazoFinanciamientoLOVImpl catPlazoFinanciamientoLOV = getCatPlazoFinanciamientoLOV();
        CatPeriodoGraciaLOVImpl catPeriodoGraciaLOV = getCatPeriodoGraciaLOV();
        CatDiasFeriadosVOImpl catDiasFeriadosLOV = getCatDiasFeriadosVO();
        DiasSpotTasaVOImpl catDiasSpotTasaLOV=getDiasSpotTasaVO1();
        TcaTipoRedondeoVOImpl catTipoRedondeo=getTcaTipoRedondeoVO1();
        TcaTipoMoraVOImpl catMora=getTcaTipoMoraVO1();
        TcaTipoFrecuenciaVOImpl catFrecuencia=getTcaTipoFrecuenciaVO1();
        CondicionesFinancierasVOImpl descripcionTasa=getCondicionesFinancierasVO();

        //id contrato necesario para el servicio
        //22/12/2015 modificar URGENTE
        if (encabezadoResgitrarDatosLineaCreditoVORow.getIdContrato() != null) {
            contrato.setIdContrato(encabezadoResgitrarDatosLineaCreditoVORow.getIdContrato().intValue());
        }
        //id operacion necesaria para el servicio
        if (idOperacion != null) {
            long idOperacionLong = Long.parseLong(idOperacion);
            logger.log(ADFLogger.WARNING, "Valor idOperacion para Actualizar" + idOperacionLong);
            contrato.setIdOperacion(idOperacionLong);
        }
        //Datos del cliente
        if (catCuentaClienteLOV.getCurrentRow() != null) {
            Cuentas cuentas = new Cuentas();
            String cuentaCliente = (String) catCuentaClienteLOV.getCurrentRow().getAttribute("CuentaCliente");
            cuentas.getCuentaCliente().add(cuentaCliente);
            contrato.setCuentaCliente(cuentas);
        }
        //Datos de escrituración
        //Son solo de lectura el usuario no puede modificarlo

        //[KB:14513] Fecha valor
        if (encabezadoResgitrarDatosLineaCreditoVORow.getFechaValor() != null) {
            GregorianCalendar contratoFechaValor = new GregorianCalendar();
            contratoFechaValor.setTimeInMillis(encabezadoResgitrarDatosLineaCreditoVORow.getFechaValor().getTime());
            try {
                contrato.setFechaValor(DatatypeFactory.newInstance().newXMLGregorianCalendar(contratoFechaValor));
            } catch (javax.xml.datatype.DatatypeConfigurationException ex) {
                logger.severe("Error al asignar fechaValor.", ex);
            }
        }

        LineaCredito lineaCredito = new LineaCredito();
        //Recuperar el id de la linea de credito, es requerido para actualizar la linea de credito seleccionada
        if (registrarDatosLineaCreditoVORow.getId() != null) {
            logger.log(ADFLogger.WARNING,
                       "Valor IdLineaCredito para Actualizar" + registrarDatosLineaCreditoVORow.getId());
            //valor requerido para  request del servicio ActualizarContratoLineaCreditoRequest
            lineaCredito.setIdLineaCredito(registrarDatosLineaCreditoVORow.getId());
        }
        //Información general
        //Número de línea
        if (registrarDatosLineaCreditoVORow.getNumeroLineaCredito() != null) {
            String numeroLineaCredito = (String) registrarDatosLineaCreditoVORow.getNumeroLineaCredito();
            lineaCredito.setNumeroLineaCredito(numeroLineaCredito);
        }
        //Fondo contable
        if (catFondoContableLOV.getCurrentRow() != null) {
            String fondoContable = (String) catFondoContableLOV.getCurrentRow().getAttribute("MisCode");
            lineaCredito.setFondo(fondoContable);
        }
        //¿Es revolvente?
        if (registrarDatosLineaCreditoVORow.getEsRevolvente() != null) {
            if (registrarDatosLineaCreditoVORow.getEsRevolvente().intValue() == ES_REVOLVENTE_TRUE_INT) {
                lineaCredito.setEsRevolvente(Boolean.TRUE);
            } else {
                lineaCredito.setEsRevolvente(Boolean.FALSE);
            }
        }

        logger.warning("moverEntreMeses : " + registrarDatosLineaCreditoVORow.getMoverEntreMeses());

        if (registrarDatosLineaCreditoVORow.getMoverEntreMeses() != null &&
            registrarDatosLineaCreditoVORow.getMoverEntreMeses().toString() != "") {
            lineaCredito.setMoverEntreMeses(new BigDecimal(registrarDatosLineaCreditoVORow.getMoverEntreMeses()));
        }

        //¿Aplican recursos ordinarios?
        if (registrarDatosLineaCreditoVORow.getEsRecursosExternos() != null) {
            Boolean esRecursosExternos;
            if (registrarDatosLineaCreditoVORow.getEsRecursosExternos().intValue() == ES_RECURSOS_ORDINARIOS_FALSE) {
                esRecursosExternos = false;
                logger.log(ADFLogger.WARNING, "setRecursosExternos: " + esRecursosExternos);
                lineaCredito.setRecursosExternos(esRecursosExternos);
            } else {
                esRecursosExternos = true; // TODO NO está actualizando en servicio este valor (By FCP 23/dic/2015)
                logger.log(ADFLogger.WARNING, "setRecursosExternos: " + esRecursosExternos);
                lineaCredito.setRecursosExternos(esRecursosExternos);
            }
        }
        //Producto
        if (catProductoLOV.getCurrentRow() != null) {
            Flexcube flexcube = new Flexcube();
            String idProductoFlexcube = (String) catProductoLOV.getCurrentRow().getAttribute("Id");
            flexcube.setIdProductoFlexcube(idProductoFlexcube);
            lineaCredito.setFlexcube(flexcube);
        }
        //Condiciones financieras
        //Fecha de apertura
        if (registrarDatosLineaCreditoVORow.getFechaValor() != null) {
            GregorianCalendar cFechaValor = new GregorianCalendar();
            cFechaValor.setTimeInMillis(registrarDatosLineaCreditoVORow.getFechaValor().getTime());
            try {
                //Actualiza en fechaValor lineaCredito
                lineaCredito.setFechaValor(DatatypeFactory.newInstance().newXMLGregorianCalendar(cFechaValor));
                //Actualiza el valor de la fecha de vigencia
                contrato.setFechaVigencia(DatatypeFactory.newInstance().newXMLGregorianCalendar(cFechaValor));
            } catch (Exception ex) {
                //remove, only test
                logger.log(ADFLogger.WARNING,
                           "Exception in if(registrarDatosLineaCreditoVORow.getFechaValor() != null){: " +
                           ex.getMessage());
                logger.log(ADFLogger.ERROR, ex.getClass() + ":" + ex.getMessage());
            }
        }
        //Plazo de financiamiento
        if (registrarDatosLineaCreditoVORow.getPlazoFinanciamiento() != null) {
            lineaCredito.setPlazoFinanciamiento(registrarDatosLineaCreditoVORow.getPlazoFinanciamiento().intValue());
        }
        //Tomar Id de CatPlazoFinanciamientoLOV del row seleccionado en la vista
        if (catPlazoFinanciamientoLOV.getCurrentRow() != null) {
            Integer idPlazoFinanciamiento = (Integer) catPlazoFinanciamientoLOV.getCurrentRow().getAttribute("Id");
            lineaCredito.setFrecuenciaFinanciamiento(idPlazoFinanciamiento.intValue());
        }
        //cierra Plazo de financiamiento
        //Periodo de gracia
        if (registrarDatosLineaCreditoVORow.getPlazoGracia() != null) {
            lineaCredito.setPlazoGracia(registrarDatosLineaCreditoVORow.getPlazoGracia().intValue());
        }
        //Tomar Id de catPeriodoGraciaLOV del row seleccionado en la vista
        if (catPeriodoGraciaLOV.getCurrentRow() != null) {
            Integer idPeriodoGracia = (Integer) catPeriodoGraciaLOV.getCurrentRow().getAttribute("Id");
            lineaCredito.setFrecuenciaGracia(idPeriodoGracia.intValue());
        }
        /////13303 /////13303 /////13303
                //if(catDiasSpotTasaLOV.getCurrentRow()!=null){
                    String idSpotTasaStr=(String)catDiasSpotTasaLOV.getCurrentRow().getAttribute("DiasSpotTasa");
                    System.out.println("spotTasa= "+idSpotTasaStr);
                    if(idSpotTasaStr.equals("No Aplica")){
                        lineaCredito.setDiasSpotTasa(0);
                        logger.log(ADFLogger.WARNING, "Manda la 0 la tasa cuando se selecciona no aplica");
                    }else{
                    logger.log(ADFLogger.WARNING, "Dia seleeccionado "+Integer.valueOf(idSpotTasaStr));
                    lineaCredito.setDiasSpotTasa(new Integer(idSpotTasaStr));
                    }
                //}
                //if(catTipoRedondeo.getCurrentRow()!=null){
                    Integer idRedondeo=(Integer)catTipoRedondeo.getCurrentRow().getAttribute("Id");
                    System.out.println("redondeo= "+idRedondeo);
                    lineaCredito.setIdTcaTipoRedondeo((Long.valueOf(idRedondeo)));
                    if(idRedondeo==0){
                        logger.log(ADFLogger.WARNING, "rounding selected "+Integer.valueOf(idRedondeo)+" se setea nulo cantidad decimles");
                        lineaCredito.setCantidadDecimales(0);
                        }else{
                        System.out.println("cantidadDecimales= "+registrarDatosLineaCreditoVORow.getCantidadDecimales()!=null?registrarDatosLineaCreditoVORow.getCantidadDecimales():"vacio");
                        lineaCredito.setCantidadDecimales(registrarDatosLineaCreditoVORow.getCantidadDecimales()!=null?new Integer(registrarDatosLineaCreditoVORow.getCantidadDecimales()):0);
                        }
                //}
                //if(catMora.getCurrentRow()!=null){
                    Integer idMora=(Integer)catMora.getCurrentRow().getAttribute("Id");
                    System.out.println("Mora= "+idMora);
                    if(idMora==1) {
                    lineaCredito.setIdTcaTipoMora(new Long(1));
                    logger.log(ADFLogger.WARNING, "Inter?s Ordinario + Spread de mora");
                    System.out.println("spreadTasa o valorDelFactor= "+registrarDatosLineaCreditoVORow.getSpreadTasa()!=null?registrarDatosLineaCreditoVORow.getSpreadTasa():"vacio");  
                    lineaCredito.setSpreadTasa(registrarDatosLineaCreditoVORow.getSpreadTasa()!=null ? new BigDecimal(registrarDatosLineaCreditoVORow.getSpreadTasa()):new BigDecimal(0));
                    lineaCredito.setValorTasa(new BigDecimal(0));
                    lineaCredito.setCodigoTasaReferencia("");
                    lineaCredito.setFrecuencia(0);
                    lineaCredito.setIdTcaTipoFrecuencia(Long.valueOf(1));
                    }else if(idMora==2){
                        lineaCredito.setIdTcaTipoMora(new Long(2));
                        logger.log(ADFLogger.WARNING, "Inter?s Ordinario * Factor");
                        System.out.println("spreadTasa o valorDelFactor= "+registrarDatosLineaCreditoVORow.getSpreadTasa()!=null?registrarDatosLineaCreditoVORow.getSpreadTasa():"vacio");  
                        lineaCredito.setSpreadTasa(registrarDatosLineaCreditoVORow.getSpreadTasa()!=null ? new BigDecimal(registrarDatosLineaCreditoVORow.getSpreadTasa()):new BigDecimal(0));
                        lineaCredito.setValorTasa(new BigDecimal(0));
                        lineaCredito.setCodigoTasaReferencia("");
                        lineaCredito.setFrecuencia(0);
                        lineaCredito.setIdTcaTipoFrecuencia(Long.valueOf(1));                
                    }
                    else if(idMora==3) {
                    logger.log(ADFLogger.WARNING, "Tasa fija");
                        System.out.println("valorTasa= "+registrarDatosLineaCreditoVORow.getValorTasa()!=null?registrarDatosLineaCreditoVORow.getValorTasa():"vacio");        
                        lineaCredito.setValorTasa(registrarDatosLineaCreditoVORow.getValorTasa()!=null ? new BigDecimal(registrarDatosLineaCreditoVORow.getValorTasa()):new BigDecimal(0));
                        lineaCredito.setSpreadTasa(new BigDecimal(0));
                        lineaCredito.setCodigoTasaReferencia("");
                        lineaCredito.setFrecuencia(0);
                        lineaCredito.setIdTcaTipoFrecuencia(Long.valueOf(1));
                        lineaCredito.setIdTcaTipoMora(new Long(3));
                    }else if(idMora==4) {
                        logger.log(ADFLogger.WARNING, "Tasa variable");
                        lineaCredito.setIdTcaTipoMora(new Long(4));
                        //System.out.println("TasaReferencia= "+registrarDatosLineaCreditoVORow.getCodigoTasaReferencia()!=null? registrarDatosLineaCreditoVORow.getCodigoTasaReferencia():"vacio");        
                        lineaCredito.setCodigoTasaReferencia(registrarDatosLineaCreditoVORow.getCodigoTasaReferencia()!=null?registrarDatosLineaCreditoVORow.getCodigoTasaReferencia():"");
                        //System.out.println("spreadTasa= "+registrarDatosLineaCreditoVORow.getSpreadTasa()!=null?registrarDatosLineaCreditoVORow.getSpreadTasa():"vacio");  
                        lineaCredito.setSpreadTasa(registrarDatosLineaCreditoVORow.getSpreadTasa()!=null ? new BigDecimal(registrarDatosLineaCreditoVORow.getSpreadTasa()):new BigDecimal(0));
                        //System.out.println("frecuencia= "+registrarDatosLineaCreditoVORow.getFrecuencia()!=null?registrarDatosLineaCreditoVORow.getFrecuencia():"vacio");
                        lineaCredito.setFrecuencia(registrarDatosLineaCreditoVORow.getFrecuencia()!=null? new Integer(registrarDatosLineaCreditoVORow.getFrecuencia()):new Integer(0));
                        if(catFrecuencia.getCurrentRow()!=null){
                            Integer idFrecuencia=(Integer)catFrecuencia.getCurrentRow().getAttribute("Id");
                            //System.out.println("Frecuencia= "+idFrecuencia);
                            lineaCredito.setIdTcaTipoFrecuencia(new Long(idFrecuencia));
                            lineaCredito.setValorTasa(new BigDecimal(0));
                        }
                    }
                //}
                /////13303 fin
        //cierra Periodo de gracia
        //Fecha de vencimiento
        //Calculo de fecha de vencimiento
        //Validar que los valores de entrada del metodo no sean null
        if (registrarDatosLineaCreditoVORow.getFechaValor() != null &&
            registrarDatosLineaCreditoVORow.getPlazoFinanciamiento() != null &&
            catPlazoFinanciamientoLOV.getCurrentRow() != null &&
            registrarDatosLineaCreditoVORow.getPlazoGracia() != null && catPeriodoGraciaLOV.getCurrentRow() != null) {
            try {
                //Recupera el id de catPlazoFinanciamientoLOV
                Integer idPlazoFinanciamiento = (Integer) catPlazoFinanciamientoLOV.getCurrentRow().getAttribute("Id");
                //Recupera el id de catPeriodoGraciaLOV
                Integer idPeriodoGracia = (Integer) catPeriodoGraciaLOV.getCurrentRow().getAttribute("Id");
                //Timestamp to XMLGregorianCalendar
                GregorianCalendar cFechaValor = new GregorianCalendar();
                cFechaValor.setTimeInMillis(registrarDatosLineaCreditoVORow.getFechaValor().getTime());
                java.sql.Timestamp fechaVencimiento =
                    calcularFechaDeVencimiento((DatatypeFactory.newInstance().newXMLGregorianCalendar(cFechaValor)),
                                               registrarDatosLineaCreditoVORow.getPlazoFinanciamiento().intValue(),
                                               idPlazoFinanciamiento.intValue(),
                                               registrarDatosLineaCreditoVORow.getPlazoGracia().intValue(),
                                               idPeriodoGracia.intValue());
                //Timestamp to XMLGregorianCalendar
                GregorianCalendar cFechaVencimiento = new GregorianCalendar();
                cFechaVencimiento.setTimeInMillis(fechaVencimiento.getTime());
                lineaCredito.setFechaVencimiento((DatatypeFactory.newInstance().newXMLGregorianCalendar(cFechaVencimiento)));
            } catch (Exception ex) {
                logger.log(ADFLogger.WARNING, "Exception in Calculo de fecha de vencimiento: " + ex.getMessage());
            }
        }
        //        if(registrarDatosLineaCreditoVORow.getFechaVencimiento() != null){
        //            GregorianCalendar cFechaVencimiento = new GregorianCalendar();
        //            cFechaVencimiento.setTimeInMillis(registrarDatosLineaCreditoVORow.getFechaVencimiento().getTime());
        //            try{
        //            lineaCredito.setFechaVencimiento(DatatypeFactory.newInstance().newXMLGregorianCalendar(cFechaVencimiento));
        //            }catch(Exception ex){
        //                //remove, only test
        //                logger.log(ADFLogger.WARNING,"Exception in if(registrarDatosLineaCreditoVORow.getFechaVencimiento() != null){: "
        //                                                              +ex.getMessage());
        //                logger.log(ADFLogger.ERROR,ex.getClass() + ":" + ex.getMessage());
        //            }
        //        }
        //Tratamiento días feriados
        if (catDiasFeriadosLOV.getCurrentRow() != null) {
            String codigoExterno = (String) catDiasFeriadosLOV.getCurrentRow().getAttribute("CodigoExterno");
            lineaCredito.setTratamientoDiasFeriados(codigoExterno);
        }
        //Monto de la línea
        if (registrarDatosLineaCreditoVORow.getMontoLinea() != null) {
            lineaCredito.setMontoLinea(registrarDatosLineaCreditoVORow.getMontoLinea());
        }
        //Restricciones
        //Tasa mínima
        ObjectFactory fact = new ObjectFactory();
        JAXBElement<Double> dbValue = null;
        JAXBElement<Double> val = null;

        if (registrarDatosLineaCreditoVORow.getTasaMinima() != null &&
            registrarDatosLineaCreditoVORow.getTasaMinima() > 0) {
            dbValue =
                fact.createLineaCreditoBasicTypeTasaMinima(new Double(registrarDatosLineaCreditoVORow.getTasaMinima().doubleValue()));
            lineaCredito.setTasaMinima(dbValue);
        } else {
            logger.log(ADFLogger.WARNING, "Tasa minima is null");
            //  val = fact.createLineaCreditoBasicTypeTasaMinima(Double.NaN);
            //  lineaCredito.setTasaMinima(val);
        }
        //Tasa máxima
        if (registrarDatosLineaCreditoVORow.getTasaMaxima() != null &&
            registrarDatosLineaCreditoVORow.getTasaMaxima() > 0) {
            dbValue =
                fact.createLineaCreditoBasicTypeTasaMaxima(new Double(registrarDatosLineaCreditoVORow.getTasaMaxima().doubleValue()));
            lineaCredito.setTasaMaxima(dbValue);
        } else {
            logger.log(ADFLogger.WARNING, "Tasa maxima is null");
            //val = fact.createLineaCreditoBasicTypeTasaMaxima(Double.NaN);
            // lineaCredito.setTasaMaxima(val);
        }
        //Monto mínimo a desembolsar por desembolso
        if (registrarDatosLineaCreditoVORow.getMontoMinimo() != null &&
            registrarDatosLineaCreditoVORow.getMontoMinimo() > 0) {
            dbValue =
                fact.createLineaCreditoBasicTypeMontoMinimo(new Double(registrarDatosLineaCreditoVORow.getMontoMinimo().doubleValue()));
            lineaCredito.setMontoMinimo(dbValue);
        } else {
            logger.log(ADFLogger.WARNING, "Monto minimo is null");
            // val = fact.createLineaCreditoBasicTypeMontoMinimo(Double.NaN);
            // lineaCredito.setMontoMinimo(val);
        }
        //Monto máximo a desembolsar por desembolso
        if (registrarDatosLineaCreditoVORow.getMontoMaximo() != null &&
            registrarDatosLineaCreditoVORow.getMontoMaximo() > 0) {
            dbValue =
                fact.createLineaCreditoBasicTypeMontoMaximo(new Double(registrarDatosLineaCreditoVORow.getMontoMaximo().doubleValue()));
            lineaCredito.setMontoMaximo(dbValue);
        } else {
            logger.log(ADFLogger.WARNING, "Monto maximo is null");
            //  val = fact.createLineaCreditoBasicTypeMontoMaximo(Double.NaN);
            //  lineaCredito.setMontoMaximo(val);
        }
        //Condiciones especiales
        //¿Condición financiera especial?
        if (registrarDatosLineaCreditoVORow.getCondicionEspecial() != null) {
            Boolean condicionEspecial;
            if (registrarDatosLineaCreditoVORow.getCondicionEspecial() == ES_FINANCIERA_ESPECIAL_TRUE) {
                //getCondicionEspecial() == 1 --> true
                condicionEspecial = true;
            } else {
                //getCondicionEspecial() == 0 --> false
                condicionEspecial = false;
            }
            //Asignamos el valor del boolean a setCondicionEspecial
            lineaCredito.setCondicionEspecial(condicionEspecial);
        } else {
            logger.warning("La condicion Especial es nula");
        }
        //Descripción de la condición financiera
        if (registrarDatosLineaCreditoVORow.getDescripcionCondEspecial() != null) {
            lineaCredito.setDescCondEspecial(registrarDatosLineaCreditoVORow.getDescripcionCondEspecial());
        } else {
            //Si descripción de la condición financiera es nula, mandar un caracter vacio
            //  SCRUM_FenixII_BCIEFNXII-5657
            //  Post Producción-Fase III-6601-Descripción de condición financiera no se borra.
            logger.warning("Se envia espacio en blanco para la descripcion de condicion especial");
            lineaCredito.setDescCondEspecial(" ");
        }

        //Vencimiento de plazos
        getVencimientoPlazoVO().setRangeSize(-1);
        Row[] vencimientoPlazoRows = getVencimientoPlazoVO().getAllRowsInRange();
        for (Row row : vencimientoPlazoRows) {
            org.bcie.terminobo.Termino termino = new org.bcie.terminobo.Termino();
            //IdVencimiento
            if (row.getAttribute("IdVencimiento") != null) {
                Long idLong = (Long) row.getAttribute("IdVencimiento");
                termino.setIdTermino(idLong.longValue());
            }
            //IdTipoDeVencimiento
            if (row.getAttribute("IdTipoDeVencimiento") != null) {
                org.bcie.terminobo.CatalogoTermino catalogoTermino = new org.bcie.terminobo.CatalogoTermino();
                Long idTipoVencimiento = (Long) row.getAttribute("IdTipoDeVencimiento");
                catalogoTermino.setIdCatTermino(idTipoVencimiento);
                termino.setTipoTermino(catalogoTermino);
            }
            //IdTipoDeFecha
            if (row.getAttribute("IdTipoDeFecha") != null) {
                org.bcie.catalogobo.Catalogo catalogo = new org.bcie.catalogobo.Catalogo();
                Long idTipoDeFecha = (Long) row.getAttribute("IdTipoDeFecha");
                catalogo.setId(idTipoDeFecha);
                termino.setTipoFechaInicio(catalogo);
            }
            //FechaInicio
            if (row.getAttribute("FechaInicio") != null) {
                try {
                    GregorianCalendar fechaInicioCalendar = new GregorianCalendar();
                    java.sql.Timestamp fechaInicioTimeStamp = (java.sql.Timestamp) row.getAttribute("FechaInicio");
                    fechaInicioCalendar.setTimeInMillis(fechaInicioTimeStamp.getTime());
                    termino.setFechaInicio(DatatypeFactory.newInstance().newXMLGregorianCalendar(fechaInicioCalendar));
                } catch (Exception e) {
                    logger.log(ADFLogger.WARNING,
                               "Exception in mappingActualizarLineaCredito " +
                               "in row.getAttribute(\"FechaInicio\"): " + e.getMessage());
                }
            }
            //Plazo
            if (row.getAttribute("Plazo") != null) {
                String plazoString = (String) row.getAttribute("Plazo");
                termino.setPlazo(Integer.valueOf(plazoString).intValue());
            }
            //IdPlazo
            if (row.getAttribute("IdPlazo") != null) {
                org.bcie.catalogobo.Catalogo catalogo = new org.bcie.catalogobo.Catalogo();
                Long idPlazo = (Long) row.getAttribute("IdPlazo");
                catalogo.setId(idPlazo);
                termino.setFrecuenciaPlazo(catalogo);
            }
            //FechaVencimiento
            if (row.getAttribute("FechaVencimiento") != null) {
                try {
                    GregorianCalendar fechaVencimientoCalendar = new GregorianCalendar();
                    java.sql.Timestamp fechaVencimientoTimeStamp =
                        (java.sql.Timestamp) row.getAttribute("FechaVencimiento");
                    fechaVencimientoCalendar.setTimeInMillis(fechaVencimientoTimeStamp.getTime());
                    termino.setFechaVencimiento(DatatypeFactory.newInstance().newXMLGregorianCalendar(fechaVencimientoCalendar));
                } catch (Exception e) {
                    logger.log(ADFLogger.WARNING,
                               "Exception in mappingActualizarLineaCredito " +
                               "in row.getAttribute(\"FechaVencimiento\"): " + e.getMessage());
                }
            }
            //Estado
            if (row.getAttribute("Estado") != null) {
                Boolean estado = (Boolean) row.getAttribute("Estado");
                termino.setEstado(estado);
            }
            //Agrega Termino
            lineaCredito.getTermino().add(termino);
        }

        //Comisiones
        getComisionVO().setRangeSize(-1);
        Row[] comisionRows = getComisionVO().getAllRowsInRange();
        for (Row row : comisionRows) {
            org.bcie.comisionbo.Comision comision = new org.bcie.comisionbo.Comision();
            //idComision si existe se actualiza, si no existe se crea
            if (row.getAttribute("IdComision") != null) {
                Long idLong = (Long) row.getAttribute("IdComision");
                comision.setIdComision(idLong.longValue());
            }
            //idTipoComision
            if (row.getAttribute("IdTipoComision") != null) {
                org.bcie.comisionbo.CatalogoComision catalogo = new org.bcie.comisionbo.CatalogoComision();

                logger.log(ADFLogger.WARNING, "REVM idTipoComision: " + row.getAttribute("IdTipoComision"));
                Long idTipoComision = (Long) row.getAttribute("IdTipoComision");
                catalogo.setIdCatComision(idTipoComision);
                comision.setTipoComision(catalogo);
            }
            //idFrecuencia
            if (row.getAttribute("IdFrecuencia") != null) {
                try {
                    logger.warning("IdFrecuencia: " + String.valueOf(row.getAttribute("IdFrecuencia")));
                    org.bcie.catalogobo.Catalogo catalogo = new org.bcie.catalogobo.Catalogo();
                    Long idTipoFrecuencia = (Long) row.getAttribute("IdFrecuencia");
                    catalogo.setId(idTipoFrecuencia);
                    comision.setTipoFrecuencia(catalogo);
                } catch (Exception e) {
                    logger.severe("Error en el atributo IdFrecuencia ", e);
                }
            }
            //frecuencia
            if (row.getAttribute("Frecuencia") != null) {
                try {
                    logger.warning("Frecuencia: " + String.valueOf(row.getAttribute("Frecuencia")));
                    String frecuenciaString = (String) row.getAttribute("Frecuencia");
                    comision.setFrecuenciaPago(Integer.valueOf(frecuenciaString));
                } catch (Exception e) {
                    logger.severe("Error en el atributo Frecuencia ", e);
                }
            }
            //IdBaseCalculo
            if (row.getAttribute("IdBaseCalculo") != null) {
                try {
                    logger.warning("IdBaseCalculo: " + String.valueOf(row.getAttribute("IdBaseCalculo")));
                    org.bcie.catalogobo.Catalogo catalogo = new org.bcie.catalogobo.Catalogo();
                    Long idBaseCalculo = (Long) row.getAttribute("IdBaseCalculo");
                    catalogo.setId(idBaseCalculo);
                    comision.setBaseCalculo(catalogo);
                } catch (Exception e) {
                    logger.severe("Error en el atributo IdBaseCalculo ", e);
                }
            }
            //Porcentaje
            if (row.getAttribute("Porcentaje") != null) {
                try {
                    logger.warning("Porcentaje: " + String.valueOf(row.getAttribute("Porcentaje")));
                    MontoBase montoBase = new MontoBase();
                    String porcentajeString = (String) row.getAttribute("Porcentaje");
                    String porcentajeSin = porcentajeString.replaceAll("%", "");
                    java.math.BigDecimal porcentaje = new java.math.BigDecimal(porcentajeSin.replaceAll(",", ""));
                    montoBase.setPorcentajeMontoBase(porcentaje);
                    comision.setMontoBase(montoBase);
                } catch (Exception e) {
                    logger.severe("Error en el atributo Porcentaje ", e);
                }
            }
            //Estado
            if (row.getAttribute("Estado") != null) {
                try {
                    logger.warning("Estado: " + String.valueOf(row.getAttribute("Estado")));
                    Boolean estado = (Boolean) row.getAttribute("Estado");
                    comision.setEstado(estado);
                } catch (Exception e) {
                    logger.severe("Error en el atributo Estado ", e);
                }
            }

            //Mapear Nombre
            if (row.getAttribute("TipoComision") != null) {
                try {
                    logger.warning("TipoComision: " + String.valueOf(row.getAttribute("TipoComision")));
                    comision.setDescripcion((String) row.getAttribute("TipoComision"));
                } catch (Exception e) {
                    logger.severe("Error en el atributo TipoComision ", e);
                }
            }
            //Mapear Codigo
            if (row.getAttribute("CodigoComision") != null) {
                logger.warning("CodigoComision: " + String.valueOf(row.getAttribute("CodigoComision")));
                comision.setNombre((String) row.getAttribute("CodigoComision"));
            }

            //Agrega comision
            lineaCredito.getComision().add(comision);
        }

        // Se agrega bandera MontoEstado por FNXII-6667
        // [KB:14513] Se solicita no tener en cuenta esta validacion para casos como formalizacion de enmiendas. Usa bandera para omitir validacion.
        if (validarCambioMonto && esMontoLineaCreditoModificado(registrarDatosLineaCreditoVORow)) {
            lineaCredito.setEstadoMonto(Boolean.TRUE);
        }

        //Agregar el objeto de lineaCredito al objeto de contrato que se retorna del metodo y se envia al request
        contrato.getLineaCredito().add(lineaCredito);


        return contrato;
    }

    public java.sql.Timestamp calcularFechaDeVencimiento(XMLGregorianCalendar fechaApertura, int plazoFinanciamiento,
                                                         int frecuenciaFinanciamiento, int plazoGracia,
                                                         int frecuenciaGracia) {
        GregorianCalendar fechaVencimientoCalendar = fechaApertura.toGregorianCalendar();

        //Sumar el valor de plazoFinanciamiento, depende de  frecuenciaFinanciamiento
        //frecuenciaFinanciamiento == 1 --> suman dias
        //frecuenciaFinanciamiento == 2 --> suman meses
        //frecuenciaFinanciamiento == 3 --> suman años
        //Validar que contenga un valor y un id mayor a 0
        if (plazoFinanciamiento > 0 && frecuenciaFinanciamiento > 0) {
            //frecuenciaFinanciamiento == 1 --> suman dias
            if (frecuenciaFinanciamiento == TIPO_PLAZO_DIA) {
                fechaVencimientoCalendar.add(GregorianCalendar.DAY_OF_YEAR, plazoFinanciamiento);
            }
            //frecuenciaFinanciamiento == 2 --> suman meses
            if (frecuenciaFinanciamiento == TIPO_PLAZO_MES) {
                fechaVencimientoCalendar.add(GregorianCalendar.MONTH, plazoFinanciamiento);
            }
            //frecuenciaFinanciamiento == 3 --> suman años
            if (frecuenciaFinanciamiento == TIPO_PLAZO_ANIO) {
                fechaVencimientoCalendar.add(GregorianCalendar.YEAR, plazoFinanciamiento);
            }
        }

        // Se comenta la suma del periodo de gracia por la solicitud de cambio relacionada al Kambanize 2764
        //Validar que contenga un valor y un id mayor a 0
        /*if(plazoGracia >0 && frecuenciaGracia >0){
            //frecuenciaFinanciamiento == 1 --> suman dias
            if(frecuenciaGracia == TIPO_PLAZO_DIA){
                fechaVencimientoCalendar.add(GregorianCalendar.DAY_OF_YEAR,plazoGracia);
            }
            //frecuenciaFinanciamiento == 2 --> suman meses
            if(frecuenciaGracia == TIPO_PLAZO_MES){
                fechaVencimientoCalendar.add(GregorianCalendar.MONTH,plazoGracia);
            }
            //frecuenciaFinanciamiento == 3 --> suman años
            if(frecuenciaGracia == TIPO_PLAZO_ANIO){
                fechaVencimientoCalendar.add(GregorianCalendar.YEAR,plazoGracia);
            }

        }
        */
        //Asignar el valor de fechaVencimiento calculado apoartir de fechaVencimientoCalendar
        java.sql.Timestamp fechaVencimiento = new java.sql.Timestamp(fechaVencimientoCalendar.getTimeInMillis());

        return fechaVencimiento;
    }

    /**
        * Termina - PC05Formalizacion - Registrar datos de linea de credito
        * */


    /**
     * Container's getter for LineaCreditoVO1.
     * @return LineaCreditoVO1
     */
    public LineaCreditoVOImpl getLineaCreditoVO() {
        return (LineaCreditoVOImpl) findViewObject("LineaCreditoVO");
    }

    /**
     * Container's getter for RegistrarFechaVigenciaVO1.
     * @return RegistrarFechaVigenciaVO1
     */
    public RegistrarFechaVigenciaVOImpl getRegistrarFechaVigenciaVO() {
        return (RegistrarFechaVigenciaVOImpl) findViewObject("RegistrarFechaVigenciaVO");
    }

    /**
     * Container's getter for DecisionReunionAprobacionVO.
     * @return DecisionReunionAprobacionVO
     */
    public DecisionReunionAprobacionVOImpl getDecisionReunionAprobacionVO() {
        return (DecisionReunionAprobacionVOImpl) findViewObject("DecisionReunionAprobacionVO");
    }


    /**
     * Container's getter for TcaLugarAprobacionLOV1.
     * @return TcaLugarAprobacionLOV1
     */
    public TcaLugarAprobacionLOVImpl getTcaLugarAprobacionLOV() {
        return (TcaLugarAprobacionLOVImpl) findViewObject("TcaLugarAprobacionLOV");
    }

    /**
     * Container's getter for CatFondoContableVO1.
     * @return CatFondoContableVO1
     */
    public CatFondoContableVOImpl getCatFondoContableVO() {
        return (CatFondoContableVOImpl) findViewObject("CatFondoContableVO");
    }

    /**
     * Container's getter for CatTipoFrecuenciaVO1.
     * @return CatTipoFrecuenciaVO1
     */
    public CatTipoFrecuenciaVOImpl getCatTipoFrecuenciaVO() {
        return (CatTipoFrecuenciaVOImpl) findViewObject("CatTipoFrecuenciaVO");
    }

    /**
     * Container's getter for CatDiasFeriadosVO1.
     * @return CatDiasFeriadosVO1
     */
    public CatDiasFeriadosVOImpl getCatDiasFeriadosVO() {
        return (CatDiasFeriadosVOImpl) findViewObject("CatDiasFeriadosVO");
    }

    /**
     * Container's getter for CatFechaInicioVO1.
     * @return CatFechaInicioVO1
     */
    public ViewObjectImpl getCatFechaInicioVO() {
        return (ViewObjectImpl) findViewObject("CatFechaInicioVO");
    }

    /**
     * Container's getter for CatBaseCalculoVO1.
     * @return CatBaseCalculoVO1
     */
    public ViewObjectImpl getCatBaseCalculoVO() {
        return (ViewObjectImpl) findViewObject("CatBaseCalculoVO");
    }

    public Boolean activarOpinion(String idOperacion) {
        Boolean resultado = Boolean.TRUE;
        Long publicoCGarantiaSob = 11L;
        if (idOperacion instanceof String && idOperacion.length() > 0) {
            String wsdl = getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
            } catch (Exception ex) {
            }

            ConsultarOperacionByIdOperacionRequestType request = new ConsultarOperacionByIdOperacionRequestType();
            request.setIdOperacion(Long.parseLong(idOperacion));
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTIVAR_OPINION);
            ConsultarOperacionResponseType obtenerOperacion = operacion12Port.consultarOperacionByIdOperacion(request);
            ModelUtils.logEndWS(logger, obtenerOperacion, FenixModelConstants.WSC_ACTIVAR_OPINION, horaInicio);

            List<Operacion> listaOperqacionesObtenidas = obtenerOperacion.getOperacion();
            if (!listaOperqacionesObtenidas.isEmpty()) {

                Operacion operacionUnica = listaOperqacionesObtenidas.get(0);
                logger.log(ADFLogger.WARNING,
                           ">HNWSSector Sector Mercado id " + operacionUnica.getSectorMercado().getId() + " Nombre " +
                           operacionUnica.getSectorMercado().getDescripcion());
                if (publicoCGarantiaSob.compareTo(operacionUnica.getSectorMercado().getId()) == 0) {
                    resultado = Boolean.FALSE;
                }
            }
        }


        return resultado;
    }

    /**
     * Container's getter for RespuestaComentarioVO1.
     * @return RespuestaComentarioVO1
     */
    public RespuestaComentarioVOImpl getRespuestaComentarioValidacionVO() {
        return (RespuestaComentarioVOImpl) findViewObject("RespuestaComentarioValidacionVO");
    }


    /**
     * Container's getter for FuenteVO1.
     * @return FuenteVO1
     */
    public FuenteVOImpl getFuentesAsignadasVO() {
        return (FuenteVOImpl) findViewObject("FuentesAsignadasVO");
    }

    /**
     * Container's getter for LineaCreditoAndFuenteVL1.
     * @return LineaCreditoAndFuenteVL1
     */
    public ViewLinkImpl getLineaCreditoAndFuenteVL() {
        return (ViewLinkImpl) findViewLink("LineaCreditoAndFuenteVL");
    }


    /**
     * Container's getter for RegistrarLineaCreditoAprobacionVO1.
     * @return RegistrarLineaCreditoAprobacionVO1
     */
    public RegistrarLineaCreditoAprobacionVOImpl getRegistrarLineaCreditoAprobacionVO() {
        return (RegistrarLineaCreditoAprobacionVOImpl) findViewObject("RegistrarLineaCreditoAprobacionVO");
    }

    /**
     * Container's getter for RegistrarLineaCreditoAprobacionActionsVO1.
     * @return RegistrarLineaCreditoAprobacionActionsVO1
     */
    public ViewObjectImpl getRegistrarLineaCreditoAprobacionActionsVO() {
        return (ViewObjectImpl) findViewObject("RegistrarLineaCreditoAprobacionActionsVO");
    }

    /*
     * Container's getter for CatCuentaClienteLOV1.
     * @return CatCuentaClienteLOV1
     */

    /**
     * Container's getter for RespuestaComentarioOperacionVO1.
     * @return RespuestaComentarioOperacionVO1
     */
    public RespuestaComentarioOperacionVOImpl getRespuestaComentarioOperacionVO() {
        return (RespuestaComentarioOperacionVOImpl) findViewObject("RespuestaComentarioOperacionVO");
    }

    /**
     * Container's getter for ComiteVotoReunionVO1.
     * @return ComiteVotoReunionVO1
     */
    public ComiteVotoReunionVOImpl getComiteVotoReunionVO() {
        return (ComiteVotoReunionVOImpl) findViewObject("ComiteVotoReunionVO");
    }

    /**
     * Container's getter for CatProductoFlexcubeLOV1.
     * @return CatProductoFlexcubeLOV1
     */
    public CatProductoFlexcubeLOVImpl getCatProductoFlexcubeLOV() {
        return (CatProductoFlexcubeLOVImpl) findViewObject("CatProductoFlexcubeLOV");
    }

    /**
     * Container's getter for RegistrarDatosLineaCreditoVO1.
     * @return RegistrarDatosLineaCreditoVO1
     */
    public RegistrarDatosLineaCreditoVOImpl getRegistrarDatosLineaCreditoVO() {
        return (RegistrarDatosLineaCreditoVOImpl) findViewObject("RegistrarDatosLineaCreditoVO");
    }

    /**
     * Container's getter for CatCuentaClienteLOV1.
     * @return CatCuentaClienteLOV1
     */
    public CatCuentaClienteLOVImpl getCatCuentaClienteLOV() {
        return (CatCuentaClienteLOVImpl) findViewObject("CatCuentaClienteLOV");
    }

    /**
     * Container's getter for EncabezadoRegistrarDatosLineaCreditoVO1.
     * @return EncabezadoRegistrarDatosLineaCreditoVO1
     */
    public EncabezadoRegistrarDatosLineaCreditoVOImpl getEncabezadoRegistrarDatosLineaCreditoVO() {
        return (EncabezadoRegistrarDatosLineaCreditoVOImpl) findViewObject("EncabezadoRegistrarDatosLineaCreditoVO");
    }


    /**
     * Container's getter for UsuReunionRolBPMLOV1.
     * @return UsuReunionRolBPMLOV1
     */
    public UsuReunionRolBPMLOVImpl getUsuReunionRolBPMLOV() {
        return (UsuReunionRolBPMLOVImpl) findViewObject("UsuReunionRolBPMLOV");
    }

    /**
     * Container's getter for CatPlazoFinanciamientoLOV1.
     * @return CatPlazoFinanciamientoLOV1
     */
    public CatPlazoFinanciamientoLOVImpl getCatPlazoFinanciamientoLOV() {
        return (CatPlazoFinanciamientoLOVImpl) findViewObject("CatPlazoFinanciamientoLOV");
    }

    /**
     * Container's getter for CatPeriodoGraciaLOV1.
     * @return CatPeriodoGraciaLOV1
     */
    public CatPeriodoGraciaLOVImpl getCatPeriodoGraciaLOV() {
        return (CatPeriodoGraciaLOVImpl) findViewObject("CatPeriodoGraciaLOV");
    }

    /**
     * Container's getter for CatPlazoVencimientoLOV1.
     * @return CatPlazoVencimientoLOV1
     */
    public CatPlazoVencimientoLOVImpl getCatPlazoVencimientoLOV() {
        return (CatPlazoVencimientoLOVImpl) findViewObject("CatPlazoVencimientoLOV");
    }


    /**
     * Container's getter for AgregarFuentePorLineaCreditoVO1.
     * @return AgregarFuentePorLineaCreditoVO1
     */
    public AgregarFuentePorLineaCreditoVOImpl getAgregarFuentePorLineaCreditoVO() {
        return (AgregarFuentePorLineaCreditoVOImpl) findViewObject("AgregarFuentePorLineaCreditoVO");
    }

    /**
     * Container's getter for RegistrarFechaFormalizacionAprobacionVO1.
     * @return RegistrarFechaFormalizacionAprobacionVO1
     */
    public RegistrarFechaFormalizacionAprobacionVOImpl getRegistrarFechaFormalizacionAprobacionVO() {
        return (RegistrarFechaFormalizacionAprobacionVOImpl) findViewObject("RegistrarFechaFormalizacionAprobacionVO");
    }

    /**
     * Container's getter for RegistrarCondicionAprobacionActionsVO1.
     * @return RegistrarCondicionAprobacionActionsVO1
     */
    public ViewObjectImpl getRegistrarCondicionAprobacionActionsVO() {
        return (ViewObjectImpl) findViewObject("RegistrarCondicionAprobacionActionsVO");
    }

    /**
     * Container's getter for RegistrarCondicionAprobacionVO1.
     * @return RegistrarCondicionAprobacionVO1
     */
    public ViewObjectImpl getRegistrarCondicionAprobacionVO() {
        return (ViewObjectImpl) findViewObject("RegistrarCondicionAprobacionVO");
    }

    /**
     * Container's getter for RegistrarDatosAprobacionVO1.
     * @return RegistrarDatosAprobacionVO1
     */
    public RegistrarDatosAprobacionVOImpl getRegistrarDatosAprobacionVO() {
        return (RegistrarDatosAprobacionVOImpl) findViewObject("RegistrarDatosAprobacionVO");
    }


    /**
     * Container's getter for VencimientoPlazoVO1.
     * @return VencimientoPlazoVO1
     */
    public VencimientoPlazoVOImpl getVencimientoPlazoVO() {
        return (VencimientoPlazoVOImpl) findViewObject("VencimientoPlazoVO");
    }

    /**
     * Container's getter for MontoOperacionVO1.
     * @return MontoOperacionVO1
     */
    public MontoOperacionVOImpl getMontoOperacionVO() {
        return (MontoOperacionVOImpl) findViewObject("MontoOperacionVO");
    }


    /**
     * Container's getter for ComisionVO1.
     * @return ComisionVO1
     */
    public ComisionVOImpl getComisionVO() {
        return (ComisionVOImpl) findViewObject("ComisionVO");
    }

    /**
     * Container's getter for AgregarVencimientoPlazoVO1.
     * @return AgregarVencimientoPlazoVO1
     */
    public AgregarVencimientoPlazoVOImpl getAgregarVencimientoPlazoVO() {
        return (AgregarVencimientoPlazoVOImpl) findViewObject("AgregarVencimientoPlazoVO");
    }

    /**
     * Container's getter for AgregarComisionVO1.
     * @return AgregarComisionVO1
     */
    public AgregarComisionVOImpl getAgregarComisionVO() {
        return (AgregarComisionVOImpl) findViewObject("AgregarComisionVO");
    }

    /**
     * Container's getter for TiposComisionLOV1.
     * @return TiposComisionLOV1
     */
    public TiposComisionLOVImpl getTiposComisionLOV() {
        return (TiposComisionLOVImpl) findViewObject("TiposComisionLOV");
    }

    /**
     * Propaga lineas a flexcube.
     * [KB:14513] Refactoriza este metodo para que se pueda enviar ua fechaValor especifica a flexcube.
     */
    public String propagarLineaCredito(String loginUsuario) {
        //[KB:14513] Refactoriza
        return propagarLineaCredito(loginUsuario, null);
    }

     /**
      * Propaga lineas a flexcube.
      * [KB:14513] Refactoriza este metodo para que se pueda enviar ua fechaValor especifica a flexcube.
      */
     public String propagarLineaCredito(String loginUsuario, Timestamp fechaValor) {
         logger.warning("Inicia propagarLineaCredito");

         logger.warning("Login Usuario: " + loginUsuario);
         //Boolean resultado=Boolean.TRUE;
         String resultado = null;
         ViewObjectImpl datosLineaCreditoVO = getDatosLineaCreditoVO();
         Integer errores = 0;
         Row[] row = datosLineaCreditoVO.getAllRowsInRange();
         Long idLineaCred = 0L;

         if (row != null && row.length > 0) {
             logger.warning("Se encontraron " + row.length + " lineas para propagar");
         } else {
             logger.severe("Error no se obtuvieron lineas para propagar");
             JboException exception =
                 new JboException("Error. No se obtuvieron l\u00EDneas de cr\u00E9dito que propagar");
             throw exception;
         }

         String idFlex = "";
         ArrayList<Long> listIdLineaCredito = new ArrayList<Long>();
         try {
             for (Row row1 : row) {
                 idFlex = "";
                 idLineaCred = (Long) row1.getAttribute("Id");
                 boolean existe = listIdLineaCredito.contains(idLineaCred);
                 
                 if(!existe){
                     logger.warning("Se lee la linea: " + idLineaCred + " para validar si se debe propagar");
     
                     logger.warning("Se lee IdFlexcube para la linea: " + idLineaCred);
                     idFlex = (String) row1.getAttribute("IdFlexcube");  
                     
                     if (errores == 0) {
                           logger.warning("idLineaCred: " + idLineaCred + " tiene el idFlex: " + idFlex);
     //                        if( idFlex.length() <= 0 ) {
                             logger.warning("Se invoca metodo para consumir servicio de propagar linea");
                             resultado = validaLineaCredito(idLineaCred, fechaValor);
                             if (!resultado.equalsIgnoreCase("Pasa")) {
                                 errores = 1;
                                 logger.severe("Error al propagara Linea: " + idLineaCred);
                             } 
                             else {
                                 logger.warning("Se propaga Linea: " + idLineaCred);
                             } 
                         }
     //                        else {
     //                            logger.warning("idLineaCred: " + idLineaCred + " tiene el idFlex: " + idFlex);
     //                        }
                 }
                 else
                 {
                     logger.warning("La linea: " + idLineaCred + " ya fue ejecutada anteriormente");
                 }
                 
                 listIdLineaCredito.add(idLineaCred);
             }
         } catch (Exception e) {

             logger.log(ADFLogger.ERROR, "Error en crearLinea " + e.getClass() + ":" + e.getMessage());
             //resultado= Boolean.FALSE;
             JboException exception = new JboException("Error: " + e.getMessage());
             throw exception;
         }

         if (errores == 0) {
             resultado = "Pasa";
         }

         logger.warning("Termina propagarLineaCredito. Return: " + resultado);
         return resultado;
     }
     

    public String propagarLineaCreditoInstancia(String loginUsuario, String instanciaProceso) {
        
       logger.warning("Inicio propagarLineaCreditoInstancia 2" + loginUsuario);
       logger.warning("Login Usuario: " + loginUsuario);
       logger.warning("instanciaProceso: " + instanciaProceso);
        return propagarLineaCreditoInstancia(loginUsuario, null, instanciaProceso);
    }

    public String propagarLineaCreditoInstancia(String loginUsuario, Timestamp fechaValor, String instanciaProceso) {
       logger.warning("Inicia propagarLineaCreditoInstancia 3");

       logger.warning("Login Usuario: " + loginUsuario);
       //Boolean resultado=Boolean.TRUE;
       String resultado = null;
       ViewObjectImpl datosLineaCreditoVO = getDatosLineaCreditoVO();
       Integer errores = 0;
       Row[] row = datosLineaCreditoVO.getAllRowsInRange();
       Long idLineaCred = 0L;
       Integer idContrato = 0;
       Long idContratoLong = 0L;
       String numeroLineaCred = "";
       String estadoLineaCredito = "";

       if (row != null && row.length > 0) {
           logger.warning("Se encontraron " + row.length + " lineas para propagar");
       } else {
           logger.severe("Error no se obtuvieron lineas para propagar");
           JboException exception =
               new JboException("Error. No se obtuvieron l\u00EDneas de cr\u00E9dito que propagar");
           throw exception;
       }

        String idFlex = "";
        ArrayList<Long> listIdLineaCredito = new ArrayList<Long>();
        try {
            for (Row row1 : row) {
               
                try{
                    idFlex = "";
                    idLineaCred = row1.getAttribute("Id") != null ? (Long) row1.getAttribute("Id") : 0L;
                    logger.warning("idLineaCred:  " + idLineaCred);
                    idContrato = row1.getAttribute("IdContrato") != null ? (Integer) row1.getAttribute("IdContrato") : 0;
                    logger.warning("idContrato:  " + idContrato);
                    idContratoLong = idContrato != null ? Long.valueOf(idContrato) : 0L;
                    logger.warning("idContratoLong:  " + idContratoLong);
                    numeroLineaCred = row1.getAttribute("NumeroLineaCredito") != null ? (String) row1.getAttribute("NumeroLineaCredito") : "";
                    logger.warning("numeroLineaCred:  " + numeroLineaCred);


                    estadoLineaCredito = this.EstadoTBILineaCredito(idContratoLong, idLineaCred, instanciaProceso, numeroLineaCred);
                    logger.warning("estadoLineaCredito: " + estadoLineaCredito + " para validar si se debe propagar de idLineaCred: " + idLineaCred);
                   
                }catch(Exception exp ){
                   logger.warning("propagarLineaCreditoInstancia: " + exp.getMessage());
                }
                
                idFlex = "";
                idLineaCred = (Long) row1.getAttribute("Id");
                boolean existe = listIdLineaCredito.contains(idLineaCred);
                
                if(!existe){
                    logger.warning("Se lee la linea: " + idLineaCred + " para validar si se debe propagar");
        
                    logger.warning("Se lee IdFlexcube para la linea: " + idLineaCred);
                    idFlex = (String) row1.getAttribute("IdFlexcube");  
                    
                    if (errores == 0) {
                        logger.warning("idLineaCred: " + idLineaCred + " tiene el idFlex: " + idFlex);
    //                        if( idFlex.length() <= 0 ) {
                            logger.warning("Se invoca metodo para consumir servicio de propagar linea");
                            resultado = validaLineaCredito(idLineaCred, fechaValor);

                            if (!resultado.equalsIgnoreCase("Pasa")) {
                                errores = 1;
                                logger.severe("Error al propagara Linea: " + idLineaCred);
                            } 
                            else {
                                logger.warning("Se propaga Linea: " + idLineaCred);
                            } 
    //                        }
    //                        else {
    //                            logger.warning("idLineaCred: " + idLineaCred + " tiene el idFlex: " + idFlex);
    //                        }
                    }
                }
                else
                {
                    logger.warning("La linea: " + idLineaCred + " ya fue ejecutada anteriormente");
                }
                
                listIdLineaCredito.add(idLineaCred);
            }
        } catch (Exception e) {

            logger.log(ADFLogger.ERROR, "Error en crearLinea " + e.getClass() + ":" + e.getMessage());
            //resultado= Boolean.FALSE;
            JboException exception = new JboException("Error: " + e.getMessage());
            throw exception;
        }

       if (errores == 0) {
           resultado = "Pasa";
       }

       logger.warning("Termina propagarLineaCreditoInstancia. Return: " + resultado);
       return resultado;
    }
    
    /**
     * Valida lineas en flexcube.
     * [KB:14513] Refactoriza este metodo para que se pueda enviar ua fechaValor especifica a flexcube.
     */
    public String validaLineaCredito(Long idLinea) {
        //[KB:14513] Refactoriza
        return validaLineaCredito(idLinea, null);
    }

    /**
     * Valida lineas en flexcube.
     * [KB:14513] Refactoriza este metodo para que se pueda enviar ua fechaValor especifica a flexcube.
     */
    private String validaLineaCredito(Long idLinea, Timestamp fechaValor) {

        String msgError = "1";
        String mensajeError = "";
        String detalleError = "";
        String result = "";
        Boolean existeError = Boolean.FALSE;
        try {
            String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);

            com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito =
                IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
            LineaCreditoPT lineaCreditoPT = lineaCredito.getLineaCredito12Bnd();
            PropagarLineaCreditoRequestType request = new PropagarLineaCreditoRequestType();
            request.setIdLineaCredito(idLinea);
            
            //[KB:14513] Envia fechaValor
            if (fechaValor != null) {
                logger.info("fecha valor recibida.");
                GregorianCalendar contratoFechaValor = new GregorianCalendar();
                contratoFechaValor.setTimeInMillis(fechaValor.getTime());
                
                XMLGregorianCalendar xmlFechaValor =
                    DatatypeFactory.newInstance().newXMLGregorianCalendar(contratoFechaValor);
                
                org.bcie.lineacreditomo.ObjectFactory obfact = new org.bcie.lineacreditomo.ObjectFactory();
                JAXBElement<XMLGregorianCalendar> jaxbFechaValor = obfact.createPropagarLineaCreditoRequestTypeFechaValor(xmlFechaValor);
                
                logger.info("Asignando fecha valor: {0}", jaxbFechaValor.getValue());
                request.setFechaValor(jaxbFechaValor);
            }
            
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_VALIDA_LINEA_CREDITO);
            PropagarLineaCreditoResponsetType propagarLineaCreditoResponseType =
                lineaCreditoPT.propagarLineaCredito(request);
            ModelUtils.logEndWS(logger, propagarLineaCreditoResponseType, FenixModelConstants.WSC_VALIDA_LINEA_CREDITO,
                                horaInicio);

            if (true == propagarLineaCreditoResponseType.getResultado().getResult().value().equals("ERROR")) {

                if (null != propagarLineaCreditoResponseType.getResultado().getMessage() &&
                    propagarLineaCreditoResponseType.getResultado().getMessage().trim().length() > 0) {
                    mensajeError = propagarLineaCreditoResponseType.getResultado().getMessage();
                }
                if (null != propagarLineaCreditoResponseType.getResultado().getError().getErrorDescription() &&
                    propagarLineaCreditoResponseType.getResultado().getError().getErrorDescription().trim().length() >
                    0) {
                    detalleError = propagarLineaCreditoResponseType.getResultado().getError().getErrorDescription();
                }

                existeError = Boolean.TRUE;
                msgError =
                    "La linea de credito: " + idLinea + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                logger.log(ADFLogger.ERROR, "Mensaje " + msgError);
                return msgError;
            } else {
                logger.log(ADFLogger.ERROR, "Pasa");
                return "Pasa";
            }
        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en propagar la linea de credito " + e.getClass() + ":" + e.getMessage());
            msgError = e.getMessage();
            return msgError;
        } finally {
            if (existeError) {
                JboException exception =
                    new JboException("result: " + result + "  message: " + mensajeError + " errorDescription: " +
                                     detalleError);
                throw exception;
            }
        }
    }

    public void setearInformacionDetalleCliente(Number pnIdCliente, String psRazonSocial, Number pnTipoPersona, Number pnSector, 
                                                Number pnPais, Number pnDiaPago, Number pnOficina, String psAbreviatura,
                                                Number pnTipoCliente, Number pnTipoInstitucion, Number pnGrupoEconomico,
                                                String psNumeroIdentificacion,String psBicCode, String psDireccion,
                                                String psEjecutivo, String psIdFlexcube)
    {
        ViewObjectImpl clienteVO = getDetalleClienteVO();
        clienteVO.clearCache();

           DetalleClienteVORowImpl newRow = (DetalleClienteVORowImpl) clienteVO.createRow();

           if (null != pnIdCliente)
               newRow.setAttribute(DetalleClienteVORowImpl.ID, pnIdCliente);
           if (null != psRazonSocial)
               newRow.setAttribute(DetalleClienteVORowImpl.RAZONSOCIAL, psRazonSocial);
           if (null != pnTipoPersona)
               newRow.setAttribute(DetalleClienteVORowImpl.TIPOPERSONA, pnTipoPersona);
           if (null != pnSector)
               newRow.setAttribute(DetalleClienteVORowImpl.SECTOR, pnSector);
           if (null != pnPais)
               newRow.setAttribute(DetalleClienteVORowImpl.PAIS, pnPais);
           if (null != pnDiaPago)
               newRow.setAttribute(DetalleClienteVORowImpl.DIAPAGO, pnDiaPago);
           if (null != pnOficina)
               newRow.setAttribute(DetalleClienteVORowImpl.OFICINA, pnOficina);
           if (null != psAbreviatura)
               newRow.setAttribute(DetalleClienteVORowImpl.ABREVIATURA, psAbreviatura);
           if (null != pnTipoCliente)
               newRow.setAttribute(DetalleClienteVORowImpl.TIPOCLIENTE, pnTipoCliente);
           if (null != pnTipoInstitucion)
               newRow.setAttribute(DetalleClienteVORowImpl.TIPOINSTITUCION, pnTipoInstitucion);
           if (null != pnGrupoEconomico)
               newRow.setAttribute(DetalleClienteVORowImpl.GRUPOECONOMICO, pnGrupoEconomico);
           if (null != psNumeroIdentificacion)
               newRow.setAttribute(DetalleClienteVORowImpl.NUMEROIDENTIFICACION, psNumeroIdentificacion);
           if (null != psBicCode)
                newRow.setAttribute(DetalleClienteVORowImpl.BICCODE, psBicCode);
            if (null != psDireccion)
                newRow.setAttribute(DetalleClienteVORowImpl.DIRECCION, psDireccion);
            if (null != psEjecutivo)
                newRow.setAttribute(DetalleClienteVORowImpl.EJECUTIVO, psEjecutivo);
            if (null != psIdFlexcube)
                newRow.setAttribute(DetalleClienteVORowImpl.IDFLEXCUBE, psIdFlexcube);

           clienteVO.insertRow(newRow);
       }
    /**
     * Container's getter for CargoTramiteVO1.
     * @return CargoTramiteVO1
     */
    public CargoTramiteVOImpl getCargoTramiteVO() {
        return (CargoTramiteVOImpl) findViewObject("CargoTramiteVO");
    }


    public void obtenerComision(String idOperacion, Long idComision) {
        String mensajeError = null;
        Boolean esError = Boolean.FALSE;
        logger.warning("Operacion: " + idOperacion);
        logger.warning("idComision " + idComision);

        CargoTramiteVOImpl consultaCargoTramiteVO = getCargoTramiteVO();
        CargoTramiteVORowImpl newConsultaOperacion = (CargoTramiteVORowImpl) consultaCargoTramiteVO.createRow();
        if (idComision != null && idOperacion != null) {
            Long claveOperacion = new Long(idOperacion);
            try {
                String wsdl = getWsdl(IWsdlLocation.COMISION);

                Comision comision = IWsdlLocation.Service.getInstance(Comision.class, wsdl);
                ComisionPT comisionPT = comision.getComision12Bnd();
                ConsultarComisionRequestType request = new ConsultarComisionRequestType();
                String montoComision = "Monto comisión:";
                String montoValor = "Valor:";
                request.setIdOperacion(claveOperacion);
                request.setIdComision(idComision);
                Long catalogo = null;
                logger.warning("Operacion con variable asignado: " + claveOperacion);

                logger.warning("Operacion en el request: " + request.getIdComision());
                logger.warning("idComision en el request " + request.getIdOperacion());

                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_OBTENER_COMISION);
                ConsultarComisionResponseType response = comisionPT.consultarComision(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_OBTENER_COMISION, horaInicio);

                logger.warning("respuesta:" + response.getResultado().getResult().value());
                if (null != response.getResultado().getResult().value()) {

                    if (response.getResultado().getResult().value() == "OK") {

                        org.bcie.comisionbo.Comision comisionUnica = null;
                        if (response.getComision() != null && response.getComision().size() > 0) {
                            comisionUnica = response.getComision().get(0);
                        }

                        if (Long.toString(comisionUnica.getIdComision()) != null)
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ID, comisionUnica.getIdComision());
                        if (null != comisionUnica.getNombre())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.NOMBRE, comisionUnica.getNombre());
                        if (catalogo != comisionUnica.getMoneda().getId())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDTIPOMONEDA,
                                                              comisionUnica.getMoneda().getId());
                        if (catalogo != comisionUnica.getTipoFrecuencia().getId())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDTIPOFRECUENCIA,
                                                              comisionUnica.getTipoFrecuencia().getId());
                        if (null != comisionUnica.getFechaVencimiento())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.FECHAVENCIMIENTO,
                                                              comisionUnica.getFechaVencimiento());
                        if (catalogo != comisionUnica.getMomentoCobro().getId())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDMOMENTOCOBRO,
                                                              comisionUnica.getMomentoCobro().getId());

                        if (null != Long.toString(comisionUnica.getIdOperacion()))
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDOPERACION,
                                                              comisionUnica.getIdOperacion());
                        if (null != comisionUnica.getFrecuenciaPago())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.FRECUENCIAPAGO,
                                                              comisionUnica.getFrecuenciaPago());
                        if (catalogo != comisionUnica.getEstadoTCC().getId()) {
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDESTADOTCC,
                                                              comisionUnica.getEstadoTCC().getId());
                            Long estadoPagado = 6L;
                            Long estadoPorDispensar = 3L;
                            Long estadoPagar = 4L;
                            String confirmarPago = "Confirmar pago";
                            String dispensarPago = "Confirmar dispensa";
                            String porDispensar = "Dispensar pago";
                            String finalizarTarea = "Finalizar tarea";
                            String colorPago = "Green";
                            String colorDispensar = "Orange";
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESCOBRO, Boolean.TRUE);
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.BTNSALIDA, finalizarTarea);
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESCOLOR, colorDispensar);
                            if (comisionUnica.getEstadoTCC().getId() == estadoPagar) {
                                newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.BTNSALIDA, porDispensar);

                            }
                            if (comisionUnica.getEstadoTCC().getId() == estadoPagado) {
                                newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESCOBRO, Boolean.FALSE);
                                newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.BTNSALIDA, confirmarPago);
                                newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESCOLOR, colorPago);
                            }
                            if (comisionUnica.getEstadoTCC().getId() == estadoPorDispensar) {
                                newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.BTNSALIDA, dispensarPago);
                            }

                        }

                        if (null != Long.toString(comisionUnica.getTipoComision().getIdTipoComision().getId()))
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDTIPOCOMISION,
                                                              comisionUnica.getTipoComision().getIdTipoComision().getId());
                        if (null != comisionUnica.getFondo())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDFONDO, comisionUnica.getFondo());
                        if (null != comisionUnica.getMontoBase().getPorcentajeMontoBase()) {
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.PORCENTAJE,
                                                              comisionUnica.getMontoBase().getPorcentajeMontoBase());
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESTASA, Boolean.TRUE);
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESMONTO, Boolean.FALSE);
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.COMISIONVALOR, montoComision);
                            if (null != comisionUnica.getMontoBase().getIdMontoBase()) {
                                newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.IDMONTOBASE,
                                                                  comisionUnica.getMontoBase().getIdMontoBase());
                            }
                            if (null != comisionUnica.getMontoBase().getValorMontoBase()) {
                                newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.MONTOBASE,
                                                                  comisionUnica.getMontoBase().getValorMontoBase());
                            }
                        } else {
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESTASA, Boolean.FALSE);
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESMONTO, Boolean.TRUE);
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.COMISIONVALOR, montoValor);
                        }
                        if (null != comisionUnica.getMontoComision())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.MONTOCOMISION,
                                                              comisionUnica.getMontoComision());
                        newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.VALIDAR, Boolean.FALSE);

                        if (null != comisionUnica.getEstadoTCC().getDescripcion())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.TIPOESTADOTCC,
                                                              comisionUnica.getEstadoTCC().getDescripcion());

                        if (null != comisionUnica.getMomentoCobro().getDescripcion())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.TIPOMOMENTOCOBRO,
                                                              comisionUnica.getMomentoCobro().getDescripcion());
                        if (null != comisionUnica.getTipoComision().getDescripcion())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.TIPOCOMISION,
                                                              comisionUnica.getTipoComision().getDescripcion());
                        if (null != comisionUnica.getMoneda().getDescripcion())
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.TIPOMONEDA,
                                                              comisionUnica.getMoneda().getDescripcionCorta());

                        if (null != comisionUnica.getTipoFrecuencia().getDescripcion()) {
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.TIPOFRECUENCIA,
                                                              comisionUnica.getTipoFrecuencia().getDescripcion());
                        } else {
                            newConsultaOperacion.setAttribute(CargoTramiteVORowImpl.ESVENCIMIENTO, Boolean.TRUE);
                        }
                        consultaCargoTramiteVO.insertRow(newConsultaOperacion);
                        consultaCargoTramiteVO.setCurrentRow(newConsultaOperacion);

                    }
                    if (response.getResultado().getResult().value() == "ERROR") {

                        if (null != response.getResultado().getMessage()) {
                            mensajeError = response.getResultado().getMessage();
                        }
                        esError = Boolean.TRUE;
                    }
                } else {
                    esError = Boolean.TRUE;
                    mensajeError = "Error al consultar el servicio, intentar más tarde";
                }

            } catch (Exception e) {
                esError = Boolean.TRUE;
                e.printStackTrace();
                logger.log(ADFLogger.ERROR, "Error en ObtenerComision " + e.getClass() + ":" + e.getMessage());
            } finally {
                if (esError) {
                    JboException exception = new JboException("Error: " + mensajeError);
                    throw exception;
                }
            }

        }


    }

    /**
     * Metodo que actuliza los estados y subestados TCC para comisiones, condiciones y terminos segun sea el caso
     * @param idTCC
     * @param idEstadoTcc
     * @param subEstado
     * @param tipoTCC
     * @return
     */
    public Boolean actualizarTCCAdmon(Long idTCC, Long idEstadoTcc, Long subEstado, String tipoTCC) {
        logger.warning("Inicia metodo actualizarTCCAdmon ");
        String mensajeError = null;
        Boolean esError = Boolean.FALSE;
        Boolean respuesta = Boolean.TRUE;
        logger.warning("Id: " + idTCC);
        logger.warning("Estado: " + idEstadoTcc);
        logger.warning("SubEstado: " + subEstado);
        logger.warning("Tipo: " + tipoTCC);


        try {
            String wsdl = getWsdl(IWsdlLocation.MATRIZ);

            MatrizTCC12BndQSService matrizTCC12BndQSService =
                IWsdlLocation.Service.getInstance(MatrizTCC12BndQSService.class, wsdl);
            MatrizTCCPT matrizTCCPT = matrizTCC12BndQSService.getMatrizTCC12BndQSPort();
            // Add your code to call the desired methods.

            ActualizarEstadoTCCRequestType request = new ActualizarEstadoTCCRequestType();
            TCC estadoActual = new TCC();
            ListaTCC listatcc = new ListaTCC();
            if (idEstadoTcc != null) {
                estadoActual.setEstado(idEstadoTcc.intValue());
            }
            if (subEstado != null) {
                estadoActual.setSubEstado(subEstado.intValue());
            }
            estadoActual.setId(idTCC.longValue());
            estadoActual.setTipo(Tipo.fromValue(tipoTCC));
            listatcc.getTCC().add(estadoActual);
            request.setListaTCC(listatcc);

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_TCC_ADMON);
            ActualizarEstadoTCCResponseType response = matrizTCCPT.actualizarEstadoTCC(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_TCC_ADMON, horaInicio);

            if (response.getResultado().getResult().value() == "ERROR") {
                logger.warning("response result error ");
                respuesta = Boolean.FALSE;
                mensajeError = response.getResultado().getMessage();
                if (null != response.getResultado().getError().getErrorDescription())
                    mensajeError = mensajeError.concat(response.getResultado().getError().getErrorDescription());
                esError = Boolean.TRUE;

            }

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error Actualizar TCC ESTADO-SUBESTADO " + e.getClass() + ":" + e.getMessage());
            respuesta = Boolean.FALSE;
            esError = Boolean.TRUE;
        } finally {
            logger.log(ADFLogger.WARNING, "mensajeError");
            if (esError) {
                JboException exception = new JboException("Error: " + mensajeError);
                throw exception;
            }
        }


        return respuesta;
    }

    public Boolean actualizarTCCAdmonEnmienda(Long idOperacion, Long idEnmienda,Long idTCC, Long idTarea) {
        logger.warning("Inicia metodo actualizarTCCAdmonEnmienda ");
        String mensajeError = null;
        Boolean esError = Boolean.FALSE;
        Boolean respuesta = Boolean.TRUE;
        logger.warning("idOperacion: " + idOperacion);
        logger.warning("idEnmienda: " + idEnmienda);
        logger.warning("idTCC: " + idTCC);
        logger.warning("idTarea: " + idTarea); 

        try {
            String wsdl = getWsdl(IWsdlLocation.MATRIZ);

            //org.bcie.matriztccservice.MatrizTCCPTPortClient
            
            MatrizTCC12BndQSService matrizTCC12BndQSService =
                IWsdlLocation.Service.getInstance(MatrizTCC12BndQSService.class, wsdl);
            MatrizTCCPT matrizTCCPT = matrizTCC12BndQSService.getMatrizTCC12BndQSPort();
            // Add your code to call the desired methods.

            ProcesarEnmiendaRequestType request = new ProcesarEnmiendaRequestType();
            request.setPIDOPERACION(idOperacion);
            request.setPIDENMIENDA(idEnmienda);
            request.setPIDTCC(idTCC);
            request.setPIDTAREA(idTarea); 

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_TCC_ADMON);
            ProcesarEnmiendaResponseType response = matrizTCCPT.procesarEnmienda(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_TCC_ADMON, horaInicio);

            if (response.getPESTADOSP().equals("ERROR")) {
                logger.warning("response result error ");
                respuesta = Boolean.FALSE;
                mensajeError = response.getPESTADOSP();
                if (null != response.getPMENSAJESP())
                    mensajeError = mensajeError.concat(response.getPMENSAJESP());
                esError = Boolean.TRUE; 
            }

        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error actualizarTCCAdmonEnmienda " + e.getClass() + ":" + e.getMessage());
            respuesta = Boolean.FALSE;
            esError = Boolean.TRUE;
        } finally {
            logger.log(ADFLogger.WARNING, "mensajeError");
            if (esError) {
                JboException exception = new JboException("Error: " + mensajeError);
                throw exception;
            }
        }

        logger.warning("Finaliza metodo actualizarTCCAdmonEnmienda ");
        return respuesta;
    }
     
   
    /**
     * Container's getter for TramoFormalizarVO1.
     * @return TramoFormalizarVO1
     */
    public TramoFormalizarVOImpl getTramoFormalizarVO() {
        return (TramoFormalizarVOImpl) findViewObject("TramoFormalizarVO");
    }

    /**
     * Container's getter for ParticipanteTramoFormalizarVO1.
     * @return ParticipanteTramoFormalizarVO1
     */
    public ParticipanteTramoFormalizarVOImpl getParticipanteTramoFormalizarVO() {
        return (ParticipanteTramoFormalizarVOImpl) findViewObject("ParticipanteTramoFormalizarVO");
    }

    /**
     * Inicializa la tarea de Cumplir las Condiciones del proceso Admon Condiciones
     * @param idOperacion contiene id de operacion
     * @param codigoTarea contiene codigo de tarea
     * @return devuelve valor booleano, true si la inicializacion fue correcta o false en caso contrario
     */
    public boolean iniTareaCumplirCondiciones(String idOperacion, String codigoTarea) {
        boolean exito = false;

        return exito;
    }

    /**
     * Inicializa la tareas de validacion de condiciones del proceso Admon Condiciones
     * @param idOperacion contiene id de operacion
     * @param codigoTarea contiene codigo de tarea
     * @return devuelve valor booleano, true si la inicializacion fue correcta o false en caso contrario
     */
    public boolean iniTareaValidarCondiciones(String idOperacion, String codigoTarea) {

        boolean exito = false;

        return exito;
    }

    /**
     * Container's getter for AdminContactosVO1.
     * @return AdminContactosVO1
     */
    public AdminContactosVOImpl getAdminContactosVO() {
        return (AdminContactosVOImpl) findViewObject("AdminContactosVO");
    }

    /**
     * Container's getter for OperacionesClienteVO1.
     * @return OperacionesClienteVO1
     */
    public OperacionesClienteVOImpl getOperacionesClienteVO() {
        return (OperacionesClienteVOImpl) findViewObject("OperacionesClienteVO");
    }

    /**
     * Container's getter for ObservacionCondicionVO1.
     * @return ObservacionCondicionVO1
     */
    public ObservacionCondicionVOImpl getObservacionCondicionVO() {
        return (ObservacionCondicionVOImpl) findViewObject("ObservacionCondicionVO");
    }

    /**
     * Container's getter for TcaCategoriaCondicionVO1.
     * @return TcaCategoriaCondicionVO1
     */
    public TcaCategoriaCondicionVOImpl getTcaCategoriaCondicionVO() {
        return (TcaCategoriaCondicionVOImpl) findViewObject("TcaCategoriaCondicionVO");
    }

    /**
     * Container's getter for ComentarioClienteVO1.
     * @return ComentarioClienteVO1
     */
    public ComentarioClienteVOImpl getComentarioClienteVO() {
        return (ComentarioClienteVOImpl) findViewObject("ComentarioClienteVO");
    }

    /**
     * Container's getter for RespuestaComentarioClienteVO1.
     * @return RespuestaComentarioClienteVO1
     */
    public RespuestaComentarioClienteVOImpl getRespuestaComentarioClienteVO() {
        return (RespuestaComentarioClienteVOImpl) findViewObject("RespuestaComentarioClienteVO");
    }

    /**
     * Container's getter for ComentarioAndRespuestaComentarioClienteVL1.
     * @return ComentarioAndRespuestaComentarioClienteVL1
     */
    public ViewLinkImpl getComentarioAndRespuestaComentarioClienteVL() {
        return (ViewLinkImpl) findViewLink("ComentarioAndRespuestaComentarioClienteVL");
    }

    /**
     * Container's getter for TcaEventoCondicionLOV1.
     * @return TcaEventoCondicionLOV1
     */
    public TcaEventoCondicionLOVImpl getTcaEventoCondicionLOV() {
        return (TcaEventoCondicionLOVImpl) findViewObject("TcaEventoCondicionLOV");
    }


    /**
     * Container's getter for AgregarTramoFormalizarVO1.
     * @return AgregarTramoFormalizarVO1
     */
    public AgregarTramoFormalizarVOImpl getAgregarTramoFormalizarVO() {
        return (AgregarTramoFormalizarVOImpl) findViewObject("AgregarTramoFormalizarVO");
    }

    /**
     * Container's getter for AgregarParticipanteTramoFormalizarVO1.
     * @return AgregarParticipanteTramoFormalizarVO1
     */
    public AgregarParticipanteTramoFormalizarVOImpl getAgregarParticipanteTramoFormalizarVO() {
        return (AgregarParticipanteTramoFormalizarVOImpl) findViewObject("AgregarParticipanteTramoFormalizarVO");
    }

    /**
     * Container's getter for DetalleClienteVO1.
     * @return DetalleClienteVO1
     */
    public DetalleClienteVOImpl getDetalleClienteVO() {
        return (DetalleClienteVOImpl) findViewObject("DetalleClienteVO");
    }

    /**
     * Container's getter for RespuestaComentarioClienteValidacionVO1.
     * @return RespuestaComentarioClienteValidacionVO1
     */
    public ViewObjectImpl getRespuestaComentarioClienteValidacionVO() {
        return (ViewObjectImpl) findViewObject("RespuestaComentarioClienteValidacionVO");
    }


    public Boolean servicioInicioComisiones(String idOperacion, String loginUsuario, String descripcionOperacion,
                                            String codigoCliente, String nombreCliente, Integer codigoProducto,
                                            String nombreProducto, BigDecimal montoSolicitado, String pais,
                                            Long idComision) {
        logger.warning("inside servicioInicioComisiones.");
        logger.warning("idComision : " + idComision);
        try {
            ViewObjectImpl cargoVO = getCargoVO();

            cargoVO.setRangeSize(-1);
            // Row row = cargoVO.getRow(new Key(new Object[] { idComision }));
            // Integer subEstado=(Integer) row.getAttribute("arg0");

            if (idOperacion != null) {
                String tipoInicio = "1";
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);

                ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
                ProcesosAlternosPortType procesosAlternosPortType =
                    procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();
                Header header = new Header();
                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                ParameterType configuracion = new ParameterType();
                String mensaje = null;
                StringWriter xmlSalida = null;
                StringWriter xmlEntrada = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);
                operacion.setCodigoCliente(codigoCliente);
                operacion.setCodigoProducto(codigoProducto);
                operacion.setNombreCliente(nombreCliente);
                operacion.setMontoSolicitado(montoSolicitado);
                operacion.setNombreOperacion(descripcionOperacion);
                operacion.setNombreProducto(nombreProducto);
                operacion.setPais(pais);
                header.setOperacion(operacion);

                configuracion.setParameterName("IDCOMISION");
                configuracion.setParameterValue(Long.toString(idComision));
                header.getParameterType().add(configuracion);
                configuracion = new ParameterType();
                configuracion.setParameterName("TIPO_INICIO");
                configuracion.setParameterValue(tipoInicio);
                header.getParameterType().add(configuracion);


                mensaje = "Invocando Servicio - inicio Comisiones-";
                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

                Resultado response = procesosAlternosPortType.inicioComisiones(header);
                mensaje = "Respuesta servicio - inicio Comisiones -";
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

                return true;
            } else {
                logger.log(ADFLogger.ERROR, "Error en inicio Comisiones: idOperacion vacio");
                return false;
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en inicio Comisiones " + e.getClass() + ":" + e.getMessage());

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicio Comisiones " + e.getClass() + ":" + e.getMessage()));
            throw ex;

        }
    }

    /**
     * Container's getter for CondicionesOperacionVO1.
     * @return CondicionesOperacionVO1
     */
    public CondicionesOperacionVOImpl getCondicionesOperacionVO() {
        return (CondicionesOperacionVOImpl) findViewObject("CondicionesOperacionVO");
    }

    /**
     * Container's getter for DocumentosCondicionesVO1.
     * @return DocumentosCondicionesVO1
     */
    public DocumentosCondicionesVOImpl getDocumentosCondicionesVO() {
        return (DocumentosCondicionesVOImpl) findViewObject("DocumentosCondicionesVO");
    }

    /**
     * Container's getter for TreEvidenciaCondicionVO1.
     * @return TreEvidenciaCondicionVO1
     */
    public TreEvidenciaCondicionVOImpl getTreEvidenciaCondicionVO() {
        return (TreEvidenciaCondicionVOImpl) findViewObject("TreEvidenciaCondicionVO");
    }


    /**
     * Container's getter for CondicionVO1.
     * @return CondicionVO1
     */
    public CondicionVOImpl getCondicionVO() {
        return (CondicionVOImpl) findViewObject("CondicionVO");
    }

    /**
     *@Autor Damacio Cordoba Medina
     * @Since 21/01/2016
     * Procedimiento que regresa los grupos a los que pertenece un usuario de OID
     * @param pUsuario id del usuario logueado.
     * @return Lista de los grupos que tiene asignados.
     */
    public List<String> getGruposUsuario(String pUsuario) {
        logger.warning("Entrando a getGruposUsuario" + pUsuario);
        String wsdl = getWsdl(IWsdlLocation.USUARIO);

        Usuario12BndQSService usuario12BndQSService =
            IWsdlLocation.Service.getInstance(Usuario12BndQSService.class, wsdl);
        UsuarioPT usuarioPT = usuario12BndQSService.getUsuario12BndQSPort();
        ConsultarAtributosUsuarioRequestType request = new ConsultarAtributosUsuarioRequestType();
        ConsultarAtributosUsuarioResponseType response = new ConsultarAtributosUsuarioResponseType();
        ListaUsuarios usuarios = new ListaUsuarios();
        ListaGrupos grupos = new ListaGrupos();
        List<String> retorno = null;

        if (pUsuario == null)
            pUsuario = this.getUserPrincipalName();

        try {
            ListaNombres lista = new ListaNombres();
            lista.getNombreUsuario().add(pUsuario);
            request.setListaNombres(lista);
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_GRUPOS_USUARIOS);
            response = usuarioPT.consultarAtributosUsuario(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_GRUPOS_USUARIOS, horaInicio);
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, e.getMessage());
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al obtener lo atributos del usuario. Intentelo más tarde."));
            throw ex;
        }
        if (response.getResultado().getResult().value().equalsIgnoreCase("OK")) {
            usuarios = response.getListaUsuarios();
            for (Usuario usuario : usuarios.getUsuario()) {
                grupos = usuario.getListaGrupos();
                if (grupos != null)
                    retorno = grupos.getGrupo();
            }
        }
        return retorno;
    }

    /**
     * Container's getter for EvidenciasCondicionesVO1.
     * @return EvidenciasCondicionesVO1
     */
    public EvidenciasCondicionesVOImpl getEvidenciasCondicionesVO() {
        return (EvidenciasCondicionesVOImpl) findViewObject("EvidenciasCondicionesVO");
    }

    /**
     * Container's getter for ClientesRepetidosVO1.
     * @return ClientesRepetidosVO1
     */
    public ClientesRepetidosVOImpl getClientesRepetidosVO() {
        return (ClientesRepetidosVOImpl) findViewObject("ClientesRepetidosVO");
    }

    /**
     * Container's getter for ConfiguracionVO.
     * @return ConfiguracionVO
     */
    public ConfiguracionVOImpl getConfiguracionVO() {
        return (ConfiguracionVOImpl) findViewObject("ConfiguracionVO");
    }

    public String getWsdl(String key) {
        ConfiguracionVOImpl vo = this.getConfiguracionVO();
        Row row = vo.getValor(key);
        String wsdl = row == null ? null : (String) row.getAttribute("Valor");
        return wsdl;
    }


    /**
     * Container's getter for TccRootNodeVO1.
     * @return TccRootNodeVO1
     */
    public TccRootNodeVOImpl getTccRootNodeVO() {
        return (TccRootNodeVOImpl) findViewObject("TccRootNodeVO");
    }

    /**
     * Inicializa la carga de TCC para visualizacion de Tabla TCC
     * @param idOperacion contiene id de operacion
     * @param idEnmienda contiene id de enmienda
     */
    public void iniciaMatrizTccGrid(Number idOperacion, Number idEnmienda) {

        if (idOperacion == null) {
            logger.severe("Error id de operacion no recibido");
        } else {
            logger.warning("Id de Operacion: " + idOperacion);
            logger.warning("Id Enmienda: " + idEnmienda);
        }

        Number idLinkCurrentRow = null;
        Number idTccCurrentRow = null;
        TccElementosOperVORowImpl currentRow = null;
        if (getTccGridElementosOperVO().getCurrentRow() != null) {
            currentRow = (TccElementosOperVORowImpl) getTccGridElementosOperVO().getCurrentRow();
            if (currentRow != null) {
                if (currentRow.getIdLink() != null && currentRow.getIdTcc() != null) {
                    idLinkCurrentRow = currentRow.getIdLink();
                    idTccCurrentRow = currentRow.getIdTcc();
                }
            }
        }

        getTccGridElementosOperVO().setpIdOperacion(idOperacion);
        if (idEnmienda != null) {
            getTccGridElementosOperVO().setpIdEnmienda(idEnmienda);
        }

        getTccGridElementosOperVO().executeQuery();

        logger.warning("Cantidad de registros de TCC encontrados: " +
                       getTccGridElementosOperVO().getEstimatedRowCount());

        //getTccGridElementosOperVO().asignaIconoEstatusPath(); //Se realiza a nivel Row Impl

        if (idLinkCurrentRow != null && idTccCurrentRow != null) {

            currentRow = null;

            RowSetIterator iter = getTccGridElementosOperVO().createRowSetIterator(null);
            if (iter != null) {
                boolean asignar = false;
                iter.reset();
                while (iter.hasNext()) {
                    currentRow = (TccElementosOperVORowImpl) iter.next();
                    if (currentRow.getIdLink() != null && currentRow.getIdTcc() != null) {

                        if (currentRow.getIdLink().equals(idLinkCurrentRow) &&
                            currentRow.getIdTcc().equals(idTccCurrentRow)) {
                            asignar = true;
                            break;
                        }
                    }
                }

                if (asignar) {
                    logger.warning("Reasigna current row");
                    getTccGridElementosOperVO().setCurrentRow(currentRow);
                }
                iter.closeRowSetIterator();
            }
        } else {

            if (getTccGridElementosOperVO().getEstimatedRowCount() > 0) {
                getTccGridElementosOperVO().setCurrentRow(getTccGridElementosOperVO().first());
            }
        }
    }

    /**
     * Guarda el registro nuevo de Condicion y el detalle de Categorias Condicion y Eventos Condicion, si el
     * proceso de guardado es exitoso, consume WS para realizar la actualizacion de Estado TCC.
     */
    public void guardarMatrizTCCAgregarCondicion() {

        TccCondicionVORowImpl row = (TccCondicionVORowImpl) getTccCondicionVO().getCurrentRow();
        if (row != null) {

            boolean esError = false;

            SequenceImpl sqCondicion = null;
            try {
                sqCondicion = new SequenceImpl("CONDICION_SEQ", getDBTransaction());
                if (sqCondicion == null) {
                    logger.severe("No se obtuvo secuencia de Condicion");
                    esError = true;
                } else {
                    Long id = sqCondicion.getSequenceNumber().longValue();
                    logger.warning("Asigna Valor de la Secuencia Condicion: " + id);
                    row.setId(id);
                }
            } catch (Exception e) {
                esError = true;
                logger.severe("Error al obtener la secuencia de Condicion", e);
            }

            if (!esError) {

                logger.warning("Realiza la actualizacion de Categorias Condicion");
                boolean exito = false;
                //exito = getTccCondicionVO().actualizaRelacionCategoriasCondicion();
                logger.warning("Categorias Condicion actualizadas correctamente: " + exito);
                if (exito) {
                    logger.warning("Realiza la actualizacion de Eventos Condicion");
                    //exito = getTccCondicionVO().actualizaRelacionEventosCondicion();
                    logger.warning("Eventos Condicion actualizados correctamente: " + exito);
                }

                if (!exito) {
                    esError = true;
                }
            }

            if (esError) {
                try {
                    logger.warning("Ejecuta Rollback");
                    getDBTransaction().rollback();
                } catch (Exception e) {
                    logger.severe("Error al realizar Rollback por fallo en el proceso de Guardar Agregar Condicion", e);
                }
            } else {

                try {
                    logger.warning("Ejecuta Commit");
                    getDBTransaction().commit();
                } catch (Exception e) {
                    esError = true;
                    logger.severe("Error al realizar Commit", e);
                    try {
                        getDBTransaction().rollback();
                    } catch (Exception ex) {
                        logger.severe("Error al realizar Rollback al fallar Commit", ex);
                    }
                }
            }

            if (!esError) {
                logger.warning("Realiza la actualizacion de Estado TCC para la Condicion via WS");
                getTccCondicionVO().actualizarEstadoCondicion();
            }
        }
    }

    /**
     * Guarda los cambios del registro de Condicion y actualiza el detalle de Categorias Condicion y Eventos Condicion,
     * si el proceso de guardado es exitoso, consume WS para realizar la actualizacion de Estado TCC.
     */
    public void guardarMatrizTCCEditarCondicion(Integer idModalidad) {

        TccCondicionVOImpl condicionVOImpl = null;
        TccCondicionVORowImpl row = null;

        if (idModalidad != null) {
            //Verifica la modalidad
            if (new Integer(1).equals(idModalidad)) {
                //Obtiene Row cuando es Modalidad Tree
                condicionVOImpl = getTccCondicionVO();
                row = (TccCondicionVORowImpl) getTccCondicionVO().getCurrentRow();
            } else {
                //Obtiene Row cuando es Modalidad Grid
                condicionVOImpl = getTccCondicionGridVO();
                row = (TccCondicionVORowImpl) getTccCondicionGridVO().getCurrentRow();
            }
        } else {
            logger.severe("Error Id de Modalidad no recibido");
        }

        if (row != null) {

            boolean esError = false;
            String keyError = null;

            logger.warning("Realiza la actualizacion de Categorias Condicion");
            boolean exito = condicionVOImpl.actualizaRelacionCategoriasCondicion(idModalidad);
            logger.warning("Categorias Condicion actualizadas correctamente: " + exito);
            if (exito) {
                logger.warning("Realiza la actualizacion de Eventos Condicion");
                exito = condicionVOImpl.actualizaRelacionEventosCondicion(idModalidad);
                logger.warning("Eventos Condicion actualizados correctamente: " + exito);

                if (exito) {
                    logger.warning("Realiza la actualizacion de Observacion Principal");
                    exito = condicionVOImpl.actualizarObservacionPrincipal(idModalidad);
                    logger.warning("Observacion Principal actualizada correctamente: " + exito);
                    if (!exito) {
                        keyError = "matriztcc.guardar.condicion.observacion.principal.msg.error";
                    }
                } else {
                    keyError = "matriztcc.guardar.condicion.eventos.msg.error";
                }
            } else {
                keyError = "matriztcc.guardar.condicion.categorias.msg.error";
            }

            if (!exito) {
                esError = true;
            }

            if (esError) {
                try {
                    logger.warning("Ejecuta Rollback");
                    getDBTransaction().rollback();
                } catch (Exception e) {
                    logger.severe("Error al realizar Rollback por fallo en el proceso de Guardar Editar Condicion", e);
                    esError = true;
                }
            } else {

                try {
                    logger.warning("Ejecuta Commit");
                    getDBTransaction().commit();
                } catch (Exception e) {
                    esError = true;
                    logger.severe("Error al realizar Commit", e);
                    logger.warning("Detalle del error: ", e.getMessage());
                    try {
                        getDBTransaction().rollback();
                    } catch (Exception ex) {
                        logger.severe("Error al realizar Rollback al fallar Commit", ex);
                    }
                }
            }

            if (!esError) {
                logger.warning("Realiza la actualizacion de Estado TCC para la Condicion via WS");
                TccTcaProcesoTareaBpmVORowImpl rowProcesoBpm =
                    (TccTcaProcesoTareaBpmVORowImpl) getTccTcaProcesoTareaBpmVO().getCurrentRow();

                String strIdProceso = null;
                if (rowProcesoBpm != null && rowProcesoBpm.getId() != null) {
                    strIdProceso = rowProcesoBpm.getId().toString();

                } else {
                    logger.severe("Error datos del Proceso BPM no obtenidos");
                }

                exito =
                    actualizarAccionesMatrizTCC(strIdProceso, FenixModelConstants.CONDICION, Accion.EDITAR.toString(),
                                                idModalidad);
                if (!exito) {
                    ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                    String msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error");
                    throw new JboException(msg);
                } else {
                    logger.warning("El estado de la tcc fue actualizado");
                }
            } else {

                ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                String msg = rb.getString(keyError);
                throw new JboException(msg);
            }
        }
    }

    public void buscarTerminoPorId(Number id, Integer idModalidad) {
        logger.warning("Entra a metodo buscarTerminoPorId");
        logger.warning("Id de Termino: " + id);
        logger.warning("Id de Modalidad: " + idModalidad);

        String strIdTcaTermino = null;
        String claveTcaTermino = null;

        TccTerminoVOImpl tccTerminoVO = null;

        if (idModalidad != null) {
            if (new Integer(1).equals(idModalidad)) {
                //Asigna VO Impl cuando es modalidad Tree
                tccTerminoVO = getTccTerminoVO();
            } else {
                //Asigna VO Impl cuando es modalidad Grid
                tccTerminoVO = getTccTerminoGridVO();
            }
        } else {
            logger.severe("Error Id de Modalidad no recibido");
        }

        tccTerminoVO.buscarTerminoPorId(id);
        Row tccTerminoRow = tccTerminoVO.getCurrentRow();

        if (null != tccTerminoRow || null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO).toString()) {

            try {
                if (tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO) != null) {
                    strIdTcaTermino = tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO).toString();
                }
                claveTcaTermino = getClaveTcaTermino(strIdTcaTermino);
            } catch (Exception e) {
                logger.severe("Error al obtener el codigo externo del TCA Termino");
            }

            if (claveTcaTermino.equals("T201") || claveTcaTermino.equals("T202") || claveTcaTermino.equals("T203") ||
                claveTcaTermino.equals("T299")) {
                if (null == tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCAMONEDA)) {
                    tccTerminoRow.setAttribute(TccTerminoVORowImpl.IDTIPOMONEDA,
                                               FenixModelConstants.TERMINO_TIPO_MONEDA_USD);
                } else {
					logger.warning("else Tipo de Moneda " + tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCAMONEDA));
                    tccTerminoRow.setAttribute(TccTerminoVORowImpl.IDTIPOMONEDA,
                                               tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCAMONEDA));
                }
            }

            if (claveTcaTermino.equals("T301")) {
                if (null == tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOTASA)) {
                    tccTerminoRow.setAttribute(TccTerminoVORowImpl.IDTIPOTASA,
                                               FenixModelConstants.TERMINO_OTRAS_CONDICIONES_TASA_PORCENTAJE);
                } else {
                    tccTerminoRow.setAttribute(TccTerminoVORowImpl.IDTIPOTASA,
                                               tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOTASA));
                }
            }
        }
    }

    public void obtenerConfiguracionEditarTerminos(Integer idModalidad) {
        logger.warning("Entra a metodo obtenerConfiguracionEditarTerminos");
        String strIdTcaTermino = null;
        String claveTcaTermino = null;

        if (null != idModalidad) {
            if (idModalidad.compareTo(1) == 0) {
                logger.warning("Modalidad Tree");
                TccTerminoVOImpl tccTerminoVO = getTccTerminoVO();
                Row tccTerminoRow = tccTerminoVO.getCurrentRow();
                logger.warning("Obteniando datos par editar término: " +
                               tccTerminoRow.getAttribute(TccTerminoVORowImpl.ID));

                try {
                    if (tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO) != null) {
                        strIdTcaTermino = tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO).toString();
                    }
                    claveTcaTermino = getClaveTcaTermino(strIdTcaTermino);
                } catch (Exception e) {
                    logger.severe("Error al obtener el codigo externo del TCA Termino");
                }

                if (claveTcaTermino != null) {

                    if (claveTcaTermino.equals("T101") || claveTcaTermino.equals("T102") ||
                        claveTcaTermino.equals("T103") || claveTcaTermino.equals("T104") ||
                        claveTcaTermino.equals("T105") || claveTcaTermino.equals("T106") ||
                        claveTcaTermino.equals("T108")) {
                        if (claveTcaTermino.equals("T101") || claveTcaTermino.equals("T102") ||
                            claveTcaTermino.equals("T103") || claveTcaTermino.equals("T105") ||
                            claveTcaTermino.equals("T106") || claveTcaTermino.equals("T108")) {
                            if (null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO) &&
                                !tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO).toString().equals("11")) {
                                if (null == tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAINICIO)) {
                                    Integer idTipoFechaInicio =
                                        Integer.parseInt(tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO).toString());
                                    //obtenerTipoFechaInicioTermino(idTipoFechaInicio);//TODO Descomentar en caso de cambio en definición de campo fechaInicio
                                }
                            }
                        }

                        if (claveTcaTermino.equals("T104")) {
                            tccTerminoRow.setAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO,
                                                       FenixModelConstants.TERMINO_TIPO_FECHA_INICIO_VIGENCIA);
                        }
                    }

                    if (null == tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAVENCIMIENTO)) {
                        if (null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAINICIO) &&
                            null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.PLAZO) &&
                            null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCAFRECUENCIAPLAZO)) {

                            String fechaInicio = tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAINICIO).toString();
                            Integer plazo =
                                Integer.parseInt(tccTerminoRow.getAttribute(TccTerminoVORowImpl.PLAZO).toString());
                            Integer frecuenciaPlazo =
                                Integer.parseInt(tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCAFRECUENCIAPLAZO).toString());
                            try {
                                logger.warning("Iniciando calculo de fechaVencimiento");
                                SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss.SSS");
                                Date date = (Date) formatter.parse(fechaInicio);
                                Timestamp fechaInicioTimestamp = new Timestamp(date.getTime());
                                Calendar calendar = Calendar.getInstance();
                                calendar.setTime(fechaInicioTimestamp);

                                if (frecuenciaPlazo.toString().equals("1"))
                                    calendar.add(Calendar.DAY_OF_WEEK, plazo);
                                else if (frecuenciaPlazo.toString().equals("2"))
                                    calendar.add(Calendar.MONTH, plazo);
                                else if (frecuenciaPlazo.toString().equals("3"))
                                    calendar.add(Calendar.YEAR, plazo);

                                Timestamp fechaVencimiento = new Timestamp(calendar.getTime().getTime());
                                logger.warning("FechaVencimientoCalculada: " + fechaVencimiento.toString());
                                tccTerminoRow.setAttribute(TccTerminoVORowImpl.FECHAVENCIMIENTO, fechaVencimiento);
                            } catch (Exception e) {
                                logger.warning("Error al convertir fecha vencimiento");
                            }
                        }
                    }
                }
            } else if (idModalidad.compareTo(2) == 0) {
                logger.warning("Modalidad Grid");
                TccTerminoVOImpl tccTerminoVO = getTccTerminoGridVO();
                Row tccTerminoRow = tccTerminoVO.getCurrentRow();
                logger.warning("Obteniando datos par editar término: " +
                               tccTerminoRow.getAttribute(TccTerminoVORowImpl.ID));

                try {
                    if (tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO) != null) {
                        strIdTcaTermino = tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO).toString();
                    }
                    claveTcaTermino = getClaveTcaTermino(strIdTcaTermino);
                } catch (Exception e) {
                    logger.severe("Error al obtener el codigo externo del TCA Termino");
                }

                if (claveTcaTermino != null) {
                    if (claveTcaTermino.equals("T101") || claveTcaTermino.equals("T102") ||
                        claveTcaTermino.equals("T103") || claveTcaTermino.equals("T104") ||
                        claveTcaTermino.equals("T105") || claveTcaTermino.equals("T106") ||
                        claveTcaTermino.equals("T108")) {
                        if (claveTcaTermino.equals("T101") || claveTcaTermino.equals("T102") ||
                            claveTcaTermino.equals("T103") || claveTcaTermino.equals("T105") ||
                            claveTcaTermino.equals("T106") || claveTcaTermino.equals("T108")) {

                            if (null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO) &&
                                !tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO).toString().equals("11")) {
                                if (null == tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAINICIO)) {
                                    Integer idTipoFechaInicio =
                                        Integer.parseInt(tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO).toString());
                                    //obtenerTipoFechaInicioTermino(idTipoFechaInicio);//TODO Descomentar en caso de cambio en definición de campo fechaInicio
                                }
                            }
                        }

                        if (claveTcaTermino.equals("T104")) {
                            tccTerminoRow.setAttribute(TccTerminoVORowImpl.IDTCATIPOFECHAINICIO,
                                                       FenixModelConstants.TERMINO_TIPO_FECHA_INICIO_VIGENCIA);
                        }

                        if (null == tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAVENCIMIENTO)) {
                            if (null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAINICIO) &&
                                null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.PLAZO) &&
                                null != tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCAFRECUENCIAPLAZO)) {

                                String fechaInicio =
                                    tccTerminoRow.getAttribute(TccTerminoVORowImpl.FECHAINICIO).toString();
                                Integer plazo =
                                    Integer.parseInt(tccTerminoRow.getAttribute(TccTerminoVORowImpl.PLAZO).toString());
                                Integer frecuenciaPlazo =
                                    Integer.parseInt(tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCAFRECUENCIAPLAZO).toString());
                                try {
                                    logger.warning("Iniciando calculo de fechaVencimiento");
                                    SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss.SSS");
                                    Date date = (Date) formatter.parse(fechaInicio);
                                    Timestamp fechaInicioTimestamp = new Timestamp(date.getTime());
                                    Calendar calendar = Calendar.getInstance();
                                    calendar.setTime(fechaInicioTimestamp);

                                    if (frecuenciaPlazo.toString().equals("1"))
                                        calendar.add(Calendar.DAY_OF_WEEK, plazo);
                                    else if (frecuenciaPlazo.toString().equals("2"))
                                        calendar.add(Calendar.MONTH, plazo);
                                    else if (frecuenciaPlazo.toString().equals("3"))
                                        calendar.add(Calendar.YEAR, plazo);

                                    Timestamp fechaVencimiento = new Timestamp(calendar.getTime().getTime());
                                    logger.warning("FechaVencimientoCalculada: " + fechaVencimiento.toString());
                                    tccTerminoRow.setAttribute(TccTerminoVORowImpl.FECHAVENCIMIENTO, fechaVencimiento);
                                } catch (Exception e) {
                                    logger.warning("Error al convertir fecha vencimiento");
                                }
                            }
                        }
                    }
                }
            }
        }

        logger.warning("Termina metodo obtenerConfiguracionEditarTerminos");
    }

    public String getClaveTcaTermino(String idTcaTermino) {

        String claveTcaTermino = null;

        if (idTcaTermino != null) {

            logger.warning("Id de Tca Termino recibido: " + idTcaTermino);

            if (getTccTcaTerminoVO() != null) {

                try {
                    getTccTcaTerminoVO().buscarTcaTerminoPorId(new oracle.jbo.domain.Number(idTcaTermino));
                } catch (Exception e) {
                    logger.severe("Error al consultar TCA Termino por Id");
                }

                if (getTccTcaTerminoVO().getEstimatedRowCount() > 0) {

                    TccTcaTerminoVORowImpl rowTcaTermino =
                        (TccTcaTerminoVORowImpl) getTccTcaTerminoVO().getCurrentRow();

                    claveTcaTermino = rowTcaTermino.getDescripcionCorta();
                    if (claveTcaTermino != null) {
                        if (claveTcaTermino.isEmpty()) {
                            logger.warning("Clave Tca Vacía");
                        } else {
                            logger.warning("Clave Tca: " + claveTcaTermino);
                        }
                    } else {
                        logger.warning("Clave Tca NULL");
                    }
                } else {
                    logger.warning("No se encontraron registros de TCA Termino");
                }
            }
        } else {
            logger.warning("Parametro requerido no recibido");
        }

        return claveTcaTermino;
    }

    /**
     * Guarda el registro nuevo de Comisión y el detalle de Categorias Comisión, si el
     * proceso de guardado es exitoso, consume WS para realizar la actualizacion de Estado TCC.
     */
    public void guardarMatrizTCCAgregarComision() {

        TccComisionVORowImpl row = (TccComisionVORowImpl) getTccComisionVO().getCurrentRow();
        if (row != null) {

            boolean esError = false;

            SequenceImpl sqCargo = null;
            try {
                sqCargo = new SequenceImpl("COMISION_SEQ", getDBTransaction());
                if (sqCargo == null) {
                    logger.severe("No se obtuvo secuencia de Comisión");
                    esError = true;
                } else {
                    Long id = sqCargo.getSequenceNumber().longValue();
                    logger.warning("Asigna Valor de la Secuencia Comisión: " + id);
                    row.setId(id);
                }
            } catch (Exception e) {
                esError = true;
                logger.severe("Error al obtener la secuencia de Comisión", e);
            }

            try {
                logger.warning("Ejecuta Commit");
                getDBTransaction().commit();
            } catch (Exception e) {
                esError = true;
                logger.severe("Error al realizar Commit", e);
                try {
                    getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback al fallar Commit", ex);
                }
            }

            if (!esError) {
                logger.warning("Realiza la actualizacion de Estado TCC para la Comisión via WS");
                // getTccComisionVO().actualizarEstadoCondicion();
            }
        }
    }


    /**
     * Guarda los cambios del registro de Comision y actualiza el detalle de Categorias Comision,
     * si el proceso de guardado es exitoso, consume WS para realizar la actualizacion de Estado TCC.
     */
    public void guardarMatrizTCCEditarComision(Integer idModalidad) {

        TccComisionVORowImpl row = null; //(TccComisionVORowImpl) getTccComisionVO().getCurrentRow();

        if (idModalidad != null) {
            if (new Integer(1).equals(idModalidad)) {
                //Obtiene el Row cuando modalidad es Tree
                row = (TccComisionVORowImpl) getTccComisionVO().getCurrentRow();
            } else {
                //Obtiene el Row cuando modalidad es Grid
                row = (TccComisionVORowImpl) getTccComisionGridVO().getCurrentRow();
            }
        } else {
            logger.severe("Error Id de Modalidad no recibido");
        }

        if (row != null) {

            boolean esError = false;

            try {
                logger.warning("Ejecuta Commit");
                getDBTransaction().commit();
            } catch (Exception e) {
                esError = true;
                logger.severe("Error al realizar Commit", e);
                try {
                    getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback al fallar Commit", ex);
                }
            }

            if (!esError) {
                logger.warning("Realiza la actualizacion de Estado TCC para la Comision via WS");

                TccTcaProcesoTareaBpmVORowImpl rowProcesoBpm =
                    (TccTcaProcesoTareaBpmVORowImpl) getTccTcaProcesoTareaBpmVO().getCurrentRow();

                String strIdProceso = null;
                if (rowProcesoBpm != null && rowProcesoBpm.getId() != null) {
                    strIdProceso = rowProcesoBpm.getId().toString();
                } else {
                    logger.severe("Error datos del Proceso BPM no obtenidos");
                }

                boolean exito =
                    actualizarAccionesMatrizTCC(strIdProceso, FenixModelConstants.COMISION, Accion.EDITAR.toString(),
                                                idModalidad);
                if (!exito) {
                    ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                    String msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error");
                    throw new JboException(msg);
                } else {
                    logger.warning("El estado de la tcc fue actualizado");
                }
            }
        }
    }

    /**
     * Guarda los cambios del registro de Comision y actualiza el detalle de Categorias Comision,
     * si el proceso de guardado es exitoso, consume WS para realizar la actualizacion de Estado TCC.
     */
    public void guardarEditarComisionMatrizTCC() {
        logger.warning("Entra en guardarEditarComisionMatrizTCC.");
        TccComisionVORowImpl row = null;
        oracle.jbo.domain.Timestamp fechaValor = null;
        //Se obtiene el row de la instancia getTccRegistroComisionVO()

        // Se refresca row antes de ser recuperado
        //getTccRegistroComisionVO().getCurrentRow().refresh(Row.REFRESH_WITH_DB_FORGET_CHANGES);
        row = (TccComisionVORowImpl) getTccRegistroComisionVO().getCurrentRow();

        if (row != null) {
            if (null == row.getFechaValor()) {
                fechaValor = obtenerFechaFlexcube();
                if (null != fechaValor) {
                    row.setFechaValor(fechaValor.getValue());
                } else {
                    logger.warning("El valor de la fecha flexcube es nula.");
                }
            }

            boolean esError = false;
            /*
            try{
                row.setAttribute("IdTcaSubEstadoTcc", FenixModelConstants.SUBESTADO_TCC_EN_REGISTRO);
                getDBTransaction().commit();
                logger.warning("Ejecuta Commit : " + row.getIdTcaSubEstadoTcc());
            }catch(Exception e){
                esError = true;
                logger.warning("Error al realizar Commit", e);
                try{
                    getDBTransaction().rollback();
                }catch(Exception ex){
                    logger.severe("Error al realizar Rollback al fallar Commit", ex);
                }
            }
        */
            if (!esError) {
                logger.warning("Realiza la actualizacion de Estado TCC para la Comision via WS");

                TccTcaProcesoTareaBpmVORowImpl rowProcesoBpm =
                    (TccTcaProcesoTareaBpmVORowImpl) getTccTcaProcesoTareaBpmVO().getCurrentRow();

                String strIdProceso = null;
                if (rowProcesoBpm != null && rowProcesoBpm.getId() != null) {
                    strIdProceso = rowProcesoBpm.getId().toString();
                } else {
                    logger.severe("Error datos del Proceso BPM no obtenidos");
                }

                boolean exito =
                    actualizarComisionAccionesMatrizTCC(strIdProceso, FenixModelConstants.COMISION,
                                                        Accion.EDITAR.toString());

                if (!exito) {
                    logger.warning("El estado de la tcc no fue actualizado");
                    ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                    String msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error");
                    throw new JboException(msg);
                } else {
                    try {
                        // Se refresca row antes de ser recuperado
                        getTccRegistroComisionVO().getCurrentRow().refresh(Row.REFRESH_WITH_DB_FORGET_CHANGES);

                        getDBTransaction().commit();
                        logger.warning("Ejecuta Commit con exito.");
                    } catch (Exception e) {
                        logger.warning("Error al realizar Commit", e);
                        try {
                            getDBTransaction().rollback();
                        } catch (Exception ex) {
                            logger.warning("Error al realizar Rollback al fallar Commit", ex);
                        }
                    }
                    logger.warning("El estado de la tcc fue actualizado");
                }
            } else {
                logger.warning("Ocurrio un error al guaradar la comision.");
            }
        } else {
            logger.warning("No se obtuvo row de la comision.");
        }
    }

    public boolean actualizarComisionAccionesMatrizTCC(String sIdProceso, String sTipoTCC, String sAccion) {
        logger.warning("Entra en actualizarComisionAccionesMatrizTCC.");
        boolean seActualizo = false;
        String wsdl = getWsdl(IWsdlLocation.MATRIZ);
        logger.log(ADFLogger.WARNING, "WSDL DB : " + wsdl);
        MatrizTCC12BndQSService service = IWsdlLocation.Service.getInstance(MatrizTCC12BndQSService.class, wsdl);
        MatrizTCCPT port = service.getMatrizTCC12BndQSPort();

        ActualizarTCCRequestType request = new ActualizarTCCRequestType();
        ActualizarTCCResponseType response = null;

        if (null != sTipoTCC && null != sIdProceso && null != sAccion) {
            request.setIdProceso(new Long(sIdProceso));
            getTccRegistroComisionVO().mappearComisionRequestType(request, Accion.fromValue(sAccion));

            try {
                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_TCC);
                response = port.actualizarTCC(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_TCC, horaInicio);

                if (response != null && null != response.getResultado() && response.getResultado().size() > 0 &&
                    response.getResultado().get(0).getResult() != null &&
                    response.getResultado().get(0).getResult().toString().equalsIgnoreCase("OK")) {
                    seActualizo = true;
                } else {
                    logger.warning("El servicio regres error.");
                    String msg = "ERROR";
                    if (response != null) {
                        if (null != response.getResultado() && response.getResultado().size() > 0) {
                            msg = response.getResultado().get(0).getMessage();
                        } else {
                            logger.warning("Resultado nulo.");
                            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                            msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error.resultado.nulo");
                        }
                    } else {
                        logger.warning("Response nulo.");
                        ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                        msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error.resultado.nulo");
                    }
                    throw new Exception(ModelUtils.getString(FenixModelConstants.WSC_ACTUALIZAR_TCC, " ERROR:", msg));
                }
            } catch (Exception e) {
                seActualizo = false;
                logger.log(ADFLogger.ERROR, e.getMessage());
                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception("Error al actualizar TCC. Inténtelo más tarde."));
                throw ex;
            }
        } else {
            logger.log(ADFLogger.ERROR,
                       ModelUtils.getString("actualizarAccionesMatrizTCC: Todos los parametros son obligatorios[",
                                            "sIdProceso: ", sIdProceso, "sTipoTCC: ", sTipoTCC, "sAccion: ", sAccion,
                                            "]"));
            JboException ex = new JboException("Error al actualizar TCC. Inténtelo más tarde.");
            throw ex;
        }

        return seActualizo;
    }

    /**
     * Metodo que valida que todas las comisiones esten con subEstado en registo
     * para poder finalizar la tarea de Registrar comisiones.
     * @return
     */
    public Boolean validaComisionEnRegistro(Long idOperacion) {
        logger.warning("Entra en validaComisionEnRegistro");
        Boolean enRegistro = Boolean.FALSE;
        Long idComision = null;
        Integer idTcaSubEstadoTcc = null;
        Integer contador = 0;
        ComisionTreeVO tccTreeTcaComisionVO = this.getComisionTreeVO();
        tccTreeTcaComisionVO.setpIdOperacionTcaComision(idOperacion);
        tccTreeTcaComisionVO.executeQuery();
        RowSetIterator iterator = tccTreeTcaComisionVO.createRowSetIterator(null);
        iterator.reset();
        try {
            logger.warning("Numero de registros encontrados : " + tccTreeTcaComisionVO.getEstimatedRowCount());
            while (iterator.hasNext()) {
                ComisionTreeVORowImpl row = (ComisionTreeVORowImpl) iterator.next();
                if (null != row.getAttribute("IdComision")) {
                    idComision = Long.valueOf(row.getAttribute("IdComision").toString());
                    idTcaSubEstadoTcc = Integer.valueOf(row.getAttribute("IdTcaSubEstadoTcc").toString());
                    logger.warning("idComision : " + idComision);
                    logger.warning("idTcaSubEstadoTcc : " + idTcaSubEstadoTcc);
                    if (idTcaSubEstadoTcc.compareTo(FenixModelConstants.SUBESTADO_TCC_EN_REGISTRO) == 0) {
                        logger.warning("La comision se encuentra en registro");
                    } else {
                        logger.warning("La comision no se encuentra en registro. es necesario editarla.");
                        contador++;
                    }
                } else {
                    logger.warning("El id de la comision es nula.");
                }
            }
            iterator.closeRowSetIterator();
            if (tccTreeTcaComisionVO.getEstimatedRowCount() > 0) {
                if (contador == 0) {
                    enRegistro = Boolean.TRUE;
                    logger.warning("Comisiones en registro.");
                } else {
                    logger.warning("Comisiones sin registrar.");
                }
            } else {
                logger.warning("No existen comisiones en el arbol.");
            }
        } catch (Exception e) {
            logger.warning("Error en validaComisionEnRegistro.", e);
        }
        logger.warning("Comisiones en registro : " + enRegistro);
        return enRegistro;
    }


    /**
     * Metodo que valida que todas las comisiones esten validadas
     * para poder finalizar la tarea de Validar registro de comisiones
     * @return
     */
    public Boolean comisionesValidadasByOperacion(Long idOperacion) {
        logger.warning("inicia metodo comisionesValidadasByOperacion");
        Boolean respuesta = Boolean.TRUE;
        Long idComision = null;
        String codigoContrato = null;
        ComisionTreeVO tccTreeTcaComisionVO = this.getComisionTreeVO();
        tccTreeTcaComisionVO.setpIdOperacionTcaComision(idOperacion);
        tccTreeTcaComisionVO.executeQuery();
        RowSetIterator iterator = tccTreeTcaComisionVO.createRowSetIterator(null);
        iterator.reset();
        try {
            logger.warning("Numero de registros encontrados : " + tccTreeTcaComisionVO.getEstimatedRowCount());
            while (iterator.hasNext()) {
                ComisionTreeVORowImpl row = (ComisionTreeVORowImpl) iterator.next();
                if (null != row.getAttribute("IdComision")) {
                    idComision = Long.valueOf(row.getAttribute("IdComision").toString());
                    logger.warning("idComision : " + idComision);
                    codigoContrato =
                        (row.getAttribute("CodigoContrato") == null) ? null :
                        row.getAttribute("CodigoContrato").toString();
                    logger.warning("codigoContrato : " + idComision);

                    if (codigoContrato != null && !codigoContrato.equals("")) {
                        logger.warning("La comision validada ");
                    } else {
                        logger.warning("La comision no se encuentra vlidada. es necesario validarla.");
                        respuesta = Boolean.FALSE;
                    }
                } else {
                    logger.warning("El id de la comision es nula.");
                }
            }
            iterator.closeRowSetIterator();

        } catch (Exception e) {
            logger.warning("Error en validaComisionEnRegistro.", e);
        }
        logger.warning("todas las comisiones han sido validadas : " + respuesta);
        logger.warning("termina metodo comisionesValidadasByOperacion");
        return respuesta;
    }


    /**
     * Metodo que actualiza el subEstado de la comision
     * @param idTcaSubEstadoTcc
     * @return
     */
    public Boolean actualizarSubEstadoComision(Integer idTcaSubEstadoTcc, Long idOperacion) {
        logger.warning("Entra en actualizarSubEstadoComision");
        Boolean comisionActualizada = Boolean.TRUE;
        Long idComision = null;
        Integer contador = 0;
        ComisionTreeVO comisionTreeVO = getComisionTreeVO();
        comisionTreeVO.setpIdOperacionTcaComision(idOperacion);
        comisionTreeVO.executeQuery();
        RowSetIterator iterator = comisionTreeVO.createRowSetIterator(null);
        iterator.reset();
        try {
            logger.warning("Numero de registros encontrados : " + comisionTreeVO.getEstimatedRowCount());
            while (iterator.hasNext()) {
                ComisionTreeVORowImpl row = (ComisionTreeVORowImpl) iterator.next();
                if (null != row.getAttribute("IdComision")) {
                    idComision = Long.valueOf(row.getAttribute("IdComision").toString());
                    logger.warning("idComision : " + idComision);
                    comisionActualizada =
                        getTccRegistroComisionVO().actualizarSubEstadoComision(idComision, idTcaSubEstadoTcc);
                    if (!comisionActualizada) {
                        contador++;
                    }
                } else {
                    logger.warning("El id de la comision es nula.");
                }
            }
            iterator.closeRowSetIterator();
            if (contador > 0) {
                comisionActualizada = Boolean.FALSE;
                logger.warning("No se encontraron  comisiones para actualizar.");
            }
        } catch (Exception e) {
            logger.warning("Error al actualizar el subestado.", e);
        }
        return comisionActualizada;
    }

    /**
     * Metodo que actualiza el Estado de la comision
     * @param idTcaSubEstadoTcc
     * @return
     */
    public Boolean actualizarEstadoComision(Integer idTcaEstadoTcc, Long idOperacion) {
        logger.warning("Entra en actualizarEstadoComision");
        Boolean comisionActualizada = Boolean.TRUE;
        Long idComision = null;
        Integer contador = 0;
        ComisionTreeVO comisionTreeVO = getComisionTreeVO();
        comisionTreeVO.setpIdOperacionTcaComision(idOperacion);
        RowSetIterator iterator = comisionTreeVO.createRowSetIterator(null);
        iterator.reset();
        try {
            logger.warning("Numero de registros encontrados : " + comisionTreeVO.getEstimatedRowCount());
            while (iterator.hasNext()) {
                ComisionTreeVORowImpl row = (ComisionTreeVORowImpl) iterator.next();
                if (null != row.getAttribute("IdComision")) {
                    idComision = Long.valueOf(row.getAttribute("IdComision").toString());
                    logger.warning("idComision : " + idComision);
                    comisionActualizada =
                        getTccRegistroComisionVO().actualizarEstadoComision(idComision, idTcaEstadoTcc);
                    if (!comisionActualizada) {
                        logger.warning("La comision no fue actualizada.");
                        contador++;
                    }
                } else {
                    logger.warning("El id de la comision es nula.");
                }
            }
            iterator.closeRowSetIterator();
            if (contador > 0) {
                comisionActualizada = Boolean.FALSE;
                logger.warning("No se encontraron  comisiones para actualizar.");
            }
        } catch (Exception e) {
            logger.warning("Error al actualizar el estado.", e);
        }
        return comisionActualizada;
    }

    /**
     * Metodo para eliminar las comisiones al cancelar el
     * proceso de Registrar comisiones.
     * @param idTcaSubEstadoTcc
     * @return
     */
    public Boolean eliminaComisionCancelarRegistrarComision(Integer idTcaSubEstadoTcc, Long idOperacion) {
        logger.warning("Entra en eliminaComisionCancelarRegistrarComision");
        Boolean comisionActualizada = Boolean.TRUE;
        Long idComision = null;
        Integer idTcaEstadoTcc = null;
        Integer contador = 0;
        ComisionTreeVO comisionTreeVO = getComisionTreeVO();
        comisionTreeVO.setpIdOperacionTcaComision(idOperacion);
        RowSetIterator iterator = comisionTreeVO.createRowSetIterator(null);
        iterator.reset();
        try {
            logger.warning("Numero de registros encontrados : " + comisionTreeVO.getEstimatedRowCount());
            while (iterator.hasNext()) {
                ComisionTreeVORowImpl row = (ComisionTreeVORowImpl) iterator.next();
                if (null != row.getAttribute("IdComision")) {
                    idComision = Long.valueOf(row.getAttribute("IdComision").toString());
                    idTcaEstadoTcc = Integer.valueOf(row.getAttribute("IdTcaEstadoTcc").toString());
                    logger.warning("idComision : " + idComision);
                    logger.warning("idTcaEstadoTcc : " + idTcaEstadoTcc);
                    if (idTcaEstadoTcc.compareTo(FenixModelConstants.ESTADO_TCC_NUEVA) == 0) {
                        getTccRegistroComisionVO().eliminarComisionEstadoNueva(idComision);
                    } else {
                        comisionActualizada =
                            getTccRegistroComisionVO().actualizarSubEstadoComision(idComision, idTcaSubEstadoTcc);
                    }
                } else {
                    logger.warning("El id de la comision es nula.");
                }
                contador++;
            }
            iterator.closeRowSetIterator();
            if (contador == 0) {
                comisionActualizada = Boolean.TRUE;
                logger.warning("No se encontraron  comisiones para actualizar.");
            }
        } catch (Exception e) {
            logger.warning("Error al actualizar el subestado.", e);
        }
        return comisionActualizada;
    }

    public List<Row> obtenerListaComision(Long idOperacion) {
        logger.warning("Entra en obtenerListaComision");
        ComisionRegistradaFlexVO comisionRegistradaFlexVO = this.getComisionRegistradaFlexVO();
        ComisionEnmendadaVO comisionEnmendadaVO = this.getComisionEnmendadaVO();
        List<Row> comisiones = new ArrayList<Row>();
        List<Long> comisionEnmendada = new ArrayList<Long>();
        List<Row> listaComisiones = new ArrayList<Row>();
        Long idComision = null;
        Boolean mostrar = Boolean.FALSE;
        try {
            comisiones = comisionRegistradaFlexVO.obtenerComisionesSinRegistrar(idOperacion);
            comisionEnmendada = comisionEnmendadaVO.obtenerComisionesEnmendadas(idOperacion);
            for (Row comision : comisiones) {
                idComision = (Long) comision.getAttribute("IdComision");
                Integer contador = 0;
                for (Long idComisionEnmendada : comisionEnmendada) {
                    if (idComision.compareTo(idComisionEnmendada) == 0) {
                        logger.warning("Es una comision enmendada");
                        contador++;
                        break;
                    }
                }
                if (contador == 0) {
                    logger.warning("No es una comision enemendada");
                    mostrar = validaEstadosComisiones(comision);
                    if (mostrar) {
                        logger.warning("Mostrar comision.");
                        listaComisiones.add(comision);
                    } else {
                        logger.warning("No mostrar la comision.");
                    }
                } else {
                    logger.warning("Comision enmendada");
                }
            }
        } catch (Exception e) {
            logger.warning("Error en obtenerListaComision.", e);
        }
        logger.warning("Numero de comisiones a mostrar : " + listaComisiones.size());
        return listaComisiones;
    }

    private Boolean validaEstadosComisiones(Row comision) {
        logger.warning("Entra en validaEstadosComisiones");
        Boolean mostrar = Boolean.TRUE;
        Integer idTcaEstado = null;
        Integer idTcaSubEstado = null;
        try {
            if (null != comision.getAttribute("IdTcaEstadoTcc")) {
                idTcaEstado = (Integer) comision.getAttribute("IdTcaEstadoTcc");
                logger.warning("Valor del estado : " + idTcaEstado);
            } else {
                logger.warning("El estado de la comusion es nula.");
            }
            if (null != comision.getAttribute("IdTcaSubEstadoTcc")) {
                idTcaSubEstado = (Integer) comision.getAttribute("IdTcaSubEstadoTcc");
                logger.warning("Valor subEstado : " + idTcaSubEstado);
            } else {
                logger.warning("El sub-Estado de la comusion es nula.");
            }
            //De acuerdo con QA se descartan las comisiones con estado NUEVA en la
            //lista para agregar en  el proceso 'Registrar comision'.
            if ((idTcaEstado.compareTo(FenixModelConstants.ESTADO_TCC_NUEVA) == 0)) {
                logger.warning("No se debe mostrar la comision con estado 'NUEVA'");
                mostrar = Boolean.FALSE;
            } else {
                logger.warning("Es posible mostrar la comision.");
            }
        } catch (Exception e) {
            logger.warning("Error en validaEstadosComisiones.", e);
        }
        return mostrar;
    }

    public Map registrarComisionesFlexcube(Long idOperacion) {
        logger.warning("Entra en registrarComisionesFlexcube");
        HashMap<String, Object> comisionMap = new HashMap<>();
        HashMap<Boolean, Object> comisionErrorMap = new HashMap<>();
        ComisionTreeVO comisionTreeVO = null;
        Long idComision = null;
        Integer contador = 0;
        Integer numeroComision = null;
        String codigoContrato = null;
        Boolean registrado = Boolean.FALSE;
        String nombre = null;
        String mensaje = null;
        Integer i = 0;
        Integer j = 0;

        try {
            comisionTreeVO = getComisionTreeVO();
            comisionTreeVO.setpIdOperacionTcaComision(idOperacion);
            comisionTreeVO.executeQuery();
            RowSetIterator iterator = comisionTreeVO.createRowSetIterator(null);
            iterator.reset();
            Long numComision = comisionTreeVO.getEstimatedRowCount();
            numeroComision = numComision.intValue();
            logger.warning("Numero de registros encontrados : " + numeroComision);
            while (iterator.hasNext()) {
                ComisionTreeVORowImpl row = (ComisionTreeVORowImpl) iterator.next();

                if (null != row.getAttribute("IdComision")) {

                    idComision = Long.valueOf(row.getAttribute("IdComision").toString());
                    nombre = (String) row.getAttribute("Nombre");
                    logger.warning("idComision : " + idComision);
                    logger.warning("CodigoContrato : " + row.getAttribute("CodigoContrato"));
                    if (null != row.getAttribute("CodigoContrato") &&
                        !"".equals(row.getAttribute("CodigoContrato").toString())) {

                        codigoContrato = row.getAttribute("CodigoContrato").toString();
                        logger.warning("La comision ya fue registrada en flexcube para el contrato : " +
                                       codigoContrato);
                        contador++;

                    } else {

                        logger.warning("Registra comision en flexcube");
                        comisionErrorMap = (HashMap) registraComisionFlexcube(idComision);

                        Iterator iteratorMap = comisionErrorMap.entrySet().iterator();
                        logger.warning("Tamaño del mapa : " + comisionErrorMap.size());
                        while (iteratorMap.hasNext()) {

                            Map.Entry comisionError = (Map.Entry) iteratorMap.next();
                            registrado = (Boolean) comisionError.getKey();
                            logger.warning("registrado : " + registrado);

                            if (!registrado) {

                                logger.warning("La comision no fue registrada : " + idComision);
                                mensaje = nombre + ": " + (String) comisionError.getValue();
                                logger.warning("mensaje : " + mensaje);
                                comisionMap.put(String.valueOf(registrado) + " " + i, mensaje);
                                i++;

                            } else {

                                logger.warning("La comision se registro correctamente.");
                                mensaje = "Se registro la comisión " + nombre + idComision + " exitosamente.";
                                comisionMap.put(String.valueOf(registrado) + " " + j, mensaje);
                                j++;

                            }
                        }
                    }

                } else {
                    logger.warning("El id de la comision es nula.");
                }
            }
            iterator.closeRowSetIterator();
            logger.warning("Contador : " + contador);
            if (contador.compareTo(numeroComision) == 0) {
                logger.warning("Todas las comisiones se encuentran registradas en FLEXCUBE");
                comisionMap.put("Registrada", "Todas las comisiones se encuentran registradas en FLEXCUBE");
            }
        } catch (Exception e) {
            logger.warning("Error en registrarComisionesFlexcube", e);
        }
        logger.warning("Termina metodo de validacion de comisiones.");
        return comisionMap;
    }

    public Map registraComisionFlexcube(Long idComision) {
        logger.warning("Entra en registraComisionFlexcube");
        HashMap<Boolean, Object> comisionMap = new HashMap<>();
        Boolean registrada = Boolean.FALSE;
        ComisionPT comisionPT = null;
        CrearCargoTramiteRequestType request = null;
        CrearCargoTramiteResponseType response = null;
        Comision comision = null;
        String wsdl = null;

        try {
            logger.warning("Valor del idComision : " + idComision);

            wsdl = this.getWsdl(IWsdlLocation.COMISION);
            comision = IWsdlLocation.Service.getInstance(Comision.class, wsdl);

            comisionPT = comision.getComision12Bnd();
            request = new CrearCargoTramiteRequestType();

            request.setIdComision(idComision);
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_COMISION);
            response = comisionPT.crearCargoTramite(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_COMISION, horaInicio);

            if (null != response) {
                if (null != response.getResultado()) {
                    if (null != response.getResultado().getResult()) {
                        if (response.getResultado().getResult().value().equalsIgnoreCase("OK")) {
                            logger.warning("Respuesta afirmativa del servicio. " +
                                           response.getResultado().getMessage());
                            registrada = Boolean.TRUE;
                            comisionMap.put(registrada, response.getResultado().getMessage());
                        } else {

                            logger.warning("El servicio regresa error. " +
                                           response.getResultado().getError().getErrorDescription());
                            comisionMap.put(registrada, response.getResultado().getError().getErrorDescription());
                            //throw new Exception(response.getResultado().getError().getErrorDescription());
                        }
                    } else {
                        logger.warning("El objeto response.getResultado().getResult() es nulo.");
                        throw new Exception("El objeto response.getResultado().getResult() es nulo.");
                    }
                } else {
                    logger.warning("Error, el objeto response.getResultado() es nulo.");
                    throw new Exception("El objeto response.getResultado() es nulo.");
                }
            } else {
                logger.warning("Error en la respuesta del servcio.");
                throw new Exception("Respuesta del servcio nula.");
            }
        } catch (Exception e) {
            logger.warning("Error en registraComisionFlexcube", e);
            JboException exception = new JboException("Error: " + e.getMessage());
            throw exception;
        }

        return comisionMap;
    }

    public Boolean registraValidarComisionFlexcube(Long idComision) {
        logger.warning("Entra en registraValidarComisionFlexcube");
        Boolean registrada = Boolean.FALSE;

        ComisionPT comisionPT = null;
        CrearCargoTramiteRequestType request = null;
        CrearCargoTramiteResponseType response = null;
        Comision comision = null;
        String wsdl = null;

        try {
            logger.warning("Valor del idComision : " + idComision);

            wsdl = this.getWsdl(IWsdlLocation.COMISION);
            comision = IWsdlLocation.Service.getInstance(Comision.class, wsdl);

            comisionPT = comision.getComision12Bnd();
            request = new CrearCargoTramiteRequestType();

            request.setIdComision(idComision);
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_COMISION);
            response = comisionPT.crearCargoTramite(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_COMISION, horaInicio);

            if (null != response) {
                if (null != response.getResultado()) {
                    if (null != response.getResultado().getResult()) {
                        if (response.getResultado().getResult().value().equalsIgnoreCase("OK")) {
                            logger.warning("Respuesta afirmativa del servicio. " +
                                           response.getResultado().getMessage());
                            registrada = Boolean.TRUE;
                        } else {

                            logger.warning("El servicio regresa error. " +
                                           response.getResultado().getError().getErrorDescription());
                            throw new Exception(response.getResultado().getError().getErrorDescription());
                        }
                    } else {
                        logger.warning("El objeto response.getResultado().getResult() es nulo.");
                        throw new Exception("El objeto response.getResultado().getResult() es nulo.");
                    }
                } else {
                    logger.warning("Error, el objeto response.getResultado() es nulo.");
                    throw new Exception("El objeto response.getResultado() es nulo.");
                }
            } else {
                logger.warning("Error en la respuesta del servcio.");
                throw new Exception("Respuesta del servcio nula.");
            }
        } catch (Exception e) {
            logger.warning("Error en registraValidarComisionFlexcube", e);
            JboException exception = new JboException("Error: " + e.getMessage());
            throw exception;
        }

        return registrada;
    }

    /**
     * Guarda los cambios del registro de Termino y actualiza el detalle de Categorias Termino,
     * si el proceso de guardado es exitoso, consume WS para realizar la actualizacion de Estado TCC.
     */
    public void guardarMatrizTCCEditarTermino(Integer idModalidad, String loginUsuario) {
        logger.warning("guardarMatrizTCCEditarTermino");
        logger.warning("idModalidad: " + idModalidad);

        TccTerminoVOImpl tccTerminoVO = null; //getTccTerminoVO();

        String strIdTcaTermino = null;
        String claveTcaTermino = null;
        Map<String, Object> responseMap = null;
        String nombreUsuario = null;

        if (idModalidad != null) {
            if (new Integer(1).equals(idModalidad)) {
                //Obtiene VO Termino cuando es Tree
                tccTerminoVO = getTccTerminoVO();
            } else {
                //Obtiene VO Termino cuando es Grid
                tccTerminoVO = getTccTerminoGridVO();
            }
        } else {
            logger.severe("Error Id de modalidad no recibido");
        }

        TccTerminoVORowImpl tccTerminoRow = (TccTerminoVORowImpl) tccTerminoVO.getCurrentRow();
        logger.warning("Tipo de termino: " + tccTerminoRow.getIdTcaTermino());

        try {
            if (tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO) != null) {
                strIdTcaTermino = tccTerminoRow.getAttribute(TccTerminoVORowImpl.IDTCATERMINO).toString();
            }
            claveTcaTermino = getClaveTcaTermino(strIdTcaTermino);
        } catch (Exception e) {
            logger.severe("Error al obtener el codigo externo del TCA Termino");
        }

        if (null != claveTcaTermino) {
            if (claveTcaTermino.equals("T201") || claveTcaTermino.equals("T202") || claveTcaTermino.equals("T203") ||
                claveTcaTermino.equals("T299")) {
                logger.warning("El termino es tipo Monto");
                if (null != tccTerminoRow.getIdTipoMoneda()) {
                    logger.warning("Seteo de valor de moneda a atributo IdTcaMoneda");
                    tccTerminoRow.setIdTcaMoneda(tccTerminoRow.getIdTipoMoneda());
                    logger.warning("Valor de IdTcaMoneda: " + tccTerminoRow.getIdTcaMoneda());
                }
            }

            if ("T603".equals(claveTcaTermino) || "T101".equals(claveTcaTermino)) {
                logger.warning("Seteo de valor de nombre y login usuario");
                responseMap = consultarDatosUsuario(loginUsuario);
                nombreUsuario = (String) responseMap.get("nombreUsuario");
                tccTerminoRow.setLoginUsuarioUltimoCambio(loginUsuario);
                tccTerminoRow.setNombreUsuarioUltimoCambio(nombreUsuario);
                tccTerminoRow.setFechaUltimoCambio(new java.sql.Timestamp(System.currentTimeMillis()));
                logger.warning("Valor de login usuario ultimo cambio: " + tccTerminoRow.getLoginUsuarioUltimoCambio());
                logger.warning("Valor de nombre usuario ultimo cambio: " +
                               tccTerminoRow.getNombreUsuarioUltimoCambio());

            }

            if (tccTerminoRow.getIdTcaTermino().compareTo(FenixModelConstants.TERMINO_OTRAS_CONDICIONES_TASA_INTERES) ==
                0) {
                if (null != tccTerminoRow.getIdTipoTasa()) {
                    tccTerminoRow.setIdTcaTipoTasa(tccTerminoRow.getIdTipoTasa());
                }
            }
        }

        /* Código Inicial */
        if (null != tccTerminoRow) {
            boolean esError = Boolean.FALSE;
            try {
                logger.warning("Ejecuta commit");
                getDBTransaction().commit();
            } catch (Exception e) {
                esError = Boolean.TRUE;
                logger.severe("Error al realizar Commit", e);
                try {
                    getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback al fallar Commit", ex);
                    logger.warning("Detalle del error: ", ex.getMessage());
                }
            }
            if (!esError) {
                logger.warning("Realiza la actualizacion de Estado TCC para el Termino via WS");

                TccTcaProcesoTareaBpmVORowImpl rowProcesoBpm =
                    (TccTcaProcesoTareaBpmVORowImpl) getTccTcaProcesoTareaBpmVO().getCurrentRow();

                String strIdProceso = null;
                if (rowProcesoBpm != null && rowProcesoBpm.getId() != null) {
                    strIdProceso = rowProcesoBpm.getId().toString();
                } else {
                    logger.severe("Error datos del Proceso BPM no obtenidos");
                }

                boolean actualizo =
                    this.actualizarAccionesMatrizTCC(strIdProceso, FenixModelConstants.TERMINO,
                                                     Accion.EDITAR.toString(), idModalidad);

                if (!actualizo) {
                    ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                    String msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error");
                    throw new JboException(msg);
                } else {
                    logger.warning("El estado de la tcc fue actualizado");
                }
            }
        }
        /* Fin Código Inicial */
        logger.exiting(FenixAMImpl.class.getName(), "guardarMatrizTCCEditarTermino");
    }

    public boolean actualizarAccionesMatrizTCC(String sIdProceso, String sTipoTCC, String sAccion,
                                               Integer idModalidad) {
        boolean seActualizo = false;
        String wsdl = getWsdl(IWsdlLocation.MATRIZ);
        logger.log(ADFLogger.WARNING, "WSDL DB : " + wsdl);
        MatrizTCC12BndQSService service = IWsdlLocation.Service.getInstance(MatrizTCC12BndQSService.class, wsdl);
        MatrizTCCPT port = service.getMatrizTCC12BndQSPort();

        ActualizarTCCRequestType request = new ActualizarTCCRequestType();
        ActualizarTCCResponseType response = null;

        request.setIdProceso(new Long(sIdProceso));

        if (null != sTipoTCC && null != sIdProceso && null != sAccion) {

            if (sTipoTCC.equalsIgnoreCase(FenixModelConstants.TERMINO)) {
                if (new Integer(1).equals(idModalidad)) {
                    getTccTerminoVO().mappingTerminoRequestType(request, Accion.fromValue(sAccion));
                } else {
                    //Mapeo cuando viene del Grid
                    getTccTerminoGridVO().mappingTerminoRequestType(request, Accion.fromValue(sAccion));
                }
            } else if (sTipoTCC.equalsIgnoreCase(FenixModelConstants.COMISION)) {
                if (new Integer(1).equals(idModalidad)) {
                    getTccComisionVO().mappearComisionRequestType(request, Accion.fromValue(sAccion));
                } else {
                    //Mapeo cuando viene del Grid
                    getTccComisionGridVO().mappearComisionRequestType(request, Accion.fromValue(sAccion));
                }
            } else if (sTipoTCC.equalsIgnoreCase(FenixModelConstants.CONDICION)) {
                if (new Integer(1).equals(idModalidad)) {
                    getTccCondicionVO().mappearCondicionRequestType(request, Accion.fromValue(sAccion));
                } else {
                    //Mapeo cuando viene del Grid
                    getTccCondicionGridVO().mappearCondicionRequestType(request, Accion.fromValue(sAccion));
                }
            }

            try {
                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_TCC);
                response = port.actualizarTCC(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_TCC, horaInicio);

                if (response != null && null != response.getResultado() && response.getResultado().size() > 0 &&
                    response.getResultado().get(0).getResult() != null &&
                    response.getResultado().get(0).getResult().toString().equalsIgnoreCase("OK")) {
                    seActualizo = true;

                    if (this.getContrapartesTerminoVO().getFilteredRows("esAgregado", Boolean.TRUE).length > 0) {
                        logger.warning("Cantidad de contrapartes agregadas programaticamente :" +
                                       this.getContrapartesTerminoVO().getFilteredRows("esAgregado",
                                                                                       Boolean.TRUE).length);
                        //Cambiar el estado de las contrapartes agregadas programaticas
                        for (Row row : this.getContrapartesTerminoVO().getFilteredRows("esAgregado", Boolean.TRUE)) {
                            row.setAttribute("esAgregado", Boolean.FALSE);
                        }
                    } else {
                        logger.warning("No se encontraron contrapartes");
                    }
                } else {
                    logger.warning("El servicio regres error.");
                    String msg = "ERROR";
                    if (response != null) {
                        if (null != response.getResultado() && response.getResultado().size() > 0) {
                            msg = response.getResultado().get(0).getMessage();
                        } else {
                            logger.warning("Resultado nulo.");
                            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                            msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error.resultado.nulo");
                        }
                    } else {
                        logger.warning("Response nulo.");
                        ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                        msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error.resultado.nulo");
                    }
                    throw new Exception(ModelUtils.getString(FenixModelConstants.WSC_ACTUALIZAR_TCC, " ERROR:", msg));
                }
            } catch (Exception e) {
                seActualizo = false;
                logger.log(ADFLogger.ERROR, e.getMessage());
                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception("Error al actualizar TCC. Inténtelo más tarde."));
                throw ex;
            }
        } else {
            logger.log(ADFLogger.ERROR,
                       ModelUtils.getString("actualizarAccionesMatrizTCC: Todos los parametros son obligatorios[",
                                            "sIdProceso: ", sIdProceso, "sTipoTCC: ", sTipoTCC, "sAccion: ", sAccion,
                                            "]"));
            JboException ex = new JboException("Error al actualizar TCC. Inténtelo más tarde.");
            throw ex;
        }

        return seActualizo;
    }

    public void obtenerTipoFechaInicioTermino(Integer idFechaInicio, Integer idModalidad) {
        logger.warning("Entra a método obtenerTipoFechaInicioTermino");
        TccTerminoVOImpl terminoVOImpl = null;

        logger.warning("IdModalidad: " + idModalidad);
        if (new Integer(1).equals(idModalidad)) {
            //Asigna VO Impl cuando es Modalidad Tree
            terminoVOImpl = getTccTerminoVO();
        } else {
            //Asigna VO Impl cuando es Modalidad Grid
            terminoVOImpl = getTccTerminoGridVO();
        }
        TccTerminoVORowImpl tccTerminoRow = (TccTerminoVORowImpl) terminoVOImpl.getCurrentRow();

        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_APROBACION) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_APROBACION");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(tccTerminoRow.getIdOperacion(),
                                                                   29); //29 id de termino Fecha de Aprobacion

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFecha()) {
                    tccTerminoRow.setFechaInicio(tccTerminoRowEditado.getFecha());
                } else {
                    logger.warning("El término Fecha/Aprobación no tiene registrada la fecha de aprobación.");
                    tccTerminoRow.setFechaInicio(null);
                }
            } else {
                logger.warning("No existe un término Fecha/Aprobación para esta operación.");
                tccTerminoRow.setFechaInicio(null);
            }

        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_ESCRITURACION) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_ESCRITURACION");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(tccTerminoRow.getIdOperacion(),
                                                                   30); //30 id de termino Fecha de Firma de Contrato

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFecha()) {
                    tccTerminoRow.setFechaInicio(tccTerminoRowEditado.getFecha());
                } else {
                    logger.warning("El término Fecha/Firma del contrato no tiene registrada la fecha de firma.");
                    tccTerminoRow.setFechaInicio(null);
                }
            } else {
                logger.warning("No existe un término Fecha/Firma del contrato para esta operación.");
                tccTerminoRow.setFechaInicio(null);
            }
        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_NOTIFICACION) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_NOTIFICACION");
            tccTerminoRow.setFechaInicio(null); //TODO
        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_PRIMER_DESEMBOLSO) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_PRIMER_DESEMBOLSO");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(tccTerminoRow.getIdOperacion(),
                                                                   2); //2 id de termino Inicio de desembolsos

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFechaInicio()) {
                    tccTerminoRow.setFechaInicio(tccTerminoRowEditado.getFechaInicio());
                } else {
                    logger.warning("El término Plazo/Inicio de desembolsos no tiene registrada la fecha de vigencia.");
                    tccTerminoRow.setFechaInicio(null);
                }
            } else {
                logger.warning("No existe un término Plazo/Inicio de desembolsos para esta operación.");
                tccTerminoRow.setFechaInicio(null);
            }
        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_VIGENCIA) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_VIGENCIA");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(tccTerminoRow.getIdOperacion(),
                                                                   31); //31 id de termino Fecha de Vigencia de Contrato

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFecha()) {
                    tccTerminoRow.setFechaInicio(tccTerminoRowEditado.getFecha());
                } else {
                    logger.warning("El término Fecha/Vigencia del contrato no tiene registrada la fecha de vigencia.");
                    tccTerminoRow.setFechaInicio(null);
                }
            } else {
                logger.warning("No existe un término Fecha/Vigencia del contrato para esta operación.");
                tccTerminoRow.setFechaInicio(null);
            }
        }
        logger.warning("Termina método obtenerTipoFechaInicioTermino");
    }

    public Timestamp obtenerTipoFechaInicio(Integer idFechaInicio, Long idOperacion) {
        logger.warning("Entra a método obtenerTipoFechaInicioTermino");
        Timestamp fechaInicio = null;
        TccTerminoVOImpl terminoVOImpl = getTccTerminoVO();
        TccTerminoVORowImpl tccTerminoRow = (TccTerminoVORowImpl) terminoVOImpl.getCurrentRow();

        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_APROBACION) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_APROBACION");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(idOperacion,
                                                                   29); //29 id de termino Fecha de Aprobacion

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFecha()) {
                    fechaInicio = tccTerminoRowEditado.getFecha();
                } else {
                    logger.warning("El término Fecha/Aprobación no tiene registrada la fecha de aprobación.");
                }
            } else {
                logger.warning("No existe un término Fecha/Aprobación para esta operación.");
            }

        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_ESCRITURACION) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_ESCRITURACION");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(idOperacion,
                                                                   30); //30 id de termino Fecha de Firma de Contrato

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFecha()) {
                    fechaInicio = tccTerminoRowEditado.getFecha();
                } else {
                    logger.warning("El término Fecha/Firma del contrato no tiene registrada la fecha de firma.");
                }
            } else {
                logger.warning("No existe un término Fecha/Firma del contrato para esta operación.");
            }
        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_NOTIFICACION) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_NOTIFICACION"); //TODO
        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_PRIMER_DESEMBOLSO) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_PRIMER_DESEMBOLSO");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(idOperacion,
                                                                   2); //2 id de termino Inicio de desembolsos

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFechaInicio()) {
                    fechaInicio = tccTerminoRowEditado.getFecha();
                } else {
                    logger.warning("El término Plazo/Inicio de desembolsos no tiene registrada la fecha de vigencia.");
                }
            } else {
                logger.warning("No existe un término Plazo/Inicio de desembolsos para esta operación.");
            }
        }
        if (idFechaInicio.compareTo(TERMINO_TIPO_FECHA_INICIO_VIGENCIA) == 0) {
            logger.warning("TERMINO_TIPO_FECHA_INICIO_VIGENCIA");

            TccEditarTerminoVOImpl tccTerminoEditarVO = getTccEditarTerminoVO();
            tccTerminoEditarVO.buscarTerminoPorOperacionTcaTermino(idOperacion,
                                                                   31); //31 id de termino Fecha de Vigencia de Contrato

            if (tccTerminoEditarVO.getRowCount() > 0) {
                TccEditarTerminoVORowImpl tccTerminoRowEditado =
                    (TccEditarTerminoVORowImpl) tccTerminoEditarVO.getCurrentRow();
                if (null != tccTerminoRowEditado.getFecha()) {
                    fechaInicio = tccTerminoRowEditado.getFecha();
                } else {
                    logger.warning("El término Fecha/Vigencia del contrato no tiene registrada la fecha de vigencia.");
                }
            } else {
                logger.warning("No existe un término Fecha/Vigencia del contrato para esta operación.");
            }
        }
        logger.warning("Termina método obtenerTipoFechaInicioTermino: " + fechaInicio);
        return fechaInicio;
    }

    /**
     * Propagacion de fecha de inicio para los terminos tipo Plazo
     * @param idOperacion
     * @since 07/04/2016
     */
    public void actualizarFechaInicioTerminosTipoPlazo(Long idOperacion, Timestamp fecha, Integer idTipoFechaInicio) {
        logger.warning("Entra actualizarFechaInicioTerminosTipoPlazo");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("fecha :" + fecha);
        logger.warning("idTipoFechaInicio :" + idTipoFechaInicio);
        RowSetIterator tccTerminoVOIter =
            getTccTerminoVO().buscarTerminoPorIdOperacionTcaTermino(idOperacion, idTipoFechaInicio);

        if (tccTerminoVOIter != null && tccTerminoVOIter.getRowCount() > 0) {
            tccTerminoVOIter.reset();
            logger.warning("Registros a modificar: " + tccTerminoVOIter.getRowCount());
            while (tccTerminoVOIter.hasNext()) {

                Row row = tccTerminoVOIter.next();
                TccTerminoVORowImpl tccTerminoRow = null;

                Long id = (Long) row.getAttribute("Id");
                tccTerminoRow = (TccTerminoVORowImpl) getTccTerminoVO().getRow(new Key(new Object[] { id }));
                tccTerminoRow.setFechaInicio(fecha);

                if (tccTerminoRow.getIdTcaTermino().compareTo(TERMINO_PLAZO_FINANCIAMIENTO) == -1) {

                    if (null != tccTerminoRow.getPlazo() && null != tccTerminoRow.getIdTcaFrecuenciaPlazo()) {
                        Integer plazo = tccTerminoRow.getPlazo();
                        Integer frecuenciaPlazo = tccTerminoRow.getIdTcaFrecuenciaPlazo();
                        try {
                            logger.warning("Iniciando calculo de fechaVencimiento");
                            Calendar calendar = Calendar.getInstance();
                            calendar.setTime(fecha);

                            logger.warning("Plazo: " + plazo);
                            logger.warning("Frecuencia de plazo: " + frecuenciaPlazo);

                            if (frecuenciaPlazo.toString().equals("1"))
                                calendar.add(Calendar.DAY_OF_WEEK, plazo);
                            else if (frecuenciaPlazo.toString().equals("2"))
                                calendar.add(Calendar.MONTH, plazo);
                            else if (frecuenciaPlazo.toString().equals("3"))
                                calendar.add(Calendar.YEAR, plazo);

                            Timestamp fechaVencimiento = new Timestamp(calendar.getTime().getTime());
                            logger.warning("FechaVencimientoCalculada: " + fechaVencimiento.toString());
                            tccTerminoRow.setAttribute(TccTerminoVORowImpl.FECHAVENCIMIENTO, fechaVencimiento);
                        } catch (Exception e) {
                            logger.severe("Error en actualizarFechaInicioTerminosTipoPlazo :" + e);
                        }
                    }
                }
                logger.warning("Se editó el término: " + tccTerminoRow.getId());
            }
            logger.warning("Realizando commit para actualizar Fechas de Inicio");
            getDBTransaction().commit();
            getTccTerminoVO().getViewCriteriaManager().removeApplyViewCriteriaName("TccTerminoPorOperTcaTerminoTipoFechaIniVC");
            getTccTerminoVO().executeQuery();
            
            tccTerminoVOIter.closeRowSetIterator();
        }

        logger.warning("Fuera actualizarFechaInicioTerminosTipoPlazo");
    }

    /**
     * Obtiene termino T603 que indica cuando una operacion se encuentra formalizada
     * @param idOperacion
     * @return existeTermino
     * 29/11/2017
     */
    public Boolean obtenerTcaTerminoFirmaContrato(Long idOperacion) {
        logger.warning("Entra en obtenerTcaTerminoFirmaContrato");
        Boolean existeTermino = Boolean.FALSE;
        //Se implementa de acuerdo a FNXII-6928
        try {
            TccTerminoVOImpl TccTerminoVO = getTccTerminoVO();
            existeTermino = TccTerminoVO.validarTcaTipoTerminoFirmaContrato(idOperacion);
        } catch (Exception e) {
            logger.warning("Error en obtenerTcaTerminoFirmaContrato");
        }

        logger.warning("Existe termino : " + existeTermino);
        return existeTermino;
    }

    /**
     * Container's getter for TccTipoPorOperVO1.
     * @return TccTipoPorOperVO1
     */
    public TccTipoPorOperVOImpl getTccTipoPorOperVO() {
        return (TccTipoPorOperVOImpl) findViewObject("TccTipoPorOperVO");
    }

    /**
     * Container's getter for TccRootNodeVOAndTccTipoPorOperVO1.
     * @return TccRootNodeVOAndTccTipoPorOperVO1
     */
    public ViewLinkImpl getTccRootNodeVOAndTccTipoPorOperVO() {
        return (ViewLinkImpl) findViewLink("TccRootNodeVOAndTccTipoPorOperVO");
    }

    /**
     * Container's getter for TccElementosOperVO1.
     * @return TccElementosOperVO1
     */
    public TccElementosOperVOImpl getTccElementosOperVO() {
        return (TccElementosOperVOImpl) findViewObject("TccElementosOperVO");
    }

    /**
     * Container's getter for TccTipoPorOperVOAndTccElementosOperVO1.
     * @return TccTipoPorOperVOAndTccElementosOperVO1
     */
    public ViewLinkImpl getTccTipoPorOperVOAndTccElementosOperVO() {
        return (ViewLinkImpl) findViewLink("TccTipoPorOperVOAndTccElementosOperVO");
    }

    /**
     * Container's getter for TccElementosOperVO1.
     * @return TccElementosOperVO1
     */
    public TccElementosOperVOImpl getTccGridElementosOperVO() {
        return (TccElementosOperVOImpl) findViewObject("TccGridElementosOperVO");
    }

    /**
     * Container's getter for TccTerminoVO1.
     * @return TccTerminoVO1
     */
    public TccTerminoVOImpl getTccTerminoVO() {
        return (TccTerminoVOImpl) findViewObject("TccTerminoVO");
    }

    /**
     * Container's getter for TccTcaProcesoTareaBpmVO1.
     * @return TccTcaProcesoTareaBpmVO1
     */
    public TccTcaProcesoTareaBpmVOImpl getTccTcaProcesoTareaBpmVO() {
        return (TccTcaProcesoTareaBpmVOImpl) findViewObject("TccTcaProcesoTareaBpmVO");
    }

    /**
     * Container's getter for TccCondicionVO1.
     * @return TccCondicionVO1
     */
    public TccCondicionVOImpl getTccCondicionVO() {
        return (TccCondicionVOImpl) findViewObject("TccCondicionVO");
    }

    /**
     * Container's getter for TccComisionVO1.
     * @return TccComisionVO1
     */
    public TccComisionVOImpl getTccComisionVO() {
        return (TccComisionVOImpl) findViewObject("TccComisionVO");
    }


    /**
     * Container's getter for OperacionVO1.
     * @return OperacionVO1
     */
    public ViewObjectImpl getOperacionVO() {
        return (ViewObjectImpl) findViewObject("OperacionVO");
    }

    /**
     * Container's getter for TcaCategoriaCondicionVO1.
     * @return TcaCategoriaCondicionVO1
     */
    public TcaCategoriaCondicionVOImpl getTccTcaCategoriaCondicionVO() {
        return (TcaCategoriaCondicionVOImpl) findViewObject("TccTcaCategoriaCondicionVO");
    }

    /**
     * Container's getter for TcaEventoCondicionLOV1.
     * @return TcaEventoCondicionLOV1
     */
    public TcaEventoCondicionLOVImpl getTccTcaEventoCondicionLOV() {
        return (TcaEventoCondicionLOVImpl) findViewObject("TccTcaEventoCondicionLOV");
    }

    /**
     * Container's getter for TreCategoriaCondicionVO1.
     * @return TreCategoriaCondicionVO1
     */
    public TreCategoriaCondicionVOImpl getTreCategoriaCondicionVO() {
        return (TreCategoriaCondicionVOImpl) findViewObject("TreCategoriaCondicionVO");
    }

    /**
     * Container's getter for CondicionAndTreCategoriaCondicionVL1.
     * @return CondicionAndTreCategoriaCondicionVL1
     */
    public ViewLinkImpl getCondicionAndTreCategoriaCondicionVL() {
        return (ViewLinkImpl) findViewLink("CondicionAndTreCategoriaCondicionVL");
    }

    /**
     * Container's getter for TreTcaEventoCondicionVO1.
     * @return TreTcaEventoCondicionVO1
     */
    public TreTcaEventoCondicionVOImpl getTreTcaEventoCondicionVO() {
        return (TreTcaEventoCondicionVOImpl) findViewObject("TreTcaEventoCondicionVO");
    }

    /**
     * Container's getter for CondicionAndTreTcaEventoCondicionVL1.
     * @return CondicionAndTreTcaEventoCondicionVL1
     */
    public ViewLinkImpl getCondicionAndTreTcaEventoCondicionVL() {
        return (ViewLinkImpl) findViewLink("CondicionAndTreTcaEventoCondicionVL");
    }

    /**
     * Container's getter for TccObservacionCondicionVO1.
     * @return TccObservacionCondicionVO1
     */
    public TccObservacionCondicionVOImpl getTccObservacionCondicionVO() {
        return (TccObservacionCondicionVOImpl) findViewObject("TccObservacionCondicionVO");
    }

    /**
     * Container's getter for CondicionAndObservacionCondicionVL1.
     * @return CondicionAndObservacionCondicionVL1
     */
    public ViewLinkImpl getCondicionAndObservacionCondicionVL() {
        return (ViewLinkImpl) findViewLink("CondicionAndObservacionCondicionVL");
    }

    /**
     * Container's getter for VotoAprobacionLOV1.
     * @return VotoAprobacionLOV1
     */
    public VotoAprobacionLOVImpl getVotoAprobacionLOV() {
        return (VotoAprobacionLOVImpl) findViewObject("VotoAprobacionLOV");
    }

    /**
     * Container's getter for ValidaDocOperTareaLOV1.
     * @return ValidaDocOperTareaLOV1
     */
    public ValidaDocOperTareaLOVImpl getValidaDocOperTareaLOV() {
        return (ValidaDocOperTareaLOVImpl) findViewObject("ValidaDocOperTareaLOV");
    }

    /**
     * Container's getter for ActualizarOperacionVO1.
     * @return ActualizarOperacionVO1
     */
    public ActualizarOperacionVOImpl getActualizarOperacionVO() {
        return (ActualizarOperacionVOImpl) findViewObject("ActualizarOperacionVO");
    }

    /**
     * Container's getter for TccTcaTerminoVO1.
     * @return TccTcaTerminoVO1
     */
    public TccTcaTerminoVOImpl getTccTcaTerminoVO() {
        return (TccTcaTerminoVOImpl) findViewObject("TccTcaTerminoVO");
    }

    /**
     * Container's getter for TccFuenteCondicionLOV1.
     * @return TccFuenteCondicionLOV1
     */
    public TccFuenteCondicionLOVImpl getTccFuenteCondicionLOV() {
        return (TccFuenteCondicionLOVImpl) findViewObject("TccFuenteCondicionLOV");
    }

    /**
     * Container's getter for TccLineaCreditoCondicionLOV1.
     * @return TccLineaCreditoCondicionLOV1
     */
    public TccLineaCreditoCondicionLOVImpl getTccLineaCreditoCondicionLOV() {
        return (TccLineaCreditoCondicionLOVImpl) findViewObject("TccLineaCreditoCondicionLOV");
    }


    /**
     * Container's getter for TccTreeRootTerminoVO1.
     * @return TccTreeRootTerminoVO1
     */
    public ViewObjectImpl getTccTreeRootTerminoVO() {
        return (ViewObjectImpl) findViewObject("TccTreeRootTerminoVO");
    }


    /**
     * Container's getter for TccTreeTcaTipoTerminoVO2.
     * @return TccTreeTcaTipoTerminoVO2
     */
    public ViewObjectImpl getTccTreeTcaTipoTerminoVO() {
        return (ViewObjectImpl) findViewObject("TccTreeTcaTipoTerminoVO");
    }

    /**
     * Container's getter for TccTreeRootTerminoAndTccTreeTcaTipoTerminoVL2.
     * @return TccTreeRootTerminoAndTccTreeTcaTipoTerminoVL2
     */
    public ViewLinkImpl getTccTreeRootTerminoAndTccTreeTcaTipoTerminoVL() {
        return (ViewLinkImpl) findViewLink("TccTreeRootTerminoAndTccTreeTcaTipoTerminoVL");
    }

    /**
     * Container's getter for TccTreeTcaTerminoVO1.
     * @return TccTreeTcaTerminoVO1
     */
    public ViewObjectImpl getTccTreeTcaTerminoVO() {
        return (ViewObjectImpl) findViewObject("TccTreeTcaTerminoVO");
    }

    /**
     * Container's getter for TccTreeTcaTipoTerminoAndTccTreeTcaTerminoVL1.
     * @return TccTreeTcaTipoTerminoAndTccTreeTcaTerminoVL1
     */
    public ViewLinkImpl getTccTreeTcaTipoTerminoAndTccTreeTcaTerminoVL() {
        return (ViewLinkImpl) findViewLink("TccTreeTcaTipoTerminoAndTccTreeTcaTerminoVL");
    }

    /**
     * Container's getter for TccTreeTerminoVO1.
     * @return TccTreeTerminoVO1
     */
    public ViewObjectImpl getTccTreeTerminoVO() {
        return (ViewObjectImpl) findViewObject("TccTreeTerminoVO");
    }

    /**
     * Container's getter for TccTreeTcaTerminoAndTccTreeTerminoVL1.
     * @return TccTreeTcaTerminoAndTccTreeTerminoVL1
     */
    public ViewLinkImpl getTccTreeTcaTerminoAndTccTreeTerminoVL() {
        return (ViewLinkImpl) findViewLink("TccTreeTcaTerminoAndTccTreeTerminoVL");
    }

    /**
     * Container's getter for TccTreeRootCondicionVO1.
     * @return TccTreeRootCondicionVO1
     */
    public ViewObjectImpl getTccTreeRootCondicionVO() {
        return (ViewObjectImpl) findViewObject("TccTreeRootCondicionVO");
    }

    /**
     * Container's getter for TccTreeTcaTipoCondicionVO1.
     * @return TccTreeTcaTipoCondicionVO1
     */
    public TccTreeTcaTipoCondicionVOImpl getTccTreeTcaTipoCondicionVO() {
        return (TccTreeTcaTipoCondicionVOImpl) findViewObject("TccTreeTcaTipoCondicionVO");
    }

    /**
     * Container's getter for TccTreeRootCondicionAndTccTreeTcaTipoCondicionVL1.
     * @return TccTreeRootCondicionAndTccTreeTcaTipoCondicionVL1
     */
    public ViewLinkImpl getTccTreeRootCondicionAndTccTreeTcaTipoCondicionVL() {
        return (ViewLinkImpl) findViewLink("TccTreeRootCondicionAndTccTreeTcaTipoCondicionVL");
    }

    /**
     * Container's getter for TccTreeTcaCondicionVO1.
     * @return TccTreeTcaCondicionVO1
     */
    public TccTreeTcaCondicionVOImpl getTccTreeTcaCondicionVO() {
        return (TccTreeTcaCondicionVOImpl) findViewObject("TccTreeTcaCondicionVO");
    }

    /**
     * Container's getter for TccTreeTcaTipoCondicionAndTccTreeTcaCondicionVL1.
     * @return TccTreeTcaTipoCondicionAndTccTreeTcaCondicionVL1
     */
    public ViewLinkImpl getTccTreeTcaTipoCondicionAndTccTreeTcaCondicionVL() {
        return (ViewLinkImpl) findViewLink("TccTreeTcaTipoCondicionAndTccTreeTcaCondicionVL");
    }

    /**
     * Container's getter for TccTreeCondicionVO1.
     * @return TccTreeCondicionVO1
     */
    public TccTreeCondicionVOImpl getTccTreeCondicionVO() {
        return (TccTreeCondicionVOImpl) findViewObject("TccTreeCondicionVO");
    }

    /**
     * Container's getter for TccTreeTcaCondicionAndTccTreeCondicionVL1.
     * @return TccTreeTcaCondicionAndTccTreeCondicionVL1
     */
    public ViewLinkImpl getTccTreeTcaCondicionAndTccTreeCondicionVL() {
        return (ViewLinkImpl) findViewLink("TccTreeTcaCondicionAndTccTreeCondicionVL");
    }

    /**
     * Container's getter for TccTreeRootComisionVO1.
     * @return TccTreeRootComisionVO1
     */
    public ViewObjectImpl getTccTreeRootComisionVO() {
        return (ViewObjectImpl) findViewObject("TccTreeRootComisionVO");
    }

    /**
     * Container's getter for TccTreeTcaTipoComisionVO1.
     * @return TccTreeTcaTipoComisionVO1
     */
    public ViewObjectImpl getTccTreeTcaTipoComisionVO() {
        return (ViewObjectImpl) findViewObject("TccTreeTcaTipoComisionVO");
    }

    /**
     * Container's getter for TccTreeRootComisionAndTccTreeTcaTipoComisionVL1.
     * @return TccTreeRootComisionAndTccTreeTcaTipoComisionVL1
     */
    public ViewLinkImpl getTccTreeRootComisionAndTccTreeTcaTipoComisionVL() {
        return (ViewLinkImpl) findViewLink("TccTreeRootComisionAndTccTreeTcaTipoComisionVL");
    }

    /**
     * Container's getter for TccTreeTcaComisionVO1.
     * @return TccTreeTcaComisionVO1
     */
    public ViewObjectImpl getTccTreeTcaComisionVO() {
        return (ViewObjectImpl) findViewObject("TccTreeTcaComisionVO");
    }

    /**
     * Container's getter for TccTreeTcaTipoComisionAndTccTreeTcaComisionVL1.
     * @return TccTreeTcaTipoComisionAndTccTreeTcaComisionVL1
     */
    public ViewLinkImpl getTccTreeTcaTipoComisionAndTccTreeTcaComisionVL() {
        return (ViewLinkImpl) findViewLink("TccTreeTcaTipoComisionAndTccTreeTcaComisionVL");
    }

    /**
     * Container's getter for TccTreeComisionVO1.
     * @return TccTreeComisionVO1
     */
    public ViewObjectImpl getTccTreeComisionVO() {
        return (ViewObjectImpl) findViewObject("TccTreeComisionVO");
    }

    /**
     * Container's getter for TccTreeTcaComisionAndTccTreeComisionVL1.
     * @return TccTreeTcaComisionAndTccTreeComisionVL1
     */
    public ViewLinkImpl getTccTreeTcaComisionAndTccTreeComisionVL() {
        return (ViewLinkImpl) findViewLink("TccTreeTcaComisionAndTccTreeComisionVL");
    }

    public void setvarIdOperacionTcc(Long value) {
        this.getTccTreeRootVO().setNamedWhereClauseParam("varIdOperacionTcc", value);
        this.getTccTreeRootVO().executeQuery();
    }

    /**
     * Container's getter for TccSeleccionarVO1.
     * @return TccSeleccionarVO1
     */
    public TccSeleccionarVOImpl getTccSeleccionarVO() {
        return (TccSeleccionarVOImpl) findViewObject("TccSeleccionarVO");
    }

    /**
     * Container's getter for TccAgregarVO1.
     * @return TccAgregarVO1
     */
    public TccAgregarVOImpl getTccAgregarVO() {
        return (TccAgregarVOImpl) findViewObject("TccAgregarVO");
    }

    /**
     * Container's getter for TcoAtributoTccVO2.
     * @return TcoAtributoTccVO2
     */
    public TcoAtributoTccVOImpl getTcoAtributoTccVO() {
        return (TcoAtributoTccVOImpl) findViewObject("TcoAtributoTccVO");
    }

    /**
     * Container's getter for EnmiendaTccVO1.
     * @return EnmiendaTccVO1
     */
    public EnmiendaTccVOImpl getEnmiendaTccVO() {
        return (EnmiendaTccVOImpl) findViewObject("EnmiendaTccVO");
    }

    /**
     * Container's getter for DetalleEnmiendaTccVO1.
     * @return DetalleEnmiendaTccVO1
     */
    public DetalleEnmiendaTccVOImpl getDetalleEnmiendaTccVO() {
        return (DetalleEnmiendaTccVOImpl) findViewObject("DetalleEnmiendaTccVO");
    }

    public Boolean enmendarTcc(Long idOperacion, Long idEnmienda, String instanciaProceso, Number idTcc, String tipoTcc,
                               Integer idTcaEstadoTcc, Integer idTcaSubEstadoTcc, String accion, String tcaDescCorta,
                               String loginUsuario) {
        logger.log(ADFLogger.WARNING,
                   "Inside enmendarTcc. idOperacion: " + idOperacion + " Id Enmienda" + idEnmienda +
                   " instanciaProceso: " + instanciaProceso + " idTcc: " + idTcc + " tipoTcc: " + tipoTcc +
                   " idTcaEstadoTcc: " + idTcaEstadoTcc + " idTcaSubEstadoTcc: " + idTcaSubEstadoTcc + " accion: " +
                   accion + " tcaDescCorta: " + tcaDescCorta + " loginUsuario: " + loginUsuario);
        Long idTccEnmendado = null;
        Boolean esEjecucionExitosa = Boolean.FALSE;
        String mensajeError = null;
        Map<String, Object> responseMap = null;
        String nombreUsuario = null;

        if (idOperacion != null && idEnmienda != null && instanciaProceso != null && idTcc != null && tipoTcc != null) {

            try {
                // 1) Invocamos método para crear TCC (enmendado), returns Id
                if (tipoTcc.equalsIgnoreCase(FenixModelConstants.TERMINO)) {

                    // Enmendar Termino
                    if ("T603".equals(tcaDescCorta) || "T101".equals(tcaDescCorta)) {
                        responseMap = consultarDatosUsuario(loginUsuario);
                        nombreUsuario = (String) responseMap.get("nombreUsuario");
                        idTccEnmendado =
                            this.getTccTerminoVO().crearTerminoEnmendado(idTcc, idTcaEstadoTcc, idTcaSubEstadoTcc,
                                                                         nombreUsuario, loginUsuario);
                    } else {
                        idTccEnmendado =
                            this.getTccTerminoVO().crearTerminoEnmendado(idTcc, idTcaEstadoTcc, idTcaSubEstadoTcc);
                    }
                } else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.CONDICION)) {

                    // Enmendar Condición
                    idTccEnmendado =
                        this.getTccCondicionVO().crearCondicionEnmendada(idTcc, idTcaEstadoTcc, idTcaSubEstadoTcc);
                } else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.COMISION)) {

                    // Enmendar Comisión
                    idTccEnmendado =
                        this.getTccComisionVO().crearComisionEnmendada(idTcc, idTcaEstadoTcc, idTcaSubEstadoTcc);
                }

                // 2) Invocamos método para crear registro en Detalle enmienda
                if (idTccEnmendado != null) {
                    this.getDetalleEnmiendaTccVO().crearDetalleEnmiendaTcc(idOperacion, idEnmienda, instanciaProceso,
                                                                           idTccEnmendado, tipoTcc, accion);
                    esEjecucionExitosa = Boolean.TRUE;
                }
            } catch (Exception e) {
                mensajeError = "Error al enmendar TCC. ";
                logger.log(ADFLogger.ERROR, mensajeError + e.getMessage());

                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception(mensajeError));
                throw ex;
            }
        } else {
            JboException ex = new JboException("Parámetros insuficientes para enmendar Tcc.");
            throw ex;
        }

        return esEjecucionExitosa;
    }

    public Boolean crearTcc(Long idOperacion, String tipoTcc, String nombreTcc, Integer idTcaTcc,
                            Integer idTcaEstadoTcc, Integer idTcaSubEstadoTcc, Long idTccCurrentRow,
                            String tcaDescCorta, String loginUsuario) {
        logger.log(ADFLogger.WARNING,
                   "Inside crearTcc. idOperacion: " + idOperacion + " tipoTcc: " + tipoTcc + " nombreTcc : " +
                   nombreTcc + " idTcaTcc: " + idTcaTcc + " idTcaEstadoTcc: " + idTcaEstadoTcc +
                   " idTcaSubEstadoTcc: " + idTcaSubEstadoTcc + " idTccCurrentRow: " + idTccCurrentRow +
                   " tcaDescCorta: " + tcaDescCorta + " loginUsuario: " + loginUsuario);
        Long idNuevoTcc = null;
        Boolean esEjecucionExitosa = Boolean.FALSE;
        String mensajeError = null;
        Map<String, Object> responseMap = null;
        String nombreUsuario = null;

        if (idOperacion != null && tipoTcc != null && nombreTcc != null && idTcaTcc != null && idTcaEstadoTcc != null) {

            try {
                // 1) Invocamos método para crear TCC, returns Id
                if (tipoTcc.equalsIgnoreCase(FenixModelConstants.TERMINO)) {

                    // Crear Termino
                    if ("T603".equals(tcaDescCorta) || "T101".equals(tcaDescCorta)) {
                        responseMap = consultarDatosUsuario(loginUsuario);
                        nombreUsuario = (String) responseMap.get("nombreUsuario");
                        idNuevoTcc =
                            this.getTccTerminoVO().crearTermino(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                                idTcaSubEstadoTcc, BANESTATUS_TRUE, nombreUsuario,
                                                                loginUsuario);
                    } else {
                        idNuevoTcc =
                            this.getTccTerminoVO().crearTermino(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                                idTcaSubEstadoTcc, BANESTATUS_TRUE);
                    }

                } else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.CONDICION)) {

                    // Crear Condición
                    idNuevoTcc =
                        this.getTccCondicionVO().crearCondicion(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                                idTcaSubEstadoTcc, BANESTATUS_TRUE);
                } else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.COMISION)) {

                    // Crear Comisión
                    idNuevoTcc =
                        this.getTccComisionVO().crearComision(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                              idTcaSubEstadoTcc, BANESTATUS_TRUE);
                }
                logger.warning("Valor idTcc: " + idNuevoTcc);
                // 2) Es ejecución exitosa
                if (idNuevoTcc != null) {
                    //esEjecucionExitosa = Boolean.TRUE;
                    logger.warning("Invocando metodo de precarga de informacion para TCC");
                    esEjecucionExitosa = precargarInformacionTCC(idNuevoTcc, idTcaTcc, ID_MODALIDAD_TCC_TREE, tipoTcc);
                    logger.warning("esEjecucionExitosa: " + esEjecucionExitosa);
                    // 3) Debido a que los métodos de crear[Termino/Condicion/Comision] y de precargarInformacionTCC
                    // modifican el current row, ya que ambos hacen commit, lo reasignamos al que estaba seleccionado.
                    // Lo anterior para no alterar datos en el Front de Matriz (tree).
                    if (esEjecucionExitosa && idTccCurrentRow != null) {

                        if (tipoTcc.equalsIgnoreCase(FenixModelConstants.TERMINO)) {
                            // The method accepts two arguments: a Key object that is used to locate the row in the VO
                            // and an integer indicating the range position of row (for VOs configured with Range Paging Access Mode)
                            this.getTccTerminoVO().findAndSetCurrentRowByKey(new Key(new Object[] { idTccCurrentRow }),
                                                                             0);
                        } else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.CONDICION))
                            this.getTccCondicionVO().findAndSetCurrentRowByKey(new Key(new Object[] {
                                                                                       idTccCurrentRow }), 0);
                        else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.COMISION))
                            this.getTccComisionVO().findAndSetCurrentRowByKey(new Key(new Object[] { idTccCurrentRow }),
                                                                              0);
                    }
                }
            } catch (Exception e) {
                mensajeError = "Error al crear TCC. ";
                logger.warning("Error al crear TCC ->", e);

                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception(mensajeError));
                throw ex;
            }
        } else {
            JboException ex = new JboException("Parámetros insuficientes para crear Tcc.");
            throw ex;
        }

        return esEjecucionExitosa;
    }

    public Map consultarDatosUsuario(String loginUsuario) {
        logger.warning("Inside consultarDatosUsuario.");

        Map<String, Object> responseMap = null;
        responseMap = consultarAtributosUsuario(loginUsuario);

        return responseMap;
    }

    public Boolean crearRegistroComision(Long idOperacion, String nombreTcc, Integer idTcaTcc, Integer idTcaEstadoTcc,
                                         Integer idTcaSubEstadoTcc, Long idTccCurrentRow) {
        logger.warning("Entra en crearRegistroComision.");
        logger.warning("Id Operacion :" + idOperacion + " nombreTcc : " + nombreTcc + " idTcaTcc: " + idTcaTcc +
                       " idTcaEstadoTcc: " + idTcaEstadoTcc + " idTcaSubEstadoTcc: " + idTcaSubEstadoTcc +
                       " idTccCurrentRow: " + idTccCurrentRow);
        Long idNuevoTcc = null;
        Boolean esEjecucionExitosa = Boolean.FALSE;
        String mensajeError = null;

        if (idOperacion != null && nombreTcc != null && idTcaTcc != null && idTcaEstadoTcc != null) {
            try {
                // Crear Comisión
                idNuevoTcc =
                    this.getTccComisionVO().crearNuevaComisionEnRegistro(idOperacion, nombreTcc, idTcaTcc,
                                                                         idTcaEstadoTcc, idTcaSubEstadoTcc,
                                                                         BANESTATUS_FALSE);
                // 2) Es ejecución exitosa
                if (idNuevoTcc != null) {
                    //esEjecucionExitosa = Boolean.TRUE;
                    logger.warning("Invocando metodo de precarga de informacion para TCC");
                    esEjecucionExitosa = precargarInformacionComision(idNuevoTcc, idTcaTcc);

                    // 3) Debido a que los métodos de crear Comision y de precargarInformacionComision
                    // modifican el current row, ya que ambos hacen commit, lo reasignamos al que estaba seleccionado.
                    // Lo anterior para no alterar datos en el Front
                    if (esEjecucionExitosa && idTccCurrentRow != null) {
                        this.getTccComisionVO().findAndSetCurrentRowByKey(new Key(new Object[] { idTccCurrentRow }), 0);
                    }
                }
            } catch (Exception e) {
                mensajeError = "Error al crear la comision. ";
                logger.warning("Error al crear la comision. ", e);

                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception(mensajeError));
                throw ex;
            }
        } else {
            JboException ex = new JboException("Parámetros insuficientes para crear Tcc.");
            throw ex;
        }
        logger.warning("Termina metodo crearRegistroComision.");
        return esEjecucionExitosa;
    }

    public Boolean crearTccEnmendado(Long idOperacion, Long idEnmienda, String instanciaProceso, String tipoTcc,
                                     String nombreTcc, Integer idTcaTcc, Integer idTcaEstadoTcc,
                                     Integer idTcaSubEstadoTcc, String accion, String tcaDescCorta,
                                     String loginUsuario) {
        logger.log(ADFLogger.WARNING,
                   "Inside crearTccEnmendado. idOperacion: " + idOperacion + " Id Enmienda " + idEnmienda +
                   " instanciaProceso" + instanciaProceso + " tipoTcc: " + tipoTcc + " nombreTcc : " + nombreTcc +
                   " idTcaTcc: " + idTcaTcc + " idTcaEstadoTcc: " + idTcaEstadoTcc + " idTcaSubEstadoTcc: " +
                   idTcaSubEstadoTcc + " accion" + accion + " tcaDescCorta: " + tcaDescCorta + " loginUsuario: " +
                   loginUsuario);
        Long idNuevoTccEnmendado = null;
        Boolean esEjecucionExitosa = Boolean.FALSE;
        String mensajeError = null;
        Map<String, Object> responseMap = null;
        String nombreUsuario = null;

        if (idOperacion != null && idEnmienda != null && tipoTcc != null && nombreTcc != null && idTcaTcc != null &&
            idTcaEstadoTcc != null) {

            try {
                // 1) Invocamos método para crear TCC Enmendado, returns Id
                if (tipoTcc.equalsIgnoreCase(FenixModelConstants.TERMINO)) {

                    // Crear Termino Enmendado
                    if ("T603".equals(tcaDescCorta) || "T101".equals(tcaDescCorta)) {
                        responseMap = consultarDatosUsuario(loginUsuario);
                        nombreUsuario = (String) responseMap.get("nombreUsuario");
                        idNuevoTccEnmendado =
                            this.getTccTerminoVO().crearTermino(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                                idTcaSubEstadoTcc, BANESTATUS_FALSE, nombreUsuario,
                                                                loginUsuario);
                    } else {
                        idNuevoTccEnmendado =
                            this.getTccTerminoVO().crearTermino(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                                idTcaSubEstadoTcc, BANESTATUS_FALSE);
                    }
                } else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.CONDICION)) {

                    // Crear Condición Enmendada
                    idNuevoTccEnmendado =
                        this.getTccCondicionVO().crearCondicion(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                                idTcaSubEstadoTcc, BANESTATUS_FALSE);
                } else if (tipoTcc.equalsIgnoreCase(FenixModelConstants.COMISION)) {

                    // Crear Comisión Enmendada
                    idNuevoTccEnmendado =
                        this.getTccComisionVO().crearComision(idOperacion, nombreTcc, idTcaTcc, idTcaEstadoTcc,
                                                              idTcaSubEstadoTcc, BANESTATUS_FALSE);
                }

                // 2) Invocamos método para crear registro en Detalle enmienda
                if (idNuevoTccEnmendado != null) {
                    this.getDetalleEnmiendaTccVO().crearDetalleEnmiendaTcc(idOperacion, idEnmienda, instanciaProceso,
                                                                           idNuevoTccEnmendado, tipoTcc, accion);
                    //esEjecucionExitosa = Boolean.TRUE;
                    Integer modalidad = 2;
                    esEjecucionExitosa = precargarInformacionTCC(idNuevoTccEnmendado, idTcaTcc, modalidad, tipoTcc);
                }
            } catch (Exception e) {
                mensajeError = "Error al crear TCC Enmendado. ";
                logger.log(ADFLogger.ERROR, mensajeError + e.getMessage());

                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception(mensajeError));
                throw ex;
            }
        } else {
            JboException ex = new JboException("Parámetros insuficientes para crear Tcc Enmendado.");
            throw ex;
        }

        return esEjecucionExitosa;
    }

    /**
     * Realiza la precarga de informacion a un determinado elemento TCC, dependiendo si es un Termino, Condicion o
     * Comision, el ID y su tipo.
     * @param idTcc contiene Id de elemento
     * @param idTcaTcc contiene Id del catalogo de tipo TCC
     * @param idModalidad contiene Id de Modalidad: 1 = Tree (Elemento TCC de operacion), 2 = Grid (Elemento TCC Enmendado)
     * @param tipoTcc define el tipo de TCC: TERMINO, CONDICION o COMISION
     * @return devuelve valor booleano, true si la precarga fue correcta o false en caso contrario
     */
    public boolean precargarInformacionTCC(Long idTcc, Integer idTcaTcc, Integer idModalidad, String tipoTcc) {

        logger.entering(FenixAMImpl.class.getName(), "precargarInformacionTCC", new Object[] {
                        idTcc, idTcaTcc, idModalidad, tipoTcc
        });

        boolean exito = false;

        if (idTcc != null && idTcaTcc != null && idModalidad != null && tipoTcc != null) {

            if (FenixModelConstants.TERMINO.equals(tipoTcc)) {

                TccTerminoVOImpl terminoVOImpl = null;
                TccTerminoVORowImpl terminoRow = null;

                if (new Integer(1).equals(idModalidad)) {
                    //Asigna VO Impl cuando es Modalidad Tree
                    terminoVOImpl = getTccTerminoVO();
                } else {
                    //Asigna VO Impl cuando es Modalidad Grid
                    terminoVOImpl = getTccTerminoGridVO();
                }

                terminoVOImpl.buscarTerminoPorId(new Number(idTcc));
                terminoRow = (TccTerminoVORowImpl) terminoVOImpl.getCurrentRow();

                if (terminoRow != null) {
                    exito = precargarInfoTermino(terminoRow, idTcaTcc);
                } else {
                    logger.severe("Termino no encontrado");
                }
            } else {
                if (FenixModelConstants.CONDICION.equals(tipoTcc)) {

                    TccCondicionVOImpl condicionVOImpl = null;
                    TccCondicionVORowImpl condicionRow = null;

                    if (new Integer(1).equals(idModalidad)) {
                        //Asigna VO Impl cuando es Modalidad Tree
                        condicionVOImpl = getTccCondicionVO();
                    } else {
                        //Asigna VO Impl cuando es Modalidad Grid
                        condicionVOImpl = getTccCondicionGridVO();
                    }

                    condicionVOImpl.buscarCondicionPorId(new Number(idTcc));
                    condicionRow = (TccCondicionVORowImpl) condicionVOImpl.getCurrentRow();

                    if (condicionRow != null) {
                        exito = precargarInfoCondicion(condicionRow, idTcaTcc);
                        logger.warning("Información de Precarga de Condiciones obtenida exitosamente: " + exito);
                    } else {
                        logger.severe("Condicion no encontrada");
                    }
                } else {
                    if (FenixModelConstants.COMISION.equals(tipoTcc)) {

                        TccComisionVOImpl comisionVOImpl = null;
                        TccComisionVORowImpl comisionRow = null;

                        if (new Integer(1).equals(idModalidad)) {
                            //Asigna VO Impl cuando es Modalidad Tree
                            comisionVOImpl = getTccComisionVO();
                        } else {
                            //Asigna VO Impl cuando es Modalidad Grid
                            comisionVOImpl = getTccComisionGridVO();
                        }

                        comisionVOImpl.buscarComisionPorId(new Number(idTcc));
                        comisionRow = (TccComisionVORowImpl) comisionVOImpl.getCurrentRow();

                        if (comisionRow != null) {
                            exito = precargarInfoComision(comisionRow, idTcaTcc);
                        } else {
                            logger.severe("Comision no encontrada");
                        }
                    } else {
                        logger.severe("Tipo TCC no definido: " + tipoTcc);
                    }
                }
            }

            if (exito) {
                try {
                    logger.warning("Ejecuta Commit");
                    getDBTransaction().commit();
                } catch (Exception e) {
                    exito = false;
                    logger.severe("Error al realizar Commit");
                    try {
                        getDBTransaction().rollback();
                    } catch (Exception ex) {
                        logger.severe("Error al realizar Rollback");
                    }
                }
            } else {
                try {
                    getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback");
                }
            }
        } else {
            logger.severe("Parametros requeridos no recibidos");
        }

        logger.exiting(FenixAMImpl.class.getName(), "precargarInformacionTCC", exito);
        return exito;
    }

    public Boolean precargarInformacionComision(Long idTcc, Integer idTcaTcc) {
        logger.warning("Entra en .");

        Boolean exito = Boolean.FALSE;
        try {
            if (idTcc != null && idTcaTcc != null) {
                TccComisionVOImpl comisionVOImpl = null;
                TccComisionVORowImpl comisionRow = null;

                comisionVOImpl = getTccComisionVO();
                comisionVOImpl.buscarComisionPorId(new Number(idTcc));
                comisionRow = (TccComisionVORowImpl) comisionVOImpl.getCurrentRow();

                if (comisionRow != null) {
                    exito = precargarInfoComision(comisionRow, idTcaTcc);
                } else {
                    logger.severe("Comision no encontrada");
                }

                if (exito) {
                    try {
                        logger.warning("Ejecuta Commit");
                        getDBTransaction().commit();
                    } catch (Exception e) {
                        exito = Boolean.FALSE;
                        logger.severe("Error al realizar Commit");
                        try {
                            getDBTransaction().rollback();
                        } catch (Exception ex) {
                            logger.severe("Error al realizar Rollback");
                        }
                    }
                } else {
                    try {
                        getDBTransaction().rollback();
                    } catch (Exception ex) {
                        logger.severe("Error al realizar Rollback");
                    }
                }
            } else {
                logger.severe("Parametros requeridos no recibidos");
            }
        } catch (Exception e) {
            logger.warning("Error al ejecutar precargarInformacionComision");
        }
        logger.warning("Se ejecuta precargarInformacionComision correctamente", exito);
        return exito;
    }

    /**
     * Realiza la precarga de informacion para Terminos
     * @param terminoRow contiene el Registro de Termino
     * @param idTcaTcc contiene Id del Tipo de Termino
     * @return devuelve valor booleano, true si la precarga es exitosa o false en caso contrario
     */
    public boolean precargarInfoTermino(TccTerminoVORowImpl terminoRow, Integer idTcaTcc) {

        boolean exito = false;

        terminoRow = getPreCargaTerminoVO().precargarInformacion(terminoRow, idTcaTcc);
        if (terminoRow != null) {
            exito = true;
        }

        return exito;
    }

    /**
     * Realiza la precarga de informacion para Condicion
     * @param condicionRow contiene el Registro de Condicion
     * @param idTcaTcc contiene Id del Tipo de Condicion
     * @return devuelve valor booleano, true si la precarga es exitosa o false en caso contrario
     */
    public boolean precargarInfoCondicion(TccCondicionVORowImpl condicionRow, Integer idTcaTcc) {

        boolean exito = false;

        condicionRow = getPreCargaCondicionVO().precargarInformacion(condicionRow, idTcaTcc);
        if (condicionRow != null) {
            logger.warning("Información de Precarga obtenida exitosamente");
            PreCargaCondicionVORowImpl preCargaRow =
                (PreCargaCondicionVORowImpl) getPreCargaCondicionVO().getCurrentRow();
            if (preCargaRow != null) {

                exito = getCategoriaCondicionVO().precargarInformacion(condicionRow, preCargaRow);
                logger.warning("Información de Precarga de Categorias obtenida exitosamente: " + exito);
                if (exito) {
                    exito = getEventoCondicionVO().precargarInformacion(condicionRow, preCargaRow);
                    logger.warning("Información de Precarga de Eventos obtenida exitosamente: " + exito);
                }
            } else {
                logger.warning("Información de Precarga Nula");
                exito = true;
            }
        }

        return exito;
    }

    /**
     * Realiza la precargar de informacion para Comision
     * @param comisionRow contiene el Registro de Comision
     * @param idTcaTcc contiene Id del Tipo de Comision
     * @return devuelve valor booleano, true si la precarga es exitosa o false en caso contrario
     */
    public Boolean precargarInfoComision(TccComisionVORowImpl comisionRow, Integer idTcaTcc) {
        logger.warning("Entra en precargarInfoComision.");
        Boolean exito = Boolean.FALSE;

        comisionRow = getPreCargaComisionVO().precargarInformacion(comisionRow, idTcaTcc);
        if (comisionRow != null) {
            exito = Boolean.TRUE;
        } else {
            logger.warning("No se obtuvo la comision.");
        }

        return exito;
    }

    /**
     * Metodo para obtener el RAROC de la operacion, ocupando el servicio de consultar operacion
     * @param idOperacion
     * @return
     */
    public Float obtenerRAROC(String idOperacion) {
        if (idOperacion != null && idOperacion.trim().length() > 0) {
            DetalleOperacionVOImpl detalleOperacionVO = getDetalleOperacionVO();
            DetalleOperacionVORowImpl newDetalleOperacion = (DetalleOperacionVORowImpl) detalleOperacionVO.createRow();

            String wsdl = getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
            } catch (Exception ex) {
            }

            ConsultarOperacionByIdOperacionRequestType request = new ConsultarOperacionByIdOperacionRequestType();
            request.setIdOperacion(Long.parseLong(idOperacion));
            ConsultarOperacionResponseType obtenerOperacion = operacion12Port.consultarOperacionByIdOperacion(request);

            List<Operacion> listaOperqacionesObtenidas = obtenerOperacion.getOperacion();
            if (!listaOperqacionesObtenidas.isEmpty()) {

                Operacion operacionUnica = listaOperqacionesObtenidas.get(0);
                return operacionUnica.getRAROC();
            }
        }

        return Float.parseFloat("0");
    }

    /**
     * Container's getter for ContrapartesTerminoVO1.
     * @return ContrapartesTerminoVO1
     */
    public ContrapartesTerminoVOImpl getContrapartesTerminoVO() {
        return (ContrapartesTerminoVOImpl) findViewObject("ContrapartesTerminoVO");
    }

    /**
     * Metodo que actualiza los campos requiere ASJUR y requiere opinion de Gerencia de credito
     * @param idEnmienda
     * @param requiereASJUR
     * @param reqOpinionGerenciaCredito
     * @param requiereCof
     * @param banderaFormalizacion
     * @param esDesobligacion
     * @param cambiodePlazo
     * @return
     
     */
    public Boolean actualizarRequeridosEnmienda(Long idEnmienda, Boolean requiereASJUR,
                                                Boolean reqOpinionGerenciaCredito, Boolean requiereCof, 
                                                Boolean banderaFormalizacion, Boolean esDesobligacion,Boolean cambiodePlazo, String justificacion) {
        Boolean resultado = Boolean.TRUE;
        Integer siRequiere = 1;
        Integer noRequiere = 0;
        ViewObjectImpl enmiendaTCCVO = getEnmiendaTccVO();
        System.out.println("Inicia metodo de actualizarRequeridosEnmienda");
        enmiendaTCCVO.setRangeSize(-1);
        Row row = enmiendaTCCVO.getRow(new Key(new Object[] { idEnmienda }));
        if (null != row) {
            if (null == requiereASJUR || !requiereASJUR) {
                row.setAttribute("RequiereAsjur", noRequiere);
            } else {
                row.setAttribute("RequiereAsjur", siRequiere);
            }
            if (null == reqOpinionGerenciaCredito || !reqOpinionGerenciaCredito) {
                row.setAttribute("RequiereOgc", noRequiere);
            } else {
                row.setAttribute("RequiereOgc", siRequiere);
            }
            
           if (null == requiereCof || !requiereCof) {
                row.setAttribute("RequiereCof", noRequiere);
            } else {
                row.setAttribute("RequiereCof", siRequiere);
            }
            if (null == banderaFormalizacion || !banderaFormalizacion) {
                 row.setAttribute("BanderaFormalizacion", noRequiere);
             } else {
                 row.setAttribute("BanderaFormalizacion", siRequiere);
             }
            if (null == esDesobligacion || !esDesobligacion) {
                 row.setAttribute("EsDesobligacion", noRequiere);
             } else {
                 row.setAttribute("EsDesobligacion", siRequiere);
             }
            if (null == cambiodePlazo || !cambiodePlazo) {
                 row.setAttribute("CambiodePlazo", noRequiere);
             } else {
                 row.setAttribute("CambiodePlazo", siRequiere);
             }
            if (null != justificacion ) {
                 row.setAttribute("Justificacion", justificacion);
            
             }

            try {
                logger.warning("Ejecuta Commit");
                getDBTransaction().commit();
            } catch (Exception e) {
                resultado = Boolean.FALSE;
                logger.severe("Error al realizar Commit", e);
                try {
                    getDBTransaction().rollback();
                } catch (Exception ex) {
                    logger.severe("Error al realizar Rollback al fallar Commit", ex);
                }
            }
        } else {
            resultado = Boolean.FALSE;
        }
        return resultado;
    }

    /**
     * Metodo que valida que las enmiendas esten registradas y sin el estado Sin movimiento
     * Se agrega idEnmienda
     * 11/04/2016 se agrea el id enmienda y solo se comparan los que tengan estados nuevo, aprobado y formalizado
     * 24/03/2017 se agrega nuevo parametro de id operacion para reejecutar la VO e identificar los valores que se obtienen
     * @return
     */
    public Boolean enmiendasSinMovimento(Long idEnmienda, Long idOperacion) {
        Boolean resultado = Boolean.TRUE;
        Integer contadorTCC = 0;
        String mensaje = "";
        Number enmiendaId = new Number(idEnmienda);
        Number operacionId = new Number(idOperacion);
        String sinMovimiento = "Sin Movimiento";
        getTccGridElementosOperVO().setpIdEnmienda(enmiendaId);
        getTccGridElementosOperVO().setpIdOperacion(operacionId);
        getTccGridElementosOperVO().executeQuery();
        ViewObjectImpl tccGridElementosOperVO = getTccGridElementosOperVO();
        RowSetIterator rowsTccElementosOperVo = tccGridElementosOperVO.createRowSetIterator(null);
        logger.warning("Elementos de la lista: " + getTccGridElementosOperVO().getEstimatedRowCount());
        if (getTccGridElementosOperVO().getEstimatedRowCount() > 0) {
            String accionValidar;
            String descripcion;
            Integer idSubEstadoTccActual;
            Number idEstadoActual;
            Long idDEnmienda;
            rowsTccElementosOperVo.reset();

            while (rowsTccElementosOperVo.hasNext()) {
                TccElementosOperVORowImpl rowTccElemnto = (TccElementosOperVORowImpl) rowsTccElementosOperVo.next();

                logger.warning("id: " + String.valueOf(rowTccElemnto.getAttribute("IdTcc")));
                if (resultado) {

                    idDEnmienda = (Long) rowTccElemnto.getAttribute("EnmiendaId");
                    descripcion = (String) rowTccElemnto.getAttribute("DescripcionTcc");
                    accionValidar = (String) rowTccElemnto.getAttribute("DetalleEnmiendaAccion");
                    idEstadoActual = (Number) rowTccElemnto.getAttribute("IdEstadoTcc");
                    idSubEstadoTccActual = (Integer) rowTccElemnto.getAttribute("IdSubEstadoTcc");
                    logger.warning("accion: " + accionValidar);
                    logger.warning("subEstadoActual: " + idSubEstadoTccActual);

                    if (idDEnmienda.compareTo(idEnmienda) == 0 &&
                        (FenixModelConstants.ESTADO_TCC_NUEVA.compareTo(idEstadoActual.intValue()) == 0 ||
                         FenixModelConstants.ESTADO_TCC_APROBADA.compareTo(idEstadoActual.intValue()) == 0 ||
                         FenixModelConstants.ESTADO_TCC_FORMALIZADA.compareTo(idEstadoActual.intValue()) == 0)) {
                        contadorTCC = contadorTCC + 1;
                        if (null == idSubEstadoTccActual || idSubEstadoTccActual.compareTo(0) == 0) {
                            mensaje =
                                "Existe enmienda agregada que no ha sufrido cambio , " +
                                "cambie la enmienda: ".concat(descripcion);
                            resultado = Boolean.FALSE;
                            break;
                        }
                    }
                }
            }
            rowsTccElementosOperVo.closeRowSetIterator();
        } else {
            if (contadorTCC <= 0) {
                mensaje =
                    "No existen enmiendas registradas, " +
                    "deben ingresar alguna y editarla o aplicarle cualquier cambio de estado para poder continuar";
                resultado = Boolean.FALSE;
            }
        }
        logger.warning("resultado: " + resultado);
        logger.warning("mensaje: " + mensaje);
        return resultado;
    }

    /**
     * Realiza la validacion de estados TCC para el proceso de Analisis
     * @param idOperacion contiene id de Operacion
     * @return devuelve valor booleano, true si la validacion es positiva o false en caso contrario
     */
    public boolean validarEstadosTCCAnalisis(Long idOperacion) {

        logger.entering(FenixAMImpl.class.getName(), "validarTCCAnalisisFinalizarTarea", idOperacion);

        boolean esValido = true;

        logger.warning("Asigna Id de Operacion: " + idOperacion);
        getTccElementosTreeVO().setvarIdOperacion(idOperacion);
        getTccElementosTreeVO().executeQuery();
        logger.warning("Cantidad de registros TCC encontrados: " + getTccElementosTreeVO().getEstimatedRowCount());

        if (getTccElementosTreeVO().getEstimatedRowCount() > 0) {

            Row row = null;
            RowSetIterator iter = getTccElementosTreeVO().createRowSetIterator(null);
            iter.reset();
            while (iter.hasNext()) {
                row = iter.next();
                if (row.getAttribute("IdTcaEstadoTcc") != null) {

                    Integer idEstadoTcc = (Integer) row.getAttribute("IdTcaEstadoTcc");
                    Integer idSubEstadoTcc = null;

                    //Valida Estados TCC
                    if (FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstadoTcc) ||
                        FenixModelConstants.ESTADO_TCC_SUGERIDA.equals(idEstadoTcc) ||
                        FenixModelConstants.ESTADO_TCC_MANDATORIA.equals(idEstadoTcc)) {

                        if (row.getAttribute("IdTcaSubEstadoTcc") != null) {

                            idSubEstadoTcc = (Integer) row.getAttribute("IdTcaSubEstadoTcc");

                            //Valida Sub Estados TCC
                            if (!FenixModelConstants.SUBESTADO_TCC_EDITADA.equals(idSubEstadoTcc) &&
                                !FenixModelConstants.SUBESTADO_TCC_ELIMINADA.equals(idSubEstadoTcc) &&
                                !FenixModelConstants.SUBESTADO_TCC_EXCEPTUADA.equals(idSubEstadoTcc) &&
                                !FenixModelConstants.SUBESTADO_TCC_MANDATORIA_EDITADA.equals(idSubEstadoTcc)) {
                                logger.severe("Registro de TCC con Estado y Sub Estado invalido para el proceso de Analisis");
                                esValido = false;
                                break;
                            }
                        } else {
                            logger.severe("Registro de TCC sin Sub Estado TCC para el proceso de Analisis");
                            esValido = false;
                            break;
                        }
                    } else {
                        //Se modifica validacion para que no sea restrictiva a los diagramas
                        //logger.severe("Registro de TCC con Estado TCC invalido para el proceso de Analisis");
                        //esValido = false;
                        //break;
                    }
                } else {
                    logger.severe("Registro de TCC sin Estado TCC para el proceso de Analisis");
                    esValido = false;
                    break;
                }
            }
            iter.closeRowSetIterator();
        } else {
            logger.warning("No hay elementos TCC que validar");
            esValido = true;
        }

        logger.warning("Resultado de la validacion: " + esValido);

        logger.exiting(FenixAMImpl.class.getName(), "validarTCCAnalisisFinalizarTarea", esValido);
        return esValido;
    }

    /**
     * Realiza la actualizacion de estados a todos los elementos TCC en el proceso de Analisis,
     * para que sean estados validos del proceso de Aprobacion
     * @param idOperacion contiene el ID de operacion
     * @return devuelve valor booleano, true si la actualizacion fue exitosa o false en caso contrario
     */
    public boolean actualizarEstadosTCCAnalisis(Long idOperacion) {

        logger.entering(FenixAMImpl.class.getName(), "actualizarEstadosTCCAnalisis", idOperacion);

        boolean exito = true;

        List<TCC> tccList = null;
        tccList = procesarElementosMatrizTccWS(idOperacion, FenixModelConstants.ID_PROCESO_ANALISIS);

        if (tccList != null && tccList.size() > 0) {
            exito = actualizarEstadosTccWS(tccList);
        }

        logger.warning("Resultado de la Actualizacion de Estados TCC: " + exito);

        logger.exiting(FenixAMImpl.class.getName(), "actualizarEstadosTCCAnalisis", exito);
        return exito;
    }

    /**
     * Realiza la validacion de estados TCC para el proceso de Aprobacion
     * @param idOperacion contiene id de Operacion
     * @return devuelve valor booleano, true si la validacion es positiva o false en caso contrario
     */
    public boolean validarEstadosTCCAprobacion(Long idOperacion) {

        logger.entering(FenixAMImpl.class.getName(), "validarEstadosTCCAprobacion", idOperacion);

        boolean esValido = true;

        logger.warning("Asigna Id de Operacion: " + idOperacion);
        getTccElementosTreeVO().setvarIdOperacion(idOperacion);
        getTccElementosTreeVO().executeQuery();
        logger.warning("Cantidad de registros TCC encontrados: " + getTccElementosTreeVO().getEstimatedRowCount());

        if (getTccElementosTreeVO().getEstimatedRowCount() > 0) {

            Row row = null;
            RowSetIterator iter = getTccElementosTreeVO().createRowSetIterator(null);
            iter.reset();
            while (iter.hasNext()) {

                row = iter.next();
                //Valida Estado TCC
                if (row.getAttribute("IdTcaEstadoTcc") != null) {

                    Integer idEstadoTcc = (Integer) row.getAttribute("IdTcaEstadoTcc");
                    if (FenixModelConstants.ESTADO_TCC_POR_APROBAR.equals(idEstadoTcc) ||
                        FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstadoTcc)) {

                        Integer idSubEstadoTcc = null;
                        if (FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstadoTcc)) {
                            //Valida Sub Estado TCC de elemento TCC con Estado Nuevo
                            if (row.getAttribute("IdTcaSubEstadoTcc") != null) {

                                idSubEstadoTcc = (Integer) row.getAttribute("IdTcaSubEstadoTcc");
                                if (!FenixModelConstants.SUBESTADO_TCC_EDITADA.equals(idSubEstadoTcc)) {
                                    logger.severe("Registro de TCC con Estado y Sub Estado invalido para el proceso de Aprobacion");
                                    esValido = false;
                                    break;
                                }
                            } else {
                                logger.severe("Registro de TCC de Estado Nuevo sin Sub Estado TCC para el proceso de Aprobacion");
                                esValido = false;
                                break;
                            }
                        } else {
                            /* Se deshabilita por que se no se considera como TCC sin movimiento las que tienen el Estado Por Aprobar
                            if(row.getAttribute("IdTcaSubEstadoTcc") == null){
                                logger.severe("Registro de TCC con Estado Por Aprobar pero sin Sub Estado, configuracion de estados no valida");
                                esValido = false;
                                break;
                            }
                            */
                        }
                    } else {
                        //Se modifica validacion para que no sea restrictiva al diagrama de estados tcc
                        //logger.severe("Registro de TCC con Estado TCC invalido para el proceso de Aprobacion");
                        //esValido = false;
                        //break;
                    }
                } else {
                    logger.severe("Registro de TCC sin Estado TCC para el proceso de Aprobacion");
                    esValido = false;
                    break;
                }
            }
            iter.closeRowSetIterator();
        } else {
            logger.warning("No hay elementos TCC que validar");
        }

        logger.warning("Resultado de la validacion: " + esValido);

        logger.exiting(FenixAMImpl.class.getName(), "validarEstadosTCCAprobacion", esValido);
        return esValido;
    }

    /**
     * Realiza la actualizacion de estados a todos los elementos TCC en el proceso de Aprobacion,
     * para que sean estados validos del proceso de Formalizacion
     * @param idOperacion contiene el ID de operacion
     * @return devuelve valor booleano, true si la actualizacion fue exitosa o false en caso contrario
     */
    public boolean actualizarEstadosTCCAprobacion(Long idOperacion) {

        logger.entering(FenixAMImpl.class.getName(), "actualizarEstadosTCCAprobacion", idOperacion);

        boolean exito = true;

        List<TCC> tccList = null;
        tccList = procesarElementosMatrizTccWS(idOperacion, FenixModelConstants.ID_PROCESO_APROBACION);

        if (tccList != null && tccList.size() > 0) {
            exito = actualizarEstadosTccWS(tccList);
        }

        logger.warning("Resultado de la Actualizacion de Estados TCC: " + exito);

        logger.exiting(FenixAMImpl.class.getName(), "actualizarEstadosTCCAprobacion", exito);
        return exito;
    }

    /**
     * Realiza la consulta de elementos TCC, asigna un Estado y un Sub Estado a todos los elementos encontrados,
     * convierte los elementos encontrados en un lista de objecto TCC para consumir el WS de MatrizTCCService
     * @param idOperacion contiene ID de operacion
     * @param idProcesoBpm contiene ID de Proceso BPM
     * @return devuelve lista de objetos TCC para WS
     */
    private List<TCC> procesarElementosMatrizTccWS(Long idOperacion, Integer idProcesoBpm) {

        List<TCC> tccList = null;

        logger.warning("Asigna Id de Operacion: " + idOperacion);
        getTccElementosTreeVO().setvarIdOperacion(idOperacion);
        getTccElementosTreeVO().executeQuery();
        logger.warning("Cantidad de registros TCC encontrados: " + getTccElementosTreeVO().getEstimatedRowCount());

        if (getTccElementosTreeVO().getEstimatedRowCount() > 0) {

            Integer estadoTcc = null;
            Integer subEstadoTcc = null;

            TCC tcc = null;
            Row row = null;
            RowSetIterator iter = getTccElementosTreeVO().createRowSetIterator(null);
            iter.reset();
            while (iter.hasNext()) {

                row = iter.next();
                tcc = null;
                if (row.getAttribute("IdTcc") != null) {

                    estadoTcc = null;
                    subEstadoTcc = null;

                    //Aplica valores para el proceso de analisis
                    if (FenixModelConstants.ID_PROCESO_ANALISIS.equals(idProcesoBpm)) {
                        if (row.getAttribute("IdTcaEstadoTcc") != null) {
                            Integer idEstado = (Integer) row.getAttribute("IdTcaEstadoTcc");
                            if (FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstado) ||
                                FenixModelConstants.ESTADO_TCC_SUGERIDA.equals(idEstado) ||
                                FenixModelConstants.ESTADO_TCC_MANDATORIA.equals(idEstado)) {

                                boolean siAplica = false;
                                if (row.getAttribute("IdTcaSubEstadoTcc") != null) {

                                    Integer idSubEstado = (Integer) row.getAttribute("IdTcaSubEstadoTcc");
                                    if (!FenixModelConstants.SUBESTADO_TCC_ELIMINADA.equals(idSubEstado)) {
                                        siAplica = true;
                                    }
                                } else {
                                    siAplica = true;
                                }

                                if (siAplica) {
                                    tcc = new TCC();

                                    estadoTcc = FenixModelConstants.ESTADO_TCC_POR_APROBAR;
                                    subEstadoTcc = null;
                                }
                            }
                        }
                    }

                    //Aplica valores para el proceso de aprobacion
                    if (FenixModelConstants.ID_PROCESO_APROBACION.equals(idProcesoBpm)) {
                        if (row.getAttribute("IdTcaEstadoTcc") != null) {
                            Integer idEstado = (Integer) row.getAttribute("IdTcaEstadoTcc");
                            if (FenixModelConstants.ESTADO_TCC_POR_APROBAR.equals(idEstado) ||
                                FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstado)) {

                                boolean siAplica = false;
                                if (row.getAttribute("IdTcaSubEstadoTcc") != null) {

                                    Integer idSubEstado = (Integer) row.getAttribute("IdTcaSubEstadoTcc");
                                    if (!FenixModelConstants.SUBESTADO_TCC_ELIMINADA.equals(idSubEstado)) {
                                        siAplica = true;
                                    }
                                } else {
                                    siAplica = true;
                                }

                                if (siAplica) {
                                    tcc = new TCC();

                                    estadoTcc = FenixModelConstants.ESTADO_TCC_APROBADA;
                                    subEstadoTcc = null;
                                }
                            }
                        }
                    }

                    //Aplica valores para el proceso de evaluacione
                    if (FenixModelConstants.ID_PROCESO_EVALUACION.equals(idProcesoBpm) ||
                        FenixModelConstants.ID_EVALUACION_SIEMAS.equals(idProcesoBpm)) {
                        if (row.getAttribute("IdTcaEstadoTcc") != null) {
                            boolean siAplica = false;
                            Integer idEstado = (Integer) row.getAttribute("IdTcaEstadoTcc");
                            if (FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstado)) {

                                if (row.getAttribute("IdTcaSubEstadoTcc") != null) {

                                    Integer idSubEstado = (Integer) row.getAttribute("IdTcaSubEstadoTcc");
                                    if (FenixModelConstants.SUBESTADO_TCC_EDITADA.equals(idSubEstado)) {
                                        tcc = new TCC();

                                        estadoTcc = FenixModelConstants.ESTADO_TCC_ACTUALIZADA;
                                        subEstadoTcc = null;
                                    }
                                }
                            }

                            if (!FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstado)) {

                                if (row.getAttribute("IdTcaSubEstadoTcc") != null) {

                                    Integer idSubEstado = (Integer) row.getAttribute("IdTcaSubEstadoTcc");
                                    if (FenixModelConstants.SUBESTADO_TCC_INACTIVA.equals(idSubEstado)) {
                                        tcc = new TCC();

                                        estadoTcc = FenixModelConstants.ESTADO_TCC_INACTIVA;
                                        subEstadoTcc = null;
                                    }
                                }
                            }
                        }
                    }

                    if (tcc != null) {

                        tcc.setId(new Long(row.getAttribute("IdTcc").toString()).longValue());

                        if (row.getAttribute("Tipo") != null) {
                            if ("TERMINO".equals(row.getAttribute("Tipo"))) {
                                tcc.setTipo(Tipo.TERMINO);
                            }
                            if ("CONDICION".equals(row.getAttribute("Tipo"))) {
                                tcc.setTipo(Tipo.CONDICION);
                            }
                            if ("COMISION".equals(row.getAttribute("Tipo"))) {
                                tcc.setTipo(Tipo.COMISION);
                            }
                        }

                        if (estadoTcc != null) {
                            tcc.setEstado(estadoTcc.intValue());
                        } else {
                            if (row.getAttribute("IdTcaEstadoTcc") != null) {
                                Integer idEstado = (Integer) row.getAttribute("IdTcaEstadoTcc");
                                tcc.setEstado(idEstado.intValue());
                            }
                        }

                        if (subEstadoTcc != null) {
                            tcc.setSubEstado(subEstadoTcc.intValue());
                        } else {
                            if (row.getAttribute("IdTcaSubEstadoTcc") != null) {
                                Integer idSubEstado = (Integer) row.getAttribute("IdTcaSubEstadoTcc");
                                tcc.setSubEstado(idSubEstado.intValue());
                            }
                        }
                    }

                    if (tccList == null) {
                        tccList = new ArrayList<TCC>();
                    }

                    if (tcc != null) {
                        tccList.add(tcc);
                    }
                }
            }
            iter.closeRowSetIterator();
        } else {
            logger.warning("No se encontraron elementos TCC");
        }

        return tccList;
    }

    /**
     * Recibe una lista de objetos TCC definidos por cliente proxy del WS MatrizTCCService, consume la operacion de
     * actualizarEstadoTCC para cambiar los Estados TCC de todos los elementos de la lista
     * @param tccList contiene lista de objetos TCC
     * @return devuelve valor booleano, true si la actualizacion fue exitosa o false en caso contrario
     */
    private boolean actualizarEstadosTccWS(List<TCC> tccList) {

        logger.entering(FenixAMImpl.class.getName(), "actualizarEstadosTccWS", tccList);

        boolean exito = true;

        String wsdl = getWsdl(IWsdlLocation.MATRIZ);
        MatrizTCC12BndQSService service = IWsdlLocation.Service.getInstance(MatrizTCC12BndQSService.class, wsdl);
        MatrizTCCPT port = service.getMatrizTCC12BndQSPort();

        ActualizarEstadoTCCRequestType request = null;
        request = new ActualizarEstadoTCCRequestType();

        //Asigna lista de elementos TCC a actualizar sus estados TCC
        ListaTCC tccListReq = new ListaTCC();
        tccListReq.getTCC().addAll(tccList);
        request.setListaTCC(tccListReq);

        ActualizarEstadoTCCResponseType response = null;

        try {
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ACTUALIZAR_TCC);
            response = port.actualizarEstadoTCC(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ACTUALIZAR_TCC, horaInicio);

            if (response != null && null != response.getResultado() && response.getResultado().getResult() != null &&
                response.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                exito = true;
            } else {
                String msg = "ERROR";
                if (response != null) {
                    if (null != response.getResultado() && response.getResultado().getMessage() != null) {
                        msg = response.getResultado().getMessage();
                    } else {
                        ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                        msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error.resultado.nulo");
                    }
                } else {
                    ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
                    msg = rb.getString("matriztcc.actualizar.estado.tcc.msg.error.resultado.nulo");
                }
                throw new Exception(ModelUtils.getString(FenixModelConstants.WSC_ACTUALIZAR_TCC, " ERROR:", msg));
            }
        } catch (Exception e) {
            exito = false;
            logger.log(ADFLogger.ERROR, e.getMessage());
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al actualizar estados TCC. Inténtelo más tarde."));
            throw ex;
        }

        logger.exiting(FenixAMImpl.class.getName(), "actualizarEstadosTccWS", exito);
        return exito;
    }

    /*
     * Agrega metodo para crear reporte TCC
     * @param idOperacion
     * Gabriel niño rosales
     * 11/07/2016
     */

    public byte[] crearReporteTcc(Long idOperacion) {
        String salidaFinal = "";
        CrearReporteTCCRequestType request = new CrearReporteTCCRequestType();
        CrearReporteTCCResponseType response = null;
        try {
            String wsdl = getWsdl(IWsdlLocation.MATRIZ);
            MatrizTCC12BndQSService matrizTCC12BndQSService =
                IWsdlLocation.Service.getInstance(MatrizTCC12BndQSService.class, wsdl);
            MatrizTCCPT matrizTCCPT = matrizTCC12BndQSService.getMatrizTCC12BndQSPort();
            request.setIdOperacion(idOperacion);
            String mensaje = null;
            StringWriter xmlEntrada = null;
            StringWriter xmlSalida = null;
            mensaje = "Invocando Servicio - MatrizTCC - CrearReporteTCC -";
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + writeXMLRequest(request, request.getClass()));
            } catch (Exception ex) {
                ;
            }
            response = matrizTCCPT.crearReporte(request);
            mensaje = "Invocando Servicio - MatrizTCC - CrearReporteTCC -";
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + writeXMLRequest(response, response.getClass()));
            } catch (Exception ex) {
                ;
            }
            if (response.getResultado().getResult().value() == "OK") {
                salidaFinal = response.getResultado().getMessage();
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error al generar el aviso de cobro " + e.getClass() + ":" + e.getMessage());
        }
        return response != null ? response.getReporte() : null;
    }

    public byte[] crearReporteEstadoCondicion(Long idOperacion, Integer idCatProducto) {
        logger.warning("Entra en crearReporteEstadoCondicion");
        logger.warning("idOperacion :" + idOperacion);
        String salidaFinal = "";
        GenerarReporteCondicionValidadorRequestType request = null;
        GenerarReporteCondicionValidadorResponseType response = null;
        logger.warning("idCatProducto : " + idCatProducto);
        try {
            String wsdl = getWsdl(IWsdlLocation.CONDICION);
            Condicion12BndQSService condicion12BndQSService =
                IWsdlLocation.Service.getInstance(Condicion12BndQSService.class, wsdl);
            CondicionPT condicionPT = condicion12BndQSService.getCondicion12BndQSPort();
            request = new GenerarReporteCondicionValidadorRequestType();
            request.setIdOperacion(idOperacion);
            //request.setIdOperacion(idCatProducto);
            String mensaje = null;
            StringWriter xmlEntrada = null;
            StringWriter xmlSalida = null;
            mensaje = "Invocando Servicio - CondicionService - GenerarReporteCondicionValidador -";
            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + writeXMLRequest(request, request.getClass()));
                response = condicionPT.generarReporteCondicionValidador(request);
                logger.log(ADFLogger.WARNING, ">HNWS" + writeXMLRequest(response, response.getClass()));
                mensaje = "Invocando Servicio - CondicionService - GenerarReporteCondicionValidador -";
            } catch (Exception ex) {
                logger.warning("Error al ejecutar el servicio.", ex);
            }
            if (null != response && null != response.getResultado() && null != response.getResultado().getResult()) {
                if (response.getResultado().getResult().value() == "OK") {
                    salidaFinal = response.getResultado().getMessage();
                    logger.warning("Mensaje servicio : " + salidaFinal);
                } else {
                    logger.warning("El servicio regresa error.");
                }
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error al generar el aviso de cobro " + e.getClass() + ":" + e.getMessage());
        }
        return response != null ? response.getReporte() : null;
    }

    public boolean obtenerComisionesNoPagadas(Long idOperacion) {
        logger.warning("inside obtenerComisionesNoPagadas.");
        Boolean result = Boolean.TRUE;
        try {
            if (idOperacion != null && idOperacion.toString().trim().length() > 0) {
                ComisionesNoPagadasVOImpl comisionesNoPagadasVO = getComisionesNoPagadasVO();
                comisionesNoPagadasVO.clearCache();

                String wsdl = getWsdl(IWsdlLocation.OPERACION);

                Operacion12BndQSService operacion12BndQSService =
                    IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
                Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + operacion12Port.toString());
                } catch (Exception ex) {
                }

                ConsultarComisionesNoCobradasBPELRequestType request =
                    new ConsultarComisionesNoCobradasBPELRequestType();

                request.setIdOperacion(idOperacion);

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_OBTENER_COMISIONES_NO_PAGADAS);
                ConsultarComisionesNoCobradasBPELResponseType response =
                    operacion12Port.consultarComisionesNoPagadas(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_OBTENER_COMISIONES_NO_PAGADAS,
                                    horaInicio);

                logger.warning("response" + response);

                List<org.bcie.comisionbo.Comision> listaComisionesObtenidas =
                    (List<org.bcie.comisionbo.Comision>) response.getComision();

                logger.warning("listaComisionesObtenidas" + listaComisionesObtenidas);

                if (!listaComisionesObtenidas.isEmpty()) {
                    Boolean seleccionar = Boolean.FALSE;

                    for (org.bcie.comisionbo.Comision comision : listaComisionesObtenidas) {
                        if (comision != null) {
                            if (comision.getTipoComision().getIdTipoComision().getId() != 1) {
                                if (comision.getSubEstadoTCC().getId() != null) {
                                    if ((comision.getSubEstadoTCC().getId() != 21) &&
                                        ((comision.getEstadoTCC().getId() != 6) &&
                                         (comision.getSubEstadoTCC().getId() != 28))) {
                                        ComisionesNoPagadasVORowImpl newComisionesNoPagadas =
                                            (ComisionesNoPagadasVORowImpl) comisionesNoPagadasVO.createRow();
                                        newComisionesNoPagadas.setAttribute("Id", comision.getIdComision());
                                        newComisionesNoPagadas.setAttribute("Descripcion", comision.getNombre());
                                        newComisionesNoPagadas.setAttribute("MontoComision",
                                                                            comision.getMontoComision());
                                        newComisionesNoPagadas.setAttribute("CodigoContrato",
                                                                            comision.getCodigoContrato());
                                        newComisionesNoPagadas.setAttribute("IdTcaEstadoTcc",
                                                                            comision.getEstadoTCC().getId());
                                        newComisionesNoPagadas.setAttribute("IdTcaSubEstadoTcc",
                                                                            comision.getSubEstadoTCC().getId());
                                        newComisionesNoPagadas.setAttribute("Seleccionar", seleccionar);

                                        logger.warning("Comision Agregada.");
                                        logger.warning("Id" + comision.getIdComision());
                                        logger.warning("Descripcion" + comision.getNombre());
                                        logger.warning("MontoComision" + comision.getMontoComision());
                                        logger.warning("CodigoContrato" + comision.getCodigoContrato());
                                        logger.warning("IdTcaEstadoTcc" + comision.getEstadoTCC().getId());
                                        logger.warning("IdTcaSubEstadoTcc" + comision.getSubEstadoTCC().getId());

                                        comisionesNoPagadasVO.insertRow(newComisionesNoPagadas);
                                    } else {
                                        logger.warning("Comision en proceso Activo: " + comision.getIdComision());
                                    }
                                } else {
                                    logger.warning("Comision sin Sub Estado: " + comision.getIdComision());

                                    ComisionesNoPagadasVORowImpl newComisionesNoPagadas =
                                        (ComisionesNoPagadasVORowImpl) comisionesNoPagadasVO.createRow();
                                    newComisionesNoPagadas.setAttribute("Id", comision.getIdComision());
                                    newComisionesNoPagadas.setAttribute("Descripcion", comision.getNombre());
                                    newComisionesNoPagadas.setAttribute("MontoComision", comision.getMontoComision());
                                    newComisionesNoPagadas.setAttribute("CodigoContrato", comision.getCodigoContrato());
                                    newComisionesNoPagadas.setAttribute("IdTcaEstadoTcc",
                                                                        comision.getEstadoTCC().getId());
                                    newComisionesNoPagadas.setAttribute("IdTcaSubEstadoTcc",
                                                                        comision.getSubEstadoTCC().getId());
                                    newComisionesNoPagadas.setAttribute("Seleccionar", seleccionar);

                                    logger.warning("Comision Agregada.");
                                    logger.warning("Id" + comision.getIdComision());
                                    logger.warning("Descripcion" + comision.getNombre());
                                    logger.warning("MontoComision" + comision.getMontoComision());
                                    logger.warning("CodigoContrato" + comision.getCodigoContrato());
                                    logger.warning("IdTcaEstadoTcc" + comision.getEstadoTCC().getId());
                                    logger.warning("IdTcaSubEstadoTcc" + comision.getSubEstadoTCC().getId());

                                    comisionesNoPagadasVO.insertRow(newComisionesNoPagadas);

                                }
                            } else {
                                logger.warning("Comision no agregada es de Tipo Por compromiso: " +
                                               comision.getIdComision());
                            }
                        } else {
                            logger.warning("La comision es Nula.");
                        }
                    }
                } else {
                    logger.warning("La lista recuperada esta es nula.");
                }
                //Valida si se introducen comisiones a ComisionesNoPagadasVO
                if (comisionesNoPagadasVO.getRowCount() > 0) {
                    result = Boolean.FALSE;
                } else {
                    result = Boolean.TRUE;
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }

        return result;
    }

    public Boolean insertarComisiones(Long idOperacion) {

        Boolean result = Boolean.TRUE;
        ComisionesNoPagadasVOImpl comisionesNoPagadasVOImpl = null;
        comisionesNoPagadasVOImpl = getComisionesNoPagadasVO();

        ConsultaComisionNoPagadaVOImpl consultaComisionNoPagadaVO = null;
        consultaComisionNoPagadaVO = getConsultaComisionNoPagadaVO();

        Integer idTcaSubEstadoTcc = null;
        Integer idTcaEstadoTcc = null;

        if (null != consultaComisionNoPagadaVO) {
            consultaComisionNoPagadaVO.setvarIdOperacion(idOperacion);
            try {
                logger.warning("Ejecutando query consultaComisionNoPagadaVO");
                consultaComisionNoPagadaVO.executeQuery();
            } catch (Exception e) {
                logger.warning("Error al ejecutar query");
            }
        }

        RowSetIterator rowConsultaComisionNoPagada = consultaComisionNoPagadaVO.createRowSetIterator(null);
        rowConsultaComisionNoPagada.reset();
        while (rowConsultaComisionNoPagada.hasNext()) {
            ConsultaComisionNoPagadaVORowImpl rowComisionNoPagada =
                (ConsultaComisionNoPagadaVORowImpl) rowConsultaComisionNoPagada.next();

            idTcaEstadoTcc = (Integer) rowComisionNoPagada.getAttribute("IdTcaEstadoTcc");
            idTcaSubEstadoTcc = (Integer) rowComisionNoPagada.getAttribute("IdTcaSubEstadoTcc");

            comisionesNoPagadasVOImpl.comisionesNoPagadas(rowComisionNoPagada);

        }
        rowConsultaComisionNoPagada.closeRowSetIterator();

        if (comisionesNoPagadasVOImpl.getRowCount() > 0) {
            result = Boolean.FALSE;
        } else {
            result = Boolean.TRUE;
        }
        return result;
    }

    public void actualizarSCRRecomendado(Integer idTcaScr) {
        logger.warning("inside actualizarSCRRecomendado.");
        logger.warning("idTcaScr: " + idTcaScr);

        SeguimientoCrediticioAprobacionVOImpl seguimientoCrediticioAprobacionVOImpl =
            getSeguimientoCrediticioAprobacionVO();
        Row rowSeguimientoCrediticioAprobacion = seguimientoCrediticioAprobacionVOImpl.getCurrentRow();

        SeguimientoCreditcioVOImpl seguimientoCreditcioVOImpl = null;
        seguimientoCreditcioVOImpl = getSeguimientoCreditcioVO();

        if (rowSeguimientoCrediticioAprobacion != null) {
            Long idSeguimiento = (Long) rowSeguimientoCrediticioAprobacion.getAttribute("Id");
            logger.warning("idSeguimiento a actualizar: " + rowSeguimientoCrediticioAprobacion.getAttribute("Id"));
            seguimientoCreditcioVOImpl.actualizarSCRRecomendado(idSeguimiento, idTcaScr);
        } else {
            logger.warning("Row Seguimiento Crediticio Aprobacion es nulo.");
        }
    }

    public void actualizarBanEstatusSCRAprobado() {
        logger.warning("inside actualizarBanEstatusSCRAprobado.");

        SeguimientoCrediticioAprobacionVOImpl seguimientoCrediticioAprobacionVOImpl =
            getSeguimientoCrediticioAprobacionVO();
        Row rowSeguimientoCrediticioAprobacion = seguimientoCrediticioAprobacionVOImpl.getCurrentRow();

        SeguimientoCreditcioVOImpl seguimientoCreditcioVOImpl = null;
        seguimientoCreditcioVOImpl = getSeguimientoCreditcioVO();

        if (rowSeguimientoCrediticioAprobacion != null) {
            Long idSeguimiento = (Long) rowSeguimientoCrediticioAprobacion.getAttribute("Id");
            logger.warning("idSeguimiento a actualizar: " + rowSeguimientoCrediticioAprobacion.getAttribute("Id"));
            seguimientoCreditcioVOImpl.actualizarBanEstatusSCRAprobado(idSeguimiento);
        } else {
            logger.warning("Row Seguimiento Crediticio Aprobacion es nulo.");
        }
    }

    /**
     * Container's getter for ConsultarContrapartesTerminoVO1.
     * @return ConsultarContrapartesTerminoVO1
     */
    public ConsultarContrapartesTerminoVOImpl getConsultarContrapartesTerminoVO() {
        return (ConsultarContrapartesTerminoVOImpl) findViewObject("ConsultarContrapartesTerminoVO");
    }

    /**
     * Container's getter for TccAgregarEnmendadoVO1.
     * @return TccAgregarEnmendadoVO1
     */
    public TccAgregarEnmendadoVOImpl getTccAgregarEnmendadoVO() {
        return (TccAgregarEnmendadoVOImpl) findViewObject("TccAgregarEnmendadoVO");
    }

    /**
     * Container's getter for TccTerminoTipoFechaInicioLOV1.
     * @return TccTerminoTipoFechaInicioLOV1
     */
    public TccTerminoTipoFechaInicioLOVImpl getTccTerminoTipoFechaInicioLOV() {
        return (TccTerminoTipoFechaInicioLOVImpl) findViewObject("TccTerminoTipoFechaInicioLOV");
    }

    /**
     * Container's getter for TccElementosTreeVO1.
     * @return TccElementosTreeVO1
     */
    public TccElementosTreeVOImpl getTccElementosTreeVO() {
        return (TccElementosTreeVOImpl) findViewObject("TccElementosTreeVO");
    }

    /**
     * Container's getter for AgregarLineaCreditoVO1.
     * @return AgregarLineaCreditoVO1
     */
    public AgregarLineaCreditoVOImpl getAgregarLineaCreditoVO() {
        return (AgregarLineaCreditoVOImpl) findViewObject("AgregarLineaCreditoVO");
    }

    /**
     * Container's getter for AprobacionVO1.
     * @return AprobacionVO1
     */
    public AprobacionVOImpl getAprobacionVO() {
        return (AprobacionVOImpl) findViewObject("AprobacionVO");
    }

    /**
     * Container's getter for DeclaracionVO1.
     * @return DeclaracionVO1
     */
    public DeclaracionVOImpl getDeclaracionVO() {
        return (DeclaracionVOImpl) findViewObject("DeclaracionVO");
    }

    /**
     * Container's getter for TccEditarTerminoVO1.
     * @return TccEditarTerminoVO1
     */
    public TccEditarTerminoVOImpl getTccEditarTerminoVO() {
        return (TccEditarTerminoVOImpl) findViewObject("TccEditarTerminoVO");
    }

    /**
     * Container's getter for TccDatosTcaTerminoVO1.
     * @return TccDatosTcaTerminoVO1
     */
    public TccDatosTcaTerminoVOImpl getTccDatosTcaTerminoVO() {
        return (TccDatosTcaTerminoVOImpl) findViewObject("TccDatosTcaTerminoVO");
    }

    /**
     * Container's getter for MemoriaProcesoBpmVO1.
     * @return MemoriaProcesoBpmVO1
     */
    public MemoriaProcesoBpmVOImpl getMemoriaProcesoBpmVO() {
        return (MemoriaProcesoBpmVOImpl) findViewObject("MemoriaProcesoBpmVO");
    }

    /**
     * Container's getter for TccTerminoVO1.
     * @return TccTerminoVO1
     */
    public TccTerminoVOImpl getTccTerminoGridVO() {
        return (TccTerminoVOImpl) findViewObject("TccTerminoGridVO");
    }

    /**
     * Container's getter for TccCondicionVO1.
     * @return TccCondicionVO1
     */
    public TccCondicionVOImpl getTccCondicionGridVO() {
        return (TccCondicionVOImpl) findViewObject("TccCondicionGridVO");
    }

    /**
     * Container's getter for TccComisionVO1.
     * @return TccComisionVO1
     */
    public TccComisionVOImpl getTccComisionGridVO() {
        return (TccComisionVOImpl) findViewObject("TccComisionGridVO");
    }

    /**
     * Container's getter for PreCargaTerminoVO1.
     * @return PreCargaTerminoVO1
     */
    public PreCargaTerminoVOImpl getPreCargaTerminoVO() {
        return (PreCargaTerminoVOImpl) findViewObject("PreCargaTerminoVO");
    }

    /**
     * Container's getter for PreCargaCondicionVO1.
     * @return PreCargaCondicionVO1
     */
    public PreCargaCondicionVOImpl getPreCargaCondicionVO() {
        return (PreCargaCondicionVOImpl) findViewObject("PreCargaCondicionVO");
    }

    /**
     * Container's getter for PreCargaComisionVO1.
     * @return PreCargaComisionVO1
     */
    public PreCargaComisionVOImpl getPreCargaComisionVO() {
        return (PreCargaComisionVOImpl) findViewObject("PreCargaComisionVO");
    }

    /**
     * Container's getter for TccObservacionCondicionVO1.
     * @return TccObservacionCondicionVO1
     */
    public TccObservacionCondicionVOImpl getTccObservacionCondicionGridVO() {
        return (TccObservacionCondicionVOImpl) findViewObject("TccObservacionCondicionGridVO");
    }

    /**
     * Container's getter for CondicionAndObservacionCondicionVL1.
     * @return CondicionAndObservacionCondicionVL1
     */
    public ViewLinkImpl getCondicionAndObservacionCondicionGridVL() {
        return (ViewLinkImpl) findViewLink("CondicionAndObservacionCondicionGridVL");
    }

    /**
     * Container's getter for TreCategoriaCondicionVO1.
     * @return TreCategoriaCondicionVO1
     */
    public TreCategoriaCondicionVOImpl getTreCategoriaCondicionGridVO() {
        return (TreCategoriaCondicionVOImpl) findViewObject("TreCategoriaCondicionGridVO");
    }

    /**
     * Container's getter for CondicionAndTreCategoriaCondicionVL1.
     * @return CondicionAndTreCategoriaCondicionVL1
     */
    public ViewLinkImpl getCondicionAndTreCategoriaCondicionGridVL() {
        return (ViewLinkImpl) findViewLink("CondicionAndTreCategoriaCondicionGridVL");
    }

    /**
     * Container's getter for TreTcaEventoCondicionVO1.
     * @return TreTcaEventoCondicionVO1
     */
    public TreTcaEventoCondicionVOImpl getTreTcaEventoCondicionGridVO() {
        return (TreTcaEventoCondicionVOImpl) findViewObject("TreTcaEventoCondicionGridVO");
    }

    /**
     * Container's getter for CondicionAndTreTcaEventoCondicionVL1.
     * @return CondicionAndTreTcaEventoCondicionVL1
     */
    public ViewLinkImpl getCondicionAndTreTcaEventoCondicionGridVL() {
        return (ViewLinkImpl) findViewLink("CondicionAndTreTcaEventoCondicionGridVL");
    }

    /**
     * Container's getter for TreCategoriaCondicionVO1.
     * @return TreCategoriaCondicionVO1
     */
    public TreCategoriaCondicionVOImpl getCategoriaCondicionVO() {
        return (TreCategoriaCondicionVOImpl) findViewObject("CategoriaCondicionVO");
    }

    /**
     * Container's getter for TreTcaEventoCondicionVO1.
     * @return TreTcaEventoCondicionVO1
     */
    public TreTcaEventoCondicionVOImpl getEventoCondicionVO() {
        return (TreTcaEventoCondicionVOImpl) findViewObject("EventoCondicionVO");
    }

    /**
     * Container's getter for DocumentosSincronizadosVO1.
     * @return DocumentosSincronizadosVO1
     */
    public DocumentosSincronizadosVOImpl getDocumentosSincronizadosVO() {
        return (DocumentosSincronizadosVOImpl) findViewObject("DocumentosSincronizadosVO");
    }

    /**
     * Actualiza los tipos de Documento que se encuentren Sincronizados para una Operación/Tarea/Tipo de Documento
     * en específico. Creado para proceso de LAFT - Seguimiento
     * @param idOperacion
     * @param idTareaBpm
     * @param idTipoDocAnterior Tipo de Documento a buscar
     * @param idTipoDocNuevo Tipo de Documento con el que será reemplazado el anterior
     *
     * @author Francisco Cuevas Pineda
     * @since 18/abril/2016
     */
    public void actualizarTiposDocumentoPorOpTareaTipo(Long idOperacion, Integer idTareaBpm, Integer idTipoDocAnterior,
                                                       Integer idTipoDocNuevo) {
        logger.log(ADFLogger.WARNING,
                   "Inside actualizarTiposDocumentoPorOpTareaTipo. idOperacion: " + idOperacion + " idTareaBpm: " +
                   idTareaBpm + " idTipoDocAnterior: " + idTipoDocAnterior + " idTipoDocNuevo: " + idTipoDocNuevo);
        List<Long> idsDocumento = null;

        if (idOperacion != null && idTareaBpm != null && idTipoDocAnterior != null && idTipoDocNuevo != null) {

            // Obtenemos la lista de Documentos sincronizados para la Operación/Tarea/Tipo en específico
            idsDocumento =
                this.getDocumentosSincronizadosVO().obtenerIdsDocPorOperacionTareaTipoDoc(idOperacion, idTareaBpm,
                                                                                          idTipoDocAnterior);

            // Si la lista no es null, procedemos a actualizar los Tipos de documento.
            // De su valor anterior, idTipoDocAnterior, al nuevo idTipoDocNuevo.
            if (idsDocumento != null) {

                for (Long idDoc : idsDocumento) {

                    this.getDocumentoVO().actualizarTipoDocumento(idDoc, idTipoDocNuevo);
                }
            }
        }
    }

    /**
     * se crea metodo para cambiar de estados tcc en enmiendas a por aprobar, asi como se va validar de que se manden las comisiones a Flexcube
     * @param idEnmienda para validar que el tcc sea de la enmienda seleccionada
     * @param estadoTcc cambia
     * @param subEstadotcc
     * @param comision
     * @return
     */
    public Boolean enmiendasAprobarYFlexcube
        (
                Long idEnmienda, 
                String comision, 
                String idOperacion, 
                String loginUsuario,
                String descripcionOperacion, 
                String codigoCliente, 
                String nombreCliente,
                Integer codigoProducto,
                String nombreProducto,
                BigDecimal montoSolicitado,
                String pais
        )
        {
            logger.warning("Dentro de enmiendasAprobarYFlexcube");
            logger.warning("idEnmienda :" + idEnmienda);
            logger.warning("comision :" + comision);
            logger.warning("idOperacion :" + idOperacion);
            logger.warning("loginUsuario :" + loginUsuario);
            logger.warning("descripcionOperacion :" + descripcionOperacion);
            logger.warning("codigoCliente :" + codigoCliente);
            logger.warning("nombreCliente :" + nombreCliente);
            logger.warning("codigoProducto :" + codigoProducto);
            logger.warning("nombreProducto :" + nombreProducto);
            logger.warning("montoSolicitado :" + montoSolicitado);
            logger.warning("pais :" + pais);
     

            Boolean resultado = Boolean.TRUE;
	        Integer contadorTCC = 1;
	        String mensaje = "";            
	        Long id_Operacion = Long.parseLong(idOperacion);
            logger.warning("id_Operacion :" + id_Operacion);
            Long id_Tarea = 10L;
            String sinMovimiento = "Sin Movimiento";

            ViewObjectImpl tccGridElementosOperVO = getTccGridElementosOperVO();
            RowSetIterator rowsTccElementosOperVo = tccGridElementosOperVO.createRowSetIterator(null);
            logger.warning("Entra a la validacion de : " + comision);
            logger.warning("Elementos de la lista: " + rowsTccElementosOperVo.getRowCount());
            if (rowsTccElementosOperVo.getRowCount() > 0) {
                Number idTccActual;
                Number idTipoTcc;
                Number idTcaTipoTcc;
                Integer idSubEstadoTccActual;
                Number idEstadoActual;
                Long EnmiendaId;
                rowsTccElementosOperVo.reset();
                String descTipoTcc;
                Boolean aprobarEnmienda;
                Boolean esFlexcube;
                Boolean cambioEstado;
                Boolean iniciaComision;
                String nombreTcc;

                while (rowsTccElementosOperVo.hasNext()) {
                    TccElementosOperVORowImpl rowTccElemnto = (TccElementosOperVORowImpl) rowsTccElementosOperVo.next();
                                            
                        idTccActual = (Number) rowTccElemnto.getAttribute("IdTcc");
                        idTipoTcc = (Number) rowTccElemnto.getAttribute("IdLink");
                        EnmiendaId = (Long) rowTccElemnto.getAttribute("EnmiendaId");
                        idEstadoActual = (Number) rowTccElemnto.getAttribute("IdEstadoTcc");
                        idSubEstadoTccActual = (Integer) rowTccElemnto.getAttribute("IdSubEstadoTcc");
                        idTcaTipoTcc = (Number) rowTccElemnto.getAttribute("IdTipoTcc");
                        nombreTcc = (String) rowTccElemnto.getAttribute("DescripcionTcc");
                                            
                                            logger.warning("IdTcc: " + (Number) rowTccElemnto.getAttribute("IdTcc")); 
                        logger.warning("idSubEstadoTccActual: " + idSubEstadoTccActual);
                        logger.warning("idTipoTcc: " + idTipoTcc);
                        logger.warning("idTcaTipoTCC: " + idTcaTipoTcc);
                        logger.warning("idTccActual: " + idTccActual);
                        logger.warning("EstadoActual: " + idEstadoActual);
                        logger.warning("EnmiendaId: " + EnmiendaId);

                        if (comision.equalsIgnoreCase("flexcube")) { 
                            if (
                                FenixModelConstants.ESTADO_TCC_APROBADA.compareTo(idEstadoActual.intValue()) == 0 ||
                                FenixModelConstants.ESTADO_TCC_ELIMINADA.compareTo(idEstadoActual.intValue()) == 0 ||
                                FenixModelConstants.ESTADO_TCC_DISPENSADA.compareTo(idEstadoActual.intValue()) == 0
                            ) {
                                contadorTCC = contadorTCC + 1; 
                                esFlexcube = Boolean.TRUE;
                                iniciaComision = Boolean.TRUE;
                                cambioEstado = Boolean.TRUE;
                                descTipoTcc = "";
                                if (FenixModelConstants.ID_COMISION.compareTo(idTipoTcc.intValue()) == 0 &&
                                    (null == idSubEstadoTccActual ||
                                        FenixModelConstants.SUBESTADO_TCC_POR_VALIDAR.compareTo(idSubEstadoTccActual) == 0 ||
                                        FenixModelConstants.SUBESTADO_TCC_VALIDADA.compareTo(idSubEstadoTccActual) == 0)) {
                                    descTipoTcc = FenixModelConstants.COMISION;
                                    aprobarEnmienda = mandaFlexcube(idTcaTipoTcc.intValue()); 
                                                                    if (null == idSubEstadoTccActual ||
                                                                            FenixModelConstants.SUBESTADO_TCC_VALIDADA.compareTo(idSubEstadoTccActual) !=
                                                                            0) {
                                                                            cambioEstado =
                                                                                    actualizarTCCAdmon(idTccActual.longValue(), idEstadoActual.longValue(),
                                                                                            FenixModelConstants.SUBESTADO_TCC_VALIDADA.longValue(),
                                                                                            descTipoTcc);
                                                                    }
                                                                    if (null == cambioEstado || !cambioEstado) {
                                                                            logger.warning("Error al cambiar estado ComisionTCC");
                                                                            resultado = Boolean.FALSE;
                                                                            break;
                                                                    } else {
                                                                            esFlexcube = crearComision(idTccActual.longValue(), nombreTcc, nombreTcc);
                                                                            if (null == esFlexcube || !esFlexcube) {
                                                                                    logger.warning("Error al crear ComisionTCC en Flexcube");
                                                                                    resultado = Boolean.FALSE;
                                                                                    break;
                                                                            } else {
                                                                                    if (null == idSubEstadoTccActual ||
                                                                                            FenixModelConstants.SUBESTADO_TCC_VALIDADA.compareTo(idSubEstadoTccActual) !=
                                                                                            0) {
                                                                                            iniciaComision =
                                                                                                    servicioInicioComisiones(idOperacion, loginUsuario,
                                                                                                            descripcionOperacion, codigoCliente,
                                                                                                            nombreCliente, codigoProducto,
                                                                                                            nombreProducto, montoSolicitado, pais,
                                                                                                            idTccActual.longValue());
                                                                                    }
                                                                                    if (null == iniciaComision || !iniciaComision) {
                                                                                            logger.warning("Error al Iniciar ComisionTCC");
                                                                                            resultado = Boolean.FALSE;
                                                                                            break;
                                                                                    }

                                                                            }
                                                                    } 
                                } else {
                                    if (null == idSubEstadoTccActual ||
                                        FenixModelConstants.SUBESTADO_TCC_POR_VALIDAR.compareTo(idSubEstadoTccActual) ==
                                        0) {
                                        if (FenixModelConstants.ID_TERMINO.compareTo(idTipoTcc.intValue()) == 0) {
                                            descTipoTcc = FenixModelConstants.TERMINO;
                                        }
                                        if (FenixModelConstants.ID_CONDICION.compareTo(idTipoTcc.intValue()) == 0) {
                                            descTipoTcc = FenixModelConstants.CONDICION;
                                        }

                                        aprobarEnmienda =
                                            actualizarTCCAdmon(idTccActual.longValue(), idEstadoActual.longValue(),
                                                FenixModelConstants.SUBESTADO_TCC_VALIDADA.longValue(),
                                                descTipoTcc);
                                        if (null == aprobarEnmienda || !aprobarEnmienda) {
                                            logger.warning("Error al actualizar TCC");
                                            resultado = Boolean.FALSE;
                                            break;
                                        }
                                    }
                                }
                            }
                            if (FenixModelConstants.ESTADO_TCC_POR_PAGAR.compareTo(idEstadoActual.intValue()) == 0 &&
                                FenixModelConstants.ID_COMISION.compareTo(idTipoTcc.intValue()) == 0 &&
                                (FenixModelConstants.SUBESTADO_TCC_VALIDADA.compareTo(idSubEstadoTccActual) == 0 ||
                                    FenixModelConstants.SUBESTADO_TCC_POR_VALIDAR.compareTo(idSubEstadoTccActual) == 0)) {
                                contadorTCC = contadorTCC + 1;
                                iniciaComision = Boolean.TRUE;
                                if (FenixModelConstants.SUBESTADO_TCC_VALIDADA.compareTo(idSubEstadoTccActual) == 0) {
                                    iniciaComision =
                                        servicioInicioComisiones(idOperacion, loginUsuario, descripcionOperacion,
                                            codigoCliente, nombreCliente, codigoProducto,
                                            nombreProducto, montoSolicitado, pais,
                                            idTccActual.longValue());
                                }
                                if (null == iniciaComision || !iniciaComision) {
                                    logger.warning("Error al iniciarComision ");
                                    resultado = Boolean.FALSE;
                                    break;
                                }
                            }
                        } 
                }
                if (comision.equalsIgnoreCase("aprobacion")) { 
                    logger.warning("Entra a actualizarTCCAdmonEnmienda idEnmienda " + idEnmienda);
                    actualizarTCCAdmonEnmienda(id_Operacion, idEnmienda, 0L, id_Tarea);
                    logger.warning("Sale de actualizarTCCAdmonEnmienda"); 
                }
                rowsTccElementosOperVo.closeRowSetIterator();
            } else {
            mensaje = "No existen enmiendas registradas";
                resultado = Boolean.TRUE;
                contadorTCC = 0;
            }
            logger.warning("resultado: " + resultado);
            logger.warning("mensaje: " + mensaje);
            logger.warning("Fuera de enmiendasAprobarYFlexcube");
            return resultado;
        }

    public Boolean inicioValidacionAsignacionRecursos(String idOperacion, String loginUsuario, String idSolicitud) {
        logger.warning("Inicia inicioValidacionAsignacionRecursos.");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;
        String valueSolicitud = "ID_SOLICITUD";

        try {
            if (idOperacion != null) {
                String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

                ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                    IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
                ProcesosPrincipalesPortType procesosPrincipalesPortType =
                    procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

                try {
                    logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
                } catch (Exception ex) {
                }

                Header header = new Header();

                org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                    new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

                org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType parameterType =
                    new org.bcie.xmlns.objetoproceso.comun.parameter.v1.ParameterType();

                StringWriter xmlEntrada = null;
                StringWriter xmlSalida = null;

                operacion.setCodigoOperacion(Integer.parseInt(idOperacion));
                operacion.setResponsableOperacion(loginUsuario);

                parameterType.setParameterName(valueSolicitud);
                parameterType.setParameterValue(idSolicitud);

                header.setOperacion(operacion);
                header.getParameterType().add(parameterType);

                xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Invocando Servicio - InicioValidacionAsignacion-" + xmlEntrada.toString());

                response = procesosPrincipalesPortType.inicioValidacionAsignacion(header);
                xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.log(ADFLogger.WARNING,
                           ">HNWS Respuesta servicio - InicioValidacionAsignacion -" + xmlSalida.toString());
                if (null != response.getError() ||
                    (response.getResult() != null && response.getResult().value() == "ERROR")) {
                    String mensajeError = "";
                    String detalleError = "";

                    if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                        mensajeError = response.getMessage();
                    }

                    existeError = Boolean.TRUE;
                    msgError = "Servicio inicioValidacionAsignacion devuelve ERROR. " + "Mensaje: " + mensajeError;
                    resultado = Boolean.FALSE;
                } else {
                    resultado = Boolean.TRUE;
                }

            } else {
                resultado = Boolean.FALSE;
                existeError = Boolean.TRUE;
                logger.log(ADFLogger.ERROR, "Error en InicioValidacionAsignacion: idOperacion vacio");
                msgError = "Error en InicioValidacionAsignacion: idOperacion vacio";
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en InicioValidacionAsignacion ", e);

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en InicioValidacionAsignacion " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        } finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        logger.warning("Termina inicioValidacionAsignacionRecursos.");
        return resultado;
    }

    /**
     * Determina si el id comision pasa a flexcube
     * @param idTipocomision
     * @return
     */
    public Boolean mandaFlexcube(Integer idTipocomision) {
        Boolean resultado = Boolean.TRUE;
        ViewObjectImpl tcaTipoComisionVo = getTcaCatComisionVO();
        tcaTipoComisionVo.setRangeSize(-1);
        Integer registraFlexcube = 0;
        Integer valido = 1;
        Row row = tcaTipoComisionVo.getRow(new Key(new Object[] { idTipocomision }));
        registraFlexcube = (Integer) row.getAttribute("SeRegistraFlexcube");
        if (null == registraFlexcube || registraFlexcube.compareTo(0) == 0) {
            resultado = Boolean.FALSE;
        } else {
            resultado = Boolean.TRUE;
        }
        return resultado;
    }

    /**
     * Container's getter for TcaCatComisionVO1.
     * @return TcaCatComisionVO1
     */
    public ViewObjectImpl getTcaCatComisionVO() {
        return (ViewObjectImpl) findViewObject("TcaCatComisionVO");
    }

    public Boolean precargaOGC(Number idOperacion) {
        Boolean enmiendaRequiereOGC = Boolean.FALSE;
        getTccGridElementosOperVO().setpIdOperacion(idOperacion);
        getTccGridElementosOperVO().executeQuery();

        logger.warning("Cantidad de registros de TCC encontrados: " +
                       getTccGridElementosOperVO().getEstimatedRowCount());

        RowSetIterator rowsTccElementosOperVo = getTccGridElementosOperVO().createRowSetIterator(null);
        if (null != rowsTccElementosOperVo) {
            logger.warning("Entra a iterador");
            TccElementosOperVORowImpl row = null;

            rowsTccElementosOperVo.reset();
            while (rowsTccElementosOperVo.hasNext()) {
                logger.warning("Iterando VO del grid");
                row = (TccElementosOperVORowImpl) rowsTccElementosOperVo.next();
                logger.warning("Obteniendo registros de la operacion");
                if (null != row.getEnmiendaRequiereOgc()) {
                    logger.warning("getEnmiendasRequiereOGC: " + row.getEnmiendaRequiereOgc());
                    if (row.getRequiereOgcEnmienda().compareTo(1) == 0) {
                        enmiendaRequiereOGC = Boolean.TRUE;
                    }
                }
            }
            rowsTccElementosOperVo.closeRowSetIterator();
        }
        return enmiendaRequiereOGC;
    }

    public Boolean precargaOT(Number idOperacion) {
        Boolean enmiendaRequiereOT = Boolean.FALSE;
        getTccGridElementosOperVO().setpIdOperacion(idOperacion);
        getTccGridElementosOperVO().executeQuery();

        logger.warning("Cantidad de registros de TCC encontrados: " +
                       getTccGridElementosOperVO().getEstimatedRowCount());

        RowSetIterator rowsTccElementosOperVo = getTccGridElementosOperVO().createRowSetIterator(null);
        if (null != rowsTccElementosOperVo) {
            logger.warning("Entra a iterador");
            TccElementosOperVORowImpl row = null;

            rowsTccElementosOperVo.reset();
            while (rowsTccElementosOperVo.hasNext()) {
                logger.warning("Iterando VO del grid");
                row = (TccElementosOperVORowImpl) rowsTccElementosOperVo.next();
                logger.warning("Obteniendo registros de la operacion");
                if (null != row.getRequiereOtEnmienda()) {
                    logger.warning("getRequiereOtEnmienda: " + row.getRequiereOtEnmienda());
                    if (row.getRequiereOtEnmienda().compareTo(1) == 0) {
                        enmiendaRequiereOT = Boolean.TRUE;
                    }
                }
            }
            rowsTccElementosOperVo.closeRowSetIterator();
        }
        return enmiendaRequiereOT;
    }

    public Boolean precargaASJUR(Number idOperacion) {
        Boolean enmiendaRequiereASJUR = Boolean.FALSE;
        getTccGridElementosOperVO().setpIdOperacion(idOperacion);
        getTccGridElementosOperVO().executeQuery();

        logger.warning("Cantidad de registros de TCC encontrados: " +
                       getTccGridElementosOperVO().getEstimatedRowCount());

        RowSetIterator rowsTccElementosOperVo = getTccGridElementosOperVO().createRowSetIterator(null);
        if (null != rowsTccElementosOperVo) {
            logger.warning("Entra a iterador");
            TccElementosOperVORowImpl row = null;

            rowsTccElementosOperVo.reset();
            while (rowsTccElementosOperVo.hasNext()) {
                logger.warning("Iterando VO del grid");
                row = (TccElementosOperVORowImpl) rowsTccElementosOperVo.next();
                logger.warning("Obteniendo registros de la operacion");
                if (null != row.getRequiereAsjurEnmienda()) {
                    logger.warning("getRequiereAsjurEnmienda: " + row.getRequiereAsjurEnmienda());
                    if (row.getRequiereAsjurEnmienda().compareTo(1) == 0) {
                        enmiendaRequiereASJUR = Boolean.TRUE;
                    }
                }
            }
            rowsTccElementosOperVo.closeRowSetIterator();
        }
        return enmiendaRequiereASJUR;
    }


    public Boolean precargaASJURPorIdOperacionAndIdEnmienda(Number idOperacion, Number idEnmienda) {
        logger.warning("Into precargaASJURPorIdOperacionAndIdEnmienda");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("idEnmienda :" + idEnmienda);
        Boolean enmiendaRequiereASJUR = Boolean.FALSE;
        getTccGridElementosOperVO().setpIdOperacion(idOperacion);
        getTccGridElementosOperVO().setpIdEnmienda(idEnmienda);
        getTccGridElementosOperVO().executeQuery();

        logger.warning("Cantidad de registros de TCC encontrados: " +
                       getTccGridElementosOperVO().getEstimatedRowCount());

        RowSetIterator rowsTccElementosOperVo = getTccGridElementosOperVO().createRowSetIterator(null);
        if (null != rowsTccElementosOperVo) {
            logger.warning("Entra a iterador");
            TccElementosOperVORowImpl row = null;

            rowsTccElementosOperVo.reset();
            while (rowsTccElementosOperVo.hasNext()) {
                logger.warning("Iterando VO del grid");
                row = (TccElementosOperVORowImpl) rowsTccElementosOperVo.next();
                logger.warning("Obteniendo registros de la operacion");
                if (null != row.getRequiereAsjurEnmienda()) {
                    logger.warning("getRequiereAsjurEnmienda: " + row.getRequiereAsjurEnmienda());
                    if (row.getRequiereAsjurEnmienda().compareTo(1) == 0) {
                        enmiendaRequiereASJUR = Boolean.TRUE;
                    }
                }
            }
            rowsTccElementosOperVo.closeRowSetIterator();
        }

        logger.warning("Leave precargaASJURPorIdOperacionAndIdEnmienda,return : " + enmiendaRequiereASJUR);
        return enmiendaRequiereASJUR;
    }

    public Boolean precargaOGCPorIdOperacionAndIdEnmienda(Number idOperacion, Number idEnmienda) {
        logger.warning("Into precargaOGCPorIdOperacionAndIdEnmienda");
        logger.warning("idOperacion :" + idOperacion);
        logger.warning("idEnmienda :" + idEnmienda);

        Boolean enmiendaRequiereOGC = Boolean.FALSE;
        getTccGridElementosOperVO().setpIdOperacion(idOperacion);
        getTccGridElementosOperVO().setpIdEnmienda(idEnmienda);
        getTccGridElementosOperVO().executeQuery();

        logger.warning("Cantidad de registros de TCC encontrados: " +
                       getTccGridElementosOperVO().getEstimatedRowCount());

        RowSetIterator rowsTccElementosOperVo = getTccGridElementosOperVO().createRowSetIterator(null);
        if (null != rowsTccElementosOperVo) {
            logger.warning("Entra a iterador");
            TccElementosOperVORowImpl row = null;

            rowsTccElementosOperVo.reset();
            while (rowsTccElementosOperVo.hasNext()) {
                logger.warning("Iterando VO del grid");
                row = (TccElementosOperVORowImpl) rowsTccElementosOperVo.next();
                logger.warning("Obteniendo registros de la operacion");
                if (null != row.getEnmiendaRequiereOgc()) {
                    logger.warning("getEnmiendasRequiereOGC: " + row.getEnmiendaRequiereOgc());
                    if (row.getRequiereOgcEnmienda().compareTo(1) == 0) {
                        enmiendaRequiereOGC = Boolean.TRUE;
                    }
                }
            }
            rowsTccElementosOperVo.closeRowSetIterator();
        }

        logger.warning("Leave precargaOGCPorIdOperacionAndIdEnmienda,return :" + enmiendaRequiereOGC);
        return enmiendaRequiereOGC;
    }

    /**
     * Container's getter for TcaCondicionLOV1.
     * @return TcaCondicionLOV1
     */
    public TcaCondicionLOVImpl getTcaCondicionLOV() {
        return (TcaCondicionLOVImpl) findViewObject("TcaCondicionLOV");
    }

    /**
     * Container's getter for TcaComisionLOV1.
     * @return TcaComisionLOV1
     */
    public TcaComisionLOVImpl getTcaComisionLOV() {
        return (TcaComisionLOVImpl) findViewObject("TcaComisionLOV");
    }

    /**
     * Container's getter for TcaCategoriaCondicionVO1.
     * @return TcaCategoriaCondicionVO1
     */
    public TcaCategoriaCondicionVOImpl getTcaCategoriaCondicionGridVO() {
        return (TcaCategoriaCondicionVOImpl) findViewObject("TcaCategoriaCondicionGridVO");
    }

    /**
     * Container's getter for TcaEventoCondicionLOV1.
     * @return TcaEventoCondicionLOV1
     */
    public TcaEventoCondicionLOVImpl getTcaEventoCondicionGridLOV() {
        return (TcaEventoCondicionLOVImpl) findViewObject("TcaEventoCondicionGridLOV");
    }

    /**
     * Container's getter for TcaCategoriaCondicionVO1.
     * @return TcaCategoriaCondicionVO1
     */
    public TcaCategoriaCondicionVOImpl getTccTcaCategoriaCondicionGridVO() {
        return (TcaCategoriaCondicionVOImpl) findViewObject("TccTcaCategoriaCondicionGridVO");
    }

    /**
     * Container's getter for TcaEventoCondicionLOV1.
     * @return TcaEventoCondicionLOV1
     */
    public TcaEventoCondicionLOVImpl getTccTcaEventoCondicionGridLOV() {
        return (TcaEventoCondicionLOVImpl) findViewObject("TccTcaEventoCondicionGridLOV");
    }

    /**
     * Container's getter for TccFuenteCondicionLOV1.
     * @return TccFuenteCondicionLOV1
     */
    public TccFuenteCondicionLOVImpl getTccFuenteCondicionGridLOV() {
        return (TccFuenteCondicionLOVImpl) findViewObject("TccFuenteCondicionGridLOV");
    }

    /**
     * Container's getter for TccLineaCreditoCondicionLOV1.
     * @return TccLineaCreditoCondicionLOV1
     */
    public TccLineaCreditoCondicionLOVImpl getTccLineaCreditoCondicionGridLOV() {
        return (TccLineaCreditoCondicionLOVImpl) findViewObject("TccLineaCreditoCondicionGridLOV");
    }

    /**
     * Container's getter for CatProductoFlexcubeLOV1.
     * @return CatProductoFlexcubeLOV1
     */
    public CatProductoFlexcubeLOVImpl getCatProductoFlexcubeLOV1() {
        return (CatProductoFlexcubeLOVImpl) findViewObject("CatProductoFlexcubeLOV1");
    }

    /**
     * Container's getter for TccTreeRootVO1.
     * @return TccTreeRootVO1
     */
    public ViewObjectImpl getTccTreeRootVO() {
        return (ViewObjectImpl) findViewObject("TccTreeRootVO");
    }

    /**
     * Container's getter for TccTreeTcaTipoVO1.
     * @return TccTreeTcaTipoVO1
     */
    public ViewObjectImpl getTccTreeTcaTipoVO() {
        return (ViewObjectImpl) findViewObject("TccTreeTcaTipoVO");
    }

    /**
     * Container's getter for TccTreeRootAndTcaTipoVL1.
     * @return TccTreeRootAndTcaTipoVL1
     */
    public ViewLinkImpl getTccTreeRootAndTcaTipoVL() {
        return (ViewLinkImpl) findViewLink("TccTreeRootAndTcaTipoVL");
    }

    /**
     * Container's getter for TccTreeTcaVO1.
     * @return TccTreeTcaVO1
     */
    public ViewObjectImpl getTccTreeTcaVO() {
        return (ViewObjectImpl) findViewObject("TccTreeTcaVO");
    }

    /**
     * Container's getter for TccTreeTcaTipoAndTcaVL1.
     * @return TccTreeTcaTipoAndTcaVL1
     */
    public ViewLinkImpl getTccTreeTcaTipoAndTcaVL() {
        return (ViewLinkImpl) findViewLink("TccTreeTcaTipoAndTcaVL");
    }

    /**
     * Container's getter for FenixRecuperacionAM1.
     * @return FenixRecuperacionAM1
     */
    public ApplicationModuleImpl getFenixRecuperacionAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixRecuperacionAM");
    }

    /**
     * Container's getter for FenixSeguimientoCrediticioAM1.
     * @return FenixSeguimientoCrediticioAM1
     */
    public ApplicationModuleImpl getFenixSeguimientoCrediticioAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixSeguimientoCrediticioAM");
    }

    /**
     * Container's getter for DocumentosAdjuntadosClientesVO1.
     * @return DocumentosAdjuntadosClientesVO1
     */
    public DocumentosAdjuntadosClientesVOImpl getDocumentosAdjuntadosClientesVO() {
        return (DocumentosAdjuntadosClientesVOImpl) findViewObject("DocumentosAdjuntadosClientesVO");
    }

    /**
     * Container's getter for AccionVO1.
     * @return AccionVO1
     */
    public AccionVOImpl getAccionVO() {
        return (AccionVOImpl) findViewObject("AccionVO");
    }

    /**
     * Container's getter for ObservacionAccionVO1.
     * @return ObservacionAccionVO1
     */
    public ObservacionAccionVOImpl getObservacionAccionVO() {
        return (ObservacionAccionVOImpl) findViewObject("ObservacionAccionVO");
    }

    /**
     * Container's getter for BitacoraSeguimientoAccionVO1.
     * @return BitacoraSeguimientoAccionVO1
     */
    public BitacoraSeguimientoAccionVOImpl getBitacoraSeguimientoAccionVO() {
        return (BitacoraSeguimientoAccionVOImpl) findViewObject("BitacoraSeguimientoAccionVO");
    }

    /**
     * Container's getter for AccionesTablaVO1.
     * @return AccionesTablaVO1
     */
    public AccionesTablaVOImpl getAccionesTablaVO() {
        return (AccionesTablaVOImpl) findViewObject("AccionesTablaVO");
    }

    /**
     * Container's getter for ValidarClienteTipoDocumentoVO1.
     * @return ValidarClienteTipoDocumentoVO1
     */
    public ValidarClienteTipoDocumentoVOImpl getValidarClienteTipoDocumentoVO() {
        return (ValidarClienteTipoDocumentoVOImpl) findViewObject("ValidarClienteTipoDocumentoVO");
    }

    /**
     * Container's getter for FenixCierreAM1.
     * @return FenixCierreAM1
     */
    public ApplicationModuleImpl getFenixCierreAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixCierreAM");
    }

    /**
     * Container's getter for FenixSupervisionAM1.
     * @return FenixSupervisionAM1
     */
    public ApplicationModuleImpl getFenixSupervisionAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixSupervisionAM");
    }

    private BlobDomain createBlobDomain(InputStream in) {
        logger.log(ADFLogger.TRACE, "Inside createBlobDomain");

        BlobDomain blobDomain = null;
        OutputStream out = null;

        try {
            blobDomain = new BlobDomain();
            out = blobDomain.getBinaryOutputStream();
            byte[] buffer = new byte[8192];
            int bytesRead = 0;

            while ((bytesRead = in.read(buffer, 0, 8192)) != -1) {
                out.write(buffer, 0, bytesRead);
            }

            in.close();

        } catch (IOException e) {
            logger.log(ADFLogger.ERROR, e.getMessage());
        } catch (SQLException e) {
            logger.log(ADFLogger.ERROR, e.getMessage());
        }

        return blobDomain;
    }

    /**
     * testAdjuntarDocumentoCliente sirve para probar el metodo adjuntarDocumentoCliente desde el AM"
     * @param oracle.jbo.domain.Number idCliente
     *        oracle.jbo.domain.Number idTareaBpm
              Boolean esJustificacion
              String fileName
              String mimeType
              String codigo
              Date fecha
              Integer idTipo
              String resumen
              oracle.jbo.domain.Number idAccion
              String loginCreadoPor
              String nombreCreadoPor
              String idOnbase
     * @since 27/07/2016
     * @by Gabriel Niño Rosales
     */
    public void testAdjuntarDocumentoCliente(oracle.jbo.domain.Number idCliente, oracle.jbo.domain.Number idTareaBpm,
                                             Boolean esJustificacion, String fileName, String mimeType, String codigo,
                                             Date fecha, Integer idTipo, String resumen,
                                             oracle.jbo.domain.Number idAccion, String loginCreadoPor,
                                             String nombreCreadoPor, String idOnbase,
                                             oracle.jbo.domain.Number numeroSerieDocumento) {
        BlobDomain content = null;
        Long idDocumento = null;
        String StringTest = "Test inputStream covnerter";
        InputStream inputStreamTest = new ByteArrayInputStream(StringTest.getBytes());
        content = createBlobDomain(inputStreamTest);
        String instanciaProceso = "9999999111";
        idDocumento =
            adjuntarDocumentoCliente(idCliente, idTareaBpm, esJustificacion, content, fileName, mimeType, codigo, fecha,
                                     idTipo, resumen, idAccion, loginCreadoPor, nombreCreadoPor, idOnbase,
                                     numeroSerieDocumento, instanciaProceso);

    }

    public void testAdjuntarDocumento(oracle.jbo.domain.Number idOperacion, oracle.jbo.domain.Number idTareaBpm,
                                      Boolean esJustificacion, String fileName, String mimeType, String codigo,
                                      Date fecha, Integer idTipo, String resumen, oracle.jbo.domain.Number idAccion,
                                      String loginCreadoPor, String nombreCreadoPor, String idOnbase,
                                      oracle.jbo.domain.Number numeroSerieDocumento) {
        BlobDomain content = null;
        Long idDocumento = null;
        String StringTest = "Test inputStream covnerter";
        InputStream inputStreamTest = new ByteArrayInputStream(StringTest.getBytes());
        content = createBlobDomain(inputStreamTest);
        String instanciaProceso = "6666666";
        idDocumento =
            adjuntarDocumento(idOperacion, idTareaBpm, esJustificacion, content, fileName, mimeType, codigo, fecha,
                              idTipo, resumen, idAccion, loginCreadoPor, nombreCreadoPor, idOnbase,
                              numeroSerieDocumento, instanciaProceso);

    }


    /**
     * adjuntarDocumentoCliente"
     * @param oracle.jbo.domain.Number idCliente
     *        oracle.jbo.domain.Number idTareaBpm
              Boolean esJustificacion
              oracle.jbo.domain.BlobDomain content
              String fileName
              String mimeType
              String codigo
              Date fecha
              Integer idTipo
              String resumen
              oracle.jbo.domain.Number idAccion
              String loginCreadoPor
              String nombreCreadoPor
              String idOnbase
     * @since 26/07/2016
     * @by Gabriel Niño Rosales
     */
    public Long adjuntarDocumentoCliente(oracle.jbo.domain.Number idCliente, oracle.jbo.domain.Number idTareaBpm,
                                         Boolean esJustificacion, oracle.jbo.domain.BlobDomain content, String fileName,
                                         String mimeType, String codigo, Date fecha, Integer idTipo, String resumen,
                                         oracle.jbo.domain.Number idAccion, String loginCreadoPor,
                                         String nombreCreadoPor, String idOnbase,
                                         oracle.jbo.domain.Number numeroSerieDocumento, String instanciaProceso) {

        logger.warning("Dentro de adjuntarDocumentoCliente");
        logger.warning("idCliente :" + idCliente);
        logger.warning("idTareaBpm :" + idTareaBpm);
        logger.warning("esJustificacion :" + esJustificacion);
        logger.warning("fileName :" + fileName);
        logger.warning("mimeType :" + mimeType);
        logger.warning("codigo :" + codigo);
        logger.warning("fecha :" + fecha);
        logger.warning("idTipo :" + idTipo);
        logger.warning("resumen :" + resumen);
        logger.warning("idAccion :" + idAccion);
        logger.warning("loginCreadoPor :" + loginCreadoPor);
        logger.warning("nombreCreadoPor :" + nombreCreadoPor);
        logger.warning("idOnbase :" + idOnbase);
        logger.warning("numeroSerieDocumento :" + numeroSerieDocumento);
        logger.warning("instanciaProceso :" + instanciaProceso);

        ViewObjectImpl documentosClienteVO = null;
        ViewObjectImpl documentoVO = null;
        ViewObjectImpl adjuntoVO = null;

        Row documentosRow = null;
        Row documentoRow = null;
        Row adjuntoRow = null;

        Integer justificacion = null;
        oracle.jbo.domain.Number idDocumento = null;
        oracle.jbo.domain.Number idAdjunto = null;

        SequenceImpl seqDocumento = new SequenceImpl("DOCUMENTO_SEQ", getDBTransaction());
        SequenceImpl seqAdjunto = new SequenceImpl("ADJUNTO_SEQ", getDBTransaction());
        NameValuePairs nvpDocumento = null;
        NameValuePairs nvpAdjunto = null;
        NameValuePairs nvpDocumentos = null;

        // Asignación para Documento
        idDocumento = seqDocumento.getSequenceNumber();
        documentoVO = this.getDocumentoVO();

        nvpDocumento = new NameValuePairs();
        nvpDocumento.setAttribute("IdDocumento", idDocumento);
        nvpDocumento.setAttribute("IdTipoDocumento", idTipo);
        nvpDocumento.setAttribute("CodigoDocumento", codigo);
        nvpDocumento.setAttribute("Comentario", resumen);
        nvpDocumento.setAttribute("FechaRegistro", new java.sql.Timestamp(System.currentTimeMillis()));
        //Agrega el atributo "numeroSerieDocumento"
        nvpDocumento.setAttribute("NumSerieDocumento", numeroSerieDocumento);
        //Agrega el atributo "InstanciaProceso"
        nvpDocumento.setAttribute("InstanciaProceso", instanciaProceso);

        if (fecha != null)
            nvpDocumento.setAttribute("FechaDocumento", new java.sql.Timestamp(fecha.getTime()));

        nvpDocumento.setAttribute("IdTcaAccion",
                                  Integer.valueOf(idAccion.intValue())); // Valores en catálogo TCA_ACCION_DOCUMENTO
        nvpDocumento.setAttribute("IdTareaBpm", idTareaBpm);

        if ((esJustificacion != null) && (esJustificacion))
            justificacion = 1;
        else
            justificacion = 0;

        nvpDocumento.setAttribute("EsJustificacion", justificacion);
        nvpDocumento.setAttribute("LoginUsuarioCrea", loginCreadoPor);
        nvpDocumento.setAttribute("NombreUsuarioCrea", nombreCreadoPor);
        nvpDocumento.setAttribute("BanEstatus", BANESTATUS_TRUE); // Estado Activo = 1
        documentoRow = documentoVO.createAndInitRow(nvpDocumento);

        // Asignación para Adjunto (sólo si content/mimeType no es null, ya que en este caso es justificación)
        // Si el idOnbase NO es null entonces estamos insertando un documento del tree
        if (((content != null) && (mimeType != null)) || (idOnbase != null)) {

            idAdjunto = seqAdjunto.getSequenceNumber();
            adjuntoVO = this.getAdjuntoVO();

            nvpAdjunto = new NameValuePairs();
            nvpAdjunto.setAttribute("IdAdjunto", idAdjunto);
            nvpAdjunto.setAttribute("Filename", fileName);
            nvpAdjunto.setAttribute("MimeType", mimeType);
            nvpAdjunto.setAttribute("Content", content);
            nvpAdjunto.setAttribute("FechaRegistro", new java.sql.Timestamp(System.currentTimeMillis()));
            nvpAdjunto.setAttribute("IdDocumento", idDocumento);
            nvpAdjunto.setAttribute("IdOnbase", idOnbase);
            adjuntoRow = adjuntoVO.createAndInitRow(nvpAdjunto);
        }

        // Asignación para DOCUMENTOS_CLIENTE

        documentosClienteVO = this.getDocumentosClienteVO();

        //No se obtiene la "Secuencia" ya que en la tabla "DOCUMENTOS_CLIENTE" existe un trigger
        //que obtiene el id de la tabla "DOCUMENTOS_CLIENTE"
        nvpDocumentos = new NameValuePairs();
        nvpDocumentos.setAttribute("IdCliente", idCliente);
        nvpDocumentos.setAttribute("IdDocumento", idDocumento);
        documentosRow = documentosClienteVO.createAndInitRow(nvpDocumentos);
        try {
            logger.warning("Se realiza primer commit");
            getDBTransaction().commit();
        } catch (Exception e) {
            logger.severe("Error en commit de adjuntarDocumentoCliente", e);
            try {
                logger.warning("Se realiza segundo commit");
                getDBTransaction().commit();
            } catch (Exception ex) {
                logger.severe("Error en segundo commit de adjuntarDocumentoCliente", ex);
            }
        }

        logger.warning("idDocumento agregado :" + idDocumento);
        logger.warning("idAdjunto agregado :" + idAdjunto);
        logger.warning("Fuera de adjuntarDocumentoCliente");
        // Retornamos el Id del nuevo documento creado
        return idDocumento.longValue();
    }

    /**
     * Container's getter for DocumentosClienteVO1.
     * @return DocumentosClienteVO1
     */
    public ViewObjectImpl getDocumentosClienteVO() {
        return (ViewObjectImpl) findViewObject("DocumentosClienteVO");
    }


    /**
     * Container's getter for TreCategoriaAccionRolVO1.
     * @return TreCategoriaAccionRolVO1
     */
    public TreCategoriaAccionRolVOImpl getTreCategoriaAccionRolVO() {
        return (TreCategoriaAccionRolVOImpl) findViewObject("TreCategoriaAccionRolVO");
    }


    /**
     * Container's getter for SeguimientoAccionVO1.
     * @return SeguimientoAccionVO1
     */
    public SeguimientoAccionVOImpl getSeguimientoAccionVO() {
        return (SeguimientoAccionVOImpl) findViewObject("SeguimientoAccionVO");
    }

    /**
     * Container's getter for FenixCierreFideicomisoAM1.
     * @return FenixCierreFideicomisoAM1
     */
    public ApplicationModuleImpl getFenixCierreFideicomisoAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixCierreFideicomisoAM");
    }

    /** solicitarIntervencionUCE"
     * Metodo que inicia el proceso de recuperacion a discrecion
     * @param  idCliente,responsableCliente
     * @since 05/08/2016
     * @by Gabriel Niño Rosales
     */
    public Map solicitarIntervencionUCE(Long idCliente, String responsableCliente) {
        logger.log(ADFLogger.TRACE, "Into solicitarIntervencionUCE , value idCliente :" + idCliente);
        Map<String, Object> resultado = new HashMap<String, Object>();
        try {
            String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);
            ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
            ProcesosAlternosPortType procesosAlternosPortType =
                procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();
            StringWriter xmlSalida = null;
            logger.log(ADFLogger.TRACE, ">HNWS" + procesosAlternosPortType.toString());
            org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente cliente =
                new org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente();
            Header header = new Header();
            ParameterType parameterType = new ParameterType();
            cliente.setIdCliente(idCliente.intValue());
            cliente.setResponsableCliente(responsableCliente);
            header.setCliente(cliente);
            parameterType.setParameterName("TIPO_INICIO");
            parameterType.setParameterValue("Discrecion");
            header.getParameterType().add(parameterType);
            xmlSalida = this.writeXMLRequest(header, header.getClass());
            logger.log(ADFLogger.TRACE, ">HNWS" + xmlSalida.toString());
            Resultado response = procesosAlternosPortType.inicioUCE(header);
            xmlSalida = this.writeXMLRequest(response, response.getClass());
            logger.log(ADFLogger.TRACE, ">HNWS" + xmlSalida.toString());
            if (null != response.getResult() && response.getResult().toString().equalsIgnoreCase("OK")) {
                logger.log(ADFLogger.WARNING,
                           "Mensaje de solicitarIntervencionUCE :" + response.getMessage().toString());
                resultado.put("resultado", Boolean.TRUE);
                resultado.put("mensaje", response.getMessage().toString());
            } else {
                logger.log(ADFLogger.WARNING,
                           "Mensaje de error de solicitarIntervencionUCE :" + response.getMessage().toString());
                resultado.put("resultado", Boolean.FALSE);
                resultado.put("mensaje", response.getMessage().toString());
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en solicitarIntervencionUCE " + e.getClass() + ":" + e.getMessage());
            resultado.put("resultado", Boolean.FALSE);
            resultado.put("mensaje", "Error en solicitarIntervencionUCE " + e.getClass() + ":" + e.getMessage());
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en solicitarIntervencionUCE " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        }
        return resultado;
    }


    public Boolean nuevaAccion(Long idOperacion, Long idCliente, Integer categoria, Integer estadoAccion,
                               Integer categoriaInicio) {
        Boolean resultado = Boolean.TRUE;
        AccionVOImpl accionVO = getAccionVO();
        try {
            AccionVORowImpl newAccion = (AccionVORowImpl) accionVO.createRow();
            SequenceImpl sqAccion = new SequenceImpl("ACCION_SEQ", getDBTransaction());
            Date fechaActual = new Date();
            newAccion.setAttribute(AccionVORowImpl.ID, sqAccion.getSequenceNumber());
            logger.warning("id categoria: " + categoria);
            logger.warning("id categoriaInicio: " + categoriaInicio);
            logger.warning("id estadoAccion: " + estadoAccion);
            logger.warning("id Operacion: " + idOperacion);
            logger.warning("Id cliente : " + idCliente);
            logger.warning("Id accion : " + newAccion.getAttribute(AccionVORowImpl.ID));
            if (null != idCliente) {
                newAccion.setAttribute(AccionVORowImpl.IDCLIENTE, idCliente);
            }
            if (null != idOperacion) {
                newAccion.setAttribute(AccionVORowImpl.IDOPERACION, idOperacion);
            }
            newAccion.setAttribute(AccionVORowImpl.IDCATEGORIA, categoriaInicio);
            newAccion.setAttribute(AccionVORowImpl.BANESTATUS, BANESTATUS_TRUE);
            newAccion.setAttribute(AccionVORowImpl.IDESTADOACCION, estadoAccion);
            if (null != categoria) {
                newAccion.setAttribute(AccionVORowImpl.IDTCACATEGORIAACCION, categoria);
            }
            logger.warning("Id categoriaFinal : " + newAccion.getAttribute("IdCategoria"));
            newAccion.setAttribute(AccionVORowImpl.FECHAREGISTRO,
                                   new oracle.jbo.domain.Timestamp(fechaActual.getTime()));
            accionVO.insertRow(newAccion);
            accionVO.setCurrentRow(newAccion);
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            e.printStackTrace();
        }
        getTreeCategoriaAccionGesVO().mostrarlista();
        return resultado;
    }

    public Boolean seleccionarAccion(Long idAccion, Integer categoriaInicio) {
        logger.warning("id accion: " + idAccion);
        logger.warning("id categoriaInicio: " + categoriaInicio);
        Boolean resultado = Boolean.FALSE;
        if (null != idAccion) {
            ViewObjectImpl accionVO = getAccionVO();
            Row rowAccion = getAccionVO().getAccionObtenido(idAccion, FenixModelConstants.ESTADO_ACCION_ELIMINADA);
            if (null != rowAccion) {
                rowAccion.setAttribute("IdCategoria", categoriaInicio);
                logger.warning("Id categoriaFinal : " + rowAccion.getAttribute("IdCategoria"));
                resultado = Boolean.TRUE;
                accionVO.setCurrentRow(rowAccion);
            }
        }
        return resultado;
    }


    public Map consultarAtributosUsuario(String login) {
        HashMap<String, Object> resultado = new HashMap<String, Object>();
        logger.warning("Entrando a consultarAtributosUsuario" + login);
        String wsdl = getWsdl(IWsdlLocation.USUARIO);

        Usuario12BndQSService usuario12BndQSService =
            IWsdlLocation.Service.getInstance(Usuario12BndQSService.class, wsdl);
        UsuarioPT usuarioPT = usuario12BndQSService.getUsuario12BndQSPort();
        ConsultarAtributosUsuarioRequestType request = new ConsultarAtributosUsuarioRequestType();
        ConsultarAtributosUsuarioResponseType response = new ConsultarAtributosUsuarioResponseType();
        ListaUsuarios usuarios = new ListaUsuarios();
        ListaGrupos grupos = new ListaGrupos();
        List<String> retorno = null;
        List<Usuario> listaUsuario = null;
        String nombreUsuario = null;
        Usuario usuarioFinal = null;
        List<String> listaGrupos = null;

        if (null != login && login.length() > 0) {

            if (login.equalsIgnoreCase("anonymous")) {
                logger.warning("Error al obtener el usuario del login se esta obteniendo un anonymous");
            }
            try {
                ListaNombres lista = new ListaNombres();
                lista.getNombreUsuario().add(login);
                request.setListaNombres(lista);
                Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_GRUPOS_USUARIOS);
                response = usuarioPT.consultarAtributosUsuario(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_GRUPOS_USUARIOS, horaInicio);
            } catch (Exception e) {
                logger.warning("Error al consultar los atributos del usuario");
                logger.log(ADFLogger.ERROR, e.getMessage());
                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception("Error al obtener lo atributos del usuario. Intentelo más tarde."));
                throw ex;
            }
            if (response.getResultado().getResult().value().equalsIgnoreCase("OK")) {
                listaUsuario = response.getListaUsuarios().getUsuario();
                if (listaUsuario.size() > 1) {
                    logger.warning("Excede mas de un registro de usuarios");
                }
                usuarioFinal = listaUsuario.get(0);
                if (null != usuarioFinal && null != usuarioFinal.getListaGrupos()) {
                    if (null != usuarioFinal.getListaGrupos().getGrupo() ||
                        usuarioFinal.getListaGrupos().getGrupo().size() > 0) {
                        listaGrupos = usuarioFinal.getListaGrupos().getGrupo();
                        resultado.put("listaGrupos", listaGrupos);
                    } else {
                        logger.warning("Error al consultar los roles del usuario");
                    }
                    if (null != usuarioFinal.getNombreCompleto() || usuarioFinal.getNombreCompleto().length() > 0) {
                        nombreUsuario = usuarioFinal.getNombreCompleto();
                        resultado.put("nombreUsuario", nombreUsuario);
                    } else {
                        logger.warning("Error al consultar el nombre completo del usuario");
                    }
                } else {
                    logger.warning("Error al consultar los datos del servicio");
                }
            }
        }
        return resultado;
    }

    public String obtenerNombreCompleto(String login) {
        logger.warning("Inicia metodo obtenerNombreCompleto");
        String respuesta = null;
        Map<String, Object> servicioLogin = null;

        try {

            if (null != login) {
                respuesta = login;
                servicioLogin = consultarAtributosUsuario(login);
                if (null != servicioLogin) {
                    if (null != servicioLogin.get("nombreUsuario")) {
                        respuesta = (String) servicioLogin.get("nombreUsuario");
                    }
                }
            }
        } catch (Exception e) {
            logger.warning("ha ocurrido un error al consultar el nombre del usuario ", e);
        }
        logger.warning("termina metodo obtenerNombre retorno: " + respuesta);
        return respuesta;
    }

    /**
     * Container's getter for TcaRolBPMVO1.
     * @return TcaRolBPMVO1
     */
    public TcaRolBPMVOImpl getTcaRolBPMVO() {
        return (TcaRolBPMVOImpl) findViewObject("TcaRolBPMVO");
    }

    /**
     * Container's getter for TcaCategoriaAccionVO1.
     * @return TcaCategoriaAccionVO1
     */
    public TcaCategoriaAccionVOImpl getTcaCategoriaAccionVO() {
        return (TcaCategoriaAccionVOImpl) findViewObject("TcaCategoriaAccionVO");
    }

    private FenixAMImpl fenixAM;


    public Long consultarSCRClienteByIdCliente(long idCliente) {
        boolean infoMora = true;
        boolean infoDeterioro = true;
        try {
            logger.log(ADFLogger.WARNING, "Into consultarClienteByIdCliente");
            fenixAM = (FenixAMImpl) this.getRootApplicationModule();
            String wsdl = fenixAM.getWsdl(IWsdlLocation.CLIENTE);
            Cliente12BndQSService cliente12BndQSService =
                IWsdlLocation.Service.getInstance(Cliente12BndQSService.class, wsdl);

            ConsultarClientesByIdClienteRequestType request = new ConsultarClientesByIdClienteRequestType();
            request.setIdCliente(idCliente);
            request.setInfoDeterioro(infoDeterioro);
            request.setInfoMora(infoMora);

            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_CLIENTE);
            ConsultarClienteResponseType response =
                cliente12BndQSService.getCliente12BndQSPort().consultarByIdCliente(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CONSULTAR_CLIENTE, horaInicio);

            Long scrCliente = null;
            if (0 < response.getCliente().size() && null != response.getCliente()) {

                Cliente cliente = response.getCliente().get(0);
                logger.log(ADFLogger.WARNING, "Into mappingConsultarClienteByIdCliente" + idCliente);

                if (null != cliente.getSCR()) {
                    Catalogo scr = cliente.getSCR();
                    if (null != scr.getId()) {
                        if (scr.getId().compareTo(0L) != 0) {
                            scrCliente = scr.getId();
                        }
                    }

                }
                logger.log(ADFLogger.WARNING,
                           "Successful mappingConsultarClienteByIdCliente-->" + idCliente + " --- SrcCliente->" +
                           scrCliente);
                return scrCliente;
            } else {
                logger.log(ADFLogger.WARNING, "Warning no se encontro el SCR del id del cliente->" + idCliente);
                scrCliente = null;
                return scrCliente;
            }
        } catch (Exception e) {
            logger.log(ADFLogger.WARNING, "Fail exception no se encontro el SCR del id del cliente->" + idCliente);
            //JboException ex = new JboException(e);
            Long scrCliente = null;
            return scrCliente;
            // throw ex;
        }
    }

    public Boolean actualizarSCRTabla(Long idCliente, String login, Boolean aprobar) {
        logger.warning("Entra en actualizarSCRTabla.");
        Boolean resultado = Boolean.TRUE;
        ViewObjectImpl operacionesClienteVo = getOperacionesClienteVO();
        Integer idSCrActual;
        Integer scrAnterior;
        Long idOperacion;
        if (operacionesClienteVo.getEstimatedRowCount() > 0) {
            Row[] rowsOperaciones = operacionesClienteVo.getAllRowsInRange();
            for (Row rowOperacion : rowsOperaciones) {
                idSCrActual = null;
                scrAnterior = null;
                idOperacion = null;
                idOperacion = (Long) rowOperacion.getAttribute("IdOperacion");
                idSCrActual = (Integer) rowOperacion.getAttribute("IdSCR");
                scrAnterior = (Integer) rowOperacion.getAttribute("IdSCRAnterior");
                logger.warning("idSCrActual : " + idSCrActual);
                logger.warning("scrAnterior : " + scrAnterior);
                if (null == idSCrActual) {
                    Long scrRes = null;
                    try {
                        scrRes = consultarSCRClienteByIdCliente(idCliente);
                    } catch (Exception ef) {
                        logger.warning("Error al obtener el scr " + ef.getMessage());
                        scrRes = null;

                    }
                    if (null != scrRes) {
                        Integer scrCliente = scrRes.intValue();
                        resultado = actualizarOperacionAnalisis(idOperacion, scrCliente, null, null, login, aprobar);
                    } else {
                        logger.warning("Error al obtener el SCT del cliente, se cierra el metodo");
                        resultado = Boolean.FALSE;
                    }

                } else {
                    if (null == scrAnterior) {
                        resultado = actualizarOperacionAnalisis(idOperacion, idSCrActual, null, null, login, aprobar);
                    } else {
                        if (scrAnterior.compareTo(idSCrActual) != 0) {
                            resultado =
                                actualizarOperacionAnalisis(idOperacion, idSCrActual, null, null, login, aprobar);
                        } else {
                            logger.warning("Los valores de SCR son iguales");
                        }
                    }

                }
                if (null == resultado || !resultado) {
                    resultado = Boolean.FALSE;
                    break;
                }
            }
        } else {
            logger.warning("No se recuperaron registros de OperacionesClienteVO.");
        }
        logger.warning("El valor de retorno es : " + resultado);
        return resultado;
    }


    /**
     * Container's getter for SeguimientoAccionLOV1.
     * @return SeguimientoAccionLOV1
     */
    public SeguimientoAccionLOVImpl getSeguimientoAccionLOV() {
        return (SeguimientoAccionLOVImpl) findViewObject("SeguimientoAccionLOV");
    }

    /**
     * Container's getter for AccionesTablaAndSeguimientoAccionVL1.
     * @return AccionesTablaAndSeguimientoAccionVL1
     */
    public ViewLinkImpl getAccionesTablaAndSeguimientoAccionVL1() {
        return (ViewLinkImpl) findViewLink("AccionesTablaAndSeguimientoAccionVL1");
    }

    /**
     * Container's getter for TcaEstadoAccionVO1.
     * @return TcaEstadoAccionVO1
     */
    public ViewObjectImpl getTcaEstadoAccionVO() {
        return (ViewObjectImpl) findViewObject("TcaEstadoAccionVO");
    }

    /**
     * Container's getter for FenixGestorDesembolsosAM1.
     * @return FenixGestorDesembolsosAM1
     */
    public ApplicationModuleImpl getFenixGestorDesembolsosAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixGestorDesembolsosAM");
    }

    /** solicitarIntervencionUCE"
     * Metodo que inicia el proceso de recuperacion a discrecion
     * @param  idCliente,responsableCliente
     * @since 05/08/2016
     * @by Gabriel Niño Rosales
     */
    public Map solicitarInicioSeguimientoCrediticio(Long idCliente, String responsableCliente, String tipoInicio) {
        logger.log(ADFLogger.TRACE, "Into solicitarIntervencionUCE , value idCliente :" + idCliente);
        Map<String, Object> resultado = new HashMap<String, Object>();
        try {
            String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);
            ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
                IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
            ProcesosAlternosPortType procesosAlternosPortType =
                procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();
            StringWriter xmlSalida = null;
            logger.log(ADFLogger.TRACE, ">HNWS" + procesosAlternosPortType.toString());
            org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente cliente =
                new org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente();
            Header header = new Header();
            ParameterType parameterType = new ParameterType();
            cliente.setIdCliente(idCliente.intValue());
            cliente.setResponsableCliente(responsableCliente);
            header.setCliente(cliente);
            parameterType.setParameterName("TIPO_INICIO");
            parameterType.setParameterValue(tipoInicio);
            header.getParameterType().add(parameterType);
            xmlSalida = this.writeXMLRequest(header, header.getClass());
            logger.log(ADFLogger.TRACE, ">HNWS" + xmlSalida.toString());
            Resultado response = procesosAlternosPortType.inicioSeguimientoCrediticio(header);
            xmlSalida = this.writeXMLRequest(response, response.getClass());
            logger.log(ADFLogger.TRACE, ">HNWS" + xmlSalida.toString());
            if (null != response.getResult() && response.getResult().toString().equalsIgnoreCase("OK")) {
                logger.log(ADFLogger.WARNING,
                           "Mensaje de solicitarIntervencionUCE :" + response.getMessage().toString());
                resultado.put("resultado", Boolean.TRUE);
                resultado.put("mensaje", response.getMessage().toString());
            } else {
                logger.log(ADFLogger.WARNING,
                           "Mensaje de error de solicitarIntervencionUCE :" + response.getMessage().toString());
                resultado.put("resultado", Boolean.FALSE);
                resultado.put("mensaje", response.getMessage().toString());
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error en solicitarIntervencionUCE " + e.getClass() + ":" + e.getMessage());
            resultado.put("resultado", Boolean.FALSE);
            resultado.put("mensaje", "Error en solicitarIntervencionUCE " + e.getClass() + ":" + e.getMessage());
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en solicitarIntervencionUCE " + e.getClass() + ":" +
                                             e.getMessage()));
            throw ex;
        }
        return resultado;
    }

    /**
     * Container's getter for CatPaisesVO1.
     * @return CatPaisesVO1
     */
    public CatPaisesVOImpl getCatPaisesVO() {
        return (CatPaisesVOImpl) findViewObject("CatPaisesVO");
    }

    /**
     * Container's getter for CatResponsablesOperacionVO1.
     * @return CatResponsablesOperacionVO1
     */
    public ViewObjectImpl getCatResponsablesOperacionVO() {
        return (ViewObjectImpl) findViewObject("CatResponsablesOperacionVO");
    }

    /**
     * Container's getter for TcaProcesoBpmVO1.
     * @return TcaProcesoBpmVO1
     */
    public ViewObjectImpl getTcaProcesoBpmVO() {
        return (ViewObjectImpl) findViewObject("TcaProcesoBpmVO");
    }

    /**
     * Container's getter for TcaEstadoOperacionVO1.
     * @return TcaEstadoOperacionVO1
     */
    public ViewObjectImpl getTcaEstadoOperacionVO() {
        return (ViewObjectImpl) findViewObject("TcaEstadoOperacionVO");
    }

    /**
     * Container's getter for FenixPrepagoAM1.
     * @return FenixPrepagoAM1
     */
    public ApplicationModuleImpl getFenixPrepagoAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixPrepagoAM");
    }

    /**
     * Container's getter for TreeCategoriaAccionGesVO1.
     * @return TreeCategoriaAccionGesVO1
     */
    public TreeCategoriaAccionGesVOImpl getTreeCategoriaAccionGesVO() {
        return (TreeCategoriaAccionGesVOImpl) findViewObject("TreeCategoriaAccionGesVO");
    }

    /**
     * Container's getter for ValidarAccionClienteVO1.
     * @return ValidarAccionClienteVO1
     */
    public ValidarAccionClienteVOImpl getValidarAccionClienteVO() {
        return (ValidarAccionClienteVOImpl) findViewObject("ValidarAccionClienteVO");
    }

    /**
     * Container's getter for DatosSupervisionVO1.
     * @return DatosSupervisionVO1
     */
    public DatosSupervisionVOImpl getDatosSupervisionVO() {
        return (DatosSupervisionVOImpl) findViewObject("DatosSupervisionVO");
    }

    /**
     * Metodo de convertir monedas sin logica especial, es el metodo convencional con logica generica para realizar
     * la conversion normal de monedas sin obedecer a logicas especiales de un determinado proceso, tarea o componente.
     * @param claveTipo
     * @param codigoA
     * @param monto
     * @return
     */
    public BigDecimal convertirMonedas(Integer claveTipo, String codigoA, BigDecimal monto) {
        logger.warning("Inicia convertirMonedas");
        logger.warning("claveTipo " + claveTipo);
        logger.warning("codigoA " + codigoA);
        logger.warning("monto " + monto);
        BigDecimal resultado = null;

        ViewObjectImpl tcaCatMoneda = getTcaTipoMonedaVO();
        tcaCatMoneda.clearCache();
        tcaCatMoneda.clearViewCriterias();
        tcaCatMoneda.setRangeSize(-1);
        tcaCatMoneda.executeQuery();
        logger.warning("cantidad de tcaCatMoneda: " + tcaCatMoneda.getEstimatedRowCount());

        String codigoDe = null;
        if (claveTipo != null) {
            Row row = tcaCatMoneda.getRow(new Key(new Object[] { claveTipo }));
            logger.warning("codigoDe: " + row.getAttribute("CodExterno") != null ? row.getAttribute("CodExterno").toString() : null);
            if (null != row.getAttribute("CodExterno")) {
                codigoDe = (String) row.getAttribute("CodExterno");
                if (codigoDe.toUpperCase().equalsIgnoreCase(codigoA.toUpperCase())) {
                    resultado = monto;
                } else {
                    try {
                        // String codigoDe=null;
                        String wsdl = getWsdl(IWsdlLocation.IMPORTES);
                        //ConversorMonedasPT12BndQSService conversorMonedasPT12BndQSService = new ConversorMonedasPT12BndQSService();
                        ConversorMonedasPT12BndQSService conversorMonedasPT12BndQSService =
                            IWsdlLocation.Service.getInstance(ConversorMonedasPT12BndQSService.class, wsdl);
                        ConversorMonedasPT conversorMonedasPT =
                            conversorMonedasPT12BndQSService.getConversorMonedasPT12BndQSPort();
                        // Add your code to call the desired methods.
                        ConvertirMonedasImportesRequestType request = new ConvertirMonedasImportesRequestType();
                        Catalogo monedaA = new Catalogo();
                        Catalogo monedaDe = new Catalogo();

                        monedaDe.setCodigoExterno(codigoDe);
                        monedaA.setCodigoExterno(codigoA);

                        ConvierteMonedas convertirMonedas = new ConvierteMonedas();
                        convertirMonedas.setMonedaA(monedaA);
                        convertirMonedas.setMonedaDe(monedaDe);
                        Double montoTotal = monto.doubleValue();
                        convertirMonedas.setMonto(montoTotal);
                        request.getConvierteMonedas().add(convertirMonedas);

                        Date horaInicio = ModelUtils.logStartWS(logger, request, "CONVERTIR MONEDAS");

                        ConvertirMonedasImportesResponseType response =
                            conversorMonedasPT.convertirMonedasImportes(request);
                        ModelUtils.logEndWS(logger, response, "CONVERTIR MONEDAS", horaInicio);

                        ConvierteMonedasImporte resultadoObtenido = response.getConvierteMonedasImporte().get(0);
                        Double convertir = resultadoObtenido.getMontoConvertido();
                        BigDecimal obtenido = new BigDecimal(convertir);
                        int decimales = 2;
                        resultado = obtenido.setScale(decimales, RoundingMode.CEILING);
                        logger.warning("Total " + obtenido.setScale(decimales, RoundingMode.CEILING));
                    } catch (Exception ex) {
                        logger.warning("Error al consultar el convertidor de monedas");
                    }
                }
            }
        }
        if (null != resultado) {
            logger.log(ADFLogger.WARNING, "Finaliza convertirMonedas. Valor de retorno :" + resultado);
        } else {
            logger.warning("Error al obtener la moneda viene nula");
        }
        return resultado;
    }

    /**
     * Se crea nuevo metodo para convertir monedas para uso de Prepago. Debido a la logica implementada en el modelo y
     * en las tareas de prepago es necesario no mezclar con la logica generica del metodo convencional de convertir monedas.
     * Se crea este metodo para resolver incidencia FNXII-5892.
     * @param claveTipo
     * @param codigoA
     * @param monto
     * @return
     */
    public BigDecimal convertirMonedasPrepago(Integer claveTipo, String codigoA, BigDecimal monto) {
        logger.warning("Inicia convertirMonedasPrepago");
        logger.warning("claveTipo " + claveTipo);
        logger.warning("codigoA " + codigoA);
        logger.warning("monto " + monto);
        BigDecimal resultado = null;

        ViewObjectImpl tcaCatMoneda = getTcaTipoMonedaVO();
        tcaCatMoneda.clearCache();
        tcaCatMoneda.clearViewCriterias();
        tcaCatMoneda.setRangeSize(-1);
        tcaCatMoneda.executeQuery();
        logger.warning("cantidad de tcaCatMoneda: " + tcaCatMoneda.getEstimatedRowCount());

        String codigoDe = null;
        if (claveTipo != null) {
            Row row = tcaCatMoneda.getRow(new Key(new Object[] { claveTipo }));
            logger.warning("codigoDe: " + row.getAttribute("CodExterno") != null ? row.getAttribute("CodExterno").toString() : null);
            if (null != (String) row.getAttribute("CodExterno")) {
                codigoDe = (String) row.getAttribute("CodExterno");

                try {
                    // String codigoDe=null;
                    String wsdl = getWsdl(IWsdlLocation.IMPORTES);
                    //ConversorMonedasPT12BndQSService conversorMonedasPT12BndQSService = new ConversorMonedasPT12BndQSService();
                    ConversorMonedasPT12BndQSService conversorMonedasPT12BndQSService =
                        IWsdlLocation.Service.getInstance(ConversorMonedasPT12BndQSService.class, wsdl);
                    ConversorMonedasPT conversorMonedasPT =
                        conversorMonedasPT12BndQSService.getConversorMonedasPT12BndQSPort();
                    // Add your code to call the desired methods.
                    ConvertirMonedasImportesRequestType request = new ConvertirMonedasImportesRequestType();
                    Catalogo monedaA = new Catalogo();
                    Catalogo monedaDe = new Catalogo();
                    //Se modifica el orden en que se setean las variables en el request codigoA y codigoDe
                    //para atender la incidencia FNXII-4847

                    //Asi funciona para PREPAGO 24/05/2017. Se crea nuevo metodo de convertir monedas solo para uso de Prepago.
                    //Deriva del error detectado en incidencia FNXII-5892.
                    monedaDe.setCodigoExterno(codigoA);
                    monedaA.setCodigoExterno(codigoDe);

                    ConvierteMonedas convertirMonedas = new ConvierteMonedas();
                    convertirMonedas.setMonedaA(monedaA);
                    convertirMonedas.setMonedaDe(monedaDe);
                    Double montoTotal = monto.doubleValue();
                    convertirMonedas.setMonto(montoTotal);
                    request.getConvierteMonedas().add(convertirMonedas);

                    Date horaInicio = ModelUtils.logStartWS(logger, request, "CONVERTIR MONEDAS");

                    ConvertirMonedasImportesResponseType response =
                        conversorMonedasPT.convertirMonedasImportes(request);
                    ModelUtils.logEndWS(logger, response, "CONVERTIR MONEDAS", horaInicio);

                    ConvierteMonedasImporte resultadoObtenido = response.getConvierteMonedasImporte().get(0);
                    Double convertir = resultadoObtenido.getMontoConvertido();
                    BigDecimal obtenido = new BigDecimal(convertir);
                    int decimales = 2;
                    resultado = obtenido.setScale(decimales, RoundingMode.CEILING);
                    logger.warning("Total " + obtenido.setScale(decimales, RoundingMode.CEILING));
                } catch (Exception ex) {
                    logger.warning("Error al consultar el convertidor de monedas");
                }

            }
        }
        logger.log(ADFLogger.WARNING, "Finaliza convertirMonedasPrepago. Valor de retorno :" + resultado);
        return resultado;
    }

    /**
     * Metodo de convertir monedas sin logica especial, es el metodo convencional con logica generica para realizar
     * la conversion normal de monedas sin obtener de sesión o del contexto algun valor.
     * @param codigoDe
     * @param codigoA
     * @param monto
     * @return
     */
    public BigDecimal convertirMonedasNew(String codigoDe, String codigoA, BigDecimal monto) {
        logger.warning("Inicia convertirMonedas");
        logger.warning("codigoDe " + codigoDe);
        logger.warning("codigoA " + codigoA);
        logger.warning("monto " + monto);
        BigDecimal resultado = null;

        if (codigoDe.toUpperCase().equalsIgnoreCase(codigoA.toUpperCase())) {
           resultado = monto;
        } else {
           try {
               // String codigoDe=null;
               String wsdl = getWsdl(IWsdlLocation.IMPORTES);
               //ConversorMonedasPT12BndQSService conversorMonedasPT12BndQSService = new ConversorMonedasPT12BndQSService();
               ConversorMonedasPT12BndQSService conversorMonedasPT12BndQSService =
                            IWsdlLocation.Service.getInstance(ConversorMonedasPT12BndQSService.class, wsdl);
               ConversorMonedasPT conversorMonedasPT =
                            conversorMonedasPT12BndQSService.getConversorMonedasPT12BndQSPort();
               // Add your code to call the desired methods.
               ConvertirMonedasImportesRequestType request = new ConvertirMonedasImportesRequestType();
               Catalogo monedaA = new Catalogo();
               Catalogo monedaDe = new Catalogo();

               monedaDe.setCodigoExterno(codigoDe);
               monedaA.setCodigoExterno(codigoA);

               ConvierteMonedas convertirMonedas = new ConvierteMonedas();
               convertirMonedas.setMonedaA(monedaA);
               convertirMonedas.setMonedaDe(monedaDe);
               Double montoTotal = monto.doubleValue();
               convertirMonedas.setMonto(montoTotal);
               request.getConvierteMonedas().add(convertirMonedas);

               Date horaInicio = ModelUtils.logStartWS(logger, request, "CONVERTIR MONEDAS");

               ConvertirMonedasImportesResponseType response =
                            conversorMonedasPT.convertirMonedasImportes(request);
               ModelUtils.logEndWS(logger, response, "CONVERTIR MONEDAS", horaInicio);

               ConvierteMonedasImporte resultadoObtenido = response.getConvierteMonedasImporte().get(0);
               Double convertir = resultadoObtenido.getMontoConvertido();
               BigDecimal obtenido = new BigDecimal(convertir);
               int decimales = 2;
               resultado = obtenido.setScale(decimales, RoundingMode.CEILING);
               logger.warning("Total " + obtenido.setScale(decimales, RoundingMode.CEILING));
           } catch (Exception ex) {
                logger.warning("Error al consultar el convertidor de monedas");
           }
        }

        if (null != resultado) {
            logger.log(ADFLogger.WARNING, "Finaliza convertirMonedas. Valor de retorno :" + resultado);
        } else {
            logger.warning("Error al obtener la moneda viene nula");
        }
        return resultado;
    }

    /**
     * Container's getter for TcaTipoMonedaVO1.
     * @return TcaTipoMonedaVO1
     */
    public TcaTipoMonedaVOImpl getTcaTipoMonedaVO() {
        return (TcaTipoMonedaVOImpl) findViewObject("TcaTipoMonedaVO");
    }

    /**
     * Container's getter for FenixGestionSegCobroAM1.
     * @return FenixGestionSegCobroAM1
     */
    public ApplicationModuleImpl getFenixGestionSegCobroAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixGestionSegCobroAM");
    }

    /**
     * Container's getter for TreComisionPrepagoVO1.
     * @return TreComisionPrepagoVO1
     */
    public TreComisionPrepagoVOImpl getTreComisionPrepagoVO() {
        return (TreComisionPrepagoVOImpl) findViewObject("TreComisionPrepagoVO");
    }

    /**
     * Container's getter for TccComisionVO1.
     * @return TccComisionVO1
     */
    public TccComisionVOImpl getTccComisionPrepagoVO() {
        return (TccComisionVOImpl) findViewObject("TccComisionPrepagoVO");
    }

    /**
     * Container's getter for TcaProcesoBpmProcesoVO1.
     * @return TcaProcesoBpmProcesoVO1
     */
    public ViewObjectImpl getTcaProcesoBpmProcesoVO() {
        return (ViewObjectImpl) findViewObject("TcaProcesoBpmProcesoVO");
    }

    /**
     * Container's getter for TreEvidenciaSolicitudVO1.
     * @return TreEvidenciaSolicitudVO1
     */
    public TreEvidenciaSolicitudVOImpl getTreEvidenciaSolicitudVO() {
        return (TreEvidenciaSolicitudVOImpl) findViewObject("TreEvidenciaSolicitudVO");
    }

    /**
     * Container's getter for TreClienteProcesoBpmVO1.
     * @return TreClienteProcesoBpmVO1
     */
    public TreClienteProcesoBpmVOImpl getTreClienteProcesoBpmVO() {
        return (TreClienteProcesoBpmVOImpl) findViewObject("TreClienteProcesoBpmVO");
    }

    /**
     * Container's getter for AsociadasVO1.
     * @return AsociadasVO1
     */
    public AsociadasVOImpl getAsociadasVO() {
        return (AsociadasVOImpl) findViewObject("AsociadasVO");
    }

    /**
     * Container's getter for ConsultarAsociadasVO1.
     * @return ConsultarAsociadasVO1
     */
    public ConsultarAsociadasVOImpl getConsultarAsociadasVO() {
        return (ConsultarAsociadasVOImpl) findViewObject("ConsultarAsociadasVO");
    }

    /**
     * Container's getter for SeguimientoCrediticioAprobacionVO1.
     * @return SeguimientoCrediticioAprobacionVO1
     */
    public SeguimientoCrediticioAprobacionVOImpl getSeguimientoCrediticioAprobacionVO() {
        return (SeguimientoCrediticioAprobacionVOImpl) findViewObject("SeguimientoCrediticioAprobacionVO");
    }

    /**
    ???? * Se crea metodo obtenerCondicionPorValidar() para obtener condiciones
    ???? * con estado por validar
    ???? * @param idOperacion
    ???? * @param idContratoDesembolso
    ???? * @since 22/05/2020
    ???? */
    public Boolean obtenerCondicionPorValidar(Long idOperacion, Long idContratoDesembolso) {
        logger.log(ADFLogger.WARNING, "Inicia CondicionDesembolsoPorValidarVO");
        
        Boolean validar = Boolean.FALSE; 
        
        CondicionDesembolsoPorValidarVOImpl condicionDesembolsoPorValidarVOImpl = this.getCondicionDesembolsoPorValidarVO();
        condicionDesembolsoPorValidarVOImpl.setpID_Contrato_Desembolso(idContratoDesembolso);  
        logger.log(ADFLogger.WARNING, "NU idOperacion" + idOperacion);  
        logger.log(ADFLogger.WARNING, "idContratoDesembolso: " + idContratoDesembolso);  
        condicionDesembolsoPorValidarVOImpl.executeQuery();
        
        logger.warning("Cantidad de registros encontrados: " + condicionDesembolsoPorValidarVOImpl.getEstimatedRowCount());
        logger.log(ADFLogger.WARNING, "Finaliza CondicionDesembolsoPorValidarVO");
        return validar;
		
    }
    /**
    ???? * Se crea metodo obtenerCondicionPorValidar() para obtener condiciones
    ???? * con estado por validar
    ???? * @param idOperacion 
    ???? * @since 22/05/2020
    ???? */
    public Boolean obtenerCondicionPorValidar(Long idOperacion) {
        logger.log(ADFLogger.WARNING, "Inicia CondicionGeneralPorValidarVO");
        Boolean validar = Boolean.FALSE; 
        
        CondicionGeneralPorValidarVOImpl condicionGeneralPorValidarVOImpl = this.getCondicionGeneralPorValidarVO();
        CondicionIncumplimientoVOImpl condicionIncumplimientoVOImpl = this.getCondicionIncumplimientoVO();
        condicionIncumplimientoVOImpl.executeQuery();
        condicionGeneralPorValidarVOImpl.setpIdOperacion(idOperacion);  
        logger.log(ADFLogger.WARNING, "idOperacion" + idOperacion);    
        condicionGeneralPorValidarVOImpl.executeQuery();
        
        logger.warning("Cantidad de registros encontrados: " + condicionGeneralPorValidarVOImpl.getEstimatedRowCount());

        try {
            if (condicionGeneralPorValidarVOImpl.getEstimatedRowCount() > 0) {
                validar = Boolean.TRUE;
                RowSetIterator rowsCondicion = condicionGeneralPorValidarVOImpl.createRowSetIterator(null);
                List<CondicionPorValidarVORowImpl> rows = new ArrayList<>(); 
                rowsCondicion.reset();

                while (rowsCondicion.hasNext()) 
                {
                    CondicionGeneralPorValidarVORowImpl rowCondicion = (CondicionGeneralPorValidarVORowImpl) rowsCondicion.next(); 
                    if (null != rowCondicion) 
                    {  
                        logger.warning("IdCondicion: " + rowCondicion.getId());
                        logger.warning("ID Tipo Fecha Inicio - " + rowCondicion.getIdTcaTipoFechaInicio());
                        logger.warning("DescripcionTipo Fecha Inicio - " + rowCondicion.getDescTcaTipoFechaInicio()); 
                        logger.warning("Nombre: " + rowCondicion.getNombre());
                        logger.warning("Fecha Vigencia: " + rowCondicion.getFechaVigencia());
                        logger.warning("Fecha Inicio: " + rowCondicion.getFechaInicio());
                        logger.warning("Fecha Final: " + rowCondicion.getFechaFinal());
                        logger.warning("Fecha Validacion: " + rowCondicion.getFechaValidacion()); 
                        logger.warning("En proceso: " + rowCondicion.getEnProceso());
                        logger.warning("Plazo: " + rowCondicion.getPlazo());
                        logger.warning("Frecuencia Plazo: " + rowCondicion.getIdTcaFrecuenciaPlazo());
                        logger.warning("Control Condicion: " + rowCondicion.getIdTcaControlCondicion()); 
                            
                        if( rowCondicion.getEnProceso().compareTo(FenixModelConstants.CONDICION_FALSO) == 0 )
                        {
                            //Se inserta la condicion encontrada y se guarda su bitacora
                            logger.warning("La condicion aun no esta validada, se agregara a condicionIncumplimientoVOImpl."); 
                            condicionIncumplimientoVOImpl.insertaRowIncumplimiento(rowCondicion);
                        } 
                        else
                        {
                            logger.warning("La condicion no cumple los criterios de validacion de idTipoFechaInicio y enProceso, NO se agregara a condicionIncumplimientoVOImpl.");     
                        } 
                    } 
                    else 
                    {
                        logger.log(ADFLogger.WARNING, "El row es nulo.");
                    }
                }
 
                rowsCondicion.closeRowSetIterator(); 
               
                if (condicionIncumplimientoVOImpl.getEstimatedRowCount() > 0) {
                    logger.warning("Condiciones agregadas: " + condicionIncumplimientoVOImpl.getEstimatedRowCount());
                } else {
                    validar = Boolean.FALSE;
                }
            } else {
                validar = Boolean.FALSE;
            }
        } catch (Exception e) {
            logger.log(ADFLogger.WARNING, "Error en obtenerCondicionPorValidar." + e.getClass() + "." + e.getMessage());
        }
        logger.log(ADFLogger.WARNING, "Finaliza CondicionGeneralPorValidarVO");
        return validar;
    }

    private Boolean validaFechaVigencia(Timestamp fechaVigencia, Timestamp fechaNuevoInicio, Timestamp fechaFinal) {
        logger.warning("Entra en validaFechaVigencia");
        logger.warning("fechaNuevoInicio: " + fechaNuevoInicio);

        Timestamp fechaActual = new java.sql.Timestamp(System.currentTimeMillis());
        Boolean validaCondicion = Boolean.FALSE;

        logger.warning("fechaActual: " + fechaActual);

        try {
            if (null != fechaNuevoInicio) {
                if (fechaNuevoInicio.compareTo(fechaActual) < 0) {

                    Calendar fechaValidacionCalendar = GregorianCalendar.getInstance();
                    fechaValidacionCalendar.setTime(fechaVigencia);
                    fechaValidacionCalendar.set(Calendar.HOUR_OF_DAY, 0);
                    fechaValidacionCalendar.set(Calendar.MINUTE, 0);
                    fechaValidacionCalendar.set(Calendar.SECOND, 0);
                    fechaVigencia = new Timestamp(fechaValidacionCalendar.getTimeInMillis());

                    logger.warning("fechaVigencia: " + fechaVigencia);

                    if (fechaFinal != null) {

                        fechaValidacionCalendar = GregorianCalendar.getInstance();
                        fechaValidacionCalendar.setTime(fechaFinal);
                        fechaValidacionCalendar.set(Calendar.HOUR_OF_DAY, 0);
                        fechaValidacionCalendar.set(Calendar.MINUTE, 0);
                        fechaValidacionCalendar.set(Calendar.SECOND, 0);
                        fechaFinal = new Timestamp(fechaValidacionCalendar.getTimeInMillis());

                        logger.warning("fechaFinal: " + fechaFinal);

                        if (fechaVigencia.compareTo(fechaNuevoInicio) >= 0 ||
                            fechaVigencia.compareTo(fechaFinal) >= 0) {
                            logger.log(ADFLogger.WARNING, "La condicion se ha cumplido");
                        } else {
                            logger.log(ADFLogger.WARNING, "La fecha vigencia es menor a plazo y a la fecha final :");
                            validaCondicion = Boolean.TRUE;
                        }
                    } else {
                        if (fechaVigencia.compareTo(fechaActual) >= 0) {
                            logger.log(ADFLogger.WARNING, "La condicion se ha cumplido");
                        } else {
                            logger.log(ADFLogger.WARNING, "La fecha vigencia es menor a plazo y a la fecha final :");
                            validaCondicion = Boolean.TRUE;
                        }
                    }
                } else {
                    logger.log(ADFLogger.WARNING, "El plazo es mayor a la fecha actual :");
                    validaCondicion = Boolean.TRUE;
                }
            } else {
                logger.log(ADFLogger.WARNING, "El plazo es nulo :" + fechaNuevoInicio);
            }
        } catch (Exception e) {
            logger.warning("Error en validaFechaVigencia.", e);
        }
        logger.warning("La condicion se ha cumplido." + validaCondicion);
        return validaCondicion;
    }

    //Queda pendiente de verificar si se utiliza.
    public void compararFechaValidacion(CondicionPorValidarVORowImpl rowCondicion, Timestamp fechaAprobacion,
                                        Timestamp fechaFirmaContrato, Timestamp fechaEfectiva) {
        logger.log(ADFLogger.WARNING, "Entra en compararFechaValidacion");

        Timestamp fechaActual = new java.sql.Timestamp(System.currentTimeMillis());
        CondicionIncumplimientoVOImpl condicionIncumplimientoVOImpl = this.getCondicionIncumplimientoVO();
        Timestamp fechaNuevoInicio = null;

        if (null != rowCondicion) {
            try {
                if (rowCondicion.getIdTcaTipoFechaInicio().compareTo(FenixModelConstants.CONDICION_TIPO_FECHA_INICIO_FECHA_ESPECIFICA) ==
                    0) {
                    if (null != rowCondicion.getFechaInicio()) {
                        if (null != rowCondicion.getPlazo() && null != rowCondicion.getIdTcaFrecuenciaPlazo()) {
                            fechaNuevoInicio = rowCondicion.getFechaInicio();
                            Calendar c1 = GregorianCalendar.getInstance();
                            c1.setTimeInMillis(fechaNuevoInicio.getTime());
                            switch (rowCondicion.getIdTcaFrecuenciaPlazo()) {
                            case 1:
                                c1.add(Calendar.DATE, rowCondicion.getPlazo());
                                fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                break;
                            case 2:
                                c1.add(Calendar.MONTH, rowCondicion.getPlazo());
                                fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                break;
                            case 3:
                                c1.add(Calendar.YEAR, rowCondicion.getPlazo());
                                fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                break;
                            default:
                                break;
                            }
                        }
                    } else {
                        logger.log(ADFLogger.WARNING, "No existe fecha de Inicio :" + rowCondicion.getFechaInicio());
                    }
                } else {
                    if (rowCondicion.getIdTcaTipoFechaInicio().compareTo(FenixModelConstants.CONDICION_TIPO_FECHA_INICIO_APROBACION) ==
                        0) {
                        logger.warning("Condicion Tipo Fecha Inicio - Aprobacion.");

                        //Valida Fecha de aprobacion de la operacion (T602)
                        if (fechaAprobacion != null) {

                            //Se valida Fecha de Aprobacion, Plazo y Frecuencia de Plazo para calcular nueva Fecha inicio y verificar si la Condicion se ha cumplido.
                            if (null != rowCondicion.getPlazo() && null != rowCondicion.getIdTcaFrecuenciaPlazo()) {
                                fechaNuevoInicio = fechaAprobacion;
                                Calendar c1 = GregorianCalendar.getInstance();
                                c1.setTimeInMillis(fechaNuevoInicio.getTime());
                                switch (rowCondicion.getIdTcaFrecuenciaPlazo()) {
                                case 1:
                                    c1.add(Calendar.DATE, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                case 2:
                                    c1.add(Calendar.MONTH, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                case 3:
                                    c1.add(Calendar.YEAR, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                default:
                                    break;
                                }
                            } else {
                                logger.log(ADFLogger.WARNING,
                                           "No se cuenta con un Plazo o una Frecuencia de Plazo para la Condicion: " +
                                           rowCondicion.getId());
                                logger.log(ADFLogger.WARNING, "Plazo: " + rowCondicion.getPlazo());
                                logger.log(ADFLogger.WARNING,
                                           "Frecuencia de Plazo: " + rowCondicion.getIdTcaFrecuenciaPlazo());
                            }
                        } else {
                            logger.warning("No se encontro Fecha de Aprobacion.");
                        }
                    }
                    if (rowCondicion.getIdTcaTipoFechaInicio().compareTo(FenixModelConstants.CONDICION_TIPO_FECHA_INICIO_ESCRITURACION) ==
                        0) {
                        logger.warning("Condicion Tipo Fecha Inicio - Escrituracion.");

                        if (fechaFirmaContrato != null) {

                            //Se valida Fecha de Firma de Contrato, Plazo y Frecuencia de Plazo para calcular nueva Fecha inicio y verificar si la Condicion se ha cumplido.
                            if (null != rowCondicion.getPlazo() && null != rowCondicion.getIdTcaFrecuenciaPlazo()) {
                                fechaNuevoInicio = fechaFirmaContrato;
                                Calendar c1 = GregorianCalendar.getInstance();
                                c1.setTimeInMillis(fechaNuevoInicio.getTime());
                                switch (rowCondicion.getIdTcaFrecuenciaPlazo()) {
                                case 1:
                                    c1.add(Calendar.DATE, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                case 2:
                                    c1.add(Calendar.MONTH, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                case 3:
                                    c1.add(Calendar.YEAR, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                default:
                                    break;
                                }
                            } else {
                                logger.log(ADFLogger.WARNING,
                                           "No se cuenta con un Plazo o una Frecuencia de Plazo para la Condicion: " +
                                           rowCondicion.getId());
                                logger.log(ADFLogger.WARNING, "Plazo: " + rowCondicion.getPlazo());
                                logger.log(ADFLogger.WARNING,
                                           "Frecuencia de Plazo: " + rowCondicion.getIdTcaFrecuenciaPlazo());
                            }
                        } else {
                            logger.warning("No se encontro Fecha de firma de contrato.");
                        }
                    }
                    if (rowCondicion.getIdTcaTipoFechaInicio().compareTo(FenixModelConstants.CONDICION_TIPO_FECHA_INICIO_PRIMER_DESEMBOLSO) ==
                        0) {
                        logger.warning("Condicion Tipo Fecha Inicio - primer desembolso.");

                        if (fechaEfectiva != null) {

                            //Se valida Fecha fechaEfectiva, Plazo y Frecuencia de Plazo para calcular nueva Fecha inicio y verificar si la Condicion se ha cumplido.
                            if (null != rowCondicion.getPlazo() && null != rowCondicion.getIdTcaFrecuenciaPlazo()) {
                                fechaNuevoInicio = fechaEfectiva;
                                Calendar c1 = GregorianCalendar.getInstance();
                                c1.setTimeInMillis(fechaNuevoInicio.getTime());
                                switch (rowCondicion.getIdTcaFrecuenciaPlazo()) {
                                case 1:
                                    c1.add(Calendar.DATE, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                case 2:
                                    c1.add(Calendar.MONTH, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                case 3:
                                    c1.add(Calendar.YEAR, rowCondicion.getPlazo());
                                    fechaNuevoInicio = new Timestamp(c1.getTimeInMillis());
                                    break;
                                default:
                                    break;
                                }
                            } else {
                                logger.log(ADFLogger.WARNING,
                                           "No se cuenta con un Plazo o una Frecuencia de Plazo para la Condicion: " +
                                           rowCondicion.getId());
                                logger.log(ADFLogger.WARNING, "Plazo: " + rowCondicion.getPlazo());
                                logger.log(ADFLogger.WARNING,
                                           "Frecuencia de Plazo: " + rowCondicion.getIdTcaFrecuenciaPlazo());
                            }
                        } else {
                            logger.warning("No se encontro Fecha de firma de contrato.");
                        }
                    }
                }
            } catch (Exception e) {
                logger.log(ADFLogger.WARNING, "Error al obtener el plazo :" + e.getClass() + "." + e);
            }
            try {
                if (fechaNuevoInicio != null) {
                    if (null != rowCondicion.getFechaValidacion()) {
                        logger.log(ADFLogger.WARNING,
                                   "Fecha Validacion en calendario :" + rowCondicion.getFechaValidacion());
                        if (null != fechaNuevoInicio) {
                            if (fechaNuevoInicio.compareTo(fechaActual) < 0) {
                                if (rowCondicion.getFechaValidacion().compareTo(fechaNuevoInicio) > 0) {
                                    if (rowCondicion.getFechaValidacion().compareTo(fechaActual) > 0) {
                                        logger.log(ADFLogger.WARNING, "La condicion se ha cumplido");
                                    } else {
                                        logger.log(ADFLogger.WARNING,
                                                   "La fecha Validacion es menor a la fecha actual.");
                                        condicionIncumplimientoVOImpl.insertaRowIncumplimiento(rowCondicion);
                                    }
                                } else {
                                    logger.log(ADFLogger.WARNING,
                                               "La fecha Validacion es menor al plazo en calendarrio.");
                                    condicionIncumplimientoVOImpl.insertaRowIncumplimiento(rowCondicion);
                                }
                            } else {
                                logger.log(ADFLogger.WARNING, "La plazo es menor a la fecha actual.");
                                condicionIncumplimientoVOImpl.insertaRowIncumplimiento(rowCondicion);
                            }
                        } else {
                            logger.log(ADFLogger.WARNING, "El plazo es nulo :" + fechaNuevoInicio);
                        }
                    } else {
                        logger.log(ADFLogger.WARNING, "La condicion no cuenta con una fecha de validacion.");
                        condicionIncumplimientoVOImpl.insertaRowIncumplimiento(rowCondicion);
                    }
                } else {
                    logger.warning("La fechaNuevoInicio es nula.");
                }
            } catch (Exception e) {
                logger.log(ADFLogger.WARNING, "Error al insertar el row :" + e.getClass() + "." + e);
            }
        } else {
            logger.log(ADFLogger.WARNING, "El registro es nulo.");
        }
    }

    private HashMap<String, Object> validaFechaInicioActual(Timestamp fechaValidacion, Timestamp fechaInicio,
                                                            Integer plazo, Integer IdTcaTipoFrecuenciaPlazo) {
        logger.warning("Entra en validaFechaInicioActual");
        HashMap<String, Object> map = new HashMap<String, Object>();
        try {
            switch (IdTcaTipoFrecuenciaPlazo) {
            case 1:
                map = calcularFechaInicioEnDias(fechaValidacion, fechaInicio, plazo);
                break;
            case 2:
                map = calcularFechaInicioEnMeses(fechaValidacion, fechaInicio, plazo);
                break;
            case 3:
                map = calcularFechaInicioEnAnios(fechaValidacion, fechaInicio, plazo);
                break;
            default:
                logger.warning("El tipo de plazo no es el correcto.");
                break;
            }
        } catch (Exception e) {
            logger.warning("Error en validaFechaInicioActual.", e);
        }
        return map;
    }

    private HashMap<String, Object> calcularFechaInicioEnDias(Timestamp fechaValidacion, Timestamp fechaInicio,
                                                              Integer plazo) {
        logger.warning("Entra en calcularFechaInicioEnDias");

        HashMap<String, Object> map = new HashMap<String, Object>();

        Timestamp fechaActual = null;
        Timestamp fechaNuevoInicio = null;
        Timestamp fechaFin = null;
        Timestamp fechaNuevaValidacion = null;

        Integer numPlazo = null;
        Integer numPlazoExacto = null;
        int dias;
        Boolean condicionValidada = Boolean.FALSE;

        Calendar fechaInicioCalendar = GregorianCalendar.getInstance();
        Calendar fechaFinCalendar = GregorianCalendar.getInstance();
        Calendar fechaValidacionCalendar = GregorianCalendar.getInstance();

        try {
            fechaActual = new java.sql.Timestamp(System.currentTimeMillis());

            dias = (int) ((fechaActual.getTime() - fechaInicio.getTime()) / 86400000);
            logger.warning("Hay " + dias + " dias de diferencia");
            numPlazo = dias / plazo;
            logger.warning("dias de plazo : " + numPlazo);
            numPlazoExacto = numPlazo * plazo;

            if (null != fechaInicio) {
                fechaInicioCalendar.setTime(fechaInicio);
                fechaInicioCalendar.add(Calendar.DATE, numPlazoExacto);
                fechaInicioCalendar.set(Calendar.HOUR_OF_DAY, 0);
                fechaInicioCalendar.set(Calendar.MINUTE, 0);
                fechaInicioCalendar.set(Calendar.SECOND, 0);
                fechaNuevoInicio = new Timestamp(fechaInicioCalendar.getTimeInMillis());
            } else {
                logger.warning("La fecha inicio se recibio nula.");
            }

            if (null != fechaNuevoInicio) {
                fechaFinCalendar.setTime(fechaNuevoInicio);
                fechaFinCalendar.add(Calendar.DATE, plazo - 1);
                fechaFinCalendar.set(Calendar.HOUR_OF_DAY, 0);
                fechaFinCalendar.set(Calendar.MINUTE, 0);
                fechaFinCalendar.set(Calendar.SECOND, 0);
                fechaFin = new Timestamp(fechaFinCalendar.getTimeInMillis());
            } else {
                logger.warning("La fechaNuevoInicio se recibio nula.");
            }

            if (null != fechaValidacion) {
                fechaValidacionCalendar.setTime(fechaValidacion);
                fechaValidacionCalendar.set(Calendar.HOUR_OF_DAY, 0);
                fechaValidacionCalendar.set(Calendar.MINUTE, 0);
                fechaValidacionCalendar.set(Calendar.SECOND, 0);
                fechaNuevaValidacion = new Timestamp(fechaValidacionCalendar.getTimeInMillis());
            } else {
                logger.warning("La fechaValidacion se recibio nula.");
            }

            logger.warning("Fecha inicio plazo actual." + fechaNuevoInicio);
            logger.warning("Fecha fin plazo actual." + fechaFin);
            logger.warning("Fecha validacion plazo actual." + fechaNuevaValidacion);

            if (null != fechaValidacion) {
                if (null != fechaNuevoInicio && null != fechaFin) {
                    if (fechaNuevaValidacion.compareTo(fechaNuevoInicio) >= 0 &&
                        fechaNuevaValidacion.compareTo(fechaFin) <= 0) {
                        logger.warning("La condicion se encuentra validada en el plazo actual, No se debe mostrar.");
                        condicionValidada = Boolean.FALSE;
                    } else {
                        logger.warning("La condicion No se encuentra validada en el plazo actual, se debe mostrar.");
                        condicionValidada = Boolean.TRUE;
                    }
                }
            } else {
                logger.warning("No existe la fecha de validacion, la condicion se debe mostrar.");
                condicionValidada = Boolean.TRUE;
            }

            map.put("fechaNuevoInicio", fechaNuevoInicio);

            //Se valida fecha inicio para iniciar el Cumplimiento de la condicion
            if (fechaInicio.compareTo(fechaActual) == 1) {
                logger.warning("La Fecha inicio de la condicion es mayor a la fecha actual, no se mostrara.");
                condicionValidada = Boolean.FALSE;
            }

            map.put("condicionValidada", condicionValidada);

        } catch (Exception e) {
            logger.warning("Error en calcularFechaInicioEnDias", e);
        }
        return map;
    }

    private HashMap<String, Object> calcularFechaInicioEnMeses(Timestamp fechaValidacion, Timestamp fechaInicio,
                                                               Integer plazo) {
        logger.warning("Entra en calcularFechaInicioEnMeses");

        HashMap<String, Object> map = new HashMap<String, Object>();

        Timestamp fechaActual = null;
        Timestamp fechaNuevoInicio = null;
        Timestamp fechaFin = null;
        Timestamp fechaAux = null;
        Timestamp fechaNuevaValidacion = null;

        Boolean condicionValidada = Boolean.FALSE;

        Integer ultimoMesActual = null;
        Integer inicioMesActual = null;
        Integer difMes = null;
        Integer divMes = null;
        Integer numMes = null;

        Calendar fechaActualCalendar = GregorianCalendar.getInstance();
        Calendar fechaInicioCalendar = GregorianCalendar.getInstance();
        Calendar fechaInicioCalendarAux = GregorianCalendar.getInstance();
        Calendar fechaFinCalendar = GregorianCalendar.getInstance();
        Calendar fechaValidacionCalendar = GregorianCalendar.getInstance();

        try {
            fechaActual = new java.sql.Timestamp(System.currentTimeMillis());
            if (null != fechaActual) {
                fechaActualCalendar.setTime(fechaActual);
                ultimoMesActual = fechaActualCalendar.get(Calendar.MONTH);
                logger.warning("Ultimo mes actual : " + ultimoMesActual);
            } else {
                logger.warning("la fecha actual se recibio nula.");
            }

            if (null != fechaInicio) {
                fechaInicioCalendar.setTime(fechaInicio);
                //inicioMesActual = fechaInicioCalendar.get(Calendar.MONTH);
                fechaInicioCalendar.add(Calendar.MONTH, plazo);
                fechaAux = new Timestamp(fechaInicioCalendar.getTimeInMillis());
                logger.warning("fecha auxiliar : " + fechaAux);
                //logger.warning("Inicio mes actual : " + inicioMesActual);
            } else {
                logger.warning("La fecha inicio se recibio nula.");
            }
            /*
            if(null != ultimoMesActual && null != inicioMesActual){
                difMes = ultimoMesActual - inicioMesActual;
                divMes = difMes / plazo;
                numMes = divMes * plazo;
                logger.warning("Numero de meses diferencia excatos : " + numMes);

                fechaInicioCalendar.add(Calendar.MONTH, numMes);
                fechaAux = new Timestamp(fechaInicioCalendar.getTimeInMillis());
                logger.warning("fecha auxiliar : " + fechaAux);
            }else{
                logger.warning("El numero del mes regreso nulo, no se realizan las operaciones.");
            }
            */
            if (null != fechaAux && null != fechaActual) {
                if (fechaAux.compareTo(fechaActual) > 0) {
                    fechaFin = fechaAux;
                    fechaFinCalendar.setTime(fechaFin);
                    fechaFinCalendar.add(Calendar.MONTH, -plazo);
                    fechaFinCalendar.set(Calendar.HOUR_OF_DAY, 0);
                    fechaFinCalendar.set(Calendar.MINUTE, 0);
                    fechaFinCalendar.set(Calendar.SECOND, 0);
                    fechaNuevoInicio = new Timestamp(fechaFinCalendar.getTimeInMillis());
                } else {
                    fechaNuevoInicio = fechaAux;
                    fechaInicioCalendarAux.setTime(fechaNuevoInicio);
                    fechaInicioCalendarAux.add(Calendar.MONTH, plazo);
                    fechaInicioCalendarAux.set(Calendar.HOUR_OF_DAY, 0);
                    fechaInicioCalendarAux.set(Calendar.MINUTE, 0);
                    fechaInicioCalendarAux.set(Calendar.SECOND, 0);
                    fechaFin = new Timestamp(fechaInicioCalendarAux.getTimeInMillis());
                }
            } else {
                logger.warning("La fecha calculada inicio o la fecha actual son nulas.");
            }

            if (null != fechaValidacion) {
                fechaValidacionCalendar.setTime(fechaValidacion);
                fechaValidacionCalendar.set(Calendar.HOUR_OF_DAY, 0);
                fechaValidacionCalendar.set(Calendar.MINUTE, 0);
                fechaValidacionCalendar.set(Calendar.SECOND, 0);
                fechaNuevaValidacion = new Timestamp(fechaValidacionCalendar.getTimeInMillis());
            } else {
                logger.warning("La fecha de validacion es nula");
            }

            logger.warning("Fecha inicio plazo actual." + fechaNuevoInicio);
            logger.warning("Fecha fin plazo actual." + fechaFin);
            logger.warning("Fecha validacion plazo actual." + fechaNuevaValidacion);
            if (null != fechaValidacion) {
                if (null != fechaValidacion && null != fechaNuevoInicio && null != fechaFin) {
                    if (fechaNuevaValidacion.compareTo(fechaNuevoInicio) >= 0 &&
                        fechaNuevaValidacion.compareTo(fechaFin) <= 0) {
                        logger.warning("La condicion se encuentra validada en el plazo actual, No se debe mostrar..");
                    } else {
                        logger.warning("La condicion No se encuentra validada en el plazo actual, se debe mostrar..");
                        condicionValidada = Boolean.TRUE;
                    }
                } else {
                    logger.warning("Las fechas son nulas, no se realiza la validacion de la condicion.");
                }
            } else {
                logger.warning("No existe la fecha de validacion, la condicion se debe mostrar.");
                condicionValidada = Boolean.TRUE;
            }

            map.put("fechaNuevoInicio", fechaNuevoInicio);

            //Se valida fecha inicio para iniciar el Cumplimiento de la condicion
            if (fechaInicio.compareTo(fechaActual) == 1) {
                logger.warning("La Fecha inicio de la condicion es mayor a la fecha actual, no se mostrara.");
                condicionValidada = Boolean.FALSE;
            }

            map.put("condicionValidada", condicionValidada);

        } catch (Exception e) {
            logger.warning("Error en calcularFechaInicioEnMeses.", e);
        }
        return map;
    }

    private HashMap<String, Object> calcularFechaInicioEnAnios(Timestamp fechaValidacion, Timestamp fechaInicio,
                                                               Integer plazo) {
        logger.warning("Entra en calcularFechaInicioEnAnios");

        HashMap<String, Object> map = new HashMap<String, Object>();

        Timestamp fechaActual = null;
        Timestamp fechaNuevoInicio = null;
        Timestamp fechaFin = null;
        Timestamp fechaAux = null;
        Timestamp fechaNuevaValidacion = null;

        Boolean condicionValidada = Boolean.FALSE;

        Integer ultimoAnioActual = null;
        Integer inicioAnio = null;
        Integer difAnio = null;
        Integer divAnio = null;
        Integer numAnio = null;

        Calendar fechaActualCalendar = GregorianCalendar.getInstance();
        Calendar fechaFinCalendar = GregorianCalendar.getInstance();
        Calendar fechaInicioCalendarAux = GregorianCalendar.getInstance();
        Calendar fechaInicioCalendar = GregorianCalendar.getInstance();
        Calendar fechaValidacionCalendar = GregorianCalendar.getInstance();

        try {
            fechaActual = new java.sql.Timestamp(System.currentTimeMillis());

            if (null != fechaActual) {
                fechaActualCalendar.setTime(fechaActual);
                ultimoAnioActual = fechaActualCalendar.get(Calendar.YEAR);
                logger.warning("Ultimo mes actual : " + ultimoAnioActual);
            } else {
                logger.warning("Error al obtener la fecha actual");
            }

            if (null != fechaInicio) {
                fechaInicioCalendar.setTime(fechaInicio);
                inicioAnio = fechaInicioCalendar.get(Calendar.YEAR);
                logger.warning("Inicio mes actual : " + inicioAnio);
            } else {
                logger.warning("Error la fecha de validacion es nula.");
            }

            if (null != ultimoAnioActual && null != inicioAnio) {
                difAnio = ultimoAnioActual - inicioAnio;
                logger.warning("Diferencia Anios : " + difAnio);
                divAnio = difAnio / plazo;
                numAnio = divAnio * plazo;
                logger.warning("Numero de meses diferencia excatos : " + numAnio);

                fechaInicioCalendar.add(Calendar.YEAR, numAnio);
                fechaAux = new Timestamp(fechaInicioCalendar.getTimeInMillis());
                logger.warning("fecha auxiliar : " + fechaAux);
            } else {
                logger.warning("Error al obtener el numero del año, no se realizan las operaciones.");
            }

            if (null != fechaAux && null != fechaActual) {
                if (fechaAux.compareTo(fechaActual) > 0) {
                    fechaFin = fechaAux;
                    fechaFinCalendar.setTime(fechaFin);
                    fechaFinCalendar.add(Calendar.YEAR, -plazo);
                    fechaFinCalendar.set(Calendar.HOUR_OF_DAY, 0);
                    fechaFinCalendar.set(Calendar.MINUTE, 0);
                    fechaFinCalendar.set(Calendar.SECOND, 0);
                    fechaNuevoInicio = new Timestamp(fechaFinCalendar.getTimeInMillis());
                } else {
                    fechaNuevoInicio = fechaAux;
                    fechaInicioCalendarAux.setTime(fechaNuevoInicio);
                    fechaInicioCalendarAux.add(Calendar.YEAR, plazo);
                    fechaInicioCalendarAux.set(Calendar.HOUR_OF_DAY, 0);
                    fechaInicioCalendarAux.set(Calendar.MINUTE, 0);
                    fechaInicioCalendarAux.set(Calendar.SECOND, 0);
                    fechaFin = new Timestamp(fechaInicioCalendarAux.getTimeInMillis());
                }
            } else {
                logger.warning("Error al buscar las fechas.");
            }

            if (null != fechaValidacion) {
                fechaValidacionCalendar.setTime(fechaValidacion);
                fechaValidacionCalendar.set(Calendar.HOUR_OF_DAY, 0);
                fechaValidacionCalendar.set(Calendar.MINUTE, 0);
                fechaValidacionCalendar.set(Calendar.SECOND, 0);
                fechaNuevaValidacion = new Timestamp(fechaValidacionCalendar.getTimeInMillis());
            } else {
                logger.warning("Error, la fecha de validacion es nula.");
            }

            logger.warning("Fecha inicio plazo actual." + fechaNuevoInicio);
            logger.warning("Fecha fin plazo actual." + fechaFin);
            logger.warning("Fecha validacion plazo actual." + fechaNuevaValidacion);

            if (null != fechaValidacion) {
                if (null != fechaNuevoInicio && null != fechaFin) {
                    if (fechaNuevaValidacion.compareTo(fechaNuevoInicio) >= 0 &&
                        fechaNuevaValidacion.compareTo(fechaFin) <= 0) {
                        logger.warning("La condicion se encuentra validada en el plazo actual, No se debe mostrar..");
                    } else {
                        logger.warning("La condicion No se encuentra validada en el plazo actual, se debe mostrar..");
                        condicionValidada = Boolean.TRUE;
                    }
                } else {
                    logger.warning("Las fechas son nulas, no se realiza la validacion de la condicion.");
                }
            } else {
                logger.warning("No existe la fecha de validacion, la condicion se debe mostrar.");
                condicionValidada = Boolean.TRUE;
            }

            map.put("fechaNuevoInicio", fechaNuevoInicio);

            //Se valida fecha inicio para iniciar el Cumplimiento de la condicion
            if (fechaInicio.compareTo(fechaActual) == 1) {
                logger.warning("La Fecha inicio de la condicion es mayor a la fecha actual, no se mostrara.");
                condicionValidada = Boolean.FALSE;
            }

            map.put("condicionValidada", condicionValidada);

        } catch (Exception e) {
            logger.warning("Error en calcularFechaInicioEnAnios.", e);
        }
        return map;
    }

    public Timestamp consultarFechaAprobacion(Long idOperacion) {
        logger.warning("Inside consultarFechaAprobacion.");
        Timestamp fechaAprobacion = null;

        ConsultarFechaAprobacionVOImpl consultarFechaAprobacionVOImpl = this.getConsultarFechaAprobacionVO();

        fechaAprobacion = consultarFechaAprobacionVOImpl.obtenerFechaAprobacion(idOperacion);

        logger.warning("fechaAprobacion: " + fechaAprobacion);
        return fechaAprobacion;
    }

    public Timestamp consultarFechaFirmaContrato(Long idOperacion) {
        logger.warning("Inside consultarFechaFirmaContrato.");
        Timestamp fechaFirmaContrato = null;

        ConsultarFechaFirmaContratoVOImpl consultarFechaFirmaContratoVOImpl = this.getConsultarFechaFirmaContratoVO();

        fechaFirmaContrato = consultarFechaFirmaContratoVOImpl.obtenerFechaFirmaContrato(idOperacion);

        logger.warning("fechaFirmaContrato: " + fechaFirmaContrato);
        return fechaFirmaContrato;
    }

    public Timestamp consultarFechaEfectiva(Long idOperacion) {
        logger.warning("Inside consultarFechaEfectiva.");
        Timestamp fechaEfectiva = null;
        try {
            ConsultarFechaEfectivaVOImpl consultarFechaEfectivaVOImpl = this.getConsultarFechaEfectivaVO();

            fechaEfectiva = consultarFechaEfectivaVOImpl.obtenerFechaEfectiva(idOperacion);

            logger.warning("fechaEfectiva: " + fechaEfectiva);
        } catch (Exception e) {
            logger.warning("Error en consultarFechaEfectiva.", e);
        }
        return fechaEfectiva;
    }

    public Map consultarDocumentosCliente(Long idCliente, Integer idTareaBpm, Long numeroSerieDocumento,
                                          Boolean esNumSerie, String instanciaProceso) {
        logger.warning("Entra en consultarDocumentosCliente");
        Documento12BndQSService documento12BndQSService = null;
        DocumentoPT documentoPT = null;
        ConsultaDocumentosRequestType request = null;
        ConsultaDocumentosResponseType response = null;
        String wsdl = null;
        HashMap<String, Object> responseMap = new HashMap<>();
        try {
            wsdl = getWsdl(IWsdlLocation.DOCUMENTO);
            documento12BndQSService = IWsdlLocation.Service.getInstance(Documento12BndQSService.class, wsdl);
            documentoPT = documento12BndQSService.getDocumento12BndQSPort();
            request = new ConsultaDocumentosRequestType();
            logger.warning("idCliente : " + idCliente);
            logger.warning("idTareaBpm : " + idTareaBpm);
            logger.warning("esNumSerie : " + esNumSerie);
            logger.warning("numeroSerieDocumento : " + numeroSerieDocumento);
            logger.warning("instanciaProceso :" + instanciaProceso);

            request.setIdCliente(idCliente);
            request.setIdTarea(idTareaBpm);
            request.setInstanciaProceso(instanciaProceso);
            //Agrega al request "numeroSerieDocumento" si la bandera "esConsultarPorNumeroSerieDocumento" viene "TRUE"
            if (null != esNumSerie && esNumSerie) {
                if (null != numeroSerieDocumento) {
                    request.setIdFlujoNegocio(numeroSerieDocumento);
                } else {
                    logger.warning("El numero de serie del documento es nulo");
                }
            } else {
                logger.warning("No se agrega el numero de serie.");
            }

            Date horaInicio = ModelUtils.logStartWS(logger, request, "Consultar Documentos");
            response = documentoPT.consultarDocumentos(request); // bloque try Por si se cae el servicio
            //ModelUtils.logEndWSDocs(logger, response, "Consultar Documentos", horaInicio);

            responseMap.put("response", response);
        } catch (Exception e) {
            logger.warning("Error al ejecutar el servicio.", e);
        }
        logger.warning("Response : " + responseMap);
        return responseMap;
    }

    /**
     * Container's getter for CondicionPorValidarVO1.
     * @return CondicionPorValidarVO1
     */
    public CondicionPorValidarVOImpl getCondicionPorValidarVO() {
        return (CondicionPorValidarVOImpl) findViewObject("CondicionPorValidarVO");
    }

 
    
    /**
     * Container's getter for TcaSCRVO1.
     * @return TcaSCRVO1
     */
    public TcaSCRVOImpl getTcaSCRVO() {
        return (TcaSCRVOImpl) findViewObject("TcaSCRVO");
    }

    /**
     * Container's getter for CondicionIncumplimientoVO1.
     * @return CondicionIncumplimientoVO1
     */
    public CondicionIncumplimientoVOImpl getCondicionIncumplimientoVO() {
        return (CondicionIncumplimientoVOImpl) findViewObject("CondicionIncumplimientoVO");
    }

    /**
     * Container's getter for TcaReglaProcesoVO1.
     * @return TcaReglaProcesoVO1
     */
    public ViewObjectImpl getTcaReglaProcesoVO() {
        return (ViewObjectImpl) findViewObject("TcaReglaProcesoVO");

    }

    /**
     * Container's getter for TreExcepcionSolicitudVO1.
     * @return TreExcepcionSolicitudVO1
     */
    public TreExcepcionSolicitudVOImpl getTreExcepcionSolicitudVO() {
        return (TreExcepcionSolicitudVOImpl) findViewObject("TreExcepcionSolicitudVO");
    }


    /**
     * Container's getter for ConsultarReglasNoCumplidasDesembolsoExcepcionVO1.
     * @return ConsultarReglasNoCumplidasDesembolsoExcepcionVO1
     */
    public ConsultarReglasNoCumplidasDesembolsoExcepcionVOImpl getConsultarReglasNoCumplidasDesembolsoExcepcionVO() {
        return (ConsultarReglasNoCumplidasDesembolsoExcepcionVOImpl) findViewObject("ConsultarReglasNoCumplidasDesembolsoExcepcionVO");
    }

    /**
     * Container's getter for ConsultarLineasReglasNoCumplidasDesembolsoExcepcionVO1.
     * @return ConsultarLineasReglasNoCumplidasDesembolsoExcepcionVO1
     */
    public ViewObjectImpl getConsultarLineasReglasNoCumplidasDesembolsoExcepcionVO() {
        return (ViewObjectImpl) findViewObject("ConsultarLineasReglasNoCumplidasDesembolsoExcepcionVO");
    }

    /**
     * Container's getter for SolicitudLineaReglasNoCumplidasDesembolsoExcepcionVL1.
     * @return SolicitudLineaReglasNoCumplidasDesembolsoExcepcionVL1
     */
    public ViewLinkImpl getSolicitudLineaReglasNoCumplidasDesembolsoExcepcionVL() {
        return (ViewLinkImpl) findViewLink("SolicitudLineaReglasNoCumplidasDesembolsoExcepcionVL");
    }

    /**
     * Container's getter for ConsultarContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVO1.
     * @return ConsultarContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVO1
     */
    public ConsultarContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVOImpl getConsultarContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVO() {
        return (ConsultarContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVOImpl) findViewObject("ConsultarContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVO");
    }

    /**
     * Container's getter for LineaContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVL1.
     * @return LineaContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVL1
     */
    public ViewLinkImpl getLineaContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVL() {
        return (ViewLinkImpl) findViewLink("LineaContratoDesembolsoReglasNoCumplidasDesembolsoExcepcionVL");
    }

    /**
    ???? * Se crea metodo para insertar las condiciones seleccionadas en el boton
    ???? * Iniciar Cumplimiento de condiciones
    ???? * @param
    ???? * @since 02/11/2016
    ???? */
    public Boolean agregarCondiciones(Long idOperacion, String responsableOperacion, Row[] SeleccionCondiciones) {
        logger.log(ADFLogger.WARNING, "INTO agregarCondiciones.");

        //En este metodo se sustituye el idEvento por Agrupador
        HashMap<String, Object> respuestaServicio = null;
        CondicionesDemandaRequestType request = null;
        CondicionesDemandaResponseType response = null;
        Long idCondicion = null;
        Boolean isValidaCondicion = Boolean.FALSE;
        OperacionBasicType operacion = new OperacionBasicType();
        TransaccionCondicion transaccionCondicion = new TransaccionCondicion();
        logger.log(ADFLogger.WARNING, "numero de Rows." + SeleccionCondiciones.length);

        try {
            if (null != SeleccionCondiciones && SeleccionCondiciones.length > 0) {
                for (Row row : SeleccionCondiciones) {
                    Condicion condicion = new Condicion();
                    idCondicion = (Long) row.getAttribute("Id");
                    condicion.setIdCondicion(idCondicion);
                    transaccionCondicion.getCondicion().add(condicion);

                    logger.warning("IdCondicion :" + idCondicion);
                }
            } else {
                logger.log(ADFLogger.WARNING, "La lista del row es nulo.");
            }
            if (null != idOperacion && null != responsableOperacion) {
                operacion.setIdOperacion(idOperacion);
                operacion.setResponsable(responsableOperacion);
                transaccionCondicion.setOperacion(operacion);
            } else {
                logger.log(ADFLogger.WARNING,
                           "La operacion o el responsableOperacion son nulos." + idOperacion + ". :" +
                           responsableOperacion);
            }
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR,
                       "Error al llenar el objeto TransaccionCondicion." + e.getClass() + "." + e.getMessage());
        }

        if (null != transaccionCondicion) {
            try {
                FenixAMImpl fenixAM = (FenixAMImpl) this.getRootApplicationModule();
                String wsdl = fenixAM.getWsdl(IWsdlLocation.CONDICION);

                Condicion12BndQSService condicion12BndQSService =
                    IWsdlLocation.Service.getInstance(Condicion12BndQSService.class, wsdl);
                CondicionPT condicionPT = condicion12BndQSService.getCondicion12BndQSPort();
                request = new CondicionesDemandaRequestType();
                request.setCondicionesDemanda(transaccionCondicion);

                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.AGREGAR_CONDICIONES_POR_VALIDAR);
                response = condicionPT.condicionesDemanda(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.AGREGAR_CONDICIONES_POR_VALIDAR, horaInicio);
                if (null != response.getResultado().getResult() &&
                    response.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                    logger.log(ADFLogger.WARNING, "respuesta del servicio." + response.getResultado().getResult());
                    logger.log(ADFLogger.WARNING, "respuesta del servicio." + response.getResultado().getMessage());
                } else {
                    logger.log(ADFLogger.WARNING, "Error en  request." + response.getResultado().getResult());
                }
                // Regresamos respuesta del servicio
                respuestaServicio = new HashMap<String, Object>();
                respuestaServicio.put("response", response);
                isValidaCondicion = Boolean.TRUE;

            } catch (Exception e) {
                logger.log(ADFLogger.ERROR, e.getMessage());
                isValidaCondicion = Boolean.FALSE;
                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception("Error al agregar las condiciones e iniciar el proceso."));
                throw ex;
            }
        }

        return isValidaCondicion;
    }

    /**
     * Container's getter for SolicitudExcepcionVO1.
     * @return SolicitudExcepcionVO1
     */
    public SolicitudExcepcionVOImpl getSolicitudExcepcionVO() {
        return (SolicitudExcepcionVOImpl) findViewObject("SolicitudExcepcionVO");
    }

    /**
     * Valida atributos de solicitud de aprobacion por cliente y mapear al objeto de tipo "SolicitudAprobacion"
     * @param params contiene parametros del ViewController. Tipo <class>java.util.Map</class>
     *        Definicion de Mapa de parametros:
     *          Clave Mapa        -> Tipo de Dato
     *          tipoReunion       -> java.lang.Integer
     *          idCliente         -> java.lang.Long
     *          loginUsuario      -> java.lang.String
     *          tipoSolicitud     -> java.lang.Integer
     *          fecha             -> java.util.Date
     *          hora              -> java.sql.Timestamp
     *          lugar             -> java.lang.String
     *          fechaApertura     -> java.util.Date
     *          fechaTermino      -> java.util.Date
     *          idNivelAprobacion -> java.lang.Integer
     *          instanciaSeguimiento -> java.lang.String
     * @return objeto de tipo "SolicitudAprobacion"
     */
    public SolicitudAprobacion mapeoSolicitudAprobacion(Map params) {
        logger.entering(FenixAMImpl.class.getName(), "mapeoSolicitudAprobacion", new Object[] { params });
        SolicitudAprobacion solicitudAprobacion = null;
        //variable de solicitu de aprobacion por cliente
        Integer tipoReunion = null;
        Long idCliente = null;
        String loginUsuario = null;
        Integer tipoSolicitud = null;
        Date fecha = null;
        oracle.jbo.domain.Timestamp hora = null;
        String lugar = null;
        Date fechaApertura = null;
        Date fechaTermino = null;
        Integer nivelAprobacion = null;
        String instanciaSeguimiento = null;
        //Obtiene los parametros de ViewController
        if (null != params.get("tipoReunion")) {
            try {
                tipoReunion = (Integer) params.get("tipoReunion");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor tipoReunion en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("idCliente")) {
            try {
                idCliente = (Long) params.get("idCliente");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor idCliente en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("loginUsuario")) {
            try {
                loginUsuario = (String) params.get("loginUsuario");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor loginUsuario en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("tipoSolicitud")) {
            try {
                tipoSolicitud = (Integer) params.get("tipoSolicitud");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor tipoSolicitud en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("fecha")) {
            try {
                fecha = (Date) params.get("fecha");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor fecha en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("hora")) {
            try {
                hora = (oracle.jbo.domain.Timestamp) params.get("hora");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor hora en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("lugar")) {
            try {
                lugar = (String) params.get("lugar");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor lugar en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("fechaApertura")) {
            try {
                fechaApertura = (Date) params.get("fechaApertura");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor fechaApertura en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("fechaTermino")) {
            try {
                fechaTermino = (Date) params.get("fechaTermino");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor fechaTermino en mapeoSolicitudAprobacion : " + e);
            }
        }

        if (null != params.get("idNivelAprobacion")) {
            try {
                nivelAprobacion = (Integer) params.get("idNivelAprobacion");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor idNivelAprobacion en mapeoSolicitudAprobacion : " + e);
            }
        }

        if(null != params.get("instanciaSeguimiento")){
            try{
                instanciaSeguimiento = (String) params.get("instanciaSeguimiento");
            }catch(Exception e){
                logger.warning("Error al recuperar el valor instanciaSeguimiento en mapeoSolicitudAprobacion : " + e);
            }
        }
        
        if(null != params.get("instanciaSeguimiento")){
            try{
                instanciaSeguimiento = (String) params.get("instanciaSeguimiento");
            }catch(Exception e){
                logger.warning("Error al recuperar el valor instanciaSeguimiento en mapeoSolicitudAprobacion : " + e);
            }
        }
        
        //Valida atributos de la solicitud de aprobacion del cliente
        if (idCliente == null || loginUsuario == null || tipoSolicitud == null || nivelAprobacion == null) {
            logger.severe("Error los campos minimos requeridos son null");
            return solicitudAprobacion;
        } else {
            if (tipoReunion != null && tipoReunion.equals(TIPO_REUNION_PRESENCIAL) &&
                nivelAprobacion.equals(NIVEL_APROBACION_COMITE_CREDITO_INT) &&
                (fecha == null || hora == null || lugar == null)) {
                logger.severe("Error faltan valores en los campos minimos para reunion presencial");
                return solicitudAprobacion;
            } else {
                if (tipoReunion != null && tipoReunion.equals(TIPO_REUNION_VIRTUAL) &&
                    nivelAprobacion.equals(NIVEL_APROBACION_COMITE_CREDITO_INT) &&
                    (fechaApertura == null || fechaTermino == null)) {
                    logger.severe("Error faltan valores en los campos minimos para reunion virtual");
                    return solicitudAprobacion;
                } else {

                    if (nivelAprobacion.equals(NIVEL_APROBACION_PRESIDENCIA_INT) &&
                        (fechaApertura == null || fechaTermino == null)) {
                        logger.severe("Error faltan valores en los campos minimos para solicitud nivel presidencia");
                        return solicitudAprobacion;
                    }
                }
            }
        }

        solicitudAprobacion = new SolicitudAprobacion();

        //Objetos comunes
        Catalogo catalogo = null;
        XMLGregorianCalendar gregorianCalendarXML = null;
        GregorianCalendar gregorianCalendar = null;

        //Estatus de creacion
        solicitudAprobacion.setEstado(true);

        //Agrega Usuario
        solicitudAprobacion.setLoginUsuario(loginUsuario);

        //IdCliente
        ClienteBasicType clienteBasicType = new ClienteBasicType();
        clienteBasicType.setIdCliente(idCliente);
        solicitudAprobacion.setCliente(clienteBasicType);

        //Catalgo de Nivel de Aprobacion
        catalogo = new Catalogo();
        catalogo.setId(nivelAprobacion.longValue());
        solicitudAprobacion.setNivelAprobacion(catalogo);
        solicitudAprobacion.setInstanciaProcesoSeguimiento(instanciaSeguimiento);
        
        if(nivelAprobacion.equals(NIVEL_APROBACION_COMITE_CREDITO_INT)){
            
            if(tipoReunion.equals(TIPO_REUNION_PRESENCIAL)){
                //Tipo Reunion Presencial
                solicitudAprobacion.setEsReunionVirtual(false);

                try {
                    gregorianCalendar = new GregorianCalendar();
                    gregorianCalendar.setTime(fecha);
                    gregorianCalendarXML = DatatypeFactory.newInstance().newXMLGregorianCalendar(gregorianCalendar);
                } catch (DatatypeConfigurationException e) {
                    logger.severe("Error al convertir Fecha Inicio", e);
                }
                //Asigna fecha de inicio
                solicitudAprobacion.setFechaInicio(gregorianCalendarXML);

                try {
                    gregorianCalendar = new GregorianCalendar();
                    gregorianCalendar.setTimeInMillis(hora.getTime());
                    gregorianCalendarXML = DatatypeFactory.newInstance().newXMLGregorianCalendar(gregorianCalendar);
                } catch (DatatypeConfigurationException e) {
                    logger.severe("Error al convertir Hora", e);
                }
                //Asigna Hora de la Reunion
                solicitudAprobacion.setHoraReunion(gregorianCalendarXML);

                //Asigna Lugar de la Reunion
                solicitudAprobacion.setLugar(lugar);
            }

            if (tipoReunion.equals(TIPO_REUNION_VIRTUAL)) {
                //Tipo Reunion Virtual
                solicitudAprobacion.setEsReunionVirtual(true);

                try {
                    gregorianCalendar = new GregorianCalendar();
                    gregorianCalendar.setTime(fechaApertura);
                    gregorianCalendarXML = DatatypeFactory.newInstance().newXMLGregorianCalendar(gregorianCalendar);
                } catch (DatatypeConfigurationException e) {
                    logger.severe("Error al convertir Fecha Inicio", e);
                }
                //Asigna fecha apertura
                solicitudAprobacion.setFechaInicio(gregorianCalendarXML);

                try {
                    gregorianCalendar = new GregorianCalendar();
                    gregorianCalendar.setTime(fechaTermino);
                    gregorianCalendarXML = DatatypeFactory.newInstance().newXMLGregorianCalendar(gregorianCalendar);
                } catch (DatatypeConfigurationException e) {
                    logger.severe("Error al convertir Fecha", e);
                }
                //Asigna fecha de termino
                solicitudAprobacion.setFechaTermino(gregorianCalendarXML);
            }
        } else {
            if (nivelAprobacion.equals(NIVEL_APROBACION_PRESIDENCIA_INT)) {

                solicitudAprobacion.setEsReunionVirtual(true);

                try {
                    gregorianCalendar = new GregorianCalendar();
                    gregorianCalendar.setTime(fechaApertura);
                    gregorianCalendarXML = DatatypeFactory.newInstance().newXMLGregorianCalendar(gregorianCalendar);
                } catch (DatatypeConfigurationException e) {
                    logger.severe("Error al convertir Fecha Inicio", e);
                }
                //Asigna fecha apertura
                solicitudAprobacion.setFechaInicio(gregorianCalendarXML);

                try {
                    gregorianCalendar = new GregorianCalendar();
                    gregorianCalendar.setTime(fechaTermino);
                    gregorianCalendarXML = DatatypeFactory.newInstance().newXMLGregorianCalendar(gregorianCalendar);
                } catch (DatatypeConfigurationException e) {
                    logger.severe("Error al convertir Fecha", e);
                }
                //Asigna fecha de cierre
                solicitudAprobacion.setFechaTermino(gregorianCalendarXML);
            }
        }

        //Asigna tipo de solicitud
        catalogo = new Catalogo();
        catalogo.setId(tipoSolicitud.longValue());
        solicitudAprobacion.setTipoSolicitud(catalogo);

        logger.exiting(FenixAMImpl.class.getName(), "mapeoSolicitudAprobacion", new Object[] { solicitudAprobacion });

        return solicitudAprobacion;
    }

    /**
     * Valida atributos de solicitud de aprobacion por cliente y crea la solicitud de aprobacion por cliente.
     * Invocando el Servicio Web "CrearSolicitudAprobacion" del WSDL "/Entidad/SolicitudAprobacionService/v1.0?WSDL"
     * @param params contiene parametros del ViewController. Tipo <class>java.util.Map</class>
     *        Definicion de Mapa de parametros:
     *          Clave Mapa        -> Tipo de Dato
     *          tipoReunion       -> java.lang.Integer
     *          idCliente         -> java.lang.Long
     *          loginUsuario      -> java.lang.String
     *          tipoSolicitud     -> java.lang.Integer
     *          fecha             -> java.util.Date
     *          hora              -> java.sql.Timestamp
     *          lugar             -> java.lang.String
     *          fechaApertura     -> java.util.Date
     *          fechaTermino      -> java.util.Date
     *          idNivelAprobacion -> java.lang.Integer
     *          instanciaSeguimiento -> java.lang.String
     * @return devuelve valor booleano, true si se creo la solicitud y false si el servicio web regresa algun tipo de error.
     */
    public boolean crearSolicitudAprobacionCliente(Map params) {

        logger.entering(FenixAMImpl.class.getName(), "crearSolicitudAprobacionCliente", new Object[] { params });

        boolean exito = false;
        //Si params es null, regresar false
        if (params == null) {
            //retornar boolean "exito"
            return exito;
        }

        List<SolicitudAprobacion> solicitudAprobacionLista = null;
        List<MiembroReunion> comiteCreditoLista = null;
        List<MiembroReunion> notificacionLista = null;
        List<MiembroReunion> equipoTrabajoLista = null;

        Number numIdSol = null;
        boolean newSolAprob = false;

        SolicitudAprobacion solicitudAprobacion = mapeoSolicitudAprobacion(params);


        logger.warning("Nodo de Solicitud de Aprobacion: " + solicitudAprobacion);
        Integer nivelAprobacion = null;
        String  loginUsuario = null;
        String instanciaSeguimiento = null;
        
        if(null != params.get("idNivelAprobacion")){
            try{
                nivelAprobacion = (Integer) params.get("idNivelAprobacion");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor idNivelAprobacion en crearSolicitudAprobacionCliente : " +
                               e);
            }
        }

        if (null != params.get("loginUsuario")) {
            try {
                loginUsuario = (String) params.get("loginUsuario");
            } catch (Exception e) {
                logger.warning("Error al recuperar el valor loginUsuario en mapeoSolicitudAprobacion : " + e);
            }
        }
        
        if(null != params.get("instanciaSeguimiento")){
            try{
                instanciaSeguimiento = (String) params.get("instanciaSeguimiento");
            }catch(Exception e){
                logger.warning("Error al recuperar el valor instanciaSeguimiento en mapeoSolicitudAprobacion : " + e);
            }
        }
        
        if(null != params.get("instanciaSeguimiento")){
            try{
                instanciaSeguimiento = (String) params.get("instanciaSeguimiento");
            }catch(Exception e){
                logger.warning("Error al recuperar el valor instanciaSeguimiento en mapeoSolicitudAprobacion : " + e);
            }
        }
        
        if(solicitudAprobacion != null){
            solicitudAprobacionLista = new ArrayList<SolicitudAprobacion>();
            solicitudAprobacionLista.add(solicitudAprobacion);
        } else {
            logger.severe("Error no se obtuvo Nodo de Solicitud de Aprobacion");
            throw new JboException("Error no se obtuvo Nodo de Solicitud de Aprobacion");
        }

        comiteCreditoLista = getMiembrosAprobacionComiteCreditoVO1().getSolAprobComiteCredWSNodeList();
        notificacionLista = getMiembrosAprobacionNotificacionVO1().getSolAprobNotificacionWSNodeList(nivelAprobacion);
        equipoTrabajoLista = getMiembrosAprobacionEquipoTrabajoVO1().getSolAprobEquipoTrabajoWSNodeList();

        //Instancia del Cliente WS
        SolicitudAprobacionPT solicitudAprobacionPT = getInstanciaSolicitudAprobacionWS();

        CrearSolicitudAprobacionRequestType request = null;
        CrearSolicitudAprobacionResponseType response = null;

        request = new CrearSolicitudAprobacionRequestType();

        if (solicitudAprobacionLista != null) {
            logger.warning("Cantidad de Elementos de Solicitud Aprobacion: " + solicitudAprobacionLista.size());
            request.getSolicitudAprobacion().addAll(solicitudAprobacionLista);
        } else {
            logger.severe("No se genero elementos de datos generales de solicitud de aprobacion");
        }
        if (comiteCreditoLista != null) {
            logger.warning("Cantidad de Elementos de Comite de Credito: " + comiteCreditoLista.size());
            request.getListadoEmitirVoto().addAll(comiteCreditoLista);
        } else {
            logger.severe("No se genero elementos de Comite de Credito");
        }
        if (notificacionLista != null) {
            logger.warning("Cantidad de Elementos de Notificacion: " + notificacionLista.size());
            request.getListadoConNotificacion().addAll(notificacionLista);
        }
        if (equipoTrabajoLista != null) {
            logger.warning("Cantidad de Elementos de Equipo de Trabajo: " + equipoTrabajoLista.size());
            request.getListadoEquipoTrabajo().addAll(equipoTrabajoLista);
        }

        if (request != null && solicitudAprobacion != null) {

            try {
                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CREAR_SOLICITUD_APROBACION_WS);
                response = solicitudAprobacionPT.crearSolicitudAprobacion(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_CREAR_SOLICITUD_APROBACION_WS,
                                    horaInicio);

                if (response.getResultado() != null) {
                    SuccessType success = response.getResultado().getResult();
                    String msg = response.getResultado().getMessage();
                    Error error = response.getResultado().getError();
                    if (error != null && !"".equals(error.getErrorCode())) {
                        msg =
                            "Error Solicitud de aprobacion no creada. Mensaje resultado de WS: Code: " +
                            error.getErrorCode() + " - Desc: " + error.getErrorDescription() + " - Type: " +
                            error.getErrorType();

                        logger.severe(msg);
                        throw new JboException(msg);
                    } else {
                        if (success != null && !"".equals(success.value())) {

                            if (success.value().toUpperCase().contains("ERROR")) {
                                exito = false;
                                logger.severe("El servicio devuelve error. Mensaje de WS: " + msg);
                                throw new JboException(msg);
                            } else {
                                exito = true;
                                logger.warning("Solicitud de Aprobacion creada con exito. Mensaje de WS: " + msg);
                            }
                        } else {
                            exito = false;
                            logger.severe("Objecto success no recibido");
                            throw new JboException("Resultado del servicio no recibido");
                        }

                        //Obtiene Id de Solicitud de aprobacion creada
                        String[] values = msg.split("Id:");
                        String strIdSol = null;

                        if (values != null && values.length > 0) {
                            strIdSol = values[values.length - 1];
                            if (strIdSol != null) {
                                strIdSol.trim();
                                try {
                                    numIdSol = new Number(strIdSol);
                                } catch (Exception e) {
                                    logger.severe("Error al convertir Id de solicitud creada a Number", e);
                                }
                            }
                        }

                        if (numIdSol == null) {
                            throw new JboException("Id de solicitud no obtenido");
                        } else {
                            //Asigna Id de Solicitud al registro actual de la VO
                            getSolicitudAprobacionVO1().buscarSolicitudAprobacionPorIdVC(numIdSol);
                            if (getSolicitudAprobacionVO1().getEstimatedRowCount() > 0) {
                                logger.warning("Solicitud de Aprobacion creada");
                                newSolAprob = true;
                            } else {
                                logger.warning("Solicitud de Aprobacion no creada");
                                newSolAprob = false;
                            }
                        }
                    }
                }
            } catch (Exception e) {
                logger.severe("Error al consumir operacion Crear Solicitud", e);
                throw new JboException(e);
            }
        }

        if (nivelAprobacion != null) {
            if (nivelAprobacion.equals(NIVEL_APROBACION_PRESIDENCIA_INT) && newSolAprob) {

                Number idTipoAccion = null;
                String numActa = null;
                String numAcuerdo = null;
                String acuerdo = null;

                idTipoAccion = (Number) params.get("idAccion");
                if (idTipoAccion == null) {
                    logger.severe("Id de Accion a Seguir no recibido");
                }

                logger.warning("Ejecuta la creacion de Decision de Presidente. Id Solicitud: " + numIdSol.toString() +
                               ". Id Accion a Seguir: " + String.valueOf(idTipoAccion));

                exito = guardarConsolidarDecision(numIdSol, idTipoAccion, numActa, numAcuerdo, acuerdo, loginUsuario);

                if (exito) {
                    logger.warning("Decision de Presidente Creado correctamente");
                } else {
                    logger.severe("Error al crear la Decision de Presidente para la nueva Solicitud");
                }
            }
        }

        logger.exiting(FenixAMImpl.class.getName(), "crearSolicitudAprobacionCliente", exito);
        return exito;
    }

    public Boolean inicializarLoteImplementacionFinConcurso(Long idOperacion) {
        logger.warning("Entra en inicializarLoteImplementacionFinConcurso");
        LoteFinConcursoVOImpl loteFinConcursoVOImpl = this.getLoteFinConcursoVO();
        LoteImplementacionFinConcursoVOImpl loteImplementacionFinConcursoVOImpl =
            this.getLoteImplementacionFinConcursoVO();
        //limpiar cache de la VO para no repetir registros en la tabla.
        loteImplementacionFinConcursoVOImpl.executeQuery();
        Boolean existeLote = Boolean.FALSE;
        Integer contador = 0;

        try {
            loteFinConcursoVOImpl.setpIdOperacion(idOperacion);
            loteFinConcursoVOImpl.executeQuery();
            RowSetIterator rowsLoteVo = loteFinConcursoVOImpl.createRowSetIterator(null);
            rowsLoteVo.reset();
            while (rowsLoteVo.hasNext()) {
                LoteFinConcursoVORowImpl rowLote = (LoteFinConcursoVORowImpl) rowsLoteVo.next();
                if (null != rowLote) {
                    if (null == rowLote.getAttribute("EnProceso")) {
                        logger.warning("Se inserta el lote para iniciar proceso.");
                        loteImplementacionFinConcursoVOImpl.insertaRowLoteImplementacion(rowLote);
                        contador++;
                    } else {
                        logger.warning("El lote esta en un proceso activo o finalizado.");
                    }

                } else {
                    logger.warning("El row es nulo.");
                }
            }
            rowsLoteVo.closeRowSetIterator();
            if (contador > 0) {
                logger.warning("Existen lotes");
                existeLote = Boolean.TRUE;
            } else {
                logger.warning("No existen lotes");
                existeLote = Boolean.FALSE;
            }
        } catch (Exception e) {
            logger.warning("Error en inicializarLoteImplementacionFinConcurso." + e.getClass() + "." + e);
        }
        logger.warning("Existen lotes para finalizar :" + existeLote);
        return existeLote;
    }

    public void consultarVotosReunion() {
        try {
            UsuarioReunionAprobacionLOVImpl usuarioReunionVO = getUsuarioReunionAprobacionLOV();
            RowSetIterator rowsUsuarioReunion = usuarioReunionVO.createRowSetIterator(null);
            List<UsuarioReunionAprobacionLOVRowImpl> listaIdUsuarioReunion = new ArrayList<>();

            while (rowsUsuarioReunion.hasNext()) {
                UsuarioReunionAprobacionLOVRowImpl rowUsuario =
                    (UsuarioReunionAprobacionLOVRowImpl) rowsUsuarioReunion.next();
                listaIdUsuarioReunion.add(rowUsuario);
            }
            rowsUsuarioReunion.closeRowSetIterator();

            logger.fine("Consulta los votos de la reunion");
            getVotoActualAprobLOV1().obtenerVotosReunion(listaIdUsuarioReunion);
        } catch (Exception e) {
            logger.severe("Error al inicializar los votos de la reunion");
        }
    }
    /*
    public Boolean inicioGestionCobro(Integer idTarea, Integer idCliente){
        logger.warning("Inside inicioGestionCobro.");
        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Boolean resultado = Boolean.FALSE;
        Resultado response = null;

        try {
            String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

            ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
            ProcesosPrincipalesPortType procesosPrincipalesPortType =
                procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
            } catch (Exception ex) {
                logger.warning("inicioGestionCobro", ex);
            }

            Header header = new Header();

            org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

            org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente cliente =
                new org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente();

            org.bcie.xmlns.objetoproceso.comun.tarea.v1.Tarea tarea =
                new org.bcie.xmlns.objetoproceso.comun.tarea.v1.Tarea();

            StringWriter xmlEntrada = null;
            StringWriter xmlSalida = null;

            tarea.setCodigoTarea(idTarea);
            cliente.setIdCliente(idCliente);

            header.setCliente(cliente);
            header.setTarea(tarea);

            xmlEntrada = this.writeXMLRequest(header, header.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - inicioGestionCobro -" + xmlEntrada.toString());

            response = procesosPrincipalesPortType.inicioGestionCobro(header);
            xmlSalida = this.writeXMLRequest(response, response.getClass());

            logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioGestionCobro -" + xmlSalida.toString());
            if (null != response.getError() ||
                (response.getResult() != null && response.getResult().value() == "ERROR")) {
                String mensajeError = "";
                String detalleError = "";

                if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                    mensajeError = response.getMessage();
                }

                if (null != response.getError().getErrorDescription() &&
                    response.getError().getErrorDescription().trim().length() > 0) {
                    detalleError = response.getError().getErrorDescription();
                }

                    existeError = Boolean.TRUE;
                    msgError =
                        "El cliente: " + idCliente + ". Mensaje: " + mensajeError + ". Detalle " + detalleError;
                    resultado = Boolean.FALSE;
            } else {
                resultado = Boolean.TRUE;
            }
        } catch (Exception e) {
            resultado = Boolean.FALSE;
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioGestionCobro.", e);

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioGestionCobro " + e.getClass() + ":" + e.getMessage()));
            throw ex;
        }finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }
        return resultado;
    }
    */
    public Map inicioGestionCobro(Integer idTarea, Integer idCliente, String responsableCliente, String inicio,
                                  Boolean automatico) {
        logger.warning("Inside inicioGestionCobro.");

        Boolean existeError = Boolean.FALSE;
        String msgError = "";
        Resultado response = null;
        Map map = new HashMap<String, Object>();

        try {
            String wsdl = getWsdl(IWsdlLocation.PROCESOS_PRINCIPALES);

            ProcesosPrincipalesBindingQSService procesosPrincipalesBindingQSService =
                IWsdlLocation.Service.getInstance(ProcesosPrincipalesBindingQSService.class, wsdl);
            ProcesosPrincipalesPortType procesosPrincipalesPortType =
                procesosPrincipalesBindingQSService.getProcesosPrincipalesBindingQSPort();

            try {
                logger.log(ADFLogger.WARNING, ">HNWS" + procesosPrincipalesPortType.toString());
            } catch (Exception ex) {
                logger.warning("inicioGestionCobro", ex);
            }

            Header header = new Header();

            ParameterType parameterType = new ParameterType();
            parameterType.setParameterName("TIPO_INICIO");
            parameterType.setParameterValue(inicio);
            header.getParameterType().add(parameterType);

            ParameterType parameterType2 = new ParameterType();
            parameterType2.setParameterName("ENVIO_AUTOMATICO");
            if (automatico) {
                parameterType2.setParameterValue(FenixModelConstants.AUTOMATICO_SI);
            } else {
                parameterType2.setParameterValue(FenixModelConstants.AUTOMATICO_NO);
            }

            header.getParameterType().add(parameterType2);

            org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
                new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();

            org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente cliente =
                new org.bcie.xmlns.objetoproceso.comun.cliente.v1.Cliente();

            org.bcie.xmlns.objetoproceso.comun.tarea.v1.Tarea tarea =
                new org.bcie.xmlns.objetoproceso.comun.tarea.v1.Tarea();

            StringWriter xmlEntrada = null;
            StringWriter xmlSalida = null;

            tarea.setCodigoTarea(idTarea);
            cliente.setIdCliente(idCliente);
            cliente.setResponsableCliente(responsableCliente);

            header.setCliente(cliente);
            header.setTarea(tarea);

            xmlEntrada = this.writeXMLRequest(header, header.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS Invocando Servicio - inicioGestionCobro -" + xmlEntrada.toString());
            logger.warning("Invocando Servicio - inicioGestionCobro" + xmlEntrada.toString());

            response = procesosPrincipalesPortType.inicioGestionCobro(header);
            xmlSalida = this.writeXMLRequest(response, response.getClass());

            logger.log(ADFLogger.WARNING, ">HNWS Respuesta servicio - inicioGestionCobro -" + xmlSalida.toString());
            logger.warning("Respuesta Servicio - inicioGestionCobro" + xmlSalida.toString());

            try {
                if (response.getResult() != null && response.getResult().value() == "OK") {
                    existeError = Boolean.TRUE;
                }

                if (null != response.getMessage() && response.getMessage().trim().length() > 0) {
                    msgError = response.getMessage();
                }
            } catch (Exception e) {
                logger.warning("Error en el servicio");
            }

        } catch (Exception e) {
            existeError = Boolean.TRUE;
            logger.log(ADFLogger.ERROR, "Error en inicioGestionCobro.", e);

            //JboException ex = new JboException(e);
            //ex.addToExceptions(new Exception("Error en inicioGestionCobro " + e.getClass() + ":" + e.getMessage()));
            //throw ex;
        } /*finally {
            if (existeError) {
                JboException exception = new JboException("Error: " + msgError);
                throw exception;
            }
        }*/
        map.put("success", existeError);
        map.put("message", msgError);
        return map;
    }

    public Boolean condicionValidadaPorValidador(Long idAgrupador, Integer idRol) {
        logger.warning("Entra en condicionValidadaPorValidador");
        Boolean isValida = Boolean.FALSE;
        Integer estado = null;
        Integer contador = 0;
        Long j = null;
        Integer i = 0;
        CondicionValidacionVOImpl condicionValidacionVOImpl = this.getCondicionValidacionVO();
        try {
            logger.log(ADFLogger.WARNING, "Id Rol Bpm :" + idRol);
            logger.log(ADFLogger.WARNING, "idAgrupador :" + idAgrupador);

            condicionValidacionVOImpl.setpIdRol(idRol);
            condicionValidacionVOImpl.setpIdAgrupador(idAgrupador);
            condicionValidacionVOImpl.setpIdCondicion(null);
            condicionValidacionVOImpl.executeQuery();
            logger.warning("Se ejecuto Query correctamente.");
            logger.log(ADFLogger.WARNING,
                       "Numero de rows encontrados :" + condicionValidacionVOImpl.getEstimatedRowCount());
            j = condicionValidacionVOImpl.getEstimatedRowCount();
            i = j.intValue();

            RowSetIterator rowsCondicionValidacion = condicionValidacionVOImpl.createRowSetIterator(null);
            if (i > 0) {
                while (rowsCondicionValidacion.hasNext()) {
                    CondicionValidacionVORowImpl condicionValidacionVORowImpl =
                        (CondicionValidacionVORowImpl) rowsCondicionValidacion.next();
                    if (null != condicionValidacionVORowImpl.getEstado()) {
                        estado = condicionValidacionVORowImpl.getEstado();
                        logger.log(ADFLogger.WARNING, "estado :" + estado);
                        if (estado.compareTo(ESTADO_VALIDACION_CONDICION) == 0) {
                            logger.warning("Condicion validada por el rol :" + idRol);
                        } else {
                            logger.warning("La condicion  no esta validada");
                            contador++;
                        }
                    } else {
                        logger.log(ADFLogger.WARNING, "estado es nulo." + estado);
                    }

                }
            } else {
                logger.warning("No se encontraron registros.");
            }
            logger.log(ADFLogger.WARNING, "Se actualizan registros correctamente.");
            rowsCondicionValidacion.closeRowSetIterator();
            if (i > 0) {
                if (contador > 0) {
                    logger.warning("Se encontro una condicion por validar.");
                } else {
                    isValida = Boolean.TRUE;
                }
            } else {
                logger.warning("No existen registros.");
            }
        } catch (Exception e) {
            logger.warning("Error en validaCondicion.", e);
        }
        logger.log(ADFLogger.WARNING, "Condicion Validada :" + isValida);
        return isValida;
    }

    public Boolean actualizarFinalizoTarea(Long idCondicion, Long idAgrupador, Integer idRol, Integer idTarea,
                                           String loginUsuario) {
        logger.log(ADFLogger.WARNING, "Entra en actualizarFinalizoTarea");
        logger.warning("loginUsuario en sesion : " + loginUsuario);
        Boolean validaActualizar = Boolean.FALSE;
        Long idCondicionValidacion = null;
        Long idAgrupadorCondicion = null;
        Integer idRolBpm = null;
        Integer finalizoTarea = null;
        Integer estadoCondicion = null;
        CondicionValidacionVOImpl condicionValidacionVOImpl = this.getCondicionValidacionVO();
        ValidaCondicionVOImpl validaCondicionVOImpl = this.getValidaCondicionVO();
        try {
            if (idTarea.compareTo(FenixModelConstants.ID_TAREA_CUMPLIR_CONDICIONES) == 0) {
                condicionValidacionVOImpl.setpIdCondicion(idCondicion);
                condicionValidacionVOImpl.setpIdAgrupador(idAgrupador);
                condicionValidacionVOImpl.setpIdRol(null);
                condicionValidacionVOImpl.executeQuery();
                loginUsuario = null;
                logger.warning("loginUsuario : " + loginUsuario);
                logger.warning("Se ejecuto Query correctamente.");
                finalizoTarea = 0;
                estadoCondicion = 0;
                logger.log(ADFLogger.WARNING,
                           "Numero de rows encontrados :" + condicionValidacionVOImpl.getEstimatedRowCount());
            } else {
                condicionValidacionVOImpl.setpIdRol(idRol);
                condicionValidacionVOImpl.setpIdAgrupador(idAgrupador);
                condicionValidacionVOImpl.setpIdCondicion(null);
                condicionValidacionVOImpl.executeQuery();
                logger.warning("Se ejecuto Query correctamente.");
                finalizoTarea = 1;
                estadoCondicion = 1;
                logger.log(ADFLogger.WARNING,
                           "Numero de rows encontrados :" + condicionValidacionVOImpl.getEstimatedRowCount());
            }
        } catch (Exception e) {
            logger.log(ADFLogger.WARNING, "Error al ejecutar consulta en CondicionValidacionVOImpl" + e);
        }

        try {
            RowSetIterator rowsCondicionValidacion = condicionValidacionVOImpl.createRowSetIterator(null);

            while (rowsCondicionValidacion.hasNext()) {
                CondicionValidacionVORowImpl condicionValidacionVORowImpl =
                    (CondicionValidacionVORowImpl) rowsCondicionValidacion.next();

                idCondicionValidacion = condicionValidacionVORowImpl.getIdCondicion();
                idAgrupadorCondicion = condicionValidacionVORowImpl.getAgrupador();
                idRolBpm = condicionValidacionVORowImpl.getIdRolBpm();
                loginUsuario = condicionValidacionVORowImpl.getLoginUsuario();

                logger.log(ADFLogger.WARNING, "idCondicionValidacion :" + idCondicionValidacion);
                logger.log(ADFLogger.WARNING, "idAgrupadorCondicion :" + idAgrupadorCondicion);
                logger.log(ADFLogger.WARNING, "idRolBpm :" + idRolBpm);
                logger.log(ADFLogger.WARNING, "finalizoTarea :" + finalizoTarea);
                logger.log(ADFLogger.WARNING, "loginUsuario validacion condicion :" + loginUsuario);

                validaActualizar =
                    validaCondicionVOImpl.actualizarFinalizoTarea(idCondicionValidacion, idAgrupadorCondicion, idRolBpm,
                                                                  finalizoTarea, estadoCondicion, loginUsuario);

            }
            logger.log(ADFLogger.WARNING, "Se actualizan registros correctamente.");
            rowsCondicionValidacion.closeRowSetIterator();
        } catch (Exception e) {
            logger.log(ADFLogger.WARNING, "Error al actualizar la tabla VALIDAR_CONDICION columna FINALIZO_TAREA " + e);
        }
        logger.warning("Actualizar finalizo tarea : " + validaActualizar);
        return validaActualizar;
    }

    /**
     * Realiza la validacion de estados TCC para el proceso de Evaluaciones
     * @param idOperacion contiene id de Operacion
     * @return devuelve valor booleano, true si la validacion es positiva o false en caso contrario
     */
    public boolean validarEstadosTCCEvaluacion(Long idOperacion) {
        logger.warning("Inside validarEstadosTCCEvaluacion.");

        boolean esValido = true;

        logger.warning("Asigna Id de Operacion: " + idOperacion);
        getTccElementosTreeVO().setvarIdOperacion(idOperacion);
        getTccElementosTreeVO().executeQuery();
        logger.warning("Cantidad de registros TCC encontrados: " + getTccElementosTreeVO().getEstimatedRowCount());

        if (getTccElementosTreeVO().getEstimatedRowCount() > 0) {

            Row row = null;
            RowSetIterator iter = getTccElementosTreeVO().createRowSetIterator(null);
            iter.reset();
            while (iter.hasNext()) {

                row = iter.next();
                //Valida Estado TCC
                logger.warning("idTCC: " + row.getAttribute("IdTcc"));
                if (row.getAttribute("IdTcaEstadoTcc") != null) {

                    Integer idEstadoTcc = (Integer) row.getAttribute("IdTcaEstadoTcc");
                    if (FenixModelConstants.ESTADO_TCC_NUEVA.equals(idEstadoTcc)) {
                        Integer idSubEstadoTcc = null;
                        //Valida Sub Estado TCC de elemento TCC con Estado Nuevo
                        if (row.getAttribute("IdTcaSubEstadoTcc") != null) {

                            idSubEstadoTcc = (Integer) row.getAttribute("IdTcaSubEstadoTcc");

                            if (!FenixModelConstants.SUBESTADO_TCC_EDITADA.equals(idSubEstadoTcc) &&
                                !FenixModelConstants.SUBESTADO_TCC_ELIMINADA.equals(idSubEstadoTcc)) {
                                logger.severe("Registro de TCC con Estado y Sub Estado invalido para el proceso de Analisis");
                                esValido = false;
                                break;
                            }
                        } else {
                            logger.severe("Registro de TCC de Estado Nuevo sin Sub Estado TCC para el proceso de Evaluacion");
                            esValido = false;
                            break;
                        }
                    } else {

                    }
                } else {
                    logger.severe("Registro de TCC sin Estado TCC para el proceso de Evaluacion");
                    esValido = false;
                    break;
                }
            }
            iter.closeRowSetIterator();
        } else {
            logger.warning("No hay elementos TCC que validar");
        }

        logger.warning("Resultado de la validacion: " + esValido);

        return esValido;
    }

    /**
     * Realiza la actualizacion de estados a todos los elementos TCC en el proceso de Evaluaciones
     * @param idOperacion contiene el ID de operacion
     * @return devuelve valor booleano, true si la actualizacion fue exitosa o false en caso contrario
     */
    public boolean actualizarEstadosTCCEvaluacion(Long idOperacion, Integer idProceso) {
        logger.warning("Inside actualizarEstadosTCCEvaluacion.");

        boolean exito = true;

        List<TCC> tccList = null;
        Integer estadoTcc = null;
        Long idTcc = null;

        tccList = procesarElementosMatrizTccWS(idOperacion, idProceso);

        if (tccList != null && tccList.size() > 0) {
            exito = actualizarEstadosTccWS(tccList);
        }

        logger.warning("Resultado de la Actualizacion de Estados TCC: " + exito);

        if (tccList != null && exito) {
            for (TCC tcc : tccList) {
                estadoTcc = new Integer(tcc.getEstado());
                idTcc = new Long(tcc.getId());

                if (estadoTcc.compareTo(FenixModelConstants.ESTADO_TCC_ACTUALIZADA) == 0 ||
                    estadoTcc.compareTo(FenixModelConstants.ESTADO_TCC_INACTIVA) == 0) {
                    getTccCondicionVO().actualizarSubEstado(idTcc);
                }
            }
        }

        logger.warning("exito: " + exito);
        return exito;
    }

    public void probarEnvioCorreoService() {
        logger.warning("*Inf, inicio el metodo probarEnvioCorreoService ");
        CorreoElectronicoDTO objetoCorreo = new CorreoElectronicoDTO();
        objetoCorreo.setIdOperacion(500010L);
        objetoCorreo.setIdPlantilla(1);

        Param param1 = new Param();
        param1.setTag("TAREA");
        //param1.setValor(1L);

        objetoCorreo.getParametros().add(param1);

        enviarCorreoService(objetoCorreo);
        logger.warning("*Inf, termina el metodo probarEnvioCorreoService ");
    }

    public Boolean enviarCorreoService(CorreoElectronicoDTO objetoCorreo) {
        logger.warning("*Inf, inicia el metodo enviarCorreoService ");
        Boolean respuesta = Boolean.TRUE;
        String errorService = null;
        String wsdl = this.getWsdl(IWsdlLocation.CORREO_ELECTRONICO);


        CorreoElectronico12BndQSService correoService =
            IWsdlLocation.Service.getInstance(CorreoElectronico12BndQSService.class, wsdl);

        CorreoElectronicoPT correoPT = correoService.getCorreoElectronico12BndQSPort();

        EnviarCorreoElectronicoRequestType request = new EnviarCorreoElectronicoRequestType();
        request.setCorreoElectronico(objetoCorreo);
        EnviarCorreoElectronicoResponseType response = null;


        try {
            java.util.Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ENVIAR_CORRO_ELECTRONICO);
            response = correoPT.enviarCorreoElectronico(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ENVIAR_CORRO_ELECTRONICO, horaInicio);
        } catch (Exception e) {
            logger.warning("Ha ocurrido un error al ejecutar enviarCorreoElectronico service-> ", e);
            errorService = "Ha ocurrido un error al ejecutar enviarCorreoElectronico service " + e.getMessage();
            respuesta = Boolean.FALSE;
        }
        logger.warning("*Inf, Termina el metodo enviarCorreoService ");
        return respuesta;
    }
    private void  mappingComplementoLineaCredito(Long idContrato,String numeroLinea){
        logger.log(ADFLogger.WARNING, "-->initmappingComplementoLineaCredito-->");
        //RegistrarDatosLineaCreditoVORowImpl registrarDatosLineaCreditoVO = null;
        //registrarDatosLineaCreditoVO = (RegistrarDatosLineaCreditoVORowImpl) getRegistrarDatosLineaCreditoVO().createRow();
        try{ 
        //registrarDatosLineaCreditoVO.setNewRowState(Row.STATUS_INITIALIZED);
        //LineaCreditoVOImpl lineaCreditoVo =(LineaCreditoVOImpl)findViewObject("LineaCreditoVO");
        logger.log(ADFLogger.WARNING, "-->mappingComplementoLineaCredito.idContrato-->"+idContrato);
        //lineaCreditoVo.setcontratoId(idContrato);
        //lineaCreditoVo.executeQuery();
        logger.log(ADFLogger.WARNING, "LineaCredito query ejecutado ");
        DiasSpotTasaVOImpl catDiasSpotTasaLOV=getDiasSpotTasaVO1();
        TcaTipoRedondeoVOImpl catTipoRedondeo=getTcaTipoRedondeoVO1();
        TcaTipoMoraVOImpl catMora=getTcaTipoMoraVO1();
        TcaTipoFrecuenciaVOImpl catFrecuencia=getTcaTipoFrecuenciaVO1();
        LineaCreditoActivaVORowImpl sql= consultaLineaContrato(idContrato,numeroLinea);    
         if(sql!=null){
         Row[] rowdiasSpot=catDiasSpotTasaLOV.getFilteredRows("DiasSpotTasa", String.valueOf(sql.getDiasSpotTasa()));
         for(Row row:rowdiasSpot){
             getDiasSpotTasaVO1().setCurrentRow(row);
             logger.log(ADFLogger.WARNING, "var spot "+row.getAttribute("DiasSpotTasa"));
         }
         logger.log(ADFLogger.WARNING, "Into getIdTcaTipoRedondeo "+sql.getIdTcaTipoRedondeo().intValue());
         Row[] rowRounding=catTipoRedondeo.getFilteredRows("Id", Integer.valueOf(sql.getIdTcaTipoRedondeo().intValue()));
         for(Row row:rowRounding){
             getTcaTipoRedondeoVO1().setCurrentRow(row);
             logger.log(ADFLogger.WARNING, "var rounding "+row.getAttribute("DescripcionCorta"));
         }
         logger.log(ADFLogger.WARNING, "Into getIdTcaTipoMora "+sql.getIdTcaTipoMora());
         Row[] rowMora=catMora.getFilteredRows("Id",Integer.valueOf(sql.getIdTcaTipoMora().intValue()));
         for(Row row:rowMora){
             getTcaTipoMoraVO1().setCurrentRow(row);
             logger.log(ADFLogger.WARNING, "var mora "+row.getAttribute("DescripcionCorta"));
         }
        logger.log(ADFLogger.WARNING, "Into getIdTcaTipoFrecuencia "+sql.getIdTcaTipoFrecuencia());
        Row[] rowfrec=getTcaTipoFrecuenciaVO1().getFilteredRows("Id", sql.getIdTcaTipoFrecuencia().intValue());
        for(Row row:rowfrec){
            getTcaTipoFrecuenciaVO1().setCurrentRow(row);
            logger.log(ADFLogger.WARNING, "var frecuencia "+row.getAttribute("DescripcionCorta"));
        }
       }
        logger.log(ADFLogger.WARNING, "-->FinmappingComplementoLineaCredito-->");
        }catch(Exception  e){
        e.printStackTrace();
        }
    }
    private LineaCreditoActivaVORowImpl consultaLineaContrato(Long idContrato,String numeroLinea){
        logger.log(ADFLogger.WARNING, "-->consultaLineaContrato--");
        logger.log(ADFLogger.WARNING, "-->setIdContrato:)-->"+idContrato);
        LineaCreditoActivaVOImpl lineaCreditoVo =(LineaCreditoActivaVOImpl)findViewObject("LineaCreditoActivaVO");
        lineaCreditoVo.setcontratoId(idContrato);
        lineaCreditoVo.setnumeroLinea(numeroLinea);
        lineaCreditoVo.executeQuery();
        logger.log(ADFLogger.WARNING, "lineaCreditoVoQuery "+ lineaCreditoVo.getQuery());
        logger.log(ADFLogger.WARNING, "lineaCreditoVgetFetchSize "+ lineaCreditoVo.getFetchSize());
        LineaCreditoActivaVORowImpl sql=null;
        sql=(LineaCreditoActivaVORowImpl)lineaCreditoVo.next();
        if(sql!=null){
        logger.log(ADFLogger.WARNING, "....datos....................................");
        logger.log(ADFLogger.WARNING, "spread "+sql.getSpreadTasa());
        logger.log(ADFLogger.WARNING, "valor tasa "+sql.getValorTasa());
        logger.log(ADFLogger.WARNING, "tasaFeferencia "+sql.getCodigoTasaReferencia());
        logger.log(ADFLogger.WARNING, "frecuencia "+sql.getFrecuencia());
        logger.log(ADFLogger.WARNING, "diasSpot "+sql.getDiasSpotTasa());
        logger.log(ADFLogger.WARNING, "redondeo "+sql.getIdTcaTipoRedondeo());
        logger.log(ADFLogger.WARNING, "decimales "+sql.getCantidadDecimales());
        logger.log(ADFLogger.WARNING, "mora "+sql.getIdTcaTipoMora());
        logger.log(ADFLogger.WARNING, "idfrecuencia "+sql.getIdTcaTipoFrecuencia());
        logger.log(ADFLogger.WARNING, "........FIN................................");
        logger.log(ADFLogger.WARNING, "..................mapeos......................");}
        return sql;
    }
    //Metodo para inicializar tree en Registrar comisiones
    public void setvarIdOperacionComision(Long value) {
        logger.warning("Entra en setvarIdOperacionComision.");
        this.getTccTreeRootComisionVO().setNamedWhereClauseParam("varIdOperacionTcc", value);
        this.getTccTreeRootComisionVO().executeQuery();
    }

    /**
     * Container's getter for MontoOperacionPorLineaCreditoVO1.
     * @return MontoOperacionPorLineaCreditoVO1
     */
    public MontoOperacionPorLineaCreditoVOImpl getMontoOperacionPorLineaCreditoVO() {
        return (MontoOperacionPorLineaCreditoVOImpl) findViewObject("MontoOperacionPorLineaCreditoVO");
    }

    /**
     * Container's getter for validarClienteTipoDocumentoYMimeTypeVO1.
     * @return validarClienteTipoDocumentoYMimeTypeVO1
     */
    public validarClienteTipoDocumentoYMimeTypeVOImpl getvalidarClienteTipoDocumentoYMimeTypeVO() {
        return (validarClienteTipoDocumentoYMimeTypeVOImpl) findViewObject("validarClienteTipoDocumentoYMimeTypeVO");
    }


    /**
     * Container's getter for DescripcionExcepcionVO3.
     * @return DescripcionExcepcionVO3
     */
    public DescripcionExcepcionVOImpl getDescripcionExcepcionVO() {
        return (DescripcionExcepcionVOImpl) findViewObject("DescripcionExcepcionVO");
    }

    /**
     * Container's getter for FenixAdquisicionAM1.
     * @return FenixAdquisicionAM1
     */
    public ApplicationModuleImpl getFenixAdquisicionAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixAdquisicionAM");
    }


    /**
     * Container's getter for ConsultarNumeroSolicitudVO2.
     * @return ConsultarNumeroSolicitudVO2
     */
    public ConsultarNumeroSolicitudVOImpl getConsultarNumeroSolicitudVO() {
        return (ConsultarNumeroSolicitudVOImpl) findViewObject("ConsultarNumeroSolicitudVO");
    }

    /**
     * Container's getter for ContratosOperacionVO1.
     * @return ContratosOperacionVO1
     */
    public ContratosOperacionVOImpl getContratosOperacionVO() {
        return (ContratosOperacionVOImpl) findViewObject("ContratosOperacionVO");
    }

    /**
     * Container's getter for CambiarResponsableVO1.
     * @return CambiarResponsableVO1
     */
    public CambiarResponsableVOImpl getCambiarResponsableVO() {
        return (CambiarResponsableVOImpl) findViewObject("CambiarResponsableVO");
    }

    /**
     * Container's getter for ConsultarResponsableOperacionVO1.
     * @return ConsultarResponsableOperacionVO1
     */
    public ConsultarResponsableOperacionVOImpl getConsultarResponsableOperacionVO() {
        return (ConsultarResponsableOperacionVOImpl) findViewObject("ConsultarResponsableOperacionVO");
    }

    /**
     * Container's getter for FT05VO1.
     * @return FT05VO1
     */
    public FT05VOImpl getFT05VO1() {
        return (FT05VOImpl) findViewObject("FT05VO1");
    }

    /**
     * Container's getter for FenixImplementacionPctAM1.
     * @return FenixImplementacionPctAM1
     */
    public ApplicationModuleImpl getFenixImplementacionPctAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixImplementacionPctAM");
    }

    /**
     * Container's getter for JustificacionEnvioOperacion1.
     * @return JustificacionEnvioOperacion1
     */
    public JustificacionEnvioOperacionImpl getJustificacionEnvioOperacion1() {
        return (JustificacionEnvioOperacionImpl) findViewObject("JustificacionEnvioOperacion1");
    }

    /**
     * Container's getter for OferentesVO1.
     * @return OferentesVO1
     */
    public OferentesVOImpl getOferentesVO() {
        return (OferentesVOImpl) findViewObject("OferentesVO");
    }

    /**
     * Container's getter for ConsultarAprobacionLOV1.
     * @return ConsultarAprobacionLOV1
     */
    public ConsultarAprobacionLOVImpl getConsultarAprobacionLOV() {
        return (ConsultarAprobacionLOVImpl) findViewObject("ConsultarAprobacionLOV");
    }

    /**
     * Container's getter for AdjudicatariosVO1.
     * @return AdjudicatariosVO1
     */
    public AdjudicatariosVOImpl getAdjudicatariosVO() {
        return (AdjudicatariosVOImpl) findViewObject("AdjudicatariosVO");
    }

    /**
     * Container's getter for ContratadosVO1.
     * @return ContratadosVO1
     */
    public ContratadosVOImpl getContratadosVO() {
        return (ContratadosVOImpl) findViewObject("ContratadosVO");
    }

    /**
     * Container's getter for NoObjecionVO1.
     * @return NoObjecionVO1
     */
    public NoObjecionVOImpl getNoObjecionVO() {
        return (NoObjecionVOImpl) findViewObject("NoObjecionVO");
    }

    /**
     * Container's getter for TreEvidenciaAdquisicionVO1.
     * @return TreEvidenciaAdquisicionVO1
     */
    public TreEvidenciaAdquisicionVOImpl getTreEvidenciaAdquisicionVO() {
        return (TreEvidenciaAdquisicionVOImpl) findViewObject("TreEvidenciaAdquisicionVO");
    }

    /**
     * Container's getter for TcaInstanciaAprobacionVO1.
     * @return TcaInstanciaAprobacionVO1
     */
    public ViewObjectImpl getTcaInstanciaAprobacionVO() {
        return (ViewObjectImpl) findViewObject("TcaInstanciaAprobacionVO");
    }

    /**
     * Container's getter for LoteImplementacionFinConcursoVO1.
     * @return LoteImplementacionFinConcursoVO1
     */
    public LoteImplementacionFinConcursoVOImpl getLoteImplementacionFinConcursoVO() {
        return (LoteImplementacionFinConcursoVOImpl) findViewObject("LoteImplementacionFinConcursoVO");
    }

    /**
     * Container's getter for LoteImplementacionVO1.
     * @return LoteImplementacionVO1
     */
    public LoteImplementacionVOImpl getLoteImplementacionConcursoVO() {
        return (LoteImplementacionVOImpl) findViewObject("LoteImplementacionConcursoVO");
    }

    /**
     * Container's getter for ConsultaContratoClienteVO1.
     * @return ConsultaContratoClienteVO1
     */
    public ViewObjectImpl getConsultaContratoClienteVO1() {
        return (ViewObjectImpl) findViewObject("ConsultaContratoClienteVO1");
    }

    /**
     * Container's getter for ConsultarCalculoInteresesVO1.
     * @return ConsultarCalculoInteresesVO1
     */
    public ConsultarCalculoInteresesVOImpl getConsultarCalculoInteresesVO() {
        return (ConsultarCalculoInteresesVOImpl) findViewObject("ConsultarCalculoInteresesVO");
    }

    /**
     * Container's getter for ContactosClienteVO1.
     * @return ContactosClienteVO1
     */
    public ContactosClienteVOImpl getContactosClienteVO() {
        return (ContactosClienteVOImpl) findViewObject("ContactosClienteVO");
    }

    /**
     * Container's getter for ConsultaContactosClienteVO1.
     * @return ConsultaContactosClienteVO1
     */
    public ConsultaContactosClienteVOImpl getConsultaContactosClienteVO() {
        return (ConsultaContactosClienteVOImpl) findViewObject("ConsultaContactosClienteVO");
    }

    /**
     * Container's getter for ConsultarLineasPorOperacionVO1.
     * @return ConsultarLineasPorOperacionVO1
     */
    public ConsultarLineasPorOperacionVOImpl getConsultarLineasPorOperacionVO() {
        return (ConsultarLineasPorOperacionVOImpl) findViewObject("ConsultarLineasPorOperacionVO");
    }

    /**
     * Container's getter for ComisionesNoPagadasVO1.
     * @return ComisionesNoPagadasVO1
     */
    public ComisionesNoPagadasVOImpl getComisionesNoPagadasVO() {
        return (ComisionesNoPagadasVOImpl) findViewObject("ComisionesNoPagadasVO");
    }

    /**
     * Container's getter for ConsultaComisionNoPagadaVO1.
     * @return ConsultaComisionNoPagadaVO1
     */
    public ConsultaComisionNoPagadaVOImpl getConsultaComisionNoPagadaVO() {
        return (ConsultaComisionNoPagadaVOImpl) findViewObject("ConsultaComisionNoPagadaVO");
    }

    /**
     * Container's getter for EvaluacionCalificacionVO1.
     * @return EvaluacionCalificacionVO1
     */
    public EvaluacionCalificacionVOImpl getEvaluacionCalificacionVO() {
        return (EvaluacionCalificacionVOImpl) findViewObject("EvaluacionCalificacionVO");
    }

    /**
     * Container's getter for TcaSCRVO1.
     * @return TcaSCRVO1
     */
    public TcaSCRVOImpl getTcaSCRRecomendadoVO() {
        return (TcaSCRVOImpl) findViewObject("TcaSCRRecomendadoVO");
    }

    /**
     * Container's getter for ComisionesVO1.
     * @return ComisionesVO1
     */
    public ComisionesVOImpl getComisionesVO() {
        return (ComisionesVOImpl) findViewObject("ComisionesVO");
    }

    /**
     * Container's getter for SeguimientoCrediticioRetornoVO1.
     * @return SeguimientoCrediticioRetornoVO1
     */
    public SeguimientoCrediticioRetornoVOImpl getSeguimientoCrediticioRetornoVO() {
        return (SeguimientoCrediticioRetornoVOImpl) findViewObject("SeguimientoCrediticioRetornoVO");
    }

    /**
     * Container's getter for SeguimientoCreditcioVO1.
     * @return SeguimientoCreditcioVO1
     */
    public SeguimientoCreditcioVOImpl getSeguimientoCreditcioVO() {
        return (SeguimientoCreditcioVOImpl) findViewObject("SeguimientoCreditcioVO");
    }

    /**
     * Container's getter for DesembolsoServiceVO1.
     * @return DesembolsoServiceVO1
     */
    public DesembolsoServiceVOImpl getDesembolsoServiceVO() {
        return (DesembolsoServiceVOImpl) findViewObject("DesembolsoServiceVO");
    }

    /**
     * Container's getter for ContratoDesembolsoVO1.
     * @return ContratoDesembolsoVO1
     */
    public ContratoDesembolsoVOImpl getContratoDesembolsoVO() {
        return (ContratoDesembolsoVOImpl) findViewObject("ContratoDesembolsoVO");
    }

    /**
     * Container's getter for ValidacionCondicionVO1.
     * @return ValidacionCondicionVO1
     */
    public ValidacionCondicionVOImpl getValidacionCondicionVO() {
        return (ValidacionCondicionVOImpl) findViewObject("ValidacionCondicionVO");
    }

    /**
     * Container's getter for ContratoOperacionSaldoNoVencidoVO1.
     * @return ContratoOperacionSaldoNoVencidoVO1
     */
    public ContratoOperacionSaldoNoVencidoVOImpl getContratoOperacionSaldoNoVencidoVO() {
        return (ContratoOperacionSaldoNoVencidoVOImpl) findViewObject("ContratoOperacionSaldoNoVencidoVO");
    }

    /**
     * Container's getter for ResponsableVO1.
     * @return ResponsableVO1
     */
    public ResponsableVOImpl getResponsableVO() {
        return (ResponsableVOImpl) findViewObject("ResponsableVO");
    }

    /**
     * Container's getter for ClientesVO1.
     * @return ClientesVO1
     */
    public ClientesVOImpl getClientesVO() {
        return (ClientesVOImpl) findViewObject("ClientesVO");
    }

    /**
     * Container's getter for ConsultarProductoOperacion1.
     * @return ConsultarProductoOperacion1
     */
    public ConsultarProductoOperacionImpl getConsultarProductoOperacion() {
        return (ConsultarProductoOperacionImpl) findViewObject("ConsultarProductoOperacion");
    }

    /**
     * Container's getter for CondicionValidacionVO1.
     * @return CondicionValidacionVO1
     */
    public CondicionValidacionVOImpl getCondicionValidacionVO() {
        return (CondicionValidacionVOImpl) findViewObject("CondicionValidacionVO");
    }

    /**
     * Container's getter for ValidaCondicionVO1.
     * @return ValidaCondicionVO1
     */
    public ValidaCondicionVOImpl getValidaCondicionVO() {
        return (ValidaCondicionVOImpl) findViewObject("ValidaCondicionVO");
    }

    /**
     * Container's getter for TiposFuenteLOV1.
     * @return TiposFuenteLOV1
     */
    public TiposFuenteLOVImpl getTiposFuenteLOV() {
        return (TiposFuenteLOVImpl) findViewObject("TiposFuenteLOV");
    }

    /**
     * Container's getter for LineaCreditoAsociadaVO1.
     * @return LineaCreditoAsociadaVO1
     */
    public LineaCreditoAsociadaVOImpl getLineaCreditoAsociadaVO() {
        return (LineaCreditoAsociadaVOImpl) findViewObject("LineaCreditoAsociadaVO");
    }

    /**
     * Container's getter for CategoriaCondicionVO1.
     * @return CategoriaCondicionVO1
     */
    public CategoriaCondicionVOImpl getCategoriaCondicionTreVO() {
        return (CategoriaCondicionVOImpl) findViewObject("CategoriaCondicionTreVO");
    }

    /**
     * Container's getter for DatosGeneralesDesembolsoVO1.
     * @return DatosGeneralesDesembolsoVO1
     */
    public DatosGeneralesDesembolsoVOImpl getDatosGeneralesDesembolsoVO() {
        return (DatosGeneralesDesembolsoVOImpl) findViewObject("DatosGeneralesDesembolsoVO");
    }

    /**
     * Container's getter for ValidarCondicionProcesoActivoVO1.
     * @return ValidarCondicionProcesoActivoVO1
     */
    public ValidarCondicionProcesoActivoVOImpl getValidarCondicionProcesoActivoVO() {
        return (ValidarCondicionProcesoActivoVOImpl) findViewObject("ValidarCondicionProcesoActivoVO");
    }

    /**
     * Container's getter for ConsultarFechaAprobacionVO1.
     * @return ConsultarFechaAprobacionVO1
     */
    public ConsultarFechaAprobacionVOImpl getConsultarFechaAprobacionVO() {
        return (ConsultarFechaAprobacionVOImpl) findViewObject("ConsultarFechaAprobacionVO");
    }

    /**
     * Container's getter for ConsultarFechaFirmaContratoVO1.
     * @return ConsultarFechaFirmaContratoVO1
     */
    public ConsultarFechaFirmaContratoVOImpl getConsultarFechaFirmaContratoVO() {
        return (ConsultarFechaFirmaContratoVOImpl) findViewObject("ConsultarFechaFirmaContratoVO");
    }

    /**
     * Container's getter for ActualizarOperacionVO1.
     * @return ActualizarOperacionVO1
     */
    public ActualizarOperacionVOImpl getFactibleOperacionVO() {
        return (ActualizarOperacionVOImpl) findViewObject("FactibleOperacionVO");
    }

    /**
     * Container's getter for TreeCategoriaEnmiendaVO1.
     * @return TreeCategoriaEnmiendaVO1
     */
    public TreeCategoriaEnmiendaVOImpl getTreeCategoriaEnmiendaVO() {
        return (TreeCategoriaEnmiendaVOImpl) findViewObject("TreeCategoriaEnmiendaVO");
    }

    /**
     * Container's getter for TreeTcaEventoEnmienda1.
     * @return TreeTcaEventoEnmienda1
     */
    public TreeTcaEventoEnmiendaImpl getTreeTcaEventoEnmienda() {
        return (TreeTcaEventoEnmiendaImpl) findViewObject("TreeTcaEventoEnmienda");
    }

    /**
     * Container's getter for ConsultarFormalizacionAutomaticaVO1.
     * @return ConsultarFormalizacionAutomaticaVO1
     */
    public ConsultarFormalizacionAutomaticaVOImpl getConsultarFormalizacionAutomaticaVO() {
        return (ConsultarFormalizacionAutomaticaVOImpl) findViewObject("ConsultarFormalizacionAutomaticaVO");
    }

    /**
     * Container's getter for LoteFinConcursoVO1.
     * @return LoteFinConcursoVO1
     */
    public LoteFinConcursoVOImpl getLoteFinConcursoVO() {
        return (LoteFinConcursoVOImpl) findViewObject("LoteFinConcursoVO");
    }

    /**
     * Container's getter for CatPaisesVO1.
     * @return CatPaisesVO1
     */
    public CatPaisesVOImpl getPaisesNombreVO() {
        return (CatPaisesVOImpl) findViewObject("PaisesNombreVO");
    }

    /**
     * Container's getter for MontoFormalizacionesEjecutadasVO1.
     * @return MontoFormalizacionesEjecutadasVO1
     */
    public MontoFormalizacionesEjecutadasVOImpl getMontoFormalizacionesEjecutadasVO() {
        return (MontoFormalizacionesEjecutadasVOImpl) findViewObject("MontoFormalizacionesEjecutadasVO");
    }

    /**
     * Container's getter for ConsultarTerminoEnEspecificoVO1.
     * @return ConsultarTerminoEnEspecificoVO1
     */
    public ConsultarTerminoEnEspecificoVOImpl getConsultarTerminoEnEspecificoVO() {
        return (ConsultarTerminoEnEspecificoVOImpl) findViewObject("ConsultarTerminoEnEspecificoVO");
    }

    /**
     * Container's getter for LineasContratosCreadosImplementacionVO1.
     * @return LineasContratosCreadosImplementacionVO1
     */
    public LineasContratosCreadosImplementacionVOImpl getLineasContratosCreadosImplementacionVO() {
        return (LineasContratosCreadosImplementacionVOImpl) findViewObject("LineasContratosCreadosImplementacionVO");
    }

    /**
     * Container's getter for DiasHabilesVO1.
     * @return DiasHabilesVO1
     */
    public DiasHabilesVOImpl getDiasHabilesVO() {
        return (DiasHabilesVOImpl) findViewObject("DiasHabilesVO");
    }

    /**
     * Container's getter for DiasInhabilesVO1.
     * @return DiasInhabilesVO1
     */
    public DiasInhabilesVOImpl getDiasInhabilesVO() {
        return (DiasInhabilesVOImpl) findViewObject("DiasInhabilesVO");
    }

    /**
     * Container's getter for ReglasValidadasDesembolsoPorExcepcion1.
     * @return ReglasValidadasDesembolsoPorExcepcion1
     */
    public ReglasValidadasDesembolsoPorExcepcionImpl getReglasValidadasDesembolsoPorExcepcion() {
        return (ReglasValidadasDesembolsoPorExcepcionImpl) findViewObject("ReglasValidadasDesembolsoPorExcepcion");
    }

    /**
     * Container's getter for LoteFormalizacionVO1.
     * @return LoteFormalizacionVO1
     */
    public LoteFormalizacionVOImpl getLoteFormalizacionVO() {
        return (LoteFormalizacionVOImpl) findViewObject("LoteFormalizacionVO");
    }

    /**
     * Container's getter for TasaReferenciaVO1.
     * @return TasaReferenciaVO1
     */
    public TasaReferenciaVOImpl getTasaDescripcionVO() {
        return (TasaReferenciaVOImpl) findViewObject("TasaDescripcionVO");
    }

    /**
     * Container's getter for ConsultarLineaCreditoDesembolsoVO1.
     * @return ConsultarLineaCreditoDesembolsoVO1
     */
    public ConsultarLineaCreditoDesembolsoVOImpl getConsultarLineaCreditoDesembolsoVO() {
        return (ConsultarLineaCreditoDesembolsoVOImpl) findViewObject("ConsultarLineaCreditoDesembolsoVO");
    }

    /**
     * Container's getter for ValidarClienteScrVO1.
     * @return ValidarClienteScrVO1
     */
    public ValidarClienteScrVOImpl getValidarClienteScrVO() {
        return (ValidarClienteScrVOImpl) findViewObject("ValidarClienteScrVO");
    }

    /**
     * Container's getter for CondicionesFinancierasVO1.
     * @return CondicionesFinancierasVO1
     */
    public CondicionesFinancierasVOImpl getCondicionesFinancierasVO() {
        return (CondicionesFinancierasVOImpl) findViewObject("CondicionesFinancierasVO");
    }

    /**
     * Container's getter for ContratoDesembolsoQueryVO1.
     * @return ContratoDesembolsoQueryVO1
     */
    public ContratoDesembolsoQueryVOImpl getContratoDesembolsoQueryVO() {
        return (ContratoDesembolsoQueryVOImpl) findViewObject("ContratoDesembolsoQueryVO");
    }

    /**
     * Container's getter for CondicionesFinancierasVO1.
     * @return CondicionesFinancierasVO1
     */
    public CondicionesFinancierasVOImpl getCondicionesFinancierasInstanciaNuevaVO() {
        return (CondicionesFinancierasVOImpl) findViewObject("CondicionesFinancierasInstanciaNuevaVO");
    }

    /**
     * Container's getter for TransferenciasConsolidarVO1.
     * @return TransferenciasConsolidarVO1
     */
    public TransferenciasConsolidarVOImpl getTransferenciasConsolidarVO() {
        return (TransferenciasConsolidarVOImpl) findViewObject("TransferenciasConsolidarVO");
    }

    /**
     * Container's getter for ConsultarFechaEfectivaVO1.
     * @return ConsultarFechaEfectivaVO1
     */
    public ConsultarFechaEfectivaVOImpl getConsultarFechaEfectivaVO() {
        return (ConsultarFechaEfectivaVOImpl) findViewObject("ConsultarFechaEfectivaVO");
    }

    /**
     * Container's getter for TimeLineEnmiendaVO1.
     * @return TimeLineEnmiendaVO1
     */
    public TimeLineEnmiendaVOImpl getTimeLineEnmiendaVO() {
        return (TimeLineEnmiendaVOImpl) findViewObject("TimeLineEnmiendaVO");
    }

    /**
     * Container's getter for TimeLineEvaluacionSiemasVO1.
     * @return TimeLineEvaluacionSiemasVO1
     */
    public TimeLineEvaluacionSiemasVOImpl getTimeLineEvaluacionSiemasVO() {
        return (TimeLineEvaluacionSiemasVOImpl) findViewObject("TimeLineEvaluacionSiemasVO");
    }

    /**
     * Container's getter for TimeLineOperacionVO1.
     * @return TimeLineOperacionVO1
     */
    public TimeLineOperacionVOImpl getTimeLineOperacionVO() {
        return (TimeLineOperacionVOImpl) findViewObject("TimeLineOperacionVO");
    }

    /**
     * Container's getter for MenuAplicacionExternaVO1.
     * @return MenuAplicacionExternaVO1
     */
    public ViewObjectImpl getMenuAplicacionExternaVO() {
        return (ViewObjectImpl) findViewObject("MenuAplicacionExternaVO");
    }


    /**
     * Container's getter for AplicacionExternaVO1.
     * @return AplicacionExternaVO1
     */
    public AplicacionExternaVOImpl getAplicacionExternaVO() {
        return (AplicacionExternaVOImpl) findViewObject("AplicacionExternaVO");
    }

    /**
     * Container's getter for FenixParametrizacionAM1.
     * @return FenixParametrizacionAM1
     */
    public ApplicationModuleImpl getFenixParametrizacionAM() {
        return (ApplicationModuleImpl) findApplicationModule("FenixParametrizacionAM");
    }

    /**
     * Container's getter for CambiarResponsableClienteVO1.
     * @return CambiarResponsableClienteVO1
     */
    public CambiarResponsableClienteVOImpl getCambiarResponsableClienteVO() {
        return (CambiarResponsableClienteVOImpl) findViewObject("CambiarResponsableClienteVO");
    }

    /**
     * Container's getter for CatResponsableClienteVO1.
     * @return CatResponsableClienteVO1
     */
    public ViewObjectImpl getCatResponsableClienteVO() {
        return (ViewObjectImpl) findViewObject("CatResponsableClienteVO");
    }

    /**
     * Container's getter for ComentarioOperacionVO1.
     * @return ComentarioOperacionVO1
     */
    public ComentarioOperacionVOImpl getComentarioOperacionVO() {
        return (ComentarioOperacionVOImpl) findViewObject("ComentarioOperacionVO");
    }

    /**
     * Container's getter for RespuestaComentarioVO1.
     * @return RespuestaComentarioVO1
     */
    public RespuestaComentarioVOImpl getRespuestaComentarioVO() {
        return (RespuestaComentarioVOImpl) findViewObject("RespuestaComentarioVO");
    }

    /**
     * Container's getter for ComentarioAndRespuestaComentarioVL1.
     * @return ComentarioAndRespuestaComentarioVL1
     */
    public ViewLinkImpl getComentarioAndRespuestaComentarioVL() {
        return (ViewLinkImpl) findViewLink("ComentarioAndRespuestaComentarioVL");
    }

    /**
     * Container's getter for RolesAccionVO1.
     * @return RolesAccionVO1
     */
    public RolesAccionVOImpl getRolesAccionVO() {
        return (RolesAccionVOImpl) findViewObject("RolesAccionVO");
    }

    /**
     * Container's getter for ConsultarTccTerminoVO1.
     * @return ConsultarTccTerminoVO1
     */
    public ConsultarTccTerminoVOImpl getConsultarTccTerminoVO() {
        return (ConsultarTccTerminoVOImpl) findViewObject("ConsultarTccTerminoVO");
    }

    /**
     * Container's getter for TccComisionVO1.
     * @return TccComisionVO1
     */
    public TccComisionVOImpl getTccRegistroComisionVO() {
        return (TccComisionVOImpl) findViewObject("TccRegistroComisionVO");
    }

    /**
     * Container's getter for ConsultarContratosDesembolsoQueryVO1.
     * @return ConsultarContratosDesembolsoQueryVO1
     */
    public ConsultarContratosDesembolsoQueryVOImpl getConsultarContratosDesembolsoQueryVO() {
        return (ConsultarContratosDesembolsoQueryVOImpl) findViewObject("ConsultarContratosDesembolsoQueryVO");
    }

    /**
     * Container's getter for ConsultarTreSolicitudLineaCreditoVO1.
     * @return ConsultarTreSolicitudLineaCreditoVO1
     */
    public ConsultarTreSolicitudLineaCreditoVOImpl getConsultarTreSolicitudLineaCreditoVO() {
        return (ConsultarTreSolicitudLineaCreditoVOImpl) findViewObject("ConsultarTreSolicitudLineaCreditoVO");
    }

    /**
     * Container's getter for ConsultarSolicitudDesembolsoQueryVO1.
     * @return ConsultarSolicitudDesembolsoQueryVO1
     */
    public ConsultarSolicitudDesembolsoQueryVOImpl getConsultarSolicitudDesembolsoQueryVO() {
        return (ConsultarSolicitudDesembolsoQueryVOImpl) findViewObject("ConsultarSolicitudDesembolsoQueryVO");
    }

    /**
     * Container's getter for ComisionRegistradaFlexVO1.
     * @return ComisionRegistradaFlexVO1
     */
    public ComisionRegistradaFlexVOImpl getComisionRegistradaFlexVO() {
        return (ComisionRegistradaFlexVOImpl) findViewObject("ComisionRegistradaFlexVO");
    }

    /**
     * Container's getter for ComisionTreeVO1.
     * @return ComisionTreeVO1
     */
    public ComisionTreeVOImpl getComisionTreeVO() {
        return (ComisionTreeVOImpl) findViewObject("ComisionTreeVO");
    }

    /**
     * Container's getter for ComisionEnmendadaVO1.
     * @return ComisionEnmendadaVO1
     */
    public ComisionEnmendadaVOImpl getComisionEnmendadaVO() {
        return (ComisionEnmendadaVOImpl) findViewObject("ComisionEnmendadaVO");
    }

    /**
     * Container's getter for LimitesExcepcionVO1.
     * @return LimitesExcepcionVO1
     */
    public LimitesExcepcionVOImpl getLimitesExcepcionVO() {
        return (LimitesExcepcionVOImpl) findViewObject("LimitesExcepcionVO");
    }

    private ConfigurarSolicitudAprobacionResponseType consultarComiteCredito(Long idSolicitud, Long idOperacion,
                                                                             Integer idNivelAprobacion) {
        logger.warning("Entra en consultarComiteCredito");

        ConsultarUsuarioReunionAprobacionVOImpl usuarioAprobacion;
        usuarioAprobacion = getConsultarUsuarioReunionAprobacionVO();
        ConfigurarSolicitudAprobacionResponseType response = null;
        Integer idTcaTipoUsuario = null;
        Long idUsuarioReunion = null;
        Integer idTcaRolBpm = null;
        String nombreUsuario = null;
        String loginUsuario = null;
        Integer notificacion = null;
        String descripcion = null;
        String descripcionCorta = null;
        Boolean isNotificacion = null;
        List<String> listaUsuariosConNotificacion = new ArrayList<>();
        List<String> listaUsuariosEmitirVoto = new ArrayList<>();

        String nivelAprobacion = (null != idNivelAprobacion ? idNivelAprobacion.toString() : null);
        try {
            logger.warning("Setea valores al response");
            response = new ConfigurarSolicitudAprobacionResponseType();
            List<SolicitudAprobacion> solAprobList = new ArrayList<>();
            SolicitudAprobacion solicitudAprobacion = new SolicitudAprobacion();
            //            Catalogo catalogo = new Catalogo();
            //            catalogo.setId(new Long(idNivelAprobacion));
            //            solicitudAprobacion.setIdSolicitudAprobacion(idSolicitud);
            //            solicitudAprobacion.setIdOperacion(idOperacion);
            //            /** FIXME - Corregir obtencion descripcion de nivel de aprobacion- **/
            //            solicitudAprobacion.setNivelAprobacion(catalogo);
            solAprobList.add(solicitudAprobacion);
            response.getSolicitudAprobacion().addAll(solAprobList);
        } catch (Exception e) {
            logger.warning("Error al setear valores en response.", e);
        }
        try {
            ListadoMiembroReunion listaMiembroEmitirVoto = new ListadoMiembroReunion();
            ListadoMiembroReunion listaMiembroNotificacion = new ListadoMiembroReunion();
            MiembroReunion miembrosReunionNotificacion = null;

            Catalogo catalogoNotificacion = new Catalogo();

            ListadoUsuariosReunion listaUsuarioNotificacion = new ListadoUsuariosReunion();

            usuarioAprobacion.consultarUsuarioReunionPorIdSolicitud(idSolicitud);
            usuarioAprobacion.setRangeSize(-1);
            Row[] rows = usuarioAprobacion.getAllRowsInRange();
            usuarioAprobacion.executeQuery();
            if (rows != null) {
                logger.warning("Numero de registros : " + rows.length);
            }

            // Obtencion de los miembros votantes
            for (Row row : rows) {
                idTcaTipoUsuario = (Integer) row.getAttribute("IdTcaTipoUsuario");

                // Obtenemos el id real para ser usado en la actualizacion
                idUsuarioReunion = (Long) row.getAttribute("Id");

                idTcaRolBpm = (Integer) row.getAttribute("IdTcaRolBpm");

                nombreUsuario = (String) row.getAttribute("NombreUsuario");
                loginUsuario = (String) row.getAttribute("LoginUsuario");

                descripcion = (String) row.getAttribute("Descripcion");
                descripcionCorta = (String) row.getAttribute("DescripcionCorta");

                notificacion = (Integer) row.getAttribute("ConNotificacion");
                if (notificacion.compareTo(1) == 0) {
                    isNotificacion = Boolean.TRUE;
                } else {
                    isNotificacion = Boolean.FALSE;
                }
                logger.warning("IdTcaTipoUsuario : " + idTcaTipoUsuario);
                logger.warning("idUsuarioReunion : " + idUsuarioReunion);
                logger.warning("idTcaRolBpm : " + idTcaRolBpm);
                logger.warning("nombreUsuario : " + nombreUsuario);
                logger.warning("loginUsuario : " + loginUsuario);
                logger.warning("notificacion : " + notificacion);
                logger.warning("isNotificacion : " + isNotificacion);
                logger.warning("descripcion : " + descripcion);
                logger.warning("descripcionCorta : " + descripcionCorta);
                if (idTcaTipoUsuario.compareTo(FenixModelConstants.TIPO_MIEMBRO_COMITE_CREDITO) == 0) {
                    logger.warning("TIPO MIEMBRO COMITE DE CREDITO");
                    MiembroReunion miembrosReunionEmitirVoto = new MiembroReunion();
                    miembrosReunionEmitirVoto.setIdUsuarioReunion(idUsuarioReunion);

                    Catalogo catalogoEmitirVoto = new Catalogo();
                    catalogoEmitirVoto.setId(idTcaRolBpm.longValue());
                    catalogoEmitirVoto.setDescripcion(descripcion);
                    catalogoEmitirVoto.setDescripcionCorta(descripcionCorta);

                    catalogoEmitirVoto.setEstatus(Boolean.FALSE);
                    catalogoEmitirVoto.setCodigoExterno(nivelAprobacion);

                    miembrosReunionEmitirVoto.setRol(catalogoEmitirVoto);

                    miembrosReunionEmitirVoto.setEmiteVoto(Boolean.FALSE);
                    miembrosReunionEmitirVoto.setNotificar(Boolean.TRUE);
                    miembrosReunionEmitirVoto.setOtro(Boolean.FALSE);
                    miembrosReunionEmitirVoto.setExcusado(Boolean.FALSE);
                    miembrosReunionEmitirVoto.setEstado(Boolean.FALSE);

                    logger.warning("idTcaRolBpm de catalogo : " + miembrosReunionEmitirVoto.getRol().getId());

                    ListadoUsuariosReunion listaUsuarioEmitirVoto = new ListadoUsuariosReunion();
                    listaUsuarioEmitirVoto.getUsuario().addAll(getListaUsuariosReunionMiembroComite(descripcionCorta,
                                                                                                    loginUsuario,
                                                                                                    nombreUsuario));
                    miembrosReunionEmitirVoto.setListadoUsuarios(listaUsuarioEmitirVoto);

                    listaMiembroEmitirVoto.getMiembroReunion().add(miembrosReunionEmitirVoto);

                    listaUsuariosEmitirVoto.add(loginUsuario);
                }
            }

            response.getListadoEmitirVoto().add(listaMiembroEmitirVoto);

            // Obtencion de miembros con notificacion
            for (Row row : rows) {
                idTcaTipoUsuario = (Integer) row.getAttribute("IdTcaTipoUsuario");
                idUsuarioReunion = (Long) row.getAttribute("Id");

                idTcaRolBpm = (Integer) row.getAttribute("IdTcaRolBpm");

                nombreUsuario = (String) row.getAttribute("NombreUsuario");
                loginUsuario = (String) row.getAttribute("LoginUsuario");

                descripcion = (String) row.getAttribute("Descripcion");
                descripcionCorta = (String) row.getAttribute("DescripcionCorta");

                notificacion = (Integer) row.getAttribute("ConNotificacion");
                if (notificacion.compareTo(1) == 0) {
                    isNotificacion = Boolean.TRUE;
                } else {
                    isNotificacion = Boolean.FALSE;
                }
                logger.warning("IdTcaTipoUsuario : " + idTcaTipoUsuario);
                logger.warning("idUsuarioReunion : " + idUsuarioReunion);
                logger.warning("idTcaRolBpm : " + idTcaRolBpm);
                logger.warning("nombreUsuario : " + nombreUsuario);
                logger.warning("loginUsuario : " + loginUsuario);
                logger.warning("notificacion : " + notificacion);
                logger.warning("isNotificacion : " + isNotificacion);
                logger.warning("descripcion : " + descripcion);
                logger.warning("descripcionCorta : " + descripcionCorta);
                if (idTcaTipoUsuario.compareTo(FenixModelConstants.TIPO_MIEMBRO_NOTIFICACION) == 0) {
                    UsuarioReunion ususarioNotificacion = new UsuarioReunion();
                    if (null == miembrosReunionNotificacion) {
                        logger.warning("miembrosReunionNotificacion es nulo.");
                        miembrosReunionNotificacion = new MiembroReunion();
                        miembrosReunionNotificacion.setIdUsuarioReunion(idUsuarioReunion);
                        logger.warning("Valor idUsuario : " + miembrosReunionNotificacion.getIdUsuarioReunion());

                        catalogoNotificacion = new Catalogo();
                        catalogoNotificacion.setId(idTcaRolBpm.longValue());
                        catalogoNotificacion.setDescripcion(descripcion);
                        catalogoNotificacion.setDescripcionCorta(descripcionCorta);
                        catalogoNotificacion.setCodigoExterno(idNivelAprobacion.toString());

                        // Valores constantes
                        catalogoNotificacion.setEstatus(Boolean.FALSE);

                        miembrosReunionNotificacion.setRol(catalogoNotificacion);
                        logger.warning("idTcaRolBpm de catalogo : " + idTcaRolBpm);

                        // Valores constantes
                        miembrosReunionNotificacion.setEmiteVoto(Boolean.FALSE);
                        miembrosReunionNotificacion.setNotificar(Boolean.TRUE);
                        miembrosReunionNotificacion.setOtro(Boolean.FALSE);
                        miembrosReunionNotificacion.setExcusado(Boolean.FALSE);
                        miembrosReunionNotificacion.setEstado(Boolean.FALSE);
                    }

                    ususarioNotificacion.setNombreUsuario(nombreUsuario);
                    ususarioNotificacion.setUsuario(loginUsuario);
                    listaUsuarioNotificacion.getUsuario().add(ususarioNotificacion);
                    miembrosReunionNotificacion.setListadoUsuarios(listaUsuarioNotificacion);

                    listaUsuariosConNotificacion.add(loginUsuario);
                }
            }

            listaMiembroNotificacion.getMiembroReunion().add(miembrosReunionNotificacion);
            response.getListadoConNotificacion().add(listaMiembroNotificacion);
        } catch (Exception e) {
            logger.warning("Error en consultarComiteCredito.", e);
        }

        response = consultarDependenciasConNotificacion(response, listaUsuariosConNotificacion);

        try {
            logger.warning("Contenido de response obtenido.");
            StringWriter sw;
            sw = ModelUtils.writeXMLRequest(response, response.getClass());
            logger.warning(sw.toString());
        } catch (JAXBException e) {
            logger.warning("Error en consultarComiteCredito.", e);
        }

        return response;
    }

    public List<UsuarioReunion> getListaUsuariosReunionMiembroComite(String rolUsuario, String loginUsuario,
                                                                     String nombreUsuario) {
        logger.warning("Dentro de getListaUsuariosReunionMiembroComite");
        logger.warning("rolUsuario :" + rolUsuario);
        logger.warning("loginUsuario :" + loginUsuario);
        logger.warning("nombreUsuario :" + nombreUsuario);

        //declaraciones variables
        Boolean existeUsuarioBD = null;
        TcaMiembroReunionVOImpl tcaMiembroReunionVOImpl = null;
        TreComiteRolBpmVOImpl treComiteRolBpmVOImpl = null;
        Boolean esUsuarioCreado = null;
        Boolean esNombreUsuarioActualisado = null;
        Boolean esValidoActBanEstatus = null;
        Boolean esValidoActivoBanEstatusUsuario = null;
        Integer idTreComiteRol = null;

        List<UsuarioReunion> listaUsuariosReunion = new ArrayList<>();

        if (null != rolUsuario) {
            List<String> listaUsuarios = new ArrayList<>();
            listaUsuarios.add(rolUsuario);
            UsuarioPT usuarioPT = UsuarioPT();
            ConsultarAtributosUsuarioRequestType request = ConsultarAtributosUsuarioRequest(listaUsuarios);
            ConsultarAtributosUsuarioResponseType responseAtributos = new ConsultarAtributosUsuarioResponseType();

            try {
                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_GERENTE_PAIS);
                responseAtributos = usuarioPT.consultarAtributosUsuario(request);
                ModelUtils.logEndWS(logger, responseAtributos, FenixModelConstants.WSC_CONSULTAR_GERENTE_PAIS,
                                    horaInicio);
            } catch (Exception e) {
                logger.log(ADFLogger.ERROR, "Error al obtener el gerente de pais", e);
                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception("Error al obtener lo atributos del usuario. Intentelo más tarde."));
                throw ex;
            }

            ListaUsuarios usuarios = new ListaUsuarios();

            if (responseAtributos.getResultado().getResult().value() != null) {
                logger.warning("result value :" + responseAtributos.getResultado().getResult().value());
            } else {
                logger.warning("result es nulo");
            }

            if (responseAtributos.getListaUsuarios() != null) {

                usuarios = responseAtributos.getListaUsuarios();

                treComiteRolBpmVOImpl = this.getTreComiteRolBpmVO();
                tcaMiembroReunionVOImpl = this.getTcaMiembroReunionVO();

                //obtener el id de TRE_COMITE_ROL por nombre de rol
                idTreComiteRol = treComiteRolBpmVOImpl.buscarIdTreComiteRolBpmPorNombreRol(rolUsuario);

                logger.warning("idTreComiteRol :" + idTreComiteRol);

                //inhabilitar los usuarios por rol con ban estatus en 0
                esValidoActBanEstatus = tcaMiembroReunionVOImpl.actualizarBanEstatusPorIdTreComiteRol(idTreComiteRol);

                logger.warning("esValidoActBanEstatus :" + esValidoActBanEstatus);


                for (Usuario usuario : usuarios.getUsuario()) {
                    if (null != usuario && null != usuario.getNombreUsuario()) {
                        boolean esPropietario = Boolean.FALSE;

                        if (null != loginUsuario) {
                            logger.warning("loginUsuario :" + loginUsuario);
                            logger.warning("usuario.getNombreUsuario() : " + usuario.getNombreUsuario());
                            esPropietario = usuario.getNombreUsuario().equals(loginUsuario);

                        }
                        logger.warning("esPropietario :" + esPropietario);

                        UsuarioReunion ususarioEmitirVoto = new UsuarioReunion();
                        ususarioEmitirVoto.setNombreUsuario(usuario.getNombreCompleto());
                        ususarioEmitirVoto.setUsuario(usuario.getNombreUsuario());
                        ususarioEmitirVoto.setPropietario(esPropietario);
                        ususarioEmitirVoto.setDependecia(usuario.getDependencia());
                        listaUsuariosReunion.add(ususarioEmitirVoto);

                        //sincroniza BD con OID

                        //validar si existe ese usuario con el mismo idTreComiteRol
                        existeUsuarioBD =
                            tcaMiembroReunionVOImpl.buscarTcaMiembroReunionPorLoginUsuarioAndIdTreComiteRol(usuario.getNombreUsuario(),
                                                                                                            idTreComiteRol);

                        logger.warning("existeUsuarioBD :" + existeUsuarioBD);


                        if (existeUsuarioBD) {
                            //usuario existe en la tabla TCA_MIEMBRO_REUNION
                            logger.warning("El usuario existe en BD no es necesario insertarlo");
                            //habilitar usuario ban estatus en 1
                            esValidoActivoBanEstatusUsuario =
                                tcaMiembroReunionVOImpl.actualizarBanEstatusActivoPorLoginUsuarioAndIdTreComiteRol(usuario.getNombreUsuario(),
                                                                                                                   idTreComiteRol);
                            logger.warning("esValidoActivoBanEstatusUsuario :" + esValidoActivoBanEstatusUsuario);
                            //validar que no se tenga el mismo nombre de usuario en OID y BD
                            Row rowUsuarioDB =
                                tcaMiembroReunionVOImpl.buscarRowTcaMiembroReunionPorLoginUsuarioAndIdTreComiteRol(usuario.getNombreUsuario(),
                                                                                                                   idTreComiteRol);

                            String nombreUsuarioDB = (String) rowUsuarioDB.getAttribute("NombreUsuario");

                            logger.warning("nombre de usuario en el  OID :" + usuario.getNombreCompleto());
                            logger.warning("nombre de usuario en la BD :" + nombreUsuarioDB);

                            if (usuario.getNombreCompleto() == nombreUsuarioDB ||
                                usuario.getNombreCompleto().compareTo(nombreUsuarioDB) == 0) {
                                logger.warning("nombre de usuario es igual en OID y BD, no es necesario actualisarlo");

                            } else {
                                logger.warning("Nombre de usuario es diferente actualizar nombre en BD");
                                esNombreUsuarioActualisado =
                                    tcaMiembroReunionVOImpl.actualizarNombreUsuarioTcaMiembroReunion(usuario.getNombreUsuario(),
                                                                                                     usuario.getNombreCompleto(),
                                                                                                     idTreComiteRol);
                                logger.warning("esNombreUsuarioActualisado :" + esNombreUsuarioActualisado);
                            }

                        } else {
                            logger.warning("El usuario no existe en BD es necesario insertarlo en la tabla TCA_MIEMBRO_REUNION");


                            if (idTreComiteRol !=
                                null) {
                                //usuario no existe en la tabla TCA_MIEMBRO_REUNION
                                esUsuarioCreado =
                  tcaMiembroReunionVOImpl.crearTcaMiembroReunion(usuario.getNombreUsuario(),
                                                                 usuario.getNombreCompleto(), usuario.getDependencia(),
                                                                 idTreComiteRol, new Integer(0), new Integer(1));
                                logger.warning("esUsuarioCreado :" + esUsuarioCreado);

                                logger.warning("Usuario :" + usuario.getNombreUsuario() +
                                               "se agrego correctamente a BD");

                            } else {
                                logger.severe("No se pudo crear el usuario por que idTreComiteRol es nulo," +
                                              "  idTreComiteRol :" + idTreComiteRol);
                            }
                        }

                    } else {
                        logger.warning("nombreUsuario es null");
                    }
                }
            } else {
                logger.warning("ListaUsuarios es null");
            }
            logger.warning("Valor del nombre de usuario : " + nombreUsuario);

            if (NOMBRE_USUARIO_OTRO_AUX.equals(nombreUsuario) || NOMBRE_USUARIO_OTRO.equalsIgnoreCase(nombreUsuario)) {
                logger.warning("Entra en usuario otro.");
                UsuarioReunion ususarioEmitirVoto = new UsuarioReunion();
                ususarioEmitirVoto.setNombreUsuario(NOMBRE_USUARIO_OTRO);
                ususarioEmitirVoto.setUsuario(NOMBRE_USUARIO_OTRO);
                ususarioEmitirVoto.setPropietario(Boolean.TRUE);
                //ususarioEmitirVoto.setDependecia(null);
                listaUsuariosReunion.add(ususarioEmitirVoto);
            }
            if (NOMBRE_USUARIO_EXCUSADO_AUX.equalsIgnoreCase(nombreUsuario) ||
                NOMBRE_USUARIO_EXCUSADO.equalsIgnoreCase(nombreUsuario)) {
                logger.warning("Entra en usuario excusado.");
                UsuarioReunion ususarioEmitirVoto = new UsuarioReunion();
                ususarioEmitirVoto.setNombreUsuario(NOMBRE_USUARIO_EXCUSADO);
                ususarioEmitirVoto.setUsuario(NOMBRE_USUARIO_EXCUSADO);
                ususarioEmitirVoto.setPropietario(Boolean.TRUE);
                //ususarioEmitirVoto.setDependecia(null);
                listaUsuariosReunion.add(ususarioEmitirVoto);
            }
        }

        logger.warning("cantidad de registros para listaUsuariosReunion :" + listaUsuariosReunion.size());
        logger.warning("Fuera de getListaUsuariosReunionMiembroComite");
        return listaUsuariosReunion;
    }

    private ConfigurarSolicitudAprobacionResponseType consultarDependenciasConNotificacion(ConfigurarSolicitudAprobacionResponseType response,
                                                                                           List<String> listaUsuarios) {
        logger.warning("Entrando en obtenerDependencias.");

        if (null != listaUsuarios) {
            logger.warning("listaUsuarios: " + listaUsuarios.toString());
        }

        UsuarioPT usuarioPT = UsuarioPT();
        ConsultarAtributosUsuarioRequestType request = ConsultarAtributosUsuarioRequest(listaUsuarios);
        ConsultarAtributosUsuarioResponseType responseAtributos = new ConsultarAtributosUsuarioResponseType();

        try {
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_GERENTE_PAIS);
            responseAtributos = usuarioPT.consultarAtributosUsuario(request);
            ModelUtils.logEndWS(logger, responseAtributos, FenixModelConstants.WSC_CONSULTAR_GERENTE_PAIS, horaInicio);
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error al obtener el gerente de pais", e);
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al obtener lo atributos del usuario. Intentelo más tarde."));
            throw ex;
        }

        return mapeoDependenciasConNotificacion(responseAtributos, response);
    }

    private ConfigurarSolicitudAprobacionResponseType consultarDependenciasEmitirVoto(ConfigurarSolicitudAprobacionResponseType response,
                                                                                      List<String> listaUsuarios) {
        logger.warning("Entrando en obtenerDependencias.");

        if (null != listaUsuarios) {
            logger.warning("listaUsuarios: " + listaUsuarios.toString());
        }

        UsuarioPT usuarioPT = UsuarioPT();
        ConsultarAtributosUsuarioRequestType request = ConsultarAtributosUsuarioRequest(listaUsuarios);
        ConsultarAtributosUsuarioResponseType responseAtributos = new ConsultarAtributosUsuarioResponseType();

        try {
            Date horaInicio = ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_CONSULTAR_GERENTE_PAIS);
            responseAtributos = usuarioPT.consultarAtributosUsuario(request);
            ModelUtils.logEndWS(logger, responseAtributos, FenixModelConstants.WSC_CONSULTAR_GERENTE_PAIS, horaInicio);
        } catch (Exception e) {
            logger.log(ADFLogger.ERROR, "Error al obtener el gerente de pais", e);
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al obtener lo atributos del usuario. Intentelo más tarde."));
            throw ex;
        }

        return mapeoDependenciasEmitirVoto(responseAtributos, response);
    }

    private ConsultarAtributosUsuarioRequestType ConsultarAtributosUsuarioRequest(List<String> listaUsuarios) {
        ConsultarAtributosUsuarioRequestType request = new ConsultarAtributosUsuarioRequestType();

        if (null != listaUsuarios) {
            ListaNombres listaNombres = new ListaNombres();
            for (String usuario : listaUsuarios) {
                listaNombres.getNombreUsuario().add(usuario);
            }
            request.setListaNombres(listaNombres);
        }

        return request;
    }

    private UsuarioPT UsuarioPT() {
        String wsdl = getWsdl(IWsdlLocation.USUARIO);

        Usuario12BndQSService usuario12BndQSService =
            IWsdlLocation.Service.getInstance(Usuario12BndQSService.class, wsdl);
        UsuarioPT usuarioPT = usuario12BndQSService.getUsuario12BndQSPort();

        return usuarioPT;
    }

    private ConfigurarSolicitudAprobacionResponseType mapeoDependenciasConNotificacion(ConsultarAtributosUsuarioResponseType responseAtributos,
                                                                                       ConfigurarSolicitudAprobacionResponseType response) {
        ListaUsuarios usuarios = new ListaUsuarios();

        if (responseAtributos.getResultado().getResult().value().equalsIgnoreCase("OK")) {
            usuarios = responseAtributos.getListaUsuarios();

            List<UsuarioReunion> listaUsuarioReunion =
                response.getListadoConNotificacion().get(0).getMiembroReunion().get(0).getListadoUsuarios().getUsuario();

            for (UsuarioReunion usuarioReunion : listaUsuarioReunion) {
                for (Usuario usuario : usuarios.getUsuario()) {
                    if (null != usuarioReunion && null != usuario && null != usuarioReunion.getUsuario() &&
                        null != usuario.getNombreUsuario()) {
                        if (usuarioReunion.getUsuario().equals(usuario.getNombreUsuario())) {
                            usuarioReunion.setDependecia(usuario.getDependencia());
                            break;
                        }
                    }
                }
            }
        }

        return response;
    }

    private ConfigurarSolicitudAprobacionResponseType mapeoDependenciasEmitirVoto(ConsultarAtributosUsuarioResponseType responseAtributos,
                                                                                  ConfigurarSolicitudAprobacionResponseType response) {
        ListaUsuarios usuarios = new ListaUsuarios();

        if (responseAtributos.getResultado().getResult().value().equalsIgnoreCase("OK")) {
            usuarios = responseAtributos.getListaUsuarios();

            List<UsuarioReunion> listaUsuarioReunion =
                response.getListadoEmitirVoto().get(0).getMiembroReunion().get(0).getListadoUsuarios().getUsuario();

            for (UsuarioReunion usuarioReunion : listaUsuarioReunion) {
                for (Usuario usuario : usuarios.getUsuario()) {
                    if (null != usuarioReunion && null != usuario && null != usuarioReunion.getUsuario() &&
                        null != usuario.getNombreUsuario()) {
                        if (usuarioReunion.getUsuario().equals(usuario.getNombreUsuario())) {
                            logger.warning("Rol : " + usuario.getNombreCompleto() + " Es propetario : " +
                                           usuario.isPropietario());
                            usuarioReunion.setDependecia(usuario.getDependencia());
                            usuarioReunion.setPropietario(usuario.isPropietario());
                            break;
                        }
                    }
                }
            }
        }

        return response;
    }

    public Boolean enviarCorreoCuestionarioElegibilidad(Long idOperacion, String responsable) {
        logger.warning("Entra en metodo enviarCorreoCuestionarioElegibilidad.");
        Boolean respuesta = Boolean.TRUE;
        String errorService = null;
        String gerente = null;

        String wsdl = this.getWsdl(IWsdlLocation.CORREO_ELECTRONICO);
        CorreoElectronicoDTO objetoCorreo = new CorreoElectronicoDTO();
        org.bcie.correobo.Usuario usuario = new org.bcie.correobo.Usuario();


        CorreoElectronico12BndQSService correoService =
            IWsdlLocation.Service.getInstance(CorreoElectronico12BndQSService.class, wsdl);
        CorreoElectronicoPT correoPT = correoService.getCorreoElectronico12BndQSPort();

        EnviarCorreoElectronicoRequestType request = new EnviarCorreoElectronicoRequestType();
        EnviarCorreoElectronicoResponseType response = null;


        try {
            gerente = obtenerGerenteResponsable(responsable);
            if (null != gerente) {
                usuario.getUsuario().add(gerente);
            } else {
                logger.warning("El gerente es nulo.");
            }
            usuario.getUsuario().add(responsable);

            objetoCorreo.setIdOperacion(idOperacion);
            objetoCorreo.setTo(usuario);
            objetoCorreo.setIdPlantilla(FenixModelConstants.PLANTILLA_ACTUALIZACION_CUESTIONARIO_ELEGIBILIDAD);

            request.setCorreoElectronico(objetoCorreo);

            java.util.Date horaInicio =
                ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_ENVIAR_CORRO_ELECTRONICO);
            response = correoPT.enviarCorreoElectronico(request);
            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_ENVIAR_CORRO_ELECTRONICO, horaInicio);
        } catch (Exception e) {
            logger.warning("Ha ocurrido un error al ejecutar enviarCorreoElectronico service-> ", e);
            errorService = "Ha ocurrido un error al ejecutar enviarCorreoElectronico service " + e.getMessage();
            respuesta = Boolean.FALSE;
        }
        logger.warning("*Inf, Termina el metodo enviarCorreoCuestionarioElegibilidad ");
        return respuesta;
    }

    private String obtenerGerenteResponsable(String responsableOperacion) {
        logger.warning("Entra en metodo obtenerGerenteResponsable");
        String manager = null;

        if (null != responsableOperacion) {
            String wsdl = getWsdl(IWsdlLocation.USUARIO);
            Usuario12BndQSService datosUsuarioService =
                IWsdlLocation.Service.getInstance(Usuario12BndQSService.class, wsdl);
            UsuarioPT usuariosPT = datosUsuarioService.getUsuario12BndQSPort();

            ConsultarAtributosUsuarioRequestType request = new ConsultarAtributosUsuarioRequestType();

            ListaNombres lista = new ListaNombres();
            lista.getNombreUsuario().add(responsableOperacion);
            request.setListaNombres(lista);

            try {
                Date horaInicio =
                    ModelUtils.logStartWS(logger, request, FenixModelConstants.WSC_VALIDAR_GERENTE_RESPONSABLE);
                ConsultarAtributosUsuarioResponseType response = usuariosPT.consultarAtributosUsuario(request);
                ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_VALIDAR_GERENTE_RESPONSABLE, horaInicio);

                if (null != response.getResultado().getResult() &&
                    response.getResultado().getResult().toString().equalsIgnoreCase("OK")) {
                    ListaUsuarios usuarios = response.getListaUsuarios();
                    for (Usuario usuario : usuarios.getUsuario()) {
                        manager = usuario.getManager();
                        logger.warning("Gerente responsable : " + manager);
                    }
                }
            } catch (Exception e) {
                logger.log(ADFLogger.ERROR,
                           "Error en obtenerGerenteResponsable " + e.getClass() + ":" + e.getMessage());

                JboException ex = new JboException(e);
                ex.addToExceptions(new Exception("Error en obtenerGerenteResponsable " + e.getClass() + ":" +
                                                 e.getMessage()));
                throw ex;
            }

        }
        logger.warning("Termina metodo obtenerGerenteResponsable");
        return manager;
    }

    // SPS | 08/11/2019 - Se agrega metodo para actualizar Clasificacion Ambiental

    /**
     * Método que actualiza la informacion de Clasificacion Ambiental en DB.
     * @author : S&P Solutions
     * @param  : ActualizarOperacionRequestType request
     * @return : Map
     * @version: v1.0
     * @Fecha  : 05/11/2019
     */
    public Map actualizarClasificacionAmbiental(ActualizarOperacionRequestType request) {
        logger.warning("\n=== Dentro de: actualizarClasificacionAmbiental | idOperacion:" + request.getOperacion().getIdOperacion());
        double TInicio, TFin, tiempo; 
        HashMap<String, ActualizarOperacionResponseType> respuestaServicio = null;    
        StringWriter xmlRequest = null;
        
        try {
            FenixAMImpl fenixAMImpl = (FenixAMImpl) this.getRootApplicationModule();
            String wsdl = fenixAMImpl.getWsdl(IWsdlLocation.OPERACION);

            Operacion12BndQSService operacion12BndQSService =
                IWsdlLocation.Service.getInstance(Operacion12BndQSService.class, wsdl);
            Operacion12Port operacion12Port = operacion12BndQSService.getOperacion12BndQSPort();
            //Request , Response
            ActualizarOperacionResponseType response = new ActualizarOperacionResponseType();
            respuestaServicio = new HashMap<String, ActualizarOperacionResponseType>();
            try {
                TInicio = System.currentTimeMillis();
                xmlRequest = this.writeXMLRequest(request, request.getClass());
                 logger.warning("\n=====> HNWS" + xmlRequest.toString());
                response = operacion12Port.actualizarOperacion(request);
                respuestaServicio.put("response", response);
                
                TFin =
                    System.currentTimeMillis(); //Tomamos la hora en que finalizó el algoritmo y la almacenamos en la variable T
                tiempo = (TFin - TInicio) / 1000; //Calculamos los milisegundos de diferencia
                logger.warning("\n=== Inf, termina metodo actualizarClasificacionAmbiental con una duracion de: " + tiempo +
                               " segundos");
            } catch (Exception e) {
                e.printStackTrace();
            }
        } catch (Exception e) {
            logger.warning("\n=== Error, la definicion del WSDL_OPERACION no esta disponible ->", e);
            throw new JboException("ha ocurrido un error al consultar la definicion del WSDL_OPERACION no esta disponible");
        }
        return respuestaServicio;
    }


    // ======== FIN  metodos de actualizacacion de CA===

    /**
     * Container's getter for ConsultarUsuarioReunionAprobacionVO1.
     * @return ConsultarUsuarioReunionAprobacionVO1
     */
    public ConsultarUsuarioReunionAprobacionVOImpl getConsultarUsuarioReunionAprobacionVO() {
        return (ConsultarUsuarioReunionAprobacionVOImpl) findViewObject("ConsultarUsuarioReunionAprobacionVO");
    }

    /**
     * Container's getter for DecisionReunionAprobacionUpdateVO1.
     * @return DecisionReunionAprobacionUpdateVO1
     */
    public DecisionReunionAprobacionUpdateVOImpl getDecisionReunionAprobacionUpdateVO1() {
        return (DecisionReunionAprobacionUpdateVOImpl) findViewObject("DecisionReunionAprobacionUpdateVO1");
    }

    /**
     * Container's getter for TreContrapartesTerminoVO1.
     * @return TreContrapartesTerminoVO1
     */
    public TreContrapartesTerminoVOImpl getTreContrapartesTerminoVO() {
        return (TreContrapartesTerminoVOImpl) findViewObject("TreContrapartesTerminoVO");
    }

    /**
     * Container's getter for DetalleContratoDesembolsoVO1.
     * @return DetalleContratoDesembolsoVO1
     */
    public DetalleContratoDesembolsoVOImpl getDetalleContratoDesembolsoVO() {
        return (DetalleContratoDesembolsoVOImpl) findViewObject("DetalleContratoDesembolsoVO");
    }

    /**
     * Container's getter for ValidarEstadoCondicionesVO1.
     * @return ValidarEstadoCondicionesVO1
     */
    public ValidarEstadoCondicionesVOImpl getValidarEstadoCondicionesVO() {
        return (ValidarEstadoCondicionesVOImpl) findViewObject("ValidarEstadoCondicionesVO");
    }

    /**
     * Container's getter for TcaTareaBpmVO1.
     * @return TcaTareaBpmVO1
     */
    public TcaTareaBpmVOImpl getTcaTareaBpmVO() {
        return (TcaTareaBpmVOImpl) findViewObject("TcaTareaBpmVO");
    }

    /**
     * Container's getter for TimeLineEvaluacionExpostVO1.
     * @return TimeLineEvaluacionExpostVO1
     */
    public TimeLineEvaluacionExpostVOImpl getTimeLineEvaluacionExpostVO() {
        return (TimeLineEvaluacionExpostVOImpl) findViewObject("TimeLineEvaluacionExpostVO");
    }

    /**
     * Container's getter for TimeLineFechaUltimoDesembolsoVO1.
     * @return TimeLineFechaUltimoDesembolsoVO1
     */
    public TimeLineFechaUltimoDesembolsoVOImpl getTimeLineFechaUltimoDesembolsoVO() {
        return (TimeLineFechaUltimoDesembolsoVOImpl) findViewObject("TimeLineFechaUltimoDesembolsoVO");
    }

    /**
     * Container's getter for ConsultarProductoByOperacionVO1.
     * @return ConsultarProductoByOperacionVO1
     */
    public ConsultarProductoByOperacionVOImpl getConsultarProductoByOperacionVO() {
        return (ConsultarProductoByOperacionVOImpl) findViewObject("ConsultarProductoByOperacionVO");
    }

    /**
     * Container's getter for ConsutarCondicionVO1.
     * @return ConsutarCondicionVO1
     */
    public ConsutarCondicionVOImpl getConsutarCondicionVO() {
        return (ConsutarCondicionVOImpl) findViewObject("ConsutarCondicionVO");
    }

    /**
     * Container's getter for SectorMercadoVO1.
     * @return SectorMercadoVO1
     */
    public SectorMercadoVOImpl getSectorMercadoVO() {
        return (SectorMercadoVOImpl) findViewObject("SectorMercadoVO");
    }

    /**
     * Container's getter for ProcesoOperacionVO1.
     * @return ProcesoOperacionVO1
     */
    public ProcesoOperacionVOImpl getProcesoOperacionVO() {
        return (ProcesoOperacionVOImpl) findViewObject("ProcesoOperacionVO");
    }

    /**
     * Container's getter for TbiDocumentoVO1.
     * @return TbiDocumentoVO1
     */
    public TbiDocumentoVOImpl getTbiDocumentoVO() {
        return (TbiDocumentoVOImpl) findViewObject("TbiDocumentoVO");
    }

    /**
     * Container's getter for RecuperarDatosLineaById1.
     * @return RecuperarDatosLineaById1
     */
    public RecuperarDatosLineaByIdImpl getRecuperarDatosLineaById() {
        return (RecuperarDatosLineaByIdImpl) findViewObject("RecuperarDatosLineaById");
    }

    public ConsultarAdjuntoVOImpl getConsultarAdjuntoVO() {
        return (ConsultarAdjuntoVOImpl) findViewObject("ConsultarAdjuntoVO");
    }

    /**
     * Container's getter for ProcesoClienteVO1.
     * @return ProcesoClienteVO1
     */
    public ProcesoClienteVOImpl getProcesoClienteVO() {
        return (ProcesoClienteVOImpl) findViewObject("ProcesoClienteVO");
    }

    /**
     * Container's getter for ValidaProcesoIniciadoByOperacionVO1.
     * @return ValidaProcesoIniciadoByOperacionVO1
     */
    public ValidaProcesoIniciadoByOperacionVOImpl getValidaProcesoIniciadoByOperacionVO() {
        return (ValidaProcesoIniciadoByOperacionVOImpl) findViewObject("ValidaProcesoIniciadoByOperacionVO");
    }

    /**
     * Container's getter for ConsultarPreguntasRolVO1.
     * @return ConsultarPreguntasRolVO1
     */
    public ConsultarPreguntasRolVOImpl getConsultarPreguntasRolVO() {
        return (ConsultarPreguntasRolVOImpl) findViewObject("ConsultarPreguntasRolVO");
    }

    /**
     * Container's getter for TcaMiembroReunionVO1.
     * @return TcaMiembroReunionVO1
     */
    public TcaMiembroReunionVOImpl getTcaMiembroReunionVO() {
        return (TcaMiembroReunionVOImpl) findViewObject("TcaMiembroReunionVO");
    }

    /**
     * Container's getter for TreComiteRolBpmVO1.
     * @return TreComiteRolBpmVO1
     */
    public TreComiteRolBpmVOImpl getTreComiteRolBpmVO() {
        return (TreComiteRolBpmVOImpl) findViewObject("TreComiteRolBpmVO");
    }

    /**
     * Container's getter for ConsultarOperacionVO1.
     * @return ConsultarOperacionVO1
     */
    public ConsultarOperacionVOImpl getConsultarOperacionVO() {
        return (ConsultarOperacionVOImpl) findViewObject("ConsultarOperacionVO");
    }

    /**
     * Container's getter for OperacionesClienteVO1.
     * @return OperacionesClienteVO1
     */
    public OperacionesClienteVOImpl getOperacionesRelacionadasClienteVO() {
        return (OperacionesClienteVOImpl) findViewObject("OperacionesRelacionadasClienteVO");
    }

    /**
     * Container's getter for ValidarOperacionTareaTipoDocumentoVO1.
     * @return ValidarOperacionTareaTipoDocumentoVO1
     */
    public ValidarOperacionTareaTipoDocumentoVOImpl getValidarOperacionTareaTipoDocumentoVO1() {
        return (ValidarOperacionTareaTipoDocumentoVOImpl) findViewObject("ValidarOperacionTareaTipoDocumentoVO1");
    }
	
	/**
	* Container's getter for DatosGeneralesIntermediacionVO1.
	* @return DatosGeneralesIntermediacionVO1
	*/
	public DatosGeneralesIntermediacionVOImpl getDatosGeneralesIntermediacionVO1() {
		return (DatosGeneralesIntermediacionVOImpl) findViewObject("DatosGeneralesIntermediacionVO1");
	}
	

    /**
     * Container's getter for ClasificacionEstrategicaVO1.
     * @return ClasificacionEstrategicaVO1
     */
    public ClasificacionEstrategicaVOImpl getClasificacionEstrategicaVO1() {
        return (ClasificacionEstrategicaVOImpl) findViewObject("ClasificacionEstrategicaVO1");
    }

    /**
     * Container's getter for ViewObj1.
     * @return ViewObj1
     */
    public DetalleClasificacionEstrategicaVOImpl getViewObj1() {
        return (DetalleClasificacionEstrategicaVOImpl) findViewObject("ViewObj1");
    }

    /**
     * Container's getter for DetalleClasificacionEstrategicaVO1.
     * @return DetalleClasificacionEstrategicaVO1
     */
    public DetalleClasificacionEstrategicaVOImpl getDetalleClasificacionEstrategicaVO1() {
        return (DetalleClasificacionEstrategicaVOImpl) findViewObject("DetalleClasificacionEstrategicaVO1");
    }

    /**
     * Container's getter for DatosDesembolsoClasificacionEstrategicaVO1.
     * @return DatosDesembolsoClasificacionEstrategicaVO1
     */
    public DatosDesembolsoClasificacionEstrategicaVOImpl getDatosDesembolsoClasificacionEstrategicaVO1() {
        return (DatosDesembolsoClasificacionEstrategicaVOImpl) findViewObject("DatosDesembolsoClasificacionEstrategicaVO1");
    }
	    /**
     * Container's getter for TcaTipoFrecuenciaVO1.
     * @return TcaTipoFrecuenciaVO1
     */
    public TcaTipoFrecuenciaVOImpl getTcaTipoFrecuenciaVO1() {
        return (TcaTipoFrecuenciaVOImpl) findViewObject("TcaTipoFrecuenciaVO1");
    }

    /**
     * Container's getter for TcaTipoMoraVO1.
     * @return TcaTipoMoraVO1
     */
    public TcaTipoMoraVOImpl getTcaTipoMoraVO1() {
        return (TcaTipoMoraVOImpl) findViewObject("TcaTipoMoraVO1");
    }

    /**
     * Container's getter for TcaTipoRedondeoVO1.
     * @return TcaTipoRedondeoVO1
     */
    public TcaTipoRedondeoVOImpl getTcaTipoRedondeoVO1() {
        return (TcaTipoRedondeoVOImpl) findViewObject("TcaTipoRedondeoVO1");
    }

    /**
     * Container's getter for DiasSpotTasaVO1.
     * @return DiasSpotTasaVO1
     */
    public DiasSpotTasaVOImpl getDiasSpotTasaVO1() {
        return (DiasSpotTasaVOImpl) findViewObject("DiasSpotTasaVO1");
    }

    /**
     * Container's getter for CodigoTasaReferencia1.
     * @return CodigoTasaReferencia1
     */
    public CodigoTasaReferenciaImpl getCodigoTasaReferencia1() {
        return (CodigoTasaReferenciaImpl) findViewObject("CodigoTasaReferencia1");
    }

    /**
     * Container's getter for TcaAporteAmbientalVO1.
     * @return TcaAporteAmbientalVO1
     */
    public TcaAporteAmbientalVOImpl getTcaAporteAmbientalVO1() {
        return (TcaAporteAmbientalVOImpl) findViewObject("TcaAporteAmbientalVO1");
    }

    /**
     * Container's getter for TcaCategoriaAmbientalVO1.
     * @return TcaCategoriaAmbientalVO1
     */
    public TcaCategoriaAmbientalVOImpl getTcaCategoriaAmbientalVO1() {
        return (TcaCategoriaAmbientalVOImpl) findViewObject("TcaCategoriaAmbientalVO1");
    }

    /**
     * Container's getter for TcaSectorAmbientalVO1.
     * @return TcaSectorAmbientalVO1
     */
    public TcaSectorAmbientalVOImpl getTcaSectorAmbientalVO1() {
        return (TcaSectorAmbientalVOImpl) findViewObject("TcaSectorAmbientalVO1");
    }

    /**
     * Container's getter for TcaSubcategoriaAmbientalVO1.
     * @return TcaSubcategoriaAmbientalVO1
     */
    public TcaSubcategoriaAmbientalVOImpl getTcaSubcategoriaAmbientalVO1() {
        return (TcaSubcategoriaAmbientalVOImpl) findViewObject("TcaSubcategoriaAmbientalVO1");
    }

    /**
     * Container's getter for DetalleClasificacionAmbientalVO1.
     * @return DetalleClasificacionAmbientalVO1
     */
    public DetalleClasificacionAmbientalVOImpl getDetalleClasificacionAmbientalVO1() {
        return (DetalleClasificacionAmbientalVOImpl) findViewObject("DetalleClasificacionAmbientalVO1");
    }

    /**
     * Container's getter for ClasificacionAmbientalVO1.
     * @return ClasificacionAmbientalVO1
     */
    public ClasificacionAmbientalVOImpl getClasificacionAmbientalVO1() {
        return (ClasificacionAmbientalVOImpl) findViewObject("ClasificacionAmbientalVO1");
    }


    /**
     * Container's getter for ActualizarClasificacionAmbientalVO1.
     * @return ActualizarClasificacionAmbientalVO1
     */
    public ActualizarClasificacionAmbientalVOImpl getActualizarClasificacionAmbientalVO1() {
        return (ActualizarClasificacionAmbientalVOImpl) findViewObject("ActualizarClasificacionAmbientalVO1");
    }

    /**
     * Container's getter for ClasificacionEstrategicaEditableVO1.
     * @return ClasificacionEstrategicaEditableVO1
     */
    public ClasificacionEstrategicaEditableVOImpl getClasificacionEstrategicaEditableVO1() {
        return (ClasificacionEstrategicaEditableVOImpl) findViewObject("ClasificacionEstrategicaEditableVO1");
    }

    /**
     * Container's getter for ClasificacionAmbientalEditableVO1.
     * @return ClasificacionAmbientalEditableVO1
     */
    public ClasificacionAmbientalEditableVOImpl getClasificacionAmbientalEditableVO1() {
        return (ClasificacionAmbientalEditableVOImpl) findViewObject("ClasificacionAmbientalEditableVO1");
    }

    /**
     * Container's getter for ConsultarContratosDesembolsoQueryVO1.
     * @return ConsultarContratosDesembolsoQueryVO1
     */
    public ConsultarContratosDesembolsoQueryVOImpl getConsultarContratosDesembolsoQueryVO1() {
        return (ConsultarContratosDesembolsoQueryVOImpl) findViewObject("ConsultarContratosDesembolsoQueryVO1");
    }

    /**
     * Container's getter for ConsultarIDContratoDesembolsoVO1.
     * @return ConsultarIDContratoDesembolsoVO1
     */
    public ConsultarIDContratoDesembolsoVOImpl getConsultarIDContratoDesembolsoVO1() {
        return (ConsultarIDContratoDesembolsoVOImpl) findViewObject("ConsultarIDContratoDesembolsoVO1");
    }
    
    /**
     * Invoca el inicio del proceso de Formalizacion de Enmiendas.
     *
     * @param params Parametros con los que se iniciara el proceso. Las llaves se encuentran en {@link org.bcie.fenix.common.FenixConstants}.
     * @throws NullPointerException si alguno de los params requeridos es nulo.
     * @trhows IllegalArgumentException si alguno de los params requeridos no es valido.
     */
    public void inicioFormalizacionEnmiendas(final Map<String, Object> params) {
        Objects.requireNonNull(params, "Params no puede ser nulo.");
        logger.info(params.toString());

        //Valida params requeridos
        Objects.requireNonNull(params.get(FenixModelConstants.AM_PARAM_KEY_ORIGEN), "Param origen es requerido.");
        Objects.requireNonNull(params.get(FenixModelConstants.AM_PARAM_KEY_IDOPERACION), "Param idOperacion es requerido.");
        
        Integer origen = (Integer) params.get(FenixModelConstants.AM_PARAM_KEY_ORIGEN);
        if (origen == null || origen < 0 || origen > 5) {
            throw new IllegalArgumentException("Valor de origen no valido.");
        }
        
        //Valida params requeridos para formalizaciones genericas
        if (origen == FenixModelConstants.ORIGEN_FORMALIZACION_ENMIENDA_GENERICO_VALUE) {
            Objects.requireNonNull(params.get(FenixModelConstants.AM_PARAM_KEY_VALIDAR_COND_FINANCIERAS), "Param validarCOF es requerido.");
            Objects.requireNonNull(params.get(FenixModelConstants.AM_PARAM_KEY_DESOBLIGACION), "Param desobigacion es requerido.");
            Objects.requireNonNull(params.get(FenixModelConstants.AM_PARAM_KEY_CAMBIO_PLAZO), "Param cambioPlazo es requerido.");
        }

        String wsdl = getWsdl(IWsdlLocation.PROCESOS_ALTERNOS);
        ProcesosAlternosBindingQSService procesosAlternosBindingQSService =
            IWsdlLocation.Service.getInstance(ProcesosAlternosBindingQSService.class, wsdl);
        ProcesosAlternosPortType procesosAlternosPortType =
            procesosAlternosBindingQSService.getProcesosAlternosBindingQSPort();
        if (procesosAlternosPortType != null) {
            logger.info(">HNWS" + procesosAlternosPortType.toString());
        }

        Long idOperacion = (Long) params.get(FenixModelConstants.AM_PARAM_KEY_IDOPERACION);
        org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion operacion =
            new org.bcie.xmlns.objetoproceso.comun.operacion.v1.Operacion();
        operacion.setCodigoOperacion(idOperacion.intValue());
        operacion.setNombreOperacion((String) params.get(FenixModelConstants.AM_PARAM_KEY_DESCRIPCION));
        operacion.setCodigoCliente((String) params.get(FenixModelConstants.AM_PARAM_KEY_CODCLIENTE));
        operacion.setNombreCliente((String) params.get(FenixModelConstants.AM_PARAM_KEY_NOMCLIENTE));
        operacion.setCodigoProducto((Integer) params.get(FenixModelConstants.AM_PARAM_KEY_CODPRODUCTO));
        operacion.setNombreProducto((String) params.get(FenixModelConstants.AM_PARAM_KEY_NOMPRODUCTO));
        operacion.setMontoSolicitado((BigDecimal) params.get(FenixModelConstants.AM_PARAM_KEY_MONTOSOLICITADO));
        operacion.setPais((String) params.get(FenixModelConstants.AM_PARAM_KEY_PAIS));
        operacion.setResponsableOperacion((String) params.get(FenixModelConstants.AM_PARAM_KEY_RESPONSABLE));

        Header header = new Header();
        header.setOperacion(operacion);
        
        //Adiciona params requeridos por el proceso
        ParameterType parameterTypeTipoFormalizacion = new ParameterType();
        parameterTypeTipoFormalizacion.setParameterName(PARAM_TIPO_FORMALIZACIONENMIENDA);
        parameterTypeTipoFormalizacion.setParameterValue(PARAM_DEFAULT_ID);

        ParameterType parameterTypeTipoInicio = new ParameterType();
        parameterTypeTipoInicio.setParameterName(PARAM_TIPOINICIO);
        parameterTypeTipoInicio.setParameterValue(PARAM_DEFAULT_ID);

        header.getParameterType().add(parameterTypeTipoFormalizacion);
        header.getParameterType().add(parameterTypeTipoInicio);

        ConfigGatewaysType cfg = null;
        if (origen == FenixModelConstants.ORIGEN_FORMALIZACION_ENMIENDA_GENERICO_VALUE) {
            cfg = new ConfigGatewaysType();
            cfg.setRequiereCOF((Boolean) params.get(FenixModelConstants.AM_PARAM_KEY_VALIDAR_COND_FINANCIERAS));
            cfg.setEsDesobligacion((Boolean) params.get(FenixModelConstants.AM_PARAM_KEY_DESOBLIGACION));
            cfg.setEsCambioPlazo((Boolean) params.get(FenixModelConstants.AM_PARAM_KEY_CAMBIO_PLAZO));
        }

        Resultado response = null;
        try {

            if (logger.isInfo()) {
                StringWriter xmlEntrada = this.writeXMLRequest(header, header.getClass());
                logger.info(">HNWS" + xmlEntrada.toString());
            }

            Date horaInicio =
                ModelUtils.logStartWS(logger, header, FenixModelConstants.WSC_INICIO_FORMALIZACION_ENMIENDA);

            //idEnmienda es opcional debido al hecho de que existen las formalizaciones de enmiendas genï¿½ricas. Por ello no se valida antes.
            Long idEnmiendaLong = (Long) params.get(FenixModelConstants.AM_PARAM_KEY_IDENMIENDA);
            Integer idEnmiendaInt = idEnmiendaLong != null ? idEnmiendaLong.intValue() : null;
            response = procesosAlternosPortType.inicioFormalizacionEnmiendas(header, origen, idEnmiendaInt, cfg);

            ModelUtils.logEndWS(logger, response, FenixModelConstants.WSC_INICIO_FORMALIZACION_ENMIENDA, horaInicio);

            if (logger.isInfo()) {
                StringWriter xmlSalida = this.writeXMLRequest(response, response.getClass());
                logger.info(">HNWS" + xmlSalida.toString());
            }

        } catch (Exception e) {
            logger.severe("Error en inicioFormalizacionEnmiendas " + e.getClass() + ":" + e.getMessage(), e);

            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error en inicioFormalizacionEnmiendas " + e.getClass() + ":" +
                                             e.getMessage()));

            throw ex;
        }

        //Verifica si hubo algun mensaje de error como respuesta
        if (null != response.getError() ||
            (response.getResult() != null && "ERROR".equals(response.getResult().value()))) {
            String mensajeError = "";
            String detalleError = "";

            if (null != response.getMessage() && !response.getMessage().trim().isEmpty()) {
                mensajeError = response.getMessage();
            }
            if (null != response.getError() && null != response.getError().getErrorDescription() &&
                !response.getError().getErrorDescription().trim().isEmpty()) {
                detalleError = response.getError().getErrorDescription();
            }

            String msgError =
                "No es posible iniciar el proceso de formalizacion de enmiendas. Operacion: " + idOperacion + ". Mensaje: " +
                mensajeError + ". " + detalleError;
            throw new JboException(msgError);
        }
        
    }

    public BigDecimal modificaMontoAmpliacion(Long idOperacion) {
        logger.log(ADFLogger.WARNING, "[modificaMontoAmpliacion] " + idOperacion);
        Integer amplicacion = 26;
        OperaAsociadaVORowImpl rowAso = null;
        BigDecimal SumaMontosEscriturados = null;
        logger.log(ADFLogger.WARNING, "***consultandoOperacionActual****");
        logger.log(ADFLogger.WARNING, "***saliendo de consultarOperacionActual****");
        OperacionGenericoVORowImpl operacionActual = consultarOperacion(idOperacion);
        if (operacionActual != null) {
            logger.log(ADFLogger.WARNING, "[operacionActual.getIdProducto()]>" + operacionActual.getIdProducto() + "<");
            logger.log(ADFLogger.WARNING, "[amplicacion]>" + amplicacion + "<");
            Integer idProductoDB = Integer.valueOf(operacionActual.getIdProducto().intValue());
            Integer idProductoStatic = Integer.valueOf(amplicacion.intValue());
            logger.log(ADFLogger.WARNING, "[idProductoDB.intValue]>" + idProductoDB + "<");
            logger.log(ADFLogger.WARNING, "[idProductoStatic.intValue]>" + idProductoStatic + "<");
            if (idProductoDB == idProductoStatic) { //Si es tipoAmpliacion, consulta la relacion con la primera operacion
                logger.log(ADFLogger.WARNING, "***Entrando a IF porque 26=26****");
                logger.log(ADFLogger.WARNING, "[consultandoOperacionesAsociadas] " + idOperacion);
                rowAso = consultarOperacionesAsociadas(idOperacion);
                logger.log(ADFLogger.WARNING, "[Saliendo...consultandoOperacionesAsociadas]");
                if (rowAso != null) {
                    logger.log(ADFLogger.WARNING, "***consultandoOperacionAnterior****");
                    OperacionGenericoVORowImpl operacionAnterior = consultarOperacion(rowAso.getIdOpAsoc());
                    logger.log(ADFLogger.WARNING, "***Sumando los montos****");
                    logger.log(ADFLogger.WARNING, "***MontoOperacionActual****" + operacionActual.getMonto());
                    logger.log(ADFLogger.WARNING, "***MontoOperacionAnterior****" + operacionAnterior.getMonto());
                    SumaMontosEscriturados = operacionAnterior.getMonto().add(operacionActual.getMonto());
                    logger.log(ADFLogger.WARNING, "***SumaMontosEscriturados****" + SumaMontosEscriturados);
                    //MontoOperacionVOImpl montoOperacion=getMontoOperacionVO();
                    logger.log(ADFLogger.WARNING, "***instancia de getMontoOperacionVO****" + SumaMontosEscriturados);
                    //montoOperacion.actualizarMontoImplementacionPCT(Integer.valueOf(operacionActual.getIdMontoOperacion().intValue()), SumaMontosEscriturados);//cambiar el lunes los valores despues unir hacia el humantask
                }
            }
        }
        return SumaMontosEscriturados;
    }

    private  OperaAsociadaVORowImpl consultarOperacionesAsociadas(Long idOperacion){
                    logger.log(ADFLogger.WARNING, "[consultarOperacionesAsociadas]"+idOperacion);
                    OperaAsociadaVORowImpl aso=null;
                    OperaAsociadaVOImpl asociada=(OperaAsociadaVOImpl)findViewObject("OperaAsociadaVO1");
                    asociada.setoperacion(idOperacion);
                    asociada.executeQuery();
                    logger.log(ADFLogger.WARNING, "[query] "+asociada.getQuery());
                    aso=(OperaAsociadaVORowImpl)asociada.next();
                    logger.log(ADFLogger.WARNING, "[queryAsociadasCreado]");
                    if(aso!=null){
                          logger.log(ADFLogger.WARNING, "Into operacionActual-> "+aso.getIdOperacion());
                                logger.log(ADFLogger.WARNING, "Into operacionAsociada-> "+aso.getIdOpAsoc());
                      }
                    logger.log(ADFLogger.WARNING, "[retornando....]");
                    return aso;
                }
    private OperacionGenericoVORowImpl consultarOperacion(Long IdOperacion){
                logger.log(ADFLogger.WARNING, "[consultarOperacion] "+IdOperacion);
                OperacionGenericoVORowImpl ope=null;
                OperacionGenericoVOImpl query=(OperacionGenericoVOImpl)findViewObject("OperacionGenericoVO1");
                query.setoperacion(IdOperacion);
                query.settipoMonto(4);//escriturado
                logger.log(ADFLogger.WARNING, "[ejecutandoQuery....]");
                query.executeQuery();
                logger.log(ADFLogger.WARNING, "[query] "+query.getQuery());
                ope=(OperacionGenericoVORowImpl)query.next();
                logger.log(ADFLogger.WARNING, "[QueryEjecutado....]");
                if(ope!=null){
                    logger.log(ADFLogger.WARNING, "+ +getIdOperacion "+ope.getIdOperacion());
                    logger.log(ADFLogger.WARNING, "+ +getNombreOperacion "+ope.getNombreOperacion());
                    logger.log(ADFLogger.WARNING, "+ +getRazonSocial "+ope.getRazonSocial());
                    logger.log(ADFLogger.WARNING, "+ +getDescripcionProducto "+ope.getDescripcionProducto());
                    logger.log(ADFLogger.WARNING, "+ +getmonto "+ope.getMonto());
                    logger.log(ADFLogger.WARNING, "+ +getIdTipoMonto "+ope.getIdTipoMonto());
                    logger.log(ADFLogger.WARNING, "+ +getDesTipoMonto "+ope.getDescMonto());
                    logger.log(ADFLogger.WARNING, "+ +getproducto "+ope.getIdProducto());
                }
                logger.log(ADFLogger.WARNING, "************RETORNANDO OBJETO LLENO*************");
            return ope;
            }

    /**
     * Container's getter for OperacionGenericoVO1.
     * @return OperacionGenericoVO1
     */
    public OperacionGenericoVOImpl getOperacionGenericoVO1() {
        return (OperacionGenericoVOImpl) findViewObject("OperacionGenericoVO1");
    }

    /**
     * Container's getter for TimeLineFormalizacionEnmiendaVO1.
     * @return TimeLineFormalizacionEnmiendaVO1
     */
    public TimeLineFormalizacionEnmiendaVOImpl getTimeLineFormalizacionEnmiendaVO() {
        return (TimeLineFormalizacionEnmiendaVOImpl) findViewObject("TimeLineFormalizacionEnmiendaVO");
    }

    /**
     * [KB:14513]
     * Container's getter for VencimientosLineaCreditoVO.
     * @return VencimientosLineaCreditoVO
     */
    public VencimientosLineaCreditoVOImpl getVencimientosLineaCreditoVO() {
        return (VencimientosLineaCreditoVOImpl) findViewObject("VencimientosLineaCreditoVO");
    }

    /**
     * [KB:14513]
     * Container's getter for ComisionesLineaCreditoVO.
     * @return ComisionesLineaCreditoVO
     */
    public ComisionesLineaCreditoVOImpl getComisionesLineaCreditoVO() {
        return (ComisionesLineaCreditoVOImpl) findViewObject("ComisionesLineaCreditoVO");
    }

    /**
     * [KB:14513]
     * Container's getter for TerminosLineaCreditoVO.
     * @return TerminosLineaCreditoVO
     */
    public TerminosLineaCreditoVOImpl getTerminosLineaCreditoVO() {
        return (TerminosLineaCreditoVOImpl) findViewObject("TerminosLineaCreditoVO");
    }

    /**
     * [KB:14513]
     * Container's getter for CuentasClienteOperacionVO.
     * @return CuentasClienteOperacionVO
     */
    public CuentasClienteOperacionVOImpl getCuentasClienteOperacionVO() {
        return (CuentasClienteOperacionVOImpl) findViewObject("CuentasClienteOperacionVO");
    }

    /**
     * [KB:14513]
     * Container's getter for TerminosOperacionVO.
     * @return TerminosOperacionVO
     */
    public TerminosOperacionVOImpl getTerminosOperacionVO() {
        return (TerminosOperacionVOImpl) findViewObject("TerminosOperacionVO");
    }

    /**
     * [KB:14513]
     * Container's getter for ClienteOperacionVO.
     * @return ClienteOperacionVO
     */
    public ClienteOperacionVOImpl getClienteOperacionVO() {
        return (ClienteOperacionVOImpl) findViewObject("ClienteOperacionVO");
    }

    /**
     * [KB:14513]
     * Container's getter for LineaCreditoAsociadaOperacionVO.
     * @return LineaCreditoAsociadaOperacionVO
     */
    public LineaCreditoAsociadaOperacionVOImpl getLineaCreditoAsociadaOperacionVO() {
        return (LineaCreditoAsociadaOperacionVOImpl) findViewObject("LineaCreditoAsociadaOperacionVO");
    }

    /**
     * [KB:14513]
     * Consulta datos de una linea de credito en base de datos y los registra en los objetos de memoria usados en la vista
     * de adin lineas de credito.
     * Tambien configura listas de valores a partir de los datos de la linea de credito.
     * @param idLineaCredito Identificador de la línea de crédito a consultar.
     * @param idProducto Producto actual.
     */
    public void consultarLineaCreditoByIdDesdeBaseDatos(Long idLineaCredito, Integer idProducto) {
        logger.info("Inicia consultarLineaCreditoByIdDesdeBaseDatos.");

        logger.info("idLineaCredito: {0}", idLineaCredito);
        logger.info("idProducto: {0}", idProducto);

        try (BaseBO operacion = new CargarLineaCreditoByIdBO(this, idLineaCredito, idProducto)) {
            //ejecutarla operacion para que se configure la linea de credito para el admin lineas credito
            operacion.execute();
        } catch(Exception e){
            logger.severe("Error al consultarLineaCreditoByIdDesdeBaseDatos.", e);
        }

        logger.info("Finaliza consultarLineaCreditoByIdDesdeBaseDatos.");
    }
    
    /**
     * [KB:14513]
     * Consulta el resumen de líneas de crédito de un contrato y los registra en los objetos de memoria
     * usados en la vista de admin lineas de credito.
     * Si el contrato tiene lineas de credito entonces la información se carga desde base de datos, de lo contrario se
     * consume el servicio de consulta líneas de crédito como se hace en PC05-Formalización.
     * Tambien configura listas de valores a partir de los datos de la linea de credito.
     **/
    public void consultarResumenLineasCreditoOperacion(String idOperacion, String instanciaProceso, Integer idProducto,
                                                       Boolean solicitudContratacion) {
        logger.info("Inicia consultarResumenLineasCreditoOperacion.");

        logger.info("idOperacion: {0}", idOperacion);
        logger.info("instanciaProceso: {0}", instanciaProceso);
        logger.info("idProducto: {0}", idProducto);
        logger.info("solicitudContratacion: {0}", solicitudContratacion);

        Long idOperLong = Long.parseLong(idOperacion);
        //Recupera el contrato por idOperacion e InstanciaProceso
        ContratoVORowImpl contratoRow =
            getContratoVO().getContratoByOperacionInstanciaProceso(idOperLong, instanciaProceso);

        if (contratoRow != null) {
            
            //primero cargamos info del contrato en memoria
            try (BaseBO operacion = new CargarContratoOperacionProcesoBO(this, idOperLong, instanciaProceso)) {
                //ejecutarla operacion para que se configure la linea de credito para el admin lineas credito
                operacion.execute();
            } catch (Exception e) {
                logger.severe("Error al CargarContratoOperacionProcesoBO.", e);
            }

            //se buscan líneas de crédito para el contrato
            LineaCreditoVOImpl lineasContratoVO = this.getLineaCreditoVO();
            lineasContratoVO.setcontratoId(contratoRow.getId());
            lineasContratoVO.executeQuery();

            //en caso de que el contrato cuente con lineas de credito, entonces usarlas. Sino, consumir
            //el servicio de consulta de lineas de credito como se hace en PC05-Formalizacion.
            if (lineasContratoVO.getEstimatedRowCount() > 0) {
                logger.info("Se encontraron líneas crédito del contrato actual. Se procede a cargarlas desde BD.");
                try (BaseBO operacion = new CargarLineasByContratoBO(this, idOperLong, contratoRow.getId())) {
                    //ejecutarla operacion para que se configure la linea de credito para el admin lineas credito
                    operacion.execute();
                } catch (Exception e) {
                    logger.severe("Error al CargarLineasByContratoBO.", e);
                }
            } else {
                logger.info("No se encontraron líneas crédito del contrato actual. Se procede a cargarlas desde WS.");
                //invocar consulta como se hace en PC05-Formalizacion
                this.consultarLineaCredito(idOperacion, instanciaProceso, idProducto, solicitudContratacion);
            }
        } else {
            logger.severe("No se encontro un contrato con idOperacion : " + idOperacion + " instanciaProceso : " +
                          instanciaProceso);
        }
        
        logger.info("Finaliza consultarResumenLineasCreditoOperacion.");
    }
    
    /**
     * [KB:14513]
     * Asegura que exista un contrato para el proceso.
     * Si el contrato no existe entonces se crea uno nuevo.
     * @param idOperacion Operacion actual.
     * @param instanciaProceso Instaancia del proceso actual.
     * @return Identificador del contrato del proceso.
     **/
    public Long asegurarExistenciaContratoProceso(Long idOperacion, String instanciaProceso) {
        logger.info("Inicia asegurarExistenciaContratoProceso.");

        logger.info("idOperacion: {0}", idOperacion);
        logger.info("instanciaProceso: {0}", instanciaProceso);

        //Recupera el contrato por idOperacion e InstanciaProceso
        Long idContrato = null;
        ContratoVORowImpl contratoRow =
            getContratoVO().getContratoByOperacionInstanciaProceso(idOperacion, instanciaProceso);

        if (contratoRow == null) {
            logger.info("Contrato no existente para el proceso. Se creará uno nuevo.");
            
            //primero cargamos info del contrato en memoria
            try (CrearContratoOperacionProcesoBO operacion = new CrearContratoOperacionProcesoBO(this, idOperacion, instanciaProceso)) {
                //ejecutar la operacion para la creacion del contrato
                operacion.execute();
                //se recupera el idContato del proceso creado/consultado por la operacion
                idContrato = operacion.getIdContratoProceso();
            } catch (Exception e) {
                logger.severe("Error al CrearContratoOperacionProcesoBO.", e);
            }

        } else {            
            idContrato = contratoRow.getId();
            logger.info("Contrato existente encontrado idContrato: {0}", contratoRow.getId());
        }
        
        logger.info("Finaliza asegurarExistenciaContratoProceso.");
        
        return idContrato;
    }

    /**
     * Container's getter for LineaCreditoActivaVO1.
     * @return LineaCreditoActivaVO1
     */
    public LineaCreditoActivaVOImpl getLineaCreditoActivaVO1() {
        return (LineaCreditoActivaVOImpl) findViewObject("LineaCreditoActivaVO1");
    }

    /**
     * Container's getter for LineaCreditoActivaVO2.
     * @return LineaCreditoActivaVO2
     */
    public LineaCreditoActivaVOImpl getLineaCreditoActivaVO2() {
        return (LineaCreditoActivaVOImpl) findViewObject("LineaCreditoActivaVO2");
    }

    /**
     * Container's getter for LineaCreditoActivaVO.
     * @return LineaCreditoActivaVO
     */
    public LineaCreditoActivaVOImpl getLineaCreditoActivaVO() {
        return (LineaCreditoActivaVOImpl) findViewObject("LineaCreditoActivaVO");
    }
    /**
     * Container's getter for vtaEvaluacionTipoVO.
     * @return vtaEvaluacionTipoVO
     */
    public ViewObjectImpl getvtaEvaluacionTipoVO() {
        return (ViewObjectImpl) findViewObject("vtaEvaluacionTipoVO");
    }

    /**
     * Container's getter for CFandCalendario1VO1.
     * @return CFandCalendario1VO1
     */
    public CFandCalendario1VOImpl getCFandCalendario1VO() {
        return (CFandCalendario1VOImpl) findViewObject("CFandCalendario1VO");
    }

    /**
     * Container's getter for CFandCC1VO1.
     * @return CFandCC1VO1
     */
    public CFandCC1VOImpl getCFandCC1VO() {
        return (CFandCC1VOImpl) findViewObject("CFandCC1VO");
    }

    /**
     * Container's getter for CFandCC2VO1.
     * @return CFandCC2VO1
     */
    public CFandCC2VOImpl getCFandCC2VO() {
        return (CFandCC2VOImpl) findViewObject("CFandCC2VO");
    }

    /**
     * Container's getter for CFandCC3VO1.
     * @return CFandCC3VO1
     */
    public CFandCC3VOImpl getCFandCC3VO() {
        return (CFandCC3VOImpl) findViewObject("CFandCC3VO");
    }

    /**
     * Container's getter for CFandCC4VO1.
     * @return CFandCC4VO1
     */
    public CFandCC4VOImpl getCFandCC4VO() {
        return (CFandCC4VOImpl) findViewObject("CFandCC4VO");
    }

    /**
     * Container's getter for CFandComponente1VO1.
     * @return CFandComponente1VO1
     */
    public CFandComponente1VOImpl getCFandComponente1VO() {
        return (CFandComponente1VOImpl) findViewObject("CFandComponente1VO");
    }

    /**
     * Container's getter for CFandComponente2VO1.
     * @return CFandComponente2VO1
     */
    public CFandComponente2VOImpl getCFandComponente2VO() {
        return (CFandComponente2VOImpl) findViewObject("CFandComponente2VO");
    }

    /**
     * Container's getter for CFTasaReferenciaVO1.
     * @return CFTasaReferenciaVO1
     */
    public CFTasaReferenciaVOImpl getCFTasaReferenciaVO() {
        return (CFTasaReferenciaVOImpl) findViewObject("CFTasaReferenciaVO");
    }

    /**
     * Container's getter for CFTempVO1.
     * @return CFTempVO1
     */
    public CFTempVOImpl getCFTempVO() {
        return (CFTempVOImpl) findViewObject("CFTempVO");
    }
    public Boolean tieneRiesgoCredito(Integer idProducto){
        Boolean tieneRiesgo = false;
        CatProductoVOImpl catProducto = getCatProductoVO();
        tieneRiesgo = catProducto.tieneRiesgoCredito(idProducto);
        return tieneRiesgo;
    }
    
    
    public void cargarCFTempVO(String idContrato,String idLineaCredito) {
        System.out.println("********** Ejecutando cargarCFTempVO **********");
        try {
            Long IdContratoLinea=null;
            Long IdTcaTipoMora=null;
            BigDecimal SpreadTasa = null;
            BigDecimal ValorTasa=null;
            String CodigoTasaReferencia="";
            Integer FrecuenciaRev=null;
            Integer IdTcaTipoFrecuenciaRev=null;
            Integer DiasSpotTasa=null;
            Long IdTcaTipoRedondeo=null;
            Integer CantidadDecimales=null;
            String TasaMinimaDesembolso="";
            String TasaMaximaDesembolso="";
            // Consultar Linea de credito
            if (idLineaCredito != null) {
                // Consultar Termino
                CFTerminoVOImpl cfTerminoVO = getCFTerminoVO();
                if(cfTerminoVO!=null){
                    Row rowCFTerminoVO = cfTerminoVO.llenarCFTerminoVO(Long.parseLong(idLineaCredito));
                    if (rowCFTerminoVO != null) {
                        System.out.println("********** IdLineaCredito "+rowCFTerminoVO.getAttribute("Id") + "");
                        
                        System.out.println("********** IdContrato "+rowCFTerminoVO.getAttribute("IdContrato") + "");
                        if (rowCFTerminoVO.getAttribute("IdContrato") != null)IdContratoLinea = (Long)rowCFTerminoVO.getAttribute("IdContrato");
                        
                        System.out.println("********** IdTcaTipoMora "+rowCFTerminoVO.getAttribute("IdTcaTipoMora") + "");
                        if (rowCFTerminoVO.getAttribute("IdTcaTipoMora") != null)IdTcaTipoMora = (Long)rowCFTerminoVO.getAttribute("IdTcaTipoMora");
                        
                        System.out.println("********** SpreadTasa "+rowCFTerminoVO.getAttribute("SpreadTasa")+"");
                        if (rowCFTerminoVO.getAttribute("SpreadTasa") != null)SpreadTasa = (BigDecimal)rowCFTerminoVO.getAttribute("SpreadTasa");
                        
                        System.out.println("********** ValorTasa "+rowCFTerminoVO.getAttribute("ValorTasa")+"");
                        if (rowCFTerminoVO.getAttribute("ValorTasa") != null)ValorTasa = (BigDecimal)rowCFTerminoVO.getAttribute("ValorTasa");
                        
                        System.out.println("********** CodigoTasaReferencia "+rowCFTerminoVO.getAttribute("CodigoTasaReferencia")+"");
                        if (rowCFTerminoVO.getAttribute("CodigoTasaReferencia") != null)CodigoTasaReferencia=(String)rowCFTerminoVO.getAttribute("CodigoTasaReferencia");
                        
                        System.out.println("********** FrecuenciaRev "+rowCFTerminoVO.getAttribute("Frecuencia")+"");
                        if (rowCFTerminoVO.getAttribute("Frecuencia") != null)FrecuenciaRev=(Integer)rowCFTerminoVO.getAttribute("Frecuencia");
                        
                        System.out.println("********** IdTcaTipoFrecuenciaRev "+rowCFTerminoVO.getAttribute("IdTcaTipoFrecuencia")+"");
                        if (rowCFTerminoVO.getAttribute("IdTcaTipoFrecuencia") != null)IdTcaTipoFrecuenciaRev=(Integer)rowCFTerminoVO.getAttribute("IdTcaTipoFrecuencia");
                        
                        System.out.println("********** DiasSpotTasa "+rowCFTerminoVO.getAttribute("DiasSpotTasa")+"");
                        if (rowCFTerminoVO.getAttribute("DiasSpotTasa") != null)DiasSpotTasa=(Integer)rowCFTerminoVO.getAttribute("DiasSpotTasa");
                        
                        System.out.println("********** IdTcaTipoRedondeo "+rowCFTerminoVO.getAttribute("IdTcaTipoRedondeo")+"");
                        if (rowCFTerminoVO.getAttribute("IdTcaTipoRedondeo") != null)IdTcaTipoRedondeo=(Long)rowCFTerminoVO.getAttribute("IdTcaTipoRedondeo");
                        
                        System.out.println("********** CantidadDecimales "+rowCFTerminoVO.getAttribute("CantidadDecimales")+"");
                        if (rowCFTerminoVO.getAttribute("CantidadDecimales") != null)CantidadDecimales=(Integer)rowCFTerminoVO.getAttribute("CantidadDecimales");
                        
                        System.out.println("********** TASA_MINIMA_DESEMBOLSO: " + rowCFTerminoVO.getAttribute("TasaMinimaDesembolso") + "");
                        if (rowCFTerminoVO.getAttribute("TasaMinimaDesembolso") != null)TasaMinimaDesembolso=rowCFTerminoVO.getAttribute("TasaMinimaDesembolso")+"";
                        
                        System.out.println("********** TASA_MAXIMA_DESEMBOLSO: " + rowCFTerminoVO.getAttribute("TasaMaximaDesembolso") + "");
                        if (rowCFTerminoVO.getAttribute("TasaMaximaDesembolso") != null)TasaMaximaDesembolso=rowCFTerminoVO.getAttribute("TasaMaximaDesembolso")+"";
                    }
                }
                
            }
            
            //Creando row CFTemp
            CFTempVOImpl cftempVO = getCFTempVO();
            CFTempVORowImpl newRowTemp = (CFTempVORowImpl) cftempVO.createRow();
            
            //Componente Principal
            CFandCalendario1VOImpl cfandCalendario1VO = getCFandCalendario1VO();
            Row rowCFandCalendario1VO = cfandCalendario1VO.llenarCFandCal(idContrato);
            System.out.println("datos rowCFandCalendario1VO: ");
            if (rowCFandCalendario1VO != null) {
                System.out.println("IdCalendario1: " + rowCFandCalendario1VO.getAttribute("Id") + "");
                if (rowCFandCalendario1VO.getAttribute("Id") != null)newRowTemp.setAttribute("idCalendario1", rowCFandCalendario1VO.getAttribute("Id") + "");

                System.out.println("Fecha: " + rowCFandCalendario1VO.getAttribute("Fecha") + "");
                if (rowCFandCalendario1VO.getAttribute("Fecha") != null)newRowTemp.setAttribute("FechaPrimerPagoCapital", rowCFandCalendario1VO.getAttribute("Fecha"));

                System.out.println("Frecuencia: " + rowCFandCalendario1VO.getAttribute("Frecuencia") + "");
                if (rowCFandCalendario1VO.getAttribute("Frecuencia") != null)newRowTemp.setAttribute("FrecuenciaPagoCapital",rowCFandCalendario1VO.getAttribute("Frecuencia") + "");

                System.out.println("IdTcaTipoFrecuencia: " + rowCFandCalendario1VO.getAttribute("IdTcaTipoFrecuencia") +"");
                if (rowCFandCalendario1VO.getAttribute("IdTcaTipoFrecuencia") != null)newRowTemp.setAttribute("IdTcaFrecuenciaPagoCapital",rowCFandCalendario1VO.getAttribute("IdTcaTipoFrecuencia") + "");

                System.out.println("Cantidad: " + rowCFandCalendario1VO.getAttribute("Cantidad") + "");
                if (rowCFandCalendario1VO.getAttribute("Cantidad") != null)newRowTemp.setAttribute("NumeroCuotasPagoCapital",rowCFandCalendario1VO.getAttribute("Cantidad") + "");
                
            }
            
            
            //Componente Interes
            CFandComponente1VOImpl cfandComponente = getCFandComponente1VO();
            Row rowCFandComponente = cfandComponente.llenarCFandComp(idContrato);
            System.out.println("datos rowCFandComponenteVO: ");
            if (rowCFandComponente != null) {
                System.out.println("IdComponente1: " + rowCFandComponente.getAttribute("Id") + "");
                if (rowCFandComponente.getAttribute("Id") != null)newRowTemp.setAttribute("idComponente1", rowCFandComponente.getAttribute("Id") + "");

                System.out.println("CodigoTasaReferencia: " + rowCFandComponente.getAttribute("CodigoTasaReferencia") +"");
                if (rowCFandComponente.getAttribute("CodigoTasaReferencia") != null)newRowTemp.setAttribute("CodigoTasaReferenciaI",rowCFandComponente.getAttribute("CodigoTasaReferencia") + "");

                System.out.println("ValorTasaReferencia: " + rowCFandComponente.getAttribute("ValorTasaReferencia") +"");
                if (rowCFandComponente.getAttribute("ValorTasaReferencia") != null)newRowTemp.setAttribute("ValorTasaI", rowCFandComponente.getAttribute("ValorTasaReferencia") + "");

                System.out.println("SpreadTasa: " + rowCFandComponente.getAttribute("SpreadTasa") + "");
                if (rowCFandComponente.getAttribute("SpreadTasa") != null)newRowTemp.setAttribute("SpreadI", rowCFandComponente.getAttribute("SpreadTasa") + "");

                System.out.println("Tasa: " + rowCFandComponente.getAttribute("Tasa") + "");
                if (rowCFandComponente.getAttribute("Tasa") != null)newRowTemp.setAttribute("TasaTotalI", rowCFandComponente.getAttribute("Tasa") + "");

                System.out.println("LimiteTasaMinima: " + rowCFandComponente.getAttribute("LimiteTasaMinima") + "");
                if (rowCFandComponente.getAttribute("LimiteTasaMinima") != null)newRowTemp.setAttribute("LimiteTasaMinima",rowCFandComponente.getAttribute("LimiteTasaMinima") + "");

                System.out.println("LimiteTasaMaxima: " + rowCFandComponente.getAttribute("LimiteTasaMaxima") + "");
                if (rowCFandComponente.getAttribute("LimiteTasaMaxima") != null)newRowTemp.setAttribute("LimiteTasaMaxima",rowCFandComponente.getAttribute("LimiteTasaMaxima") + "");

                System.out.println("MontoDescuento: " + rowCFandComponente.getAttribute("MontoDescuento") + "");
                if (rowCFandComponente.getAttribute("MontoDescuento") != null)newRowTemp.setAttribute("MontoDescuento", rowCFandComponente.getAttribute("MontoDescuento") + "");

                System.out.println("idCondicionFinanciera: " +rowCFandComponente.getAttribute("IdCondicionFinanciera") + "");
                if (rowCFandComponente.getAttribute("IdCondicionFinanciera") != null)newRowTemp.setAttribute("idCondicionFinanciera",rowCFandComponente.getAttribute("IdCondicionFinanciera") + "");
                
                System.out.println("DiasSpotI: " +rowCFandComponente.getAttribute("DiasSpotTasa") + "");
                if (rowCFandComponente.getAttribute("DiasSpotTasa") != null)newRowTemp.setAttribute("DiasSpotI",rowCFandComponente.getAttribute("DiasSpotTasa") + "");
                
                System.out.println("IdTcaTipoRedondeo: " +rowCFandComponente.getAttribute("IdTcaTipoRedondeo") + "");
                if (rowCFandComponente.getAttribute("IdTcaTipoRedondeo") != null)newRowTemp.setAttribute("IdTcaTipoRedondeo",rowCFandComponente.getAttribute("IdTcaTipoRedondeo") + "");
                
                System.out.println("CantidadDecimales: " +rowCFandComponente.getAttribute("CantidadDecimales") + "");
                if (rowCFandComponente.getAttribute("CantidadDecimales") != null)newRowTemp.setAttribute("CantidadDecimales",rowCFandComponente.getAttribute("CantidadDecimales") + "");
                
            }
            
            CFandCC1VOImpl CFandCC1VO = getCFandCC1VO();
            Row rowCFandCC1VO = CFandCC1VO.llenarCFandCC1(idContrato);
            System.out.println("datos rowCFandCC1VO: ");
            if (rowCFandCC1VO != null) {
                System.out.println("IdCalendario2: " + rowCFandCC1VO.getAttribute("Id"));
                if (rowCFandCC1VO.getAttribute("Id") != null)newRowTemp.setAttribute("idCalendario2", rowCFandCC1VO.getAttribute("Id") + "");

                System.out.println("FechaProximoPagoInteres: " + rowCFandCC1VO.getAttribute("Fecha"));
                if (rowCFandCC1VO.getAttribute("Fecha") != null)newRowTemp.setAttribute("FechaProximoPagoInteres", rowCFandCC1VO.getAttribute("Fecha"));

                System.out.println("FrecuenciaPagoInteres: " + rowCFandCC1VO.getAttribute("Frecuencia") + "");
                if (rowCFandCC1VO.getAttribute("Frecuencia") != null)newRowTemp.setAttribute("FrecuenciaPagoInteres", rowCFandCC1VO.getAttribute("Frecuencia") + "");

                System.out.println("IdTcaFrecuenciaPagoInteres: " + rowCFandCC1VO.getAttribute("IdTcaTipoFrecuencia") +"");
                if (rowCFandCC1VO.getAttribute("IdTcaTipoFrecuencia") != null)newRowTemp.setAttribute("IdTcaFrecuenciaPagoInteres",rowCFandCC1VO.getAttribute("IdTcaTipoFrecuencia") + "");

                System.out.println("NumeroCuotasPagoInteres: " + rowCFandCC1VO.getAttribute("Cantidad") + "");
                if (rowCFandCC1VO.getAttribute("Cantidad") != null)newRowTemp.setAttribute("NumeroCuotasPagoInteres", rowCFandCC1VO.getAttribute("Cantidad") + "");

            }

            CFandCC2VOImpl CFandCC2VO = getCFandCC2VO();
            Row rowCFandCC2VO = CFandCC2VO.llenarCFandCC2(idContrato);
            System.out.println("datos rowCFandCC2VO: ");
            if (rowCFandCC2VO != null) {
                System.out.println("IdCalendario3: " + rowCFandCC2VO.getAttribute("Id"));
                if (rowCFandCC2VO.getAttribute("Id") != null)newRowTemp.setAttribute("idCalendario3", rowCFandCC2VO.getAttribute("Id") + "");

                System.out.println("FechaProximaRevisionTasa: " + rowCFandCC2VO.getAttribute("Fecha") + "");
                if (rowCFandCC2VO.getAttribute("Fecha") != null)newRowTemp.setAttribute("FechaProximaRevisionTasaI", rowCFandCC2VO.getAttribute("Fecha"));

                System.out.println("FrecuenciaRevisionTasa: " + rowCFandCC2VO.getAttribute("Frecuencia"));
                if (rowCFandCC2VO.getAttribute("Frecuencia") != null)newRowTemp.setAttribute("FrecuenciaRevisionTasaI", rowCFandCC2VO.getAttribute("Frecuencia") + "");

                System.out.println("IdTcaFrecuenciaRevTasa: " + rowCFandCC2VO.getAttribute("IdTcaTipoFrecuencia") + "");
                if (rowCFandCC2VO.getAttribute("IdTcaTipoFrecuencia") != null)newRowTemp.setAttribute("IdTcaFrecuenciaRevTasaI",rowCFandCC2VO.getAttribute("IdTcaTipoFrecuencia") + "");

                System.out.println("NumeroRevisionesTasa: " + rowCFandCC2VO.getAttribute("Cantidad") + "");
                if (rowCFandCC2VO.getAttribute("Cantidad") != null)newRowTemp.setAttribute("NumeroRevisionesTasaI", rowCFandCC2VO.getAttribute("Cantidad") + "");

            }
            
            // Aplicando Reglas para componente interes
            if(newRowTemp.getAttribute("DiasSpotI")==null){
                if(DiasSpotTasa!=null){
                    if(DiasSpotTasa==0)newRowTemp.setAttribute("DiasSpotI","No Aplica");//R12
                    else newRowTemp.setAttribute("DiasSpotI",DiasSpotTasa+"");//R12
                }    
                else newRowTemp.setAttribute("DiasSpotI","No Aplica");
            }
            if(newRowTemp.getAttribute("IdTcaTipoRedondeo")==null) 
                if(IdTcaTipoRedondeo!=null) newRowTemp.setAttribute("IdTcaTipoRedondeo",IdTcaTipoRedondeo+"");//R12
                else newRowTemp.setAttribute("IdTcaTipoRedondeo","0");
            if(newRowTemp.getAttribute("CantidadDecimales")==null) if(CantidadDecimales!=null)newRowTemp.setAttribute("CantidadDecimales",CantidadDecimales+"");
            if(newRowTemp.getAttribute("LimiteTasaMinima")==null) if(TasaMinimaDesembolso!="")newRowTemp.setAttribute("LimiteTasaMinima",TasaMinimaDesembolso);
            if(newRowTemp.getAttribute("LimiteTasaMaxima")==null) if(TasaMaximaDesembolso!="")newRowTemp.setAttribute("LimiteTasaMaxima",TasaMaximaDesembolso);
            
            
            // Componente Mora
            CFandComponente2VOImpl cfandComponente2 = getCFandComponente2VO();
            Row rowCFandComponente2 = cfandComponente2.llenarCFandComponente2(idContrato);
            System.out.println("datos rowCFandComponente2: ");
            if (rowCFandComponente2 != null) {
                System.out.println("IdComponente2: " + rowCFandComponente2.getAttribute("Id") + "");
                if (rowCFandComponente2.getAttribute("Id") != null)newRowTemp.setAttribute("idComponente2", rowCFandComponente2.getAttribute("Id") + "");

                System.out.println("CodigoTasaReferencia: " + rowCFandComponente2.getAttribute("CodigoTasaReferencia") +"");
                if (rowCFandComponente2.getAttribute("CodigoTasaReferencia") != null)newRowTemp.setAttribute("CodigoTasaReferencia",rowCFandComponente2.getAttribute("CodigoTasaReferencia") + "");

                System.out.println("ValorTasaReferencia: " + rowCFandComponente2.getAttribute("ValorTasaReferencia") +"");
                if (rowCFandComponente2.getAttribute("ValorTasaReferencia") != null)newRowTemp.setAttribute("ValorTasa", rowCFandComponente2.getAttribute("ValorTasaReferencia") + "");

                System.out.println("SpreadTasa: " + rowCFandComponente2.getAttribute("SpreadTasa") + "");
                if (rowCFandComponente2.getAttribute("SpreadTasa") != null)newRowTemp.setAttribute("SpreadTasa", rowCFandComponente2.getAttribute("SpreadTasa") + "");


                System.out.println("Tasa: " + rowCFandComponente2.getAttribute("Tasa") + "");
                if (rowCFandComponente2.getAttribute("Tasa") != null)newRowTemp.setAttribute("TasaTotal", rowCFandComponente2.getAttribute("Tasa") + "");

                System.out.println("MontoDescuento: " + rowCFandComponente2.getAttribute("MontoDescuento") + "");
                if (rowCFandComponente2.getAttribute("MontoDescuento") != null)newRowTemp.setAttribute("MontoDescuento", rowCFandComponente2.getAttribute("MontoDescuento") + "");
                
                System.out.println("DiasSpotM: " +rowCFandComponente2.getAttribute("DiasSpotTasa") + "");
                if (rowCFandComponente2.getAttribute("DiasSpotTasa") != null)newRowTemp.setAttribute("DiasSpotM",rowCFandComponente2.getAttribute("DiasSpotTasa") + "");
                else newRowTemp.setAttribute("DiasSpotM","No Aplica");
                
                System.out.println("Es dependiente: " +rowCFandComponente2.getAttribute("EsDependiente") + "");
                if (rowCFandComponente2.getAttribute("EsDependiente") != null){
                    int esDependiente = (Integer)rowCFandComponente2.getAttribute("EsDependiente");
                    if(esDependiente==0)newRowTemp.setAttribute("esDependiente","No");
                    else if(esDependiente==1)newRowTemp.setAttribute("esDependiente","Si");
                }
                
                System.out.println("Es factor: " +rowCFandComponente2.getAttribute("EsFactor") + "");
                if (rowCFandComponente2.getAttribute("EsFactor") != null){
                    int esFactor = (Integer)rowCFandComponente2.getAttribute("EsFactor");
                    if(esFactor==0)newRowTemp.setAttribute("esFactor","No");
                    else if(esFactor==1)newRowTemp.setAttribute("esFactor","Si");
                }
                
                System.out.println("Tipo Tasa: " +rowCFandComponente2.getAttribute("IdTcaTipoTasaDesembolso") + "");
                if (rowCFandComponente2.getAttribute("IdTcaTipoTasaDesembolso") != null){
                    int tipoTasa = (Integer)rowCFandComponente2.getAttribute("IdTcaTipoTasaDesembolso");
                    System.out.println("tipoTasa: " +tipoTasa);
                    if(tipoTasa==2)newRowTemp.setAttribute("tipoTasa","Fijo");
                    else if(tipoTasa==3)newRowTemp.setAttribute("tipoTasa","Variable");
                }
                System.out.println("Tipo Tasa final --> " +newRowTemp.getAttribute("tipoTasa") + "");
                
            }
            
            if(newRowTemp.getAttribute("DiasSpotM")==null)newRowTemp.setAttribute("DiasSpotM","No Aplica");
            else if(newRowTemp.getAttribute("DiasSpotM")=="0")newRowTemp.setAttribute("DiasSpotM","No Aplica");
            
            CFandCC4VOImpl CFandCC4VO = getCFandCC4VO();
            Row rowCFandCC4VO = CFandCC4VO.llenarCFandCC4(idContrato);
            System.out.println("datos CFandCC4VO: ");
            if (rowCFandCC4VO != null) {
                System.out.println("IdCalendario4: " + rowCFandCC4VO.getAttribute("Id"));
                if (rowCFandCC4VO.getAttribute("Id") != null)newRowTemp.setAttribute("idCalendario4", rowCFandCC4VO.getAttribute("Id") + "");

                System.out.println("FechaProximaRevisionTasa: " + rowCFandCC4VO.getAttribute("Fecha") + "");
                if (rowCFandCC4VO.getAttribute("Fecha") != null)newRowTemp.setAttribute("FechaProximaRevisionTasa", rowCFandCC4VO.getAttribute("Fecha"));

                System.out.println("FrecuenciaRevisionTasa: " + rowCFandCC4VO.getAttribute("Frecuencia"));
                if (rowCFandCC4VO.getAttribute("Frecuencia") != null)newRowTemp.setAttribute("FrecuenciaRevisionTasa", rowCFandCC4VO.getAttribute("Frecuencia"));

                System.out.println("IdTcaFrecuenciaRevTasa: " + rowCFandCC4VO.getAttribute("IdTcaTipoFrecuencia"));
                if (rowCFandCC4VO.getAttribute("IdTcaTipoFrecuencia") != null)newRowTemp.setAttribute("IdTcaFrecuenciaRevTasa",rowCFandCC4VO.getAttribute("IdTcaTipoFrecuencia"));

                System.out.println("NumeroRevisionesTasa: " + rowCFandCC4VO.getAttribute("Cantidad"));
                if (rowCFandCC4VO.getAttribute("Cantidad") != null)newRowTemp.setAttribute("NumeroRevisionesTasa", rowCFandCC4VO.getAttribute("Cantidad"));
                
            }
            
            
            // Aplicando Reglas para componente Mora
            if(IdTcaTipoMora!=null){
                System.out.println("*** Validando Reglas ***");
                if(newRowTemp!=null){
                    // Interes Ordinario + Spread mora
                    if(IdTcaTipoMora==1){
                        if(newRowTemp.getAttribute("esDependiente")==null)newRowTemp.setAttribute("esDependiente","Si");//R7
                        if(newRowTemp.getAttribute("esFactor")==null)newRowTemp.setAttribute("esFactor","No");//R7
                        if(newRowTemp.getAttribute("SpreadTasa")==null)if(SpreadTasa!=null)newRowTemp.setAttribute("SpreadTasa", SpreadTasa + "");//R7
                    }
                    
                    // Interés Ordinario * Factor
                    if(IdTcaTipoMora==2){
                        if(newRowTemp.getAttribute("esDependiente")==null)newRowTemp.setAttribute("esDependiente","Si");//R8
                        if(newRowTemp.getAttribute("esFactor")==null)newRowTemp.setAttribute("esFactor","Si"); //R8
                        if(newRowTemp.getAttribute("SpreadTasa")==null)if(SpreadTasa!=null)newRowTemp.setAttribute("SpreadTasa", SpreadTasa + "");//R8
                    }
                    
                    // Tasa Fija
                    if(IdTcaTipoMora==3){
                       if(newRowTemp.getAttribute("esDependiente")==null) newRowTemp.setAttribute("esDependiente","No"); //R9
                       if(newRowTemp.getAttribute("tipoTasa")==null) newRowTemp.setAttribute("tipoTasa","Fijo"); //R9
                       if(newRowTemp.getAttribute("ValorTasa")==null)if(ValorTasa!=null)newRowTemp.setAttribute("ValorTasa",  ValorTasa+ "");//R9
                    }
                    
                    // Tasa Variable
                    if(IdTcaTipoMora==4){
                        if(newRowTemp.getAttribute("esDependiente")==null) newRowTemp.setAttribute("esDependiente","No"); //R10
                        if(newRowTemp.getAttribute("tipoTasa")==null) newRowTemp.setAttribute("tipoTasa","Variable"); //R10
                        if(newRowTemp.getAttribute("CodigoTasaReferencia")==null) if(CodigoTasaReferencia!="") newRowTemp.setAttribute("CodigoTasaReferencia",CodigoTasaReferencia+ "");//R10
                        if(newRowTemp.getAttribute("SpreadTasa")==null)if(SpreadTasa!=null)newRowTemp.setAttribute("SpreadTasa", SpreadTasa + "");//R10
                        if(newRowTemp.getAttribute("FrecuenciaRevisionTasa")==null) if(FrecuenciaRev!=null) newRowTemp.setAttribute("FrecuenciaRevisionTasa",FrecuenciaRev+"");//R10
                        if(newRowTemp.getAttribute("IdTcaFrecuenciaRevTasa")==null) if(IdTcaTipoFrecuenciaRev!=null) newRowTemp.setAttribute("IdTcaFrecuenciaRevTasa", IdTcaTipoFrecuenciaRev); //R10
                    }
                    
                }
                
            }
            
            
            //Componente Spread
            CFTasaReferenciaVOImpl cfTasaReferenciaVO = getCFTasaReferenciaVO();
            Row rowCFTasaReferenciaVO = cfTasaReferenciaVO.llenarCFTasaRef(idContrato);
            System.out.println("datos rowCFTasaReferenciaVO: ");
            if (rowCFTasaReferenciaVO != null) {
                System.out.println("IdComponente3: " + rowCFTasaReferenciaVO.getAttribute("Id"));
                if (rowCFTasaReferenciaVO.getAttribute("Id") != null)newRowTemp.setAttribute("idComponente3", rowCFTasaReferenciaVO.getAttribute("Id") + "");
                
                System.out.println("CodigoTasaReferenciaSpread: " +rowCFTasaReferenciaVO.getAttribute("CodigoTasaReferencia") + "");
                if (rowCFTasaReferenciaVO.getAttribute("CodigoTasaReferencia") != null)newRowTemp.setAttribute("CodigoTasaReferenciaSpread",rowCFTasaReferenciaVO.getAttribute("CodigoTasaReferencia") + "");
                
                System.out.println("ValorTasaReferenciaSpread: " +rowCFTasaReferenciaVO.getAttribute("ValorTasaReferencia") + "");
                if (rowCFTasaReferenciaVO.getAttribute("ValorTasaReferencia") != null)newRowTemp.setAttribute("ValorTasaReferenciaSpread",rowCFTasaReferenciaVO.getAttribute("ValorTasaReferencia") + "");
                
            }

            CFandCC3VOImpl CFandCC3VO = getCFandCC3VO();
            Row rowCFandCC3VO = CFandCC3VO.llenarCFandCC3(idContrato);
            System.out.println("datos rowCFandCC3VO: ");
            if (rowCFandCC3VO != null) {
                System.out.println("IdCalendario5: " + rowCFandCC3VO.getAttribute("Id"));
                if (rowCFandCC3VO.getAttribute("Id") != null)newRowTemp.setAttribute("idCalendario5", rowCFandCC3VO.getAttribute("Id") + "");

                System.out.println("FechaProximaRevisionSpread: " + rowCFandCC3VO.getAttribute("Fecha") + "");
                if (rowCFandCC3VO.getAttribute("Fecha") != null)newRowTemp.setAttribute("FechaProximaRevisionSpread", rowCFandCC3VO.getAttribute("Fecha"));

                System.out.println("FrecuenciaRevisionSpread: " + rowCFandCC3VO.getAttribute("Frecuencia"));
                if (rowCFandCC3VO.getAttribute("Frecuencia") != null)newRowTemp.setAttribute("FrecuenciaRevisionSpread", rowCFandCC3VO.getAttribute("Frecuencia"));

                System.out.println("IdTcaFrecuenciaRevSpread: " + rowCFandCC3VO.getAttribute("IdTcaTipoFrecuencia"));
                if (rowCFandCC3VO.getAttribute("IdTcaTipoFrecuencia") != null)newRowTemp.setAttribute("IdTcaFrecuenciaRevSpread",rowCFandCC3VO.getAttribute("IdTcaTipoFrecuencia"));

                System.out.println("NumeroRevisionesSpread: " + rowCFandCC3VO.getAttribute("Cantidad"));
                if (rowCFandCC3VO.getAttribute("Cantidad") != null)newRowTemp.setAttribute("NumeroRevisionesSpread", rowCFandCC3VO.getAttribute("Cantidad"));
                
            }

            cftempVO.insertRow(newRowTemp);
            CondicionesFinancierasVOImpl cfVO = getCondicionesFinancierasVO();
            cfVO.asignarValorTransient(null);
        } catch (Exception ex) {
            System.out.println("Error --> " + ex.getMessage() + " - " + ex.getStackTrace() + " - " +
                               ex.getSuppressed());
            ex.printStackTrace();
        }

    }

    public void recuperarTemp(Long idCondicionFinanciera,Long IdLineaCredito) {
        if (idCondicionFinanciera != null) {
            CondicionesFinancierasVOImpl condicionesVO = getCondicionesFinancierasVO();
            ViewCriteria criteria_condiciones =
                condicionesVO.getViewCriteriaManager().getViewCriteria("IdCondicionFinancieraCriteria");
            criteria_condiciones.ensureVariableManager().setVariableValue("pIdCondicionFinanciera",
                                                                          idCondicionFinanciera);
            condicionesVO.applyViewCriteria(criteria_condiciones);
            condicionesVO.executeQuery();
            
            RowSetIterator rowsCondiciones = condicionesVO.createRowSetIterator(null);
            rowsCondiciones.reset();
            
            while (rowsCondiciones.hasNext()) {
                Row row_condicion = rowsCondiciones.next();
                Long IdContratoDesembolso = (Long) row_condicion.getAttribute("IdContratoDesembolso");
                cargarCFTempVO(String.valueOf(IdContratoDesembolso),String.valueOf(IdLineaCredito));
            }
            rowsCondiciones.closeRowSetIterator();
        }
    }

    public Boolean findandDeleteCalendarioComponente(Long idCondicionFinanciera,Long idLineaCredito) {
        ComponenteVOImpl componenteVO = getComponenteVO();
        CalendarioVOImpl calendarioVO = getCalendarioVO();
        Tre_Componente_Cal_VOImpl treComponenteCalVO = getTre_Componente_Cal_VO();
        Tre_Condicion_Financiera_Cal_VOImpl treCondicionFinancieraCalVO = getTre_Condicion_Financiera_Cal_VO();
        Boolean estado = Boolean.FALSE;

        ViewCriteria criteria_componente = componenteVO.getViewCriteriaManager().getViewCriteria("findComponente");
        criteria_componente.ensureVariableManager().setVariableValue("pidCondicionFinanciera", idCondicionFinanciera);
        componenteVO.applyViewCriteria(criteria_componente);
        componenteVO.executeQuery();
        
        RowSetIterator rowsComponentes = componenteVO.createRowSetIterator(null);
        rowsComponentes.reset();

        while (rowsComponentes.hasNext()) {
            Row row_componente = rowsComponentes.next();
            System.out.println("id_componente --> " + row_componente.getAttribute("Id"));
            ViewCriteria criteria_treComponenteCal =
                treComponenteCalVO.getViewCriteriaManager().getViewCriteria("findTreComponenteCal");
            criteria_treComponenteCal.ensureVariableManager().setVariableValue("pIdComponente",
                                                                               row_componente.getAttribute("Id"));
            treComponenteCalVO.applyViewCriteria(criteria_treComponenteCal);
            treComponenteCalVO.executeQuery();
            
            RowSetIterator rowsComponenteCal = treComponenteCalVO.createRowSetIterator(null);
            rowsComponenteCal.reset();

            while (rowsComponenteCal.hasNext()) {
                Row row_treComponenteCal = rowsComponenteCal.next();
                System.out.println("id_calendario --> " + row_treComponenteCal.getAttribute("IdCalendario"));

                ViewCriteria criteria_calendario =
                    calendarioVO.getViewCriteriaManager().getViewCriteria("findCalendario");
                criteria_calendario.ensureVariableManager().setVariableValue("pidCalendario",
                                                                             row_treComponenteCal.getAttribute("IdCalendario"));
                calendarioVO.applyViewCriteria(criteria_calendario);
                calendarioVO.executeQuery();
                
                RowSetIterator rowsCalendario = calendarioVO.createRowSetIterator(null);
                rowsCalendario.reset();
                
                row_treComponenteCal.remove();
                while (rowsCalendario.hasNext()) {
                    Row row_calendario = rowsCalendario.next();
                    row_calendario.remove();
                }
                rowsCalendario.closeRowSetIterator();
            }
            rowsComponenteCal.closeRowSetIterator();
            
            row_componente.remove();
            estado = Boolean.TRUE;
        }
        
        rowsComponentes.closeRowSetIterator();
        

        ViewCriteria criteria_treCondicionFinancieraCal =
            treCondicionFinancieraCalVO.getViewCriteriaManager().getViewCriteria("findTreCondicionFinancieraCal");
        criteria_treCondicionFinancieraCal.ensureVariableManager().setVariableValue("pidCondicionFinanciera",
                                                                                    idCondicionFinanciera);
        treCondicionFinancieraCalVO.applyViewCriteria(criteria_treCondicionFinancieraCal);
        treCondicionFinancieraCalVO.executeQuery();
        
        RowSetIterator rowsTreCondicionFinanciera = treCondicionFinancieraCalVO.createRowSetIterator(null);
        rowsTreCondicionFinanciera.reset();

        while (rowsTreCondicionFinanciera.hasNext()) {
            Row row_treCondicionFinancieraCal = rowsTreCondicionFinanciera.next();
            System.out.println("IdCalendario --> " + row_treCondicionFinancieraCal.getAttribute("IdCalendario"));
            ViewCriteria criteria_calendario = calendarioVO.getViewCriteriaManager().getViewCriteria("findCalendario");
            criteria_calendario.ensureVariableManager().setVariableValue("pidCalendario",
                                                                         row_treCondicionFinancieraCal.getAttribute("IdCalendario"));
            calendarioVO.applyViewCriteria(criteria_calendario);
            calendarioVO.executeQuery();
            
            RowSetIterator rowsCalendario = calendarioVO.createRowSetIterator(null);
            rowsCalendario.reset();

            row_treCondicionFinancieraCal.remove();
            while (rowsCalendario.hasNext()) {
                Row row_calendario = rowsCalendario.next();
                row_calendario.remove();
            }
            rowsCalendario.closeRowSetIterator();
            estado = Boolean.TRUE;
        }
        
        rowsTreCondicionFinanciera.closeRowSetIterator();

        if (estado) {
            logger.warning("Encontro registros para eliminar");
            try {
                logger.warning("Se realiza el Commit delete ");
                getDBTransaction().commit();
            } catch (Exception e) {
                getDBTransaction().rollback();
                logger.warning("Intento de commit fallido", e);
                e.printStackTrace();
            }
            recuperarTemp(idCondicionFinanciera,idLineaCredito);
        }
        return estado;
    }

    @SuppressWarnings("unchecked")
    public Boolean guardarCalendarioComponente(Map map) {
        System.out.println("********** Ejecutando guardarCalendarioComponente V5 **********");
        Boolean validaCampos = Boolean.FALSE;
        CFTempVOImpl cftempVO = getCFTempVO();
        Row rowCFTempVO = cftempVO.getCurrentRow();
        try {

            if (rowCFTempVO != null) {
                validaCampos = Boolean.TRUE;
                // Componenete principal
                //Calendario pago capital
                if (rowCFTempVO.getAttribute("FechaPrimerPagoCapital") != null ||
                    rowCFTempVO.getAttribute("FrecuenciaPagoCapital") != null ||
                    rowCFTempVO.getAttribute("IdTcaFrecuenciaPagoCapital") != null ||
                    rowCFTempVO.getAttribute("NumeroCuotasPagoCapital") != null) {
                    Map calendario_principal = new HashMap();
                    if (rowCFTempVO.getAttribute("idCalendario1") != null)calendario_principal.put("Id", rowCFTempVO.getAttribute("idCalendario1"));
                    calendario_principal.put("TipoPlan", "P");
                    calendario_principal.put("Fecha", rowCFTempVO.getAttribute("FechaPrimerPagoCapital"));
                    calendario_principal.put("Frecuencia", rowCFTempVO.getAttribute("FrecuenciaPagoCapital"));
                    calendario_principal.put("IdTcaTipoFrecuencia",rowCFTempVO.getAttribute("IdTcaFrecuenciaPagoCapital"));
                    calendario_principal.put("Cantidad", rowCFTempVO.getAttribute("NumeroCuotasPagoCapital"));
                    Map map_response = new HashMap();
                    map_response = validarCalendario(calendario_principal);
                    validaCampos = validaCampos && (Boolean) map_response.get("validaCampos");
                    logger.warning("calendario Componenete principal --> " + validaCampos);
                    Boolean nuevo_registro = (Boolean) map_response.get("nuevo_registro");
                    if (nuevo_registro) {
                        Row rowCalendario = (Row) map_response.get("calendarioVORow");
                        Tre_Condicion_Financiera_Cal_VOImpl treCondicioFinancieraCalVO =getTre_Condicion_Financiera_Cal_VO();
                        Tre_Condicion_Financiera_Cal_VORowImpl treCondicioFinancieraCalVORow =
                            (Tre_Condicion_Financiera_Cal_VORowImpl) treCondicioFinancieraCalVO.createRow();
                        if (treCondicioFinancieraCalVORow != null && rowCalendario != null) {
                            treCondicioFinancieraCalVORow.setAttribute("IdCalendario",rowCalendario.getAttribute("Id"));
                            treCondicioFinancieraCalVORow.setAttribute("IdCondicionFinanciera",map.get("idCondicionFinanciera"));
                        } else {
                            logger.warning("Rows nulos en Componenete principal");
                        }
                    }
                }

                // Componente interes
                Map map_response_comp_interes = new HashMap();
                /*if (
                    //rowCFTempVO.getAttribute("LimiteTasaMinima") != null ||
                    //rowCFTempVO.getAttribute("LimiteTasaMaxima") != null ||
                    rowCFTempVO.getAttribute("SpreadI") != null || 
                    //rowCFTempVO.getAttribute("TasaTotalI") != null ||
                    rowCFTempVO.getAttribute("CodigoTasaReferenciaI") != null ||
                    //rowCFTempVO.getAttribute("ValorTasaI") != null ||
                    //rowCFTempVO.getAttribute("MontoDescuento") != null || 
                    rowCFTempVO.getAttribute("IdTcaTipoRedondeo")!=null ||
                    rowCFTempVO.getAttribute("CantidadDecimales")!=null ||
                    rowCFTempVO.getAttribute("DiasSpotI")!=null
                    ) {*/
                    Map componente_interes = new HashMap();
                    if (rowCFTempVO.getAttribute("idComponente1") != null)componente_interes.put("Id", rowCFTempVO.getAttribute("idComponente1"));
                    componente_interes.put("idCondicionFinanciera", map.get("idCondicionFinanciera"));
                    componente_interes.put("IdTcaTipoComponente", 2);
                    componente_interes.put("LimiteTasaMinima", rowCFTempVO.getAttribute("LimiteTasaMinima"));
                    componente_interes.put("LimiteTasaMaxima", rowCFTempVO.getAttribute("LimiteTasaMaxima"));
                    componente_interes.put("SpreadTasa", rowCFTempVO.getAttribute("SpreadI"));
                    componente_interes.put("Tasa", rowCFTempVO.getAttribute("TasaTotalI"));
                    componente_interes.put("CodigoTasaReferencia", rowCFTempVO.getAttribute("CodigoTasaReferenciaI"));
                    componente_interes.put("ValorTasaReferencia", rowCFTempVO.getAttribute("ValorTasaI"));
                    componente_interes.put("MontoDescuento", rowCFTempVO.getAttribute("MontoDescuento"));
                    componente_interes.put("IdTcaTipoRedondeo", rowCFTempVO.getAttribute("IdTcaTipoRedondeo"));
                    componente_interes.put("CantidadDecimales", rowCFTempVO.getAttribute("CantidadDecimales"));
                    componente_interes.put("DiasSpotTasa", rowCFTempVO.getAttribute("DiasSpotI"));
                    map_response_comp_interes = validarComponente(componente_interes);
                    validaCampos = validaCampos && (Boolean) map_response_comp_interes.get("validaCampos");
                    logger.warning("Componenete interes --> " + validaCampos);
                    //Boolean nuevo_registro_componente = (Boolean) map_response_comp_interes.get("nuevo_registro");
                //}
                
                //calendario pago interes
                if (rowCFTempVO.getAttribute("FechaProximoPagoInteres") != null ||
                    rowCFTempVO.getAttribute("FrecuenciaPagoInteres") != null ||
                    rowCFTempVO.getAttribute("IdTcaFrecuenciaPagoInteres") != null ||
                    rowCFTempVO.getAttribute("NumeroCuotasPagoInteres") != null) {
                    Map calendario = new HashMap();
                    if (rowCFTempVO.getAttribute("idCalendario2") != null)calendario.put("Id", rowCFTempVO.getAttribute("idCalendario2"));
                    calendario.put("TipoPlan", "P");
                    calendario.put("Fecha", rowCFTempVO.getAttribute("FechaProximoPagoInteres"));
                    calendario.put("Frecuencia", rowCFTempVO.getAttribute("FrecuenciaPagoInteres"));
                    calendario.put("IdTcaTipoFrecuencia", rowCFTempVO.getAttribute("IdTcaFrecuenciaPagoInteres"));
                    calendario.put("Cantidad", rowCFTempVO.getAttribute("NumeroCuotasPagoInteres"));
                    Map map_response_calendario = new HashMap();
                    map_response_calendario = validarCalendario(calendario);
                    validaCampos = validaCampos && (Boolean) map_response_calendario.get("validaCampos");
                    logger.warning("Calendario pago interes Componenete interes --> " + validaCampos);
                    Boolean nuevo_registro_calendario = (Boolean) map_response_calendario.get("nuevo_registro");
                    if (nuevo_registro_calendario) {
                        Row rowCalendario = (Row) map_response_calendario.get("calendarioVORow");
                        Row rowComponente = (Row) map_response_comp_interes.get("componenteVORow");
                        Tre_Componente_Cal_VOImpl treComponenteCalVO = getTre_Componente_Cal_VO();
                        Tre_Componente_Cal_VORowImpl treComponenteCalVORow =
                            (Tre_Componente_Cal_VORowImpl) treComponenteCalVO.createRow();
                        if (treComponenteCalVORow != null && rowCalendario != null && rowComponente != null) {
                            logger.warning(" --- Tre_Componente_Cal_VOImpl Componente interes ---");
                            logger.warning("Id --> " + treComponenteCalVORow.getAttribute("Id"));
                            logger.warning("IdComponente --> " + rowComponente.getAttribute("Id"));
                            logger.warning("IdCalendario --> " + rowCalendario.getAttribute("Id"));
                            logger.warning(" ----------------------------------------------------");
                            treComponenteCalVORow.setAttribute("IdComponente", rowComponente.getAttribute("Id"));
                            treComponenteCalVORow.setAttribute("IdCalendario", rowCalendario.getAttribute("Id"));
                        } else {
                            logger.warning("Rows nulos en Componente interes");
                        }
                    }
                }

                //calendario revision tasa
                if (rowCFTempVO.getAttribute("FechaProximaRevisionTasaI") != null ||
                    rowCFTempVO.getAttribute("FrecuenciaRevisionTasaI") != null ||
                    rowCFTempVO.getAttribute("IdTcaFrecuenciaRevTasaI") != null ||
                    rowCFTempVO.getAttribute("NumeroRevisionesTasaI") != null) {
                    Map calendario = new HashMap();
                    if (rowCFTempVO.getAttribute("idCalendario3") != null)calendario.put("Id", rowCFTempVO.getAttribute("idCalendario3"));
                    calendario.put("TipoPlan", "R");
                    calendario.put("Fecha", rowCFTempVO.getAttribute("FechaProximaRevisionTasaI"));
                    calendario.put("Frecuencia", rowCFTempVO.getAttribute("FrecuenciaRevisionTasaI"));
                    calendario.put("IdTcaTipoFrecuencia", rowCFTempVO.getAttribute("IdTcaFrecuenciaRevTasaI"));
                    calendario.put("Cantidad", rowCFTempVO.getAttribute("NumeroRevisionesTasaI"));
                    Map response_calendario = new HashMap();
                    response_calendario = validarCalendario(calendario);
                    validaCampos = validaCampos && (Boolean) response_calendario.get("validaCampos");
                    logger.warning("Calendario Componenete Interes --> " + validaCampos);
                    Boolean nuevo_registro_calendario = (Boolean) response_calendario.get("nuevo_registro");

                    if (nuevo_registro_calendario) {
                        Row rowCalendario = (Row) response_calendario.get("calendarioVORow");
                        Row rowComponente = (Row) map_response_comp_interes.get("componenteVORow");
                        Tre_Componente_Cal_VOImpl treComponenteCalVO = getTre_Componente_Cal_VO();
                        Tre_Componente_Cal_VORowImpl treComponenteCalVORow =
                            (Tre_Componente_Cal_VORowImpl) treComponenteCalVO.createRow();
                        if (treComponenteCalVORow != null && rowCalendario != null && rowComponente != null) {
                            logger.warning(" --- Tre_Componente_Cal_VOImpl Componente Interes ---");
                            logger.warning("Id --> " + treComponenteCalVORow.getAttribute("Id"));
                            logger.warning("IdComponente --> " + rowComponente.getAttribute("Id"));
                            logger.warning("IdCalendario --> " + rowCalendario.getAttribute("Id"));
                            logger.warning(" -------------------------------------------------");

                            treComponenteCalVORow.setAttribute("IdComponente", rowComponente.getAttribute("Id"));
                            treComponenteCalVORow.setAttribute("IdCalendario", rowCalendario.getAttribute("Id"));
                        } else {
                            logger.warning("Rows nulos en Componente Mora");
                        }
                    }
                }
                
                
                
                // Componente mora
                Map map_response_comp_mora = new HashMap();
                /*if (rowCFTempVO.getAttribute("SpreadTasa") != null || 
                    //rowCFTempVO.getAttribute("TasaTotal") != null ||
                    rowCFTempVO.getAttribute("CodigoTasaReferencia") != null ||
                    rowCFTempVO.getAttribute("ValorTasa") != null ||
                    rowCFTempVO.getAttribute("esDependiente") != null ||
                    rowCFTempVO.getAttribute("esFactor") != null ||
                    rowCFTempVO.getAttribute("tipoTasa") != null ||
                    rowCFTempVO.getAttribute("DiasSpotM")!=null
                    ) {*/
                    Map componente_mora = new HashMap();
                    if (rowCFTempVO.getAttribute("idComponente2") != null)componente_mora.put("Id", rowCFTempVO.getAttribute("idComponente2"));
                    
                    componente_mora.put("idCondicionFinanciera", map.get("idCondicionFinanciera"));
                    componente_mora.put("IdTcaTipoComponente", 3);
                    componente_mora.put("SpreadTasa", rowCFTempVO.getAttribute("SpreadTasa"));
                    componente_mora.put("Tasa", rowCFTempVO.getAttribute("TasaTotal"));
                    componente_mora.put("CodigoTasaReferencia", rowCFTempVO.getAttribute("CodigoTasaReferencia"));
                    componente_mora.put("ValorTasaReferencia", rowCFTempVO.getAttribute("ValorTasa"));
                    componente_mora.put("EsDependiente", rowCFTempVO.getAttribute("esDependiente"));
                    componente_mora.put("EsFactor", rowCFTempVO.getAttribute("esFactor"));
                    componente_mora.put("TipoTasa", rowCFTempVO.getAttribute("tipoTasa"));
                    componente_mora.put("DiasSpotTasa", rowCFTempVO.getAttribute("DiasSpotM"));
                    map_response_comp_mora = validarComponente(componente_mora);
                    validaCampos = validaCampos && (Boolean) map_response_comp_mora.get("validaCampos");
                    logger.warning("Componenete interes --> " + validaCampos);
                    //Boolean nuevo_registro_mora = (Boolean) map_response_comp_mora.get("nuevo_registro");

                //}
                
                //Calendario revision tasa
                if (rowCFTempVO.getAttribute("FechaProximaRevisionTasa") != null ||
                    rowCFTempVO.getAttribute("FrecuenciaRevisionTasa") != null ||
                    rowCFTempVO.getAttribute("IdTcaFrecuenciaRevTasa") != null ||
                    rowCFTempVO.getAttribute("NumeroRevisionesTasa") != null) {
                    Map calendario = new HashMap();
                    if (rowCFTempVO.getAttribute("idCalendario4") != null)calendario.put("Id", rowCFTempVO.getAttribute("idCalendario4"));
                    calendario.put("TipoPlan", "R");
                    calendario.put("Fecha", rowCFTempVO.getAttribute("FechaProximaRevisionTasa"));
                    calendario.put("Frecuencia", rowCFTempVO.getAttribute("FrecuenciaRevisionTasa"));
                    calendario.put("IdTcaTipoFrecuencia", rowCFTempVO.getAttribute("IdTcaFrecuenciaRevTasa"));
                    calendario.put("Cantidad", rowCFTempVO.getAttribute("NumeroRevisionesTasa"));
                    Map response_calendario = new HashMap();
                    response_calendario = validarCalendario(calendario);
                    validaCampos = validaCampos && (Boolean) response_calendario.get("validaCampos");
                    logger.warning("Calendario Componenete Mora --> " + validaCampos);
                    Boolean nuevo_registro_calendario = (Boolean) response_calendario.get("nuevo_registro");

                    if (nuevo_registro_calendario) {
                        Row rowCalendario = (Row) response_calendario.get("calendarioVORow");
                        Row rowComponente = (Row) map_response_comp_mora.get("componenteVORow");
                        Tre_Componente_Cal_VOImpl treComponenteCalVO = getTre_Componente_Cal_VO();
                        Tre_Componente_Cal_VORowImpl treComponenteCalVORow =
                            (Tre_Componente_Cal_VORowImpl) treComponenteCalVO.createRow();
                        if (treComponenteCalVORow != null && rowCalendario != null && rowComponente != null) {
                            logger.warning(" --- Tre_Componente_Cal_VOImpl Componente Mora ---");
                            logger.warning("Id --> " + treComponenteCalVORow.getAttribute("Id"));
                            logger.warning("IdComponente --> " + rowComponente.getAttribute("Id"));
                            logger.warning("IdCalendario --> " + rowCalendario.getAttribute("Id"));
                            logger.warning(" -------------------------------------------------");

                            treComponenteCalVORow.setAttribute("IdComponente", rowComponente.getAttribute("Id"));
                            treComponenteCalVORow.setAttribute("IdCalendario", rowCalendario.getAttribute("Id"));
                        } else {
                            logger.warning("Rows nulos en Componente Mora");
                        }
                    }
                }

                // Componente Spread Variable
                Map response_componente = new HashMap();
                /*if (rowCFTempVO.getAttribute("CodigoTasaReferenciaSpread") != null ||
                    rowCFTempVO.getAttribute("ValorTasaReferenciaSpread") != null) {*/
                    Map componente_spread = new HashMap();
                    if (rowCFTempVO.getAttribute("idComponente3") != null)
                        componente_spread.put("Id", rowCFTempVO.getAttribute("idComponente3"));
                    componente_spread.put("IdTcaTipoComponente", 4);
                    componente_spread.put("idCondicionFinanciera", map.get("idCondicionFinanciera"));
                    componente_spread.put("CodigoTasaReferenciaSpread",rowCFTempVO.getAttribute("CodigoTasaReferenciaSpread"));
                    componente_spread.put("ValorTasaReferenciaSpread",rowCFTempVO.getAttribute("ValorTasaReferenciaSpread"));
                    response_componente = validarComponente(componente_spread);
                    validaCampos = validaCampos && (Boolean) response_componente.get("validaCampos");
                    logger.warning("Componenete Spread Variable --> " + validaCampos);
                    //Boolean nuevo_registro_componente = (Boolean) response_componente.get("nuevo_registro");
                //}
                
                // Calendario revision spread
                if (rowCFTempVO.getAttribute("FechaProximaRevisionSpread") != null ||
                    rowCFTempVO.getAttribute("FrecuenciaRevisionSpread") != null ||
                    rowCFTempVO.getAttribute("IdTcaFrecuenciaRevSpread") != null ||
                    rowCFTempVO.getAttribute("NumeroRevisionesSpread") != null) {
                    Map calendario = new HashMap();
                    if (rowCFTempVO.getAttribute("idCalendario5") != null)calendario.put("Id", rowCFTempVO.getAttribute("idCalendario5"));
                    calendario.put("TipoPlan", "R");
                    calendario.put("Fecha", rowCFTempVO.getAttribute("FechaProximaRevisionSpread"));
                    calendario.put("Frecuencia", rowCFTempVO.getAttribute("FrecuenciaRevisionSpread"));
                    calendario.put("IdTcaTipoFrecuencia", rowCFTempVO.getAttribute("IdTcaFrecuenciaRevSpread"));
                    calendario.put("Cantidad", rowCFTempVO.getAttribute("NumeroRevisionesSpread"));
                    Map response_calendario = new HashMap();
                    response_calendario = validarCalendario(calendario);
                    validaCampos = validaCampos && (Boolean) response_calendario.get("validaCampos");
                    logger.warning("Calendario Spread Variable --> " + validaCampos);
                    Boolean nuevo_registro_calendario = (Boolean) response_calendario.get("nuevo_registro");

                    if (nuevo_registro_calendario) {
                        Row rowCalendario = (Row) response_calendario.get("calendarioVORow");
                        Row rowComponente = (Row) response_componente.get("componenteVORow");
                        Tre_Componente_Cal_VOImpl treComponenteCalVO = getTre_Componente_Cal_VO();
                        Tre_Componente_Cal_VORowImpl treComponenteCalVORow =
                            (Tre_Componente_Cal_VORowImpl) treComponenteCalVO.createRow();

                        if (treComponenteCalVORow != null && rowCalendario != null && rowComponente != null) {

                            logger.warning(" --- Tre_Componente_Cal_VOImpl Componente Spread ---");
                            logger.warning("Id --> " + treComponenteCalVORow.getAttribute("Id"));
                            logger.warning("IdComponente --> " + rowComponente.getAttribute("Id"));
                            logger.warning("IdCalendario --> " + rowCalendario.getAttribute("Id"));
                            logger.warning("----------------------------------------------------");

                            treComponenteCalVORow.setAttribute("IdComponente", rowComponente.getAttribute("Id"));
                            treComponenteCalVORow.setAttribute("IdCalendario", rowCalendario.getAttribute("Id"));
                        } else {
                            logger.warning("Rows nulos en Componente Spread Variable");
                        }
                    }
                }
            } else {
                logger.warning("No se recupero el row CFTemp.");
            }

            //Si todos los campos tienen valor se realiza commit
            if (validaCampos) {
                logger.warning("validacion de campos es correcto.");
                try {
                    logger.warning("Se realiza primer intento de Commit");
                    getDBTransaction().commit();
                } catch (Exception e) {
                    logger.warning("Intento de commit fallido", e);
                    e.printStackTrace();
                    getDBTransaction().rollback();
                }
            } else {
                logger.warning("Existen valores nulos.");
            }
        } catch (Exception e) {
            logger.warning("Error al guardar lo campos.", e);
            validaCampos = Boolean.FALSE;
            getDBTransaction().rollback();
            e.printStackTrace();
        }
        logger.warning("Valor de retorno :" + validaCampos);
        return validaCampos;
    }

    @SuppressWarnings("unchecked")
    public Map validarComponente(Map map) {
        
        logger.warning("----Inicio validarComponente ");
        
        ComponenteVOImpl componenteVO = getComponenteVO();
        ComponenteVORowImpl componenteVORow = null;
        Boolean nuevo_registro = Boolean.TRUE;
        Map response = new HashMap();

        try {

            Row[] rows = null;
            if (map.get("Id") != null) {
                
                rows = new Row[1];
                ViewCriteria criteria_componente = componenteVO.getViewCriteriaManager().getViewCriteria("ComponenteById");
                criteria_componente.ensureVariableManager().setVariableValue("pId",(Number)map.get("Id"));
                componenteVO.applyViewCriteria(criteria_componente);
                componenteVO.executeQuery();
                
                RowSetIterator rowsComponente = componenteVO.createRowSetIterator(null);
                rowsComponente.reset();
                
                while (rowsComponente.hasNext()) {
                    Row row_componente = rowsComponente.next();
                    rows[0]= row_componente;
                    logger.warning("rows[0] --> "+rows[0]);
                    logger.warning("rows[Id] --> "+rows[0].getAttribute("Id"));
                    break;
                }
                rowsComponente.closeRowSetIterator();
            }

            logger.warning("---- Componente " + map.get("Id"));
            if (rows!=null) {
                if(rows[0]!=null){        
                    logger.warning("----Existe ");
                    logger.warning("componenteVORow rows[id] -->"+rows[0].getAttribute("Id"));
                    componenteVORow = (ComponenteVORowImpl) rows[0];
                    nuevo_registro = Boolean.FALSE;
                }else{
                    logger.warning("----No Existe ");
                    logger.warning("No se encontro componente rows "+rows[0]);
                }
                
            } else {
                componenteVORow = (ComponenteVORowImpl) componenteVO.createRow();
                nuevo_registro = Boolean.TRUE;
                logger.warning("No se encontro componente");
            }

            CondicionesFinancierasVOImpl condicionesVO = getCondicionesFinancierasVO();
            CondicionesFinancierasVORowImpl condicionesVORow = null;

            logger.warning("Entra en validarDatosRequeridos Componente ");
            Boolean validaCampos = Boolean.TRUE;

            if (componenteVORow != null) {

                logger.warning("idCondicionFinanciera: " + map.get("idCondicionFinanciera"));
                if (map.get("idCondicionFinanciera") != null || map.get("idCondicionFinanciera") != "null") {
                    componenteVORow.setAttribute("IdCondicionFinanciera", map.get("idCondicionFinanciera"));
                    Row rows2[] = condicionesVO.findByKey(new Key(new Object[] { map.get("idCondicionFinanciera") }),
                                                          1);
                    if (rows2.length > 0) {
                        condicionesVORow = (CondicionesFinancierasVORowImpl) rows2[0];
                        if (condicionesVORow != null) {
                            logger.warning("IdTcaTipoTasaDesembolso: " + condicionesVORow.getAttribute("IdTcaTipoTasaDesembolso"));
                            if(condicionesVORow.getAttribute("IdTcaTipoTasaDesembolso")!=null){
                                map.put("IdTcaTipoTasaDesembolso",condicionesVORow.getAttribute("IdTcaTipoTasaDesembolso"));
                            }else{
                                validaCampos = Boolean.FALSE;
                                logger.warning("IdTcaTipoTasaDesembolso requerido en componente");
                            }
                            logger.warning("IdTcaBaseCalculo: " + condicionesVORow.getAttribute("IdTcaBaseCalculo"));
                            if(condicionesVORow.getAttribute("IdTcaBaseCalculo")!=null){
                                map.put("IdTcaBaseCalculo", condicionesVORow.getAttribute("IdTcaBaseCalculo"));
                            }else{
                                validaCampos = Boolean.FALSE;
                                logger.warning("IdTcaBaseCalculo requerido en componente");
                            }
                        }
                    }
                } else {
                    validaCampos = Boolean.FALSE;
                    logger.warning("idCondicionFinanciera requerido en componente");
                }

                logger.warning("IdTcaTipoComponente: " + map.get("IdTcaTipoComponente"));
                if (map.get("IdTcaTipoComponente") != null){
                    componenteVORow.setAttribute("IdTcaTipoComponente", map.get("IdTcaTipoComponente"));
                    int idTcaTipoComponente = (Integer)map.get("IdTcaTipoComponente");
                    if(idTcaTipoComponente==3){
                        if(map.get("TipoTasa")!=null){
                            String tipoTasa=(String)map.get("TipoTasa");
                            logger.warning("TipoTasa-->" + map.get("TipoTasa"));
                            if(tipoTasa.trim().toLowerCase().equals("fijo"))map.put("IdTcaTipoTasaDesembolso",2);
                            if(tipoTasa.trim().toLowerCase().equals("variable"))map.put("IdTcaTipoTasaDesembolso",3);
                        }
                    }
                }else {
                    validaCampos = Boolean.FALSE;
                    logger.warning("IdTcaTipoComponente requerido en componente");
                }

                logger.warning("IdTcaTipoTasaDesembolso: " + map.get("IdTcaTipoTasaDesembolso"));
                if (map.get("IdTcaTipoTasaDesembolso") != null)
                    componenteVORow.setAttribute("IdTcaTipoTasaDesembolso", map.get("IdTcaTipoTasaDesembolso"));
                else {
                    validaCampos = Boolean.FALSE;
                    logger.warning("IdTcaTipoTasaDesembolso requerido en componente");
                }

                logger.warning("IdTcaBaseCalculo: " + map.get("IdTcaBaseCalculo"));
                if (map.get("IdTcaBaseCalculo") != null)
                    componenteVORow.setAttribute("IdTcaBaseCalculo", map.get("IdTcaBaseCalculo"));
                else {
                    validaCampos = Boolean.FALSE;
                    logger.warning("IdTcaBaseCalculo requerido en componente");
                }

                logger.warning("EsDependiente: " + map.get("EsDependiente"));
                if (map.get("EsDependiente") != null){
                    if(map.get("EsDependiente").equals("Si"))componenteVORow.setAttribute("EsDependiente", 1);
                    if(map.get("EsDependiente").equals("No"))componenteVORow.setAttribute("EsDependiente", 0);
                }
                else componenteVORow.setAttribute("EsDependiente", 1);

                logger.warning("EsFactor: " + map.get("EsFactor"));
                if (map.get("EsFactor") != null){
                    if(map.get("EsFactor").equals("Si"))componenteVORow.setAttribute("EsFactor", 1);
                    if(map.get("EsFactor").equals("No"))componenteVORow.setAttribute("EsFactor", 0);
                }else
                    componenteVORow.setAttribute("EsFactor", 0);

                logger.warning("DiasSpotTasa: " + map.get("DiasSpotTasa"));
                if (map.get("DiasSpotTasa") != null) {
                    String diasSpot= (String)map.get("DiasSpotTasa");
                    logger.warning("DiasSpotTasa-->" +diasSpot);
                    if(diasSpot.trim().toLowerCase().equals("no aplica")){
                        componenteVORow.setAttribute("DiasSpotTasa", null);  
                    }else{
                        componenteVORow.setAttribute("DiasSpotTasa", diasSpot);
                    }
                    
                }

                logger.warning("CodigoTasaReferencia: " + map.get("CodigoTasaReferencia"));
                if (map.get("CodigoTasaReferencia") != null)
                    componenteVORow.setAttribute("CodigoTasaReferencia", map.get("CodigoTasaReferencia"));

                logger.warning("ValorTasaReferencia: " + map.get("ValorTasaReferencia"));
                if (map.get("ValorTasaReferencia") != null)
                    componenteVORow.setAttribute("ValorTasaReferencia", map.get("ValorTasaReferencia"));


                logger.warning("CodigoTasaReferenciaSpread: " + map.get("CodigoTasaReferenciaSpread"));
                if (map.get("CodigoTasaReferenciaSpread") != null)
                    componenteVORow.setAttribute("CodigoTasaReferencia", map.get("CodigoTasaReferenciaSpread"));

                logger.warning("ValorTasaReferenciaSpread: " + map.get("ValorTasaReferenciaSpread"));
                if (map.get("ValorTasaReferenciaSpread") != null)
                    componenteVORow.setAttribute("ValorTasaReferencia", map.get("ValorTasaReferenciaSpread"));

                logger.warning("Tasa: " + map.get("Tasa"));
                if (map.get("Tasa") != null)
                    componenteVORow.setAttribute("Tasa", map.get("Tasa"));

                logger.warning("SpreadTasa: " + map.get("SpreadTasa"));
                if (map.get("SpreadTasa") != null)
                    componenteVORow.setAttribute("SpreadTasa", map.get("SpreadTasa"));

                logger.warning("MontoDescuento: " + map.get("MontoDescuento"));
                if (map.get("MontoDescuento") != null)
                    componenteVORow.setAttribute("MontoDescuento", map.get("MontoDescuento"));

                logger.warning("LimiteTasaMinima: " + map.get("LimiteTasaMinima"));
                if (map.get("LimiteTasaMinima") != null)
                    componenteVORow.setAttribute("LimiteTasaMinima", map.get("LimiteTasaMinima"));

                logger.warning("LimiteTasaMaxima: " + map.get("LimiteTasaMaxima"));
                if (map.get("LimiteTasaMaxima") != null)
                    componenteVORow.setAttribute("LimiteTasaMaxima", map.get("LimiteTasaMaxima"));
                
                logger.warning("IdTcaTipoRedondeo: " + map.get("IdTcaTipoRedondeo"));
                if (map.get("IdTcaTipoRedondeo") != null)
                    componenteVORow.setAttribute("IdTcaTipoRedondeo", map.get("IdTcaTipoRedondeo"));
                
                logger.warning("CantidadDecimales: " + map.get("CantidadDecimales"));
                if (map.get("CantidadDecimales") != null)
                    componenteVORow.setAttribute("CantidadDecimales", map.get("CantidadDecimales"));

                response.put("nuevo_registro", nuevo_registro);
                response.put("validaCampos", validaCampos);
                response.put("componenteVORow", componenteVORow);
                logger.warning("response_componente --> " + response);
            } else {
                logger.warning("No se recupero el row Componente.");
            }
            
        } catch (Exception e) {
            logger.warning("Ocurrio un error al validar Componente - " + e.getMessage());
            e.printStackTrace();
        }
        return response;
    }

    @SuppressWarnings("unchecked")
    public Map validarCalendario(Map map) {
        Boolean validaCampos = Boolean.TRUE;
        Boolean nuevo_registro = Boolean.TRUE;
        Map response = new HashMap();
        try {
            CalendarioVOImpl calendarioVO = getCalendarioVO();
            CalendarioVORowImpl calendarioVORow = null;
            Row rows2[] = null;
            if (map.get("Id") != null) {
                rows2 = calendarioVO.findByKey(new Key(new Object[] { map.get("Id") }), 1);
            }

            logger.warning("---- Calendario " + map.get("Id"));
            if (rows2 != null) {
                calendarioVORow = (CalendarioVORowImpl) rows2[0];
                nuevo_registro = Boolean.FALSE;
            } else {
                calendarioVORow = (CalendarioVORowImpl) calendarioVO.createRow();
                nuevo_registro = Boolean.TRUE;
                logger.warning("Se crea un registro de calendario");
            }

            logger.warning("Entra en validarDatosRequeridos Calendario ");

            // Se agregan atributos al Row Calendario
            if (calendarioVORow != null) {
                if (map.get("TipoPlan") != null) {
                    calendarioVORow.setAttribute("TipoPlan", map.get("TipoPlan"));
                    logger.warning("TipoPlan: " + calendarioVORow.getAttribute("TipoPlan"));
                } else {
                    validaCampos = Boolean.FALSE;
                    logger.warning("TipoPlan requerido en calendario");
                }

                logger.warning("Fecha: " + map.get("Fecha"));
                if (map.get("Fecha") != null)
                    calendarioVORow.setAttribute("Fecha", map.get("Fecha"));

                logger.warning("Frecuencia: " + map.get("Frecuencia"));
                if (map.get("Frecuencia") != null)
                    calendarioVORow.setAttribute("Frecuencia", map.get("Frecuencia"));

                calendarioVORow.setAttribute("IdTcaTipoFrecuencia", map.get("IdTcaTipoFrecuencia"));
                logger.warning("IdTcaTipoFrecuencia: " + calendarioVORow.getAttribute("IdTcaTipoFrecuencia"));

                logger.warning("Cantidad: " + map.get("Cantidad"));
                if (map.get("Cantidad") != null)
                    calendarioVORow.setAttribute("Cantidad", map.get("Cantidad"));

            } else {
                logger.warning("No se recupero el row Calendario null.");
            }

            response.put("validaCampos", validaCampos);
            response.put("nuevo_registro", nuevo_registro);
            response.put("calendarioVORow", calendarioVORow);
            logger.warning("response_calendario --> " + response);

        } catch (Exception ex) {
            System.out.println("Ocurrio un error al validar Calendario - " + ex.getMessage());
            ex.printStackTrace();
        }
        return response;
    }


    /**
     * Este metodo calcula y establece el numero de cuotas de la seccion principal de condiciones financieras
     *
     * @since 18/01/2017
     * @author Carlos Lopez
     */
    public Boolean calcularCoutasPrincipal(java.sql.Timestamp fechaInicio, java.sql.Timestamp fechaTermino,
                                           Integer IdTcaFrecuencia, Integer frecuencia, String tipoCuota,
                                           Long IdCondicionFinanciera) {
        logger.warning("*Inf, inicia metodo para calcular las cuotas  tipoCuota: " + tipoCuota);
        Boolean respuesta = Boolean.FALSE;
        Integer numCuotas = null;

        logger.warning("*Inf, fechaInicio " + fechaInicio);
        logger.warning("*Inf, fechaTermino " + fechaTermino);
        logger.warning("*Inf, IdTcaFrecuencia " + IdTcaFrecuencia);
        logger.warning("*Inf, frecuencia " + frecuencia);

        CFTempVOImpl cftempVO = getCFTempVO();
        Row rowCFTempVO = cftempVO.getCurrentRow();
        CondicionesFinancierasVOImpl condicionesFinancieras = getCondicionesFinancierasVO();

        if (fechaInicio == null || fechaTermino == null || IdTcaFrecuencia == null || frecuencia == null ||
            tipoCuota == null) {
            logger.warning("*Inf, Important! faltan parametros para poder calcular el numero de cuotas ");
        } else {
            numCuotas =
                condicionesFinancieras.calcularCuotasService(fechaInicio, fechaTermino, IdTcaFrecuencia, frecuencia,
                                                             IdCondicionFinanciera);
            respuesta = Boolean.TRUE;
        }

        if (tipoCuota != null && !tipoCuota.equals("")) {

            switch (tipoCuota) {
            case "principal":
                rowCFTempVO.setAttribute("NumeroCuotasPagoCapital", numCuotas);
                logger.warning("*Inf, NumeroCuotasPagoCapital Calculando: " + numCuotas);
                respuesta = Boolean.TRUE;
                break;
            case "interes":
                rowCFTempVO.setAttribute("NumeroCuotasPagoInteres", numCuotas);
                logger.warning("*Inf, NumeroCuotasPagoInteres Calculando: " + numCuotas);
                respuesta = Boolean.TRUE;
                break;
            case "taza":
                rowCFTempVO.setAttribute("NumeroRevisionesTasa", numCuotas);
                logger.warning("*Inf, NumeroRevisionesTasa Calculando: " + numCuotas);
                respuesta = Boolean.TRUE;
                break;
            case "spread":
                rowCFTempVO.setAttribute("NumeroRevisionesSpread", numCuotas);
                logger.warning("*Inf, NumeroRevisionesSpread Calculando: " + numCuotas);
                respuesta = Boolean.TRUE;
                break;
            case "tazaI":
                rowCFTempVO.setAttribute("NumeroRevisionesTasaI", numCuotas);
                logger.warning("*Inf, NumeroRevisionesTasa Calculando: " + numCuotas);
                respuesta = Boolean.TRUE;
                break;
            }
        } else {
            logger.warning("*Inf, Important! el tipoCuota no fue especificado no se realizara la asignacion");
            respuesta = Boolean.FALSE;
        }

        logger.warning("Inf, termina metodo calcularCoutasInteres numCuotas calculado : " + numCuotas);
        return respuesta;
    }

    /**
     * Container's getter for ComponenteVO1.
     * @return ComponenteVO1
     */
    public ComponenteVOImpl getComponenteVO() {
        return (ComponenteVOImpl) findViewObject("ComponenteVO");
    }

    /**
     * Container's getter for Tre_Componente_Cal_VO1.
     * @return Tre_Componente_Cal_VO1
     */
    public Tre_Componente_Cal_VOImpl getTre_Componente_Cal_VO() {
        return (Tre_Componente_Cal_VOImpl) findViewObject("Tre_Componente_Cal_VO");
    }

    /**
     * Container's getter for Tre_Condicion_Financiera_Cal_VO1.
     * @return Tre_Condicion_Financiera_Cal_VO1
     */
    public Tre_Condicion_Financiera_Cal_VOImpl getTre_Condicion_Financiera_Cal_VO() {
        return (Tre_Condicion_Financiera_Cal_VOImpl) findViewObject("Tre_Condicion_Financiera_Cal_VO");
    }

    /**
     * Container's getter for CalendarioVO1.
     * @return CalendarioVO1
     */
    public CalendarioVOImpl getCalendarioVO() {
        return (CalendarioVOImpl) findViewObject("CalendarioVO");
    }

    /**
     * Container's getter for TasaReferenciaVO1.
     * @return TasaReferenciaVO1
     */
    public TasaReferenciaVOImpl getTasaReferenciaVO() {
        return (TasaReferenciaVOImpl) findViewObject("TasaReferenciaVO");
    }

    /**
     * Container's getter for SpreadReferenciaVO1.
     * @return SpreadReferenciaVO1
     */
    public SpreadReferenciaVOImpl getSpreadReferenciaVO() {
        return (SpreadReferenciaVOImpl) findViewObject("SpreadReferenciaVO");
    }
    
    public Row getCFTempVORowCurrent(){
        logger.warning("*Inf, Inicia metodo getCFTempVORowCurrent");
        CFTempVOImpl cftempVO = getCFTempVO();
        Row fila = null;

        if (cftempVO.getCurrentRow() != null) fila = cftempVO.getCurrentRow();
        else logger.warning("*Inf, Important! no se ha encontrado una row CFTemp current");

        logger.warning("*Inf, Termina metodo getCondicionFinancieraCurrent");
        return fila;
    }
    
    public Map buscarCondicionFinancieraPorIdContrato(Long idContrato){
        FenixGestorDesembolsosAMImpl fenixGD = (FenixGestorDesembolsosAMImpl) getFenixGestorDesembolsosAM();
        return fenixGD.buscarCondicionFinancieraPorIdContrato(idContrato,getCFTempVORowCurrent());
    }

    /**
     * Container's getter for OperaAsociadaVO1.
     * @return OperaAsociadaVO1
     */
    public OperaAsociadaVOImpl getOperaAsociadaVO1() {
        return (OperaAsociadaVOImpl) findViewObject("OperaAsociadaVO1");
    }

    /**
     * Container's getter for CondicionGeneralPorValidarVO.
     * @return CondicionGeneralPorValidarVO1
     */
    public CondicionGeneralPorValidarVOImpl getCondicionGeneralPorValidarVO() {
        return (CondicionGeneralPorValidarVOImpl) findViewObject("CondicionGeneralPorValidarVO");
    }

    /**
     * Container's getter for CondicionDesembolsoPorValidarVO.
     * @return CondicionDesembolsoPorValidarVO1
     */
    public CondicionDesembolsoPorValidarVOImpl getCondicionDesembolsoPorValidarVO() {
        return (CondicionDesembolsoPorValidarVOImpl) findViewObject("CondicionDesembolsoPorValidarVO");
    }

    /**
     * Container's getter for CFandCalendario1VO1.
     * @return CFandCalendario1VO1
     */
    public CFandCalendario1VOImpl getCFandCalendario1VO1() {
        return (CFandCalendario1VOImpl) findViewObject("CFandCalendario1VO1");
    }

    /**
     * Container's getter for CFTerminoVO1.
     * @return CFTerminoVO1
     */
    public CFTerminoVOImpl getCFTerminoVO() {
        return (CFTerminoVOImpl) findViewObject("CFTerminoVO");
    }
    
    /**
     * [KB: 15528]
     * Propaga una línea de crédito. Usa método actual: validaLineaCredito, pero no relanza la excepción sino que retorna el error como texto.
     *
     * @param idLinea Linea a propagar. Obligatorio.
     * @param fechaValor Fecha valor. Opcional.
     * @return Resultado de la prpagación. Si todo va bien, retorna "Pasa", de lo contrario retorna errores de validación.
     */
    public String propagarLineaCredito(final Long idLinea, final Timestamp fechaValor) {
        Objects.requireNonNull(idLinea);
        
        String resultadoPropagacion = null;
        try {
            logger.warning("Se invoca metodo para consumir servicio de propagar linea");
            resultadoPropagacion = validaLineaCredito(idLinea, fechaValor);

            if (resultadoPropagacion.equalsIgnoreCase("Pasa")) {
                logger.warning("Se propaga Linea: {0}", idLinea);
            } else {
                logger.warning("Error al propagara Linea: {0}", idLinea);
            }
        } catch (Exception e) {
            logger.severe(e);
            resultadoPropagacion = e.getMessage();
        }

        return resultadoPropagacion;
    }

    /**
     * Container's getter for vtaEvaluacionesVO.
     * @return vtaEvaluacionesVO
     */
    public vtaEvaluacionesVOImpl getvtaEvaluacionesVO() {
        return (vtaEvaluacionesVOImpl) findViewObject("vtaEvaluacionesVO");
    }

    /**
     * Container's getter for CatSectorMercado1.
     * @return CatSectorMercado1
     */
    public ViewObjectImpl getCatSectorMercado() {
        return (ViewObjectImpl) findViewObject("CatSectorMercado");
    }

    /**
     * Container's getter for CatEjercicioPoaVO1.
     * @return CatEjercicioPoaVO1
     */
    public ViewObjectImpl getCatEjercicioPoaVO() {
        return (ViewObjectImpl) findViewObject("CatEjercicioPoaVO");
    }

    /**
     * Container's getter for CatTipoGarantiaVO1.
     * @return CatTipoGarantiaVO1
     */
    public ViewObjectImpl getCatTipoGarantiaVO() {
        return (ViewObjectImpl) findViewObject("CatTipoGarantiaVO");
    }
	
	
	/**
	* Container's getter for ContratoDesembolsoEstadoVO1.
	* @return ContratoDesembolsoEstadoVO1
	*/
	public ContratoDesembolsoEstadoVOImpl getContratoDesembolsoEstadoVO1() {
		return (ContratoDesembolsoEstadoVOImpl) findViewObject("ContratoDesembolsoEstadoVO1");
	}
	
	/**
	* Container's getter for ValidarOperacionGestorTipoDocumentoVO1.
	* @return ValidarOperacionGestorTipoDocumentoVO1
	*/
	public ValidarOperacionGestorTipoDocumentoVOImpl getValidarOperacionGestorTipoDocumentoVO1() {
		return (ValidarOperacionGestorTipoDocumentoVOImpl) findViewObject("ValidarOperacionGestorTipoDocumentoVO1");
	}


    /**
     * Container's getter for CatSectorIbcieVO1.
     * @return CatSectorIbcieVO1
     */
    public ViewObjectImpl getCatSectorIbcieVO() {
        return (ViewObjectImpl) findViewObject("CatSectorIbcieVO");
    }

    /**
     * Container's getter for CatSubSectorIbcieVO1.
     * @return CatSubSectorIbcieVO1
     */
    public ViewObjectImpl getCatSubSectorIbcieVO() {
        return (ViewObjectImpl) findViewObject("CatSubSectorIbcieVO");
    }
	
    /**
     * Container's getter for ValidarTareaMensajesVO1.
     * @return ValidarTareaMensajesVO1
     */
    public ValidarTareaMensajesVOImpl getValidarTareaMensajesVO() {
        return (ValidarTareaMensajesVOImpl) findViewObject("ValidarTareaMensajesVO");
    }

    /**
     * Container's getter for ValidarTareaMensajesVO2.
     * @return ValidarTareaMensajesVO2
     */
    public ValidarTareaMensajesVOImpl getValidarTareaMensajesCintaVO() {
        return (ValidarTareaMensajesVOImpl) findViewObject("ValidarTareaMensajesCintaVO");
    }


    public BigDecimal obtenerMontoDescuento(String idContratoDesembolso) {
        logger.warning("********** Ejecutando obtenerMontoDescuento **********");
        logger.warning("idContrato: " + idContratoDesembolso);  
        BigDecimal MontoDescuento = new BigDecimal("0");
        
        try { 
                         
            //Componente Interes
            CFandComponente1VOImpl cfandComponente = getCFandComponente1VO();
            Row rowCFandComponente = cfandComponente.llenarCFandComp(idContratoDesembolso);
            logger.warning("datos rowCFandComponenteVO: ");
            if (rowCFandComponente != null) { 
                logger.warning("MontoDescuento: " + rowCFandComponente.getAttribute("MontoDescuento") + "");
                if (rowCFandComponente.getAttribute("MontoDescuento") != null){
                    MontoDescuento = (BigDecimal) rowCFandComponente.getAttribute("MontoDescuento");
                }
            } 
             
        } catch (Exception ex) {
            logger.warning("Error obtenerMontoDescuento FenixAMImpl --> " + ex.getMessage() + " - " + ex.getStackTrace() + " - " + ex.getSuppressed());
            ex.printStackTrace();
        }
        logger.warning("MontoDescuento: " + MontoDescuento); 
        return MontoDescuento;
    }
    
    
    public Boolean guardarCuestionario(Object plPreguntas) {
        logger.warning("============= FenixAM  =====================" );
        logger.warning("plPreguntas :" + plPreguntas);
        logger.warning("getDBTransaction().isConnected() :" + getDBTransaction().isConnected());
        Boolean preguntarGuardadas = false;
        if (!getDBTransaction().isConnected()) {
            try {
                logger.warning("Base de datos no conectada, intentando reconnect");
                getDBTransaction().reconnect();

            } catch (Exception ex) {
                logger.warning("Error al realizar el reconnect ->", ex);
            }
        }

        if (getDBTransaction().isConnected()) {
            try {

                ViewObjectImpl cuestionarioVO = this.getGestionCuestionariosVO1();
                RowSetIterator rs = cuestionarioVO.createRowSetIterator(null);
                rs.reset();

                logger.warning("rs.getRowCount() :" + rs.getRowCount());
                logger.warning("rs.hasNext() :" + rs.hasNext());

                //Se valida que si el rowcount de VO es mayor que cero y el Rowset cero en ese caso se devuelve false
                if (cuestionarioVO.getEstimatedRowCount() > 0 && rs.getRowCount() == 0) {
                    rs.closeRowSetIterator();
                    preguntarGuardadas = Boolean.FALSE;
                } else {
                    while (rs.hasNext()) {
                        GestionCuestionariosVORowImpl preguntaRow = (GestionCuestionariosVORowImpl) rs.next();
                        Long idPregunta = (Long) preguntaRow.getAttribute(QPreguntaVORowImpl.IDPREGUNTA);
                        logger.warning("idPregunta: " + idPregunta);
                        if (null != idPregunta) {

                            List<Map> preguntas = (ArrayList<Map>) plPreguntas;

                            Iterator<Map> i = preguntas.iterator();
                            while (i.hasNext()) {
                                Map preguntaMap = i.next();

                                Long idPreguntaMap = (Long) preguntaMap.get("IdPregunta");
                                //logger.warning("idPregunta: "+idPregunta+" idPreguntaMap: "+idPreguntaMap);
                                if (idPregunta.compareTo(idPreguntaMap) == 0) {
                                    String respuesta = (String) preguntaMap.get("Respuesta");
                                    String justificacion = (String) preguntaMap.get("Justificacion");
                                    logger.warning("coincidencia encontrada agregando respuesta y justificacion: " +
                                                   respuesta + " - " + justificacion);
                                    if (respuesta != null && !respuesta.isEmpty()) {
                                        preguntaRow.setAttribute(GestionCuestionariosVORowImpl.RESPUESTA, respuesta);
                                    }
                                    if (justificacion != null && !justificacion.isEmpty()) {
                                        preguntaRow.setAttribute(GestionCuestionariosVORowImpl.JUSTIFICACION,
                                                                 justificacion);
                                    }

                                    i.remove();
                                }
                            }
                        }
                    }
                    rs.closeRowSetIterator();
                    getDBTransaction().commit();
                    preguntarGuardadas = Boolean.TRUE;

                }
            } catch (Exception ex) {
                logger.warning("Error al realizar el commit ->", ex);
                preguntarGuardadas = Boolean.FALSE;
            }
        } else {
            logger.warning("Transaction is not connected");
            preguntarGuardadas = Boolean.FALSE;
        }

        return preguntarGuardadas;
    }
    /**
     * @MÃ©todo asociadoo a Feature20
     * @funtion: Guardar respuestas del Cuestionario de Derivados Implicitos
     * @since 16/06/2021
     * Container's getter for TcaTareaConBtnDinVO1.
     * @return TcaTareaConBtnDinVO1
     */
    public TcaTareaConBtnDinVOImpl getTcaTareaConBtnDinVO1() {
        return (TcaTareaConBtnDinVOImpl) findViewObject("TcaTareaConBtnDinVO1");
    }
     
     /* Container's getter for TcaCategoriaLeccionVO1.
     * @return TcaCategoriaLeccionVO1
     */
    public TcaCategoriaLeccionVOImpl getTcaCategoriaLeccionVO() {
        return (TcaCategoriaLeccionVOImpl) findViewObject("TcaCategoriaLeccionVO");
    }

    /**
     * Container's getter for TcaEstadoLeccionVO1.
     * @return TcaEstadoLeccionVO1
     */
    public TcaEstadoLeccionVOImpl getTcaEstadoLeccionVO() {
        return (TcaEstadoLeccionVOImpl) findViewObject("TcaEstadoLeccionVO");
    }


    /**
     * Container's getter for CrearOperacionVO1.
     * @return CrearOperacionVO1
     */
    public CrearOperacionVOImpl getCrearOperacionVO() {
        return (CrearOperacionVOImpl) findViewObject("CrearOperacionVO");
    }

    /**
     * Container's getter for JustificacionOperacionVO1.
     * @return JustificacionOperacionVO1
     */
    public JustificacionOperacionVOImpl getJustificacionOperacionVO1() {
        return (JustificacionOperacionVOImpl) findViewObject("JustificacionOperacionVO1");
    }


    /**
     * Container's getter for DocumentosTrazabilidadOperacionAdquisicionesVO1.
     * @return DocumentosTrazabilidadOperacionAdquisicionesVO1
     */
    public DocumentosTrazabilidadOperacionAdquisicionesVOImpl getDocumentosTrazabilidadOperacionAdquisicionesVO() {
        return (DocumentosTrazabilidadOperacionAdquisicionesVOImpl) findViewObject("DocumentosTrazabilidadOperacionAdquisicionesVO");
    }

    /**
     * Container's getter for QPreguntaVO1.
     * @return QPreguntaVO1
     */
    public QPreguntaVOImpl getQPreguntaVO() {
        return (QPreguntaVOImpl) findViewObject("QPreguntaVO");
    }

    /**
     * Container's getter for RespuestaComentarioVO1.
     * @return RespuestaComentarioVO1
     */
    public RespuestaComentarioVOImpl getRespuestaComentarioVO1() {
        return (RespuestaComentarioVOImpl) findViewObject("RespuestaComentarioVO1");
    }

    /**
     * Container's getter for DatosLineaCreditoVO1.
     * @return DatosLineaCreditoVO1
     */
    public DatosLineaCreditoVOImpl getDatosLineaCreditoVO() {
        return (DatosLineaCreditoVOImpl) findViewObject("DatosLineaCreditoVO");
    }

    /**
     * Container's getter for OperacionResultadoVO1.
     * @return OperacionResultadoVO1
     */
    public ViewObjectImpl getOperacionResultadoVO() {
        return (ViewObjectImpl) findViewObject("OperacionResultadoVO");
    }


    public String EstadoTBILineaCredito(
            Long pIdContrato,  
            Long pIdLineaCredito,
            String pInstanciaProceso, 
            String pNumeroLineaCredito
    ){
        logger.warning("Inicio EstadoTBILineaCredito");
        logger.warning("pIdContrato: " + pIdContrato);
        logger.warning("pIdLineaCredito: " + pIdLineaCredito);
        logger.warning("pInstanciaProceso: " + pInstanciaProceso);
        logger.warning("pNumeroLineaCredito: " + pNumeroLineaCredito);
        
        TBILineaCreditoType lc = this.ConsultarTBILineaCredito(pIdContrato,pIdLineaCredito,pInstanciaProceso,pNumeroLineaCredito);
        
        String estadoLineaCredito = "ERROR";
        if(lc != null){
            estadoLineaCredito = lc.getEstadoLineaCredito().getValue();
        }

        logger.warning("estadoLineaCredito: " + estadoLineaCredito);
        logger.warning("Fin EstadoTBILineaCredito");
        return estadoLineaCredito;
    }
         
        
    public String MergeTBILineaCredito(
            Long pIdContrato,  
            Long pIdLineaCredito,  
            Long pIdTareaBpm,  
            String pInstanciaProceso,  
            String pEstadoLineaCredito,  
            String pUsuario,   
            Integer pBanEstatus,   
            String pNumeroLineaCredito
    ){
        logger.warning("Inicio MergeTBILineaCredito");
        logger.warning("pIdContrato: " + pIdContrato);
        logger.warning("pIdLineaCredito: " + pIdLineaCredito);
        logger.warning("pIdTareaBpm: " + pIdTareaBpm);
        logger.warning("pInstanciaProceso: " + pInstanciaProceso);
        logger.warning("pEstadoLineaCredito: " + pEstadoLineaCredito);
        logger.warning("pUsuario: " + pUsuario);
        logger.warning("pBanEstatus: " + pBanEstatus);
        logger.warning("pNumeroLineaCredito: " + pNumeroLineaCredito);

        try {        
            String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);
    
            com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito12BndQSService = IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
            com.bcie.xmlns.lineacreditoservice.LineaCreditoPT lineaCreditoPT = lineaCredito12BndQSService.getLineaCredito12Bnd();
            ObjectFactory obj = new ObjectFactory();
            org.bcie.lineacreditomo.TBILineaCreditoRequestType request = new TBILineaCreditoRequestType();
    
            org.bcie.lineacreditobo.TBILineaCreditoType lc = this.ConsultarTBILineaCredito(pIdContrato,pIdLineaCredito,pInstanciaProceso,pNumeroLineaCredito);
            
            if(lc == null){
                lc =  new TBILineaCreditoType();
    
                lc.setIdContrato(obj.createTBILineaCreditoTypeIdContrato(pIdContrato));
                lc.setIdLineaCredito(obj.createTBILineaCreditoTypeIdLineaCredito(pIdLineaCredito));
                lc.setIdTareaBpm(obj.createTBILineaCreditoTypeIdTareaBpm(pIdTareaBpm));
                lc.setInstanciaProceso(obj.createTBILineaCreditoTypeInstanciaProceso(pInstanciaProceso));
                lc.setEstadoLineaCredito(obj.createTBILineaCreditoTypeEstadoLineaCredito(pEstadoLineaCredito));
                lc.setUsuario(obj.createTBILineaCreditoTypeUsuario(pUsuario));
                lc.setBanEstatus(pBanEstatus);
                lc.setNumeroLineaCredito(obj.createTBILineaCreditoTypeNumeroLineaCredito(pNumeroLineaCredito));
                request.setTbiLineaCredito(lc);
                
                Date horaInicio = ModelUtils.logStartWS(logger, request, "Request CrearTBILineaCredito");
                org.bcie.lineacreditomo.TBILineaCreditoResponseType response = lineaCreditoPT.tbiLineaCreditoCrear(request);
                ModelUtils.logEndWS(logger, response, "Response CrearTBILineaCredito", horaInicio);
            }
            else
            {  
                lc.setIdContrato(obj.createTBILineaCreditoTypeIdContrato(pIdContrato));
                lc.setIdLineaCredito(obj.createTBILineaCreditoTypeIdLineaCredito(pIdLineaCredito));
                lc.setIdTareaBpm(obj.createTBILineaCreditoTypeIdTareaBpm(pIdTareaBpm));
                lc.setInstanciaProceso(obj.createTBILineaCreditoTypeInstanciaProceso(pInstanciaProceso));
                lc.setEstadoLineaCredito(obj.createTBILineaCreditoTypeEstadoLineaCredito(pEstadoLineaCredito));
                lc.setUsuario(obj.createTBILineaCreditoTypeUsuario(pUsuario));
                lc.setBanEstatus(pBanEstatus);
                lc.setNumeroLineaCredito(obj.createTBILineaCreditoTypeNumeroLineaCredito(pNumeroLineaCredito));
                request.setTbiLineaCredito(lc);
                
                Date horaInicio = ModelUtils.logStartWS(logger, request, "Request ActualizarTBILineaCredito");
                org.bcie.lineacreditomo.TBILineaCreditoResponseType response = lineaCreditoPT.tbiLineaCreditoActualizar(request);
                ModelUtils.logEndWS(logger, response, "Response ActualizarTBILineaCredito", horaInicio);
            }
             
            lc = this.ConsultarTBILineaCredito(pIdContrato,pIdLineaCredito,pInstanciaProceso,pNumeroLineaCredito);
                
            logger.warning("Fin MergeTBILineaCredito");
            if(lc == null){
                return "ERROR";
            }
            else
            {
                return "OK";
            }
        } catch (Exception e) {
            logger.warning("Error ConsultarTBILineaCredito:", e);
            return  e.getMessage();
        } 
        

    }
        
        
    public TBILineaCreditoType ConsultarTBILineaCredito( 
            Long pIdContrato,  
            Long pIdLineaCredito,   
            String pInstanciaProceso, 
            String pNumeroLineaCredito
    ){
        logger.warning("Inicio ConsultarTBILineaCredito");
        logger.warning("pIdContrato: " + pIdContrato);
        logger.warning("pIdLineaCredito: " + pIdLineaCredito); 
        logger.warning("pInstanciaProceso: " + pInstanciaProceso); 
        logger.warning("pNumeroLineaCredito: " + pNumeroLineaCredito);
                
        String wsdl = getWsdl(IWsdlLocation.LINEA_CREDITO);

        ObjectFactory obj = new ObjectFactory();
        com.bcie.xmlns.lineacreditoservice.LineaCredito lineaCredito12BndQSService = IWsdlLocation.Service.getInstance(com.bcie.xmlns.lineacreditoservice.LineaCredito.class, wsdl);
        com.bcie.xmlns.lineacreditoservice.LineaCreditoPT lineaCreditoPT = lineaCredito12BndQSService.getLineaCredito12Bnd();

        try {
            logger.log(ADFLogger.WARNING, ">HNWS lineaCreditoPT.toString()" + lineaCreditoPT.toString());
            org.bcie.lineacreditomo.TBILineaCreditoRequestType request = new org.bcie.lineacreditomo.TBILineaCreditoRequestType();

            TBILineaCreditoType lc =  new TBILineaCreditoType();
            lc.setIdContrato(obj.createTBILineaCreditoTypeIdContrato(pIdContrato));
            lc.setIdLineaCredito(obj.createTBILineaCreditoTypeIdLineaCredito(pIdLineaCredito)); 
            lc.setInstanciaProceso(obj.createTBILineaCreditoTypeInstanciaProceso(pInstanciaProceso));  
            lc.setNumeroLineaCredito(obj.createTBILineaCreditoTypeNumeroLineaCredito(pNumeroLineaCredito));
            request.setTbiLineaCredito(lc); 

            Date horaInicio = ModelUtils.logStartWS(logger, request, "Request ConsultarTBILineaCredito");
            org.bcie.lineacreditomo.TBILineaCreditoResponseType response = lineaCreditoPT.tbiLineaCreditoConsultar(request);
            ModelUtils.logEndWS(logger, response, "Response ConsultarTBILineaCredito", horaInicio);
            
            logger.warning("Fin ConsultarTBILineaCredito");
            return response.getTbiLineaCredito().get(0).getTbiLineaCredito().get(0); 
                        
        } catch (Exception e) {
            logger.warning("Error ConsultarTBILineaCredito:", e);
            return  null;
        } 
        
    }

    /**
     * Container's getter for DetalleOperacionEditableVO1.
     * @return DetalleOperacionEditableVO1
     */
    public DetalleOperacionEditableVOImpl getDetalleOperacionEditableVO() {
        return (DetalleOperacionEditableVOImpl) findViewObject("DetalleOperacionEditableVO");
    }
    
    public Boolean actualizarEstado(String idContrato, Integer estado) {
            logger.warning("Entrando en FenixAMImpl actualizarEstado.");
            logger.warning("idContrato: " + idContrato);
            logger.warning("estado: " + estado);
        
            StringWriter xmlEntrada = null;
            StringWriter xmlSalida = null;
            
            Boolean resultado = Boolean.FALSE;
            
            try
            {
                logger.warning("Ejecutar servicio de actualizarEstado");
                String wsdl = getWsdl(IWsdlLocation.DESEMBOLSO);
                DesembolsoPTSOAP12BindingQSService desembolso12BndQSService = IWsdlLocation.Service.getInstance(DesembolsoPTSOAP12BindingQSService.class, wsdl);
                DesembolsoPT desembolsoPT = desembolso12BndQSService.getDesembolsoPTSOAP12BindingQSPort();
                
                BigInteger vbi_idContrato = new BigInteger(idContrato);
                BigInteger vbi_TcaEstado = new BigInteger(estado.toString());
                logger.warning("vbi_idContrato: " + vbi_idContrato);
                logger.warning("vbi_TcaEstado: " + vbi_TcaEstado);
                
                ActualizarEstadoContratoDesembolsoRequestType actualizarEstadoContratoDesembolsoRequest = new ActualizarEstadoContratoDesembolsoRequestType();
                actualizarEstadoContratoDesembolsoRequest.setIdContrato(vbi_idContrato);
                actualizarEstadoContratoDesembolsoRequest.setIdTcaEstado(vbi_TcaEstado);
                
                logger.warning("actualizarEstadoContratoDesembolsoRequest");        
                xmlEntrada = this.writeXMLRequest(actualizarEstadoContratoDesembolsoRequest, actualizarEstadoContratoDesembolsoRequest.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());            
                logger.warning("Ejecutar servicio de actualizarEstado");   
                ActualizarEstadoContratoDesembolsoResponseType actualizarEstadoContratoDesembolsoResponse = desembolsoPT.actualizarEstadoContratoDesembolso(actualizarEstadoContratoDesembolsoRequest) ;
                 
                logger.log(ADFLogger.WARNING, ">HNWS" + "Respuesta servicio - actualizarEstadoContratoDesembolso -");
                xmlSalida = this.writeXMLRequest(actualizarEstadoContratoDesembolsoResponse, actualizarEstadoContratoDesembolsoResponse.getClass());
                logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());

     

                if (
                    null != actualizarEstadoContratoDesembolsoResponse
                )
                {
                    logger.warning("Obtener el resultado del servicio actualizarEstadoContratoDesembolsoResponse");
                    String result = actualizarEstadoContratoDesembolsoResponse.getResultado().getResult().toString();
                    String message = actualizarEstadoContratoDesembolsoResponse.getResultado().getMessage().toString();
                    String respuestaDB = actualizarEstadoContratoDesembolsoResponse.getRespuestaDB().toString();
                    
                    logger.log(ADFLogger.WARNING, "result: " + result);                
                    logger.log(ADFLogger.WARNING, "message: " + message);                
                    logger.log(ADFLogger.WARNING, "respuestaDB: " + respuestaDB);
                    if(result.equals("OK") && respuestaDB.equals("TRUE")){
                        resultado = Boolean.TRUE;     
                    }
                } 
            }
            catch(Exception exp)
            {
                logger.log(ADFLogger.WARNING, "exp: " + exp);            
            }
            return resultado;
        }


    /**
     * Container's getter for ComponenteProductoPoseeMoraVO1.
     * @return ComponenteProductoPoseeMoraVO1
     */
    public ComponenteProductoPoseeMoraVOImpl getComponenteProductoPoseeMoraVO() {
        return (ComponenteProductoPoseeMoraVOImpl) findViewObject("ComponenteProductoPoseeMoraVO");
    }

    /**
     * Container's getter for CondicionPreviasFormalizarPorValidarVO1.
     * @return CondicionPreviasFormalizarPorValidarVO1
     */
    public CondicionPreviasFormalizarPorValidarVOImpl getCondicionPreviasFormalizarPorValidarVO() {
        return (CondicionPreviasFormalizarPorValidarVOImpl) findViewObject("CondicionPreviasFormalizarPorValidarVO");
    }

    /**
     * Container's getter for GestionCuestionariosVO1.
     * @return GestionCuestionariosVO1
     */
    public GestionCuestionariosVOImpl getGestionCuestionariosVO1() {
        return (GestionCuestionariosVOImpl) findViewObject("GestionCuestionariosVO1");
    }
    
    public Map<String,String> obtienePermisosUsuario(String pUser, String pApplication, String pWindow, String pControl) {
        logger.warning("Inicio obtienePermisosUsuario");
        logger.warning("pUser: " + pUser);
        logger.warning("pApplication: " + pApplication);
        logger.warning("pWindow: " + pWindow);
        logger.warning("pControl: " + pControl);

        Date horaInicio = null;
        Date horaTermino = null;
        Long tiempoProcesoSegundos;
        SimpleDateFormat dateFormat = null;
        StringWriter xmlEntrada = null;
        StringWriter xmlSalida = null;
        String mensaje = "";
        Map<String,String> respuesta = new HashMap<String,String>();
        try { 
            String wsdl = getWsdl(IWsdlLocation.SEGURIDAD); 
            logger.log(ADFLogger.WARNING, ">wsdl> " + wsdl);
            Seguridad12BndQSService servicioSeguridad = null;
            SeguridadPT seguridadPT = null;
            try{
                servicioSeguridad = IWsdlLocation.Service.getInstance(Seguridad12BndQSService.class, wsdl);
                seguridadPT = servicioSeguridad.getSeguridad12BndQSPort();
            }
            catch(Exception eee){
                logger.log(ADFLogger.WARNING, ">Error eee> " + eee);
                    servicioSeguridad = new Seguridad12BndQSService();
                    seguridadPT =servicioSeguridad.getSeguridad12BndQSPort();
                logger.log(ADFLogger.WARNING, ">Fin  seguridadpt> " );
                }
                        
            ObtienePermisosUsuarioRequestType requestObtienePermisosUsuario = new ObtienePermisosUsuarioRequestType();
            
            requestObtienePermisosUsuario.setPVUSER(pUser);
            requestObtienePermisosUsuario.setPVAPPLICATION(pApplication);
            requestObtienePermisosUsuario.setPVWINDOW(pWindow);
            requestObtienePermisosUsuario.setPVCONTROL(pControl);
            
            dateFormat = new SimpleDateFormat("HH:mm:ss");
            horaInicio = new GregorianCalendar().getTime();
            logger.log(ADFLogger.WARNING, ">HNWS" + "Start invocando Servicio - Consultar Condicion Aprobacion-");
            logger.log(ADFLogger.WARNING, ">HNWS" + "Hora de inicio: " + dateFormat.format(horaInicio.getTime()));
            xmlEntrada = this.writeXMLRequest(requestObtienePermisosUsuario, requestObtienePermisosUsuario.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlEntrada.toString());

            ObtienePermisosUsuarioResponseType responseObtienePermisosUsuario = seguridadPT.obtienePermisosUsuario(requestObtienePermisosUsuario);

            horaTermino = new GregorianCalendar().getTime();
            tiempoProcesoSegundos = (horaTermino.getTime() - horaInicio.getTime()) / CONVERTIR_MILISEGUNDOS_SEGUNDOS;
            logger.log(ADFLogger.WARNING, ">HNWS" + "Tiempo de proceso en segundos: " + tiempoProcesoSegundos);
            logger.log(ADFLogger.WARNING, ">HNWS" + "Respuesta servicio - Consultar Tiene acceso -");
            xmlSalida = this.writeXMLRequest(responseObtienePermisosUsuario, responseObtienePermisosUsuario.getClass());
            logger.log(ADFLogger.WARNING, ">HNWS" + xmlSalida.toString());
            
            if (responseObtienePermisosUsuario.getPVCODIGO().equals("OK"))
            {
                List<PERMISOTYPE> listaPermisos = responseObtienePermisosUsuario.getPLPERMISOS().getPLPERMISOSITEM();
                int listaPermisosSize = listaPermisos.size();
                if(listaPermisosSize !=0 ){
                    logger.log(ADFLogger.WARNING, "listaPermisosSize es (" + listaPermisosSize +")");
                    respuesta.put("RESULTADO", "OK");
                    respuesta.put("MENSAJE", mensaje);
                    for(PERMISOTYPE item : listaPermisos){
                        String llave = item.getCONTROL() != null? item.getCONTROL().toString() : null;
                        String valor = item.getDESCRIPCION() != null? item.getDESCRIPCION().toString() : null;
                        if(llave != null && valor != null){
                            respuesta.put(llave, valor);
                            logger.log(ADFLogger.WARNING, llave + "(" + valor +")");
                        }
                        else
                        {
                            logger.log(ADFLogger.WARNING, "Alguno es nulo>" + llave + "(" + valor +")");
                        }
                    }  
                }
                else
                {
                    mensaje = "listaPermisosSize es cero(" + listaPermisosSize +")";
                    logger.log(ADFLogger.WARNING, mensaje);
                    respuesta.put("RESULTADO", "ERROR");
                    respuesta.put("MENSAJE", mensaje);
                } 
            } else {
                if (responseObtienePermisosUsuario.getResultado().getResult().equals("ERROR"))
                {
                    mensaje = responseObtienePermisosUsuario.getResultado().getMessage();
                    logger.log(ADFLogger.WARNING, "respuesta>" + mensaje);
                    respuesta.put("RESULTADO", "ERROR");
                    respuesta.put("MENSAJE", mensaje);
                }
                else
                {
                    mensaje = responseObtienePermisosUsuario.getResultado().getMessage();
                    logger.log(ADFLogger.WARNING, "respuesta>" + mensaje);
                    String resultado = responseObtienePermisosUsuario.getResultado().getResult().value();
                    respuesta.put("RESULTADO", resultado);
                    respuesta.put("MENSAJE", mensaje);
                }
            }
        } catch (Exception e) {
            mensaje = e.getMessage();
            logger.log(ADFLogger.WARNING, "Error al consultar obtienePermisosUsuario." + e.getMessage());
            respuesta.put("RESPUESTA", mensaje);
            JboException ex = new JboException(e);
            ex.addToExceptions(new Exception("Error al consultar obtienePermisosUsuario."));
            throw ex;
        }
        logger.warning("Finalizo obtienePermisosUsuario");
        return respuesta;

    }
    
}
