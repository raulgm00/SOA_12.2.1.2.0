package org.bcie.fenix.common.model.vo;

import oracle.adf.share.logging.ADFLogger;

import oracle.jbo.Row;
import oracle.jbo.server.ViewObjectImpl;

import org.bcie.fenix.common.model.vo.common.vtaEvaluacionesVO;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Tue Nov 03 11:29:37 CST 2020
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class vtaEvaluacionesVOImpl extends ViewObjectImpl implements vtaEvaluacionesVO {
    
    private static ADFLogger logger = null;
    
    /**
     * This is the default constructor (do not remove).
     */

    public vtaEvaluacionesVOImpl() {
        if (logger == null) {
            logger = ADFLogger.createADFLogger(this.getClass());
        }
    }
    /**
     * Returns the bind variable value for id_operacion.
     * @return bind variable value for id_operacion
     */
    public Long getid_operacion() {
        return (Long) getNamedWhereClauseParam("id_operacion");
    }

    /**
     * Sets <code>value</code> for bind variable id_operacion.
     * @param value value to bind as id_operacion
     */
    public void setid_operacion(Long value) {
        setNamedWhereClauseParam("id_operacion", value);
    }

    /**
     * Returns the bind variable value for codigo_tipo_evaluacion.
     * @return bind variable value for codigo_tipo_evaluacion
     */
    public Long getcodigo_tipo_evaluacion() {
        return (Long) getNamedWhereClauseParam("codigo_tipo_evaluacion");
    }

    /**
     * Sets <code>value</code> for bind variable codigo_tipo_evaluacion.
     * @param value value to bind as codigo_tipo_evaluacion
     */
    public void setcodigo_tipo_evaluacion(Long value) {
        setNamedWhereClauseParam("codigo_tipo_evaluacion", value);
    }
    
    //Procedimiento para validar si una operacion posee cuestionario base segun un tipo de evaluacion
    public String poseeCuestionarioBaseEvaluaciones(Long id_operacion, Long codigo_tipo_evaluacion)
    {   
        logger.log(ADFLogger.WARNING, "inicia metodo poseeCuestionarioBase");
        logger.log(ADFLogger.WARNING, "id_operacion: " + id_operacion);
        logger.log(ADFLogger.WARNING, "codigo_tipo_evaluacion: " + codigo_tipo_evaluacion);
        
        String valorRespuesta = "ERROR";
        Long tipoEvaluacion_CuestionarioBase = null;
        
        if(codigo_tipo_evaluacion.compareTo(2L) == 0 || codigo_tipo_evaluacion.compareTo(4L) == 0 || codigo_tipo_evaluacion.compareTo(5L) == 0)
        {
            //Ex ante es para Medio Término, Seguimiento de Ejecución y Seguimiento de operación
            tipoEvaluacion_CuestionarioBase = 1L;
        }
        else if(codigo_tipo_evaluacion.compareTo(3L) == 0)
        {
            //Medio Término para Ex Post
            tipoEvaluacion_CuestionarioBase = 2L;
        }
        else if(codigo_tipo_evaluacion.compareTo(1L) == 0)
        {
            //Ex ante no necesita cuestionario
            valorRespuesta = "OK";
        }
        logger.log(ADFLogger.WARNING, "tipoEvaluacion_CuestionarioBase: " + tipoEvaluacion_CuestionarioBase);
        
        //Si es Ex ante no se consultaran las evaluaciones
        if(valorRespuesta.equals("OK"))
        {
            logger.log(ADFLogger.WARNING, "valorRespuesta: " + valorRespuesta);
        }
        else
        {
            try{
                this.setid_operacion(id_operacion);
                this.setcodigo_tipo_evaluacion(tipoEvaluacion_CuestionarioBase);
                this.executeQuery();
                
                Long count = this.getEstimatedRowCount();  
                logger.log(ADFLogger.WARNING, "count: " + count);
                
                if(!(count.compareTo(0L) == 0)){
                    logger.log(ADFLogger.WARNING, "Si se encontraron registros");
                    Row row = this.getRowAtRangeIndex(0);
                    logger.log(ADFLogger.WARNING, "row: " + row.toString());
                    
                    Long cantidaEvaluaciones = (Long)row.getAttribute("Cantidad");
                    logger.log(ADFLogger.WARNING, "cantidaEvaluaciones: " + cantidaEvaluaciones);
                    if(cantidaEvaluaciones.compareTo(0L) == 0)
                    {
                        valorRespuesta = "No existe cuestionario base.";
                    }
                    else
                    {
                        valorRespuesta ="OK";
                    }  
                }
                else
                {
                    logger.log(ADFLogger.WARNING, "No se encontraron registros");
                    valorRespuesta = "No existe cuestionario base.";
                }  
                logger.log(ADFLogger.WARNING, "valorRespuesta: " + valorRespuesta);
            }
            catch(Exception exp)
            {
                logger.log(ADFLogger.WARNING, "Error poseeCuestionarioBase: " + exp);
            }     
        }
        logger.log(ADFLogger.WARNING, "Finalizo metodo poseeCuestionarioBase");
        return valorRespuesta;
    }
    
}

