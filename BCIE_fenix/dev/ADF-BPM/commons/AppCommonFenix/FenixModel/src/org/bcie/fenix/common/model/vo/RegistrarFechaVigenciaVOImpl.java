package org.bcie.fenix.common.model.vo;

import oracle.adf.share.logging.ADFLogger;

import oracle.jbo.Row;
import oracle.jbo.server.ViewObjectImpl;

import org.bcie.fenix.common.model.am.FenixAMImpl;
import org.bcie.fenix.common.model.vo.common.RegistrarFechaVigenciaVO;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Tue Dec 08 17:51:20 CST 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class RegistrarFechaVigenciaVOImpl extends ViewObjectImpl implements RegistrarFechaVigenciaVO {
    
    private static ADFLogger logger = null;
    
    /**
     * This is the default constructor (do not remove).
     */
    public RegistrarFechaVigenciaVOImpl() {
        
        if (logger == null) {
            logger = ADFLogger.createADFLogger(this.getClass());
        }
    }
    
    public void crearRowFechaVigencia(){
        logger.log(ADFLogger.TRACE, "Inside crearRowFechaVigencia.");
        
        this.clearCache(); // Limpiamos VO
        Row row = this.createRow();
        row.setAttribute("Id", Integer.valueOf(1));
        
        this.insertRowAtRangeIndex(0, row); // Insertamos row en VO
        this.setCurrentRow(row); // Asignamos nuevo row como current
    }
    
    public void asignarDatosFechaVigencia(Long idOperacion, String instanciaProceso) {
        logger.log(ADFLogger.WARNING, "Inside asignarDatosFechaVigencia.");
        FenixAMImpl fenixAM = null;
        ContratoVORowImpl contratoRow = null;
        
        // Filtramos tabla Contrato para obtener Fecha de Firma y Monto escriturado
        fenixAM = (FenixAMImpl)this.getRootApplicationModule();
        contratoRow = fenixAM.getContratoVO().getContratoByOperacionInstanciaProceso(idOperacion, instanciaProceso);
        
        // Asignamos datos
        if(contratoRow != null) {
            this.getRowAtRangeIndex(0).setAttribute("FechaFirma", contratoRow.getAttribute("FechaFirma"));
            this.getRowAtRangeIndex(0).setAttribute("FechaVigencia", contratoRow.getAttribute("FechaVigencia"));
            
            if(contratoRow.getMontoOperacionVO() != null) {
				logger.log(ADFLogger.WARNING, "Monto Escriturado: " + contratoRow.getMontoOperacionVO().getAttribute("Monto"));
                this.getRowAtRangeIndex(0).setAttribute("MontoEscriturado", 
                                                        contratoRow.getMontoOperacionVO().getAttribute("Monto"));
				if(contratoRow.getMontoOperacionVO().getAttribute("IdTcaTipoMoneda") != null) {    
                    Integer tipoMoneda = (Integer) contratoRow.getMontoOperacionVO().getAttribute("IdTcaTipoMoneda");
                    tipoMoneda = tipoMoneda - 1;
                    logger.log(ADFLogger.WARNING, "Id Tca Tipo Moneda: " + tipoMoneda);
                    this.getRowAtRangeIndex(0).setAttribute("IdTcaTipoMoneda", tipoMoneda);
                } else {
                    logger.log(ADFLogger.WARNING, "Id Tca Tipo Moneda: " + 0);
                    this.getRowAtRangeIndex(0).setAttribute("IdTcaTipoMoneda", 0);
                }
            }
        }
    }
}

