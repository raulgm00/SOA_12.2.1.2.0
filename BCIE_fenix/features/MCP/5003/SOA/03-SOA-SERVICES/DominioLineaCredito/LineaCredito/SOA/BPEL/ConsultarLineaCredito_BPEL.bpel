<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Thu Aug 04 13:59:06 CDT 2016
  Author:  dalia-reyes
  Purpose: Synchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="ConsultarLineaCredito_BPEL"
         targetNamespace="http://xmlns.oracle.com/DominioLineaCredito/LineaCredito/ConsultarLineaCredito_BPEL"
         xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:client="http://xmlns.oracle.com/DominioLineaCredito/LineaCredito/ConsultarLineaCredito_BPEL"
         xmlns:ora="http://schemas.oracle.com/xpath/extension" xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:ns1="ConsultarLineaCredito" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ui="http://xmlns.oracle.com/soa/designer" xmlns:ns2="http://www.bcie.org/LineaCreditoService"
         xmlns:ns3="http://www.bice.org/ActualizarLineaCreditoService" xmlns:ns6="http://www.bcie.org/CondicionBO"
         xmlns:ns10="http://www.bcie.org/TerminoBO" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:ns13="http://www.bcie.org/ResultBO" xmlns:ns12="http://www.bcie.org/CommonBO"
         xmlns:ns9="http://www.bcie.org/DocumentoBO" xmlns:ns11="http://www.bcie.org/ComisionBO"
         xmlns:ns7="http://www.bcie.org/CatalogoBO" xmlns:ns5="http://www.bcie.org/LineaCreditoBO"
         xmlns:ns8="http://www.bcie.org/AtributoBO" xmlns:ns14="http://www.bcie.org/ErrorBO"
         xmlns:ns4="http://www.bcie.org/LineaCreditoMO" xmlns:ns15="http://www.bcie.org/TerminoService"
         xmlns:ns16="http://www.bcie.org/TerminoMO" xmlns:ns17="http://xmlns.bcie.com/ComisionService"
         xmlns:ns18="http://www.bcie.org/ComisionMO" xmlns:ns19="http://www.bcie.org/CondicionService"
         xmlns:ns20="http://www.bcie.org/CondicionMO"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions"
         xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue"
         xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ess="http://xmlns.oracle.com/scheduler"
         xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap" xmlns:ns21="http://www.bcie.org/ObtenerURL"
         xmlns:ns22="http://www.bcie.org/ObtenerURLMO" xmlns:ns23="http://www.bcie.org/CorreoBO"
         xmlns:ns24="http://www.bcie.org/ObtenerDisponibilidadARE" xmlns:ns25="http://www.bcie.org/ConsultarFLEXCUBE"
         xmlns:ns26="http://www.bcie.org/ConsultarImporteTransitoSAD" xmlns:ns27="http://www.bcie.org/DesembolsoBO"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns28="http://www.bcie.org/ConsultarCommitmentSAD"
         xmlns:ns29="http://www.bcie.org/ConsultarProgramacionPYD" xmlns:ns30="http://www.bcie.org/ProductoBO"
         xmlns:ns31="http://www.bcie.org/HerramientaCEBO" xmlns:ns32="http://www.bcie.org/MatrizTCCBO"
         xmlns:ns33="http://www.bcie.org/ConsultarHerramientaCE" xmlns:ns34="http://www.bcie.org/HerramientaCEMO"
         xmlns:ns35="http://www.bcie.org/OperacionBO" xmlns:ns36="http://www.bcie.org/ReglaBO">
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      PARTNERLINKS                                                      
      List of services participating in this BPEL process               
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <import namespace="ConsultarLineaCredito"
          location="oramds:/apps/Resources/ComponentesComunes/DominioLineaCredito/LineaCredito/V1/Wsdl/BPEL/ConsultarLineaCreditoSOR.wsdl"
          importType="http://schemas.xmlsoap.org/wsdl/"/>
  <import namespace="ConsultarLineaCredito" location="../WSDLs/ConsultarLineaCreditoSORWrapper.wsdl"
          importType="http://schemas.xmlsoap.org/wsdl/" ui:processWSDL="true"/>
  <partnerLinks>
    <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
    <partnerLink name="consultarlineacredito_bpel_client" partnerLinkType="ns1:ConsultarLineaCredito_BPEL"
                 myRole="ConsultarLineaCreditoPT"/>
    <partnerLink name="ConsultarLineaCredito" partnerLinkType="ns3:ConsultarLineaCredito"
                 partnerRole="ConsultarFuenteLCPT"/>
    <partnerLink name="ConsultarTerminoByIdLineaCredito" partnerLinkType="ns15:ConsultarTerminoByIdLineaCredito"
                 partnerRole="ConsultarTerminoByLineaCreditoPT"/>
    <partnerLink name="ConsultarComisionByIdLineaCredito" partnerLinkType="ns17:ConsultarComisionByIdLineaCredito"
                 partnerRole="ConsultarComisionByIdLineaCreditoPT"/>
    <partnerLink name="ObtenerURL" partnerLinkType="ns21:ObtenerURL" partnerRole="ObtenerURLPT"/>
    <partnerLink name="ConsultarCondicionByIdlineaCredito" partnerLinkType="ns19:ConsultarCondicionByIdlineaCredito"
                 partnerRole="ConsultarCondicionByIdLineaCreditoPT"/>
    <partnerLink name="ConsultarImporteTransito" partnerLinkType="ns26:ConsultarImporteTransito"
                 partnerRole="ConsultarImporteTransito_PT"/>
    <partnerLink name="ConsultarFLEXCUBE" partnerLinkType="ns25:ConsultarFLEXCUBE" partnerRole="ConsultarFLEXCUBE_PT"/>
    <partnerLink name="ConsultarHerramientaCE_SB" partnerLinkType="ns33:ConsultarHerramientaCE_SB"
                 partnerRole="ConsultarHerramientaCE_PT"/>
  </partnerLinks>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <variables>
    <!-- Reference to the message passed as input during initiation -->
    <variable name="inputVariable" messageType="ns1:ConsultarLineaCreditoRequestMessage"/>
    <!-- Reference to the message that will be returned to the requester-->
    <variable name="outputVariable" messageType="ns1:ConsultarLineaCreditoResponseMessage"/>
    <variable name="LineaCredito" messageType="ns1:ConsultarLineaCreditoResponseMessage"/>
    <variable name="InvokeConsultaImporteTransitoIn" messageType="ns26:requestConsultarImporteTransitoMessage"/>
    <variable name="InvokeConsultaImporteTransitoOut" messageType="ns26:responseConsultarImporteTransitoMessage"/>
    <variable name="MontoImporteTransito" type="xsd:double"/>
    <variable name="setTitleInstance" type="xsd:string"/>
    <variable name="InvokeConsultarFLEXCUBE_In" messageType="ns25:requestConsultarFLEXCUBEMessage"/>
    <variable name="InvokeConsultarFLEXCUBE_Out" messageType="ns25:responseConsultarFLEXCUBEMessage"/>
    <variable name="outConsultarHerramientaCE" messageType="ns33:responseConsultarHerramientaCEMessage"/>
    <variable name="InvokeConsultarFLEXCUBE_In_Recall" messageType="ns25:requestConsultarFLEXCUBEMessage"/>
    <variable name="InvokeConsultarFLEXCUBE_Out_Recall" messageType="ns25:responseConsultarFLEXCUBEMessage"/>
  </variables>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <sequence name="main">
    <!-- Receive input from requestor. (Note: This maps to operation defined in ConsultarLineaCredito_BPEL.wsdl) -->
    <receive name="receiveInput" partnerLink="consultarlineacredito_bpel_client" portType="ns1:ConsultarLineaCreditoPT"
             operation="consultarLineaCredito" variable="inputVariable" createInstance="yes"/>
    <assign name="setTitleInstance">
      <copy>
        <from>oraext:setFlowInstanceTitle(concat("Linea:",string($inputVariable.ConsultarLineaCreditoRequest/ns4:idLineaCredito)))</from>
        <to>$setTitleInstance</to>
      </copy>
    </assign>
    <scope name="ScopeConsultarLineaCredito_Fuente">
      <variables>
        <variable name="inInvoke_ConsultarLineaCredito" messageType="ns3:ConsultarFuenteLineaCreditoRequestMessage"/>
        <variable name="outInvoke_ConsultarLineaCredito" messageType="ns3:ConsultarFuenteLineaCreditoResponseMessage"/>
      </variables>
      <sequence name="SequenceConsultarLineaCredito_Fuente">
        <assign name="Assign_ConsultarLCFuente">
          <copy ignoreMissingFromData="yes">
            <from>$inputVariable.ConsultarLineaCreditoRequest/ns4:idLineaCredito</from>
            <to>$inInvoke_ConsultarLineaCredito.request/ns4:idLineaCredito</to>
          </copy>
          <copy ignoreMissingFromData="yes">
            <from>$inputVariable.ConsultarLineaCreditoRequest/ns4:numeroLinea</from>
            <to>$inInvoke_ConsultarLineaCredito.request/ns4:numero_linea</to>
          </copy>
        </assign>
        <invoke name="Invoke_ConsultarLineaCredito" bpelx:invokeAsDetail="no" partnerLink="ConsultarLineaCredito"
                portType="ns3:ConsultarFuenteLCPT" operation="consultarFuenteLineaCredito"
                inputVariable="inInvoke_ConsultarLineaCredito" outputVariable="outInvoke_ConsultarLineaCredito"/>
        <if name="IfResultadoConsultarLC">
          <documentation>
            <![CDATA[Con_Registros]]>
          </documentation>
          <condition>string($outInvoke_ConsultarLineaCredito.response/ns4:lineaCredito[1]/ns5:idLineaCredito)!=''</condition>
          <sequence name="SequenceIfResultadoLC">
            <assign name="Assign_LCFuente">
              <copy>
                <from>$outInvoke_ConsultarLineaCredito.response/ns4:lineaCredito</from>
                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito</to>
              </copy>
            </assign>
            <scope name="ScopeConsultarTermino">
              <variables>
                <variable name="inInvoke_ConsultarTermino"
                          messageType="ns15:ConsultarTerminoByLineaCreditoRequestMessage"/>
                <variable name="outInvoke_ConsultarTermino"
                          messageType="ns15:ConsultarTerminoLineaCreditoResponseMessage"/>
              </variables>
              <sequence name="SequenceConsultarTermino">
                <assign name="Assign_ConsultarTermino">
                  <copy>
                    <from>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito[1]/ns5:idLineaCredito</from>
                    <to>$inInvoke_ConsultarTermino.request/ns16:idLineaCredito</to>
                  </copy>
                </assign>
                <invoke name="Invoke_ConsultarTermino" bpelx:invokeAsDetail="no"
                        partnerLink="ConsultarTerminoByIdLineaCredito" portType="ns15:ConsultarTerminoByLineaCreditoPT"
                        operation="consultarTerminoByLineaCredito" inputVariable="inInvoke_ConsultarTermino"
                        outputVariable="outInvoke_ConsultarTermino"/>
                <assign name="XQTransform_Terminos">
                  <bpelx:annotation>
                    <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from>ora:processXQuery10('../Transformations/ConsultarTermino_TO_ConsultarLineaCredito.xqy', 'outputVariable.ConsultarLineaCreditoResponse', $outputVariable.ConsultarLineaCreditoResponse, 'outInvoke_ConsultarTermino.response', $outInvoke_ConsultarTermino.response)</from>
                    <to variable="outputVariable" part="ConsultarLineaCreditoResponse"/>
                  </copy>
                </assign>
              </sequence>
            </scope>
            <scope name="ScopeConsultarComision">
              <variables>
                <variable name="inInvoke_ConsultarComision"
                          messageType="ns17:requestConsultarComisionByIdLineaCreditoMessage"/>
                <variable name="outInvoke_ConsultarComision"
                          messageType="ns17:responseConsultarComisionByIdLineaCreditoMessage"/>
              </variables>
              <sequence name="SequenceConsultarComision">
                <assign name="Assign_ConsultarComision">
                  <copy>
                    <from>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito[1]/ns5:idLineaCredito</from>
                    <to>$inInvoke_ConsultarComision.request/ns18:idLineaCredito</to>
                  </copy>
                </assign>
                <invoke name="Invoke_ConsultarComision" bpelx:invokeAsDetail="no"
                        partnerLink="ConsultarComisionByIdLineaCredito"
                        portType="ns17:ConsultarComisionByIdLineaCreditoPT"
                        operation="ConsultarComisionByIdLineaCredito" inputVariable="inInvoke_ConsultarComision"
                        outputVariable="outInvoke_ConsultarComision"/>
                <assign name="XQTransform_Comisiones">
                  <bpelx:annotation>
                    <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from>ora:processXQuery10('../Transformations/ConsultarComision_TO_ConsultarLineaCredito.xqy', 'outputVariable.ConsultarLineaCreditoResponse', $outputVariable.ConsultarLineaCreditoResponse, 'outInvoke_ConsultarComision.response', $outInvoke_ConsultarComision.response)</from>
                    <to variable="outputVariable" part="ConsultarLineaCreditoResponse"/>
                  </copy>
                </assign>
              </sequence>
            </scope>
            <scope name="ScopeConsultarCondicion">
              <variables>
                <variable name="inInvoke_ConsultarCondicionByLineaCredito"
                          messageType="ns19:ConsultarCondicionByIdLineaCreditoRequestMessage"/>
                <variable name="outInvoke_ConsultarCondicionByLineaCredito"
                          messageType="ns19:ConsultarCondicionByIdLineaCreditoResponseMessage"/>
              </variables>
              <sequence name="SequenceConsultarCondicion">
                <assign name="Assign_ConsultarCondicionByOperacion">
                  <copy>
                    <from>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito[1]/ns5:idLineaCredito</from>
                    <to>$inInvoke_ConsultarCondicionByLineaCredito.ConsultarCondicionByIdLineaCreditoRequest/ns20:idLineaCredito</to>
                  </copy>
                </assign>
                <invoke name="Invoke_ConsultarCondicionByLineaCredito" bpelx:invokeAsDetail="no"
                        partnerLink="ConsultarCondicionByIdlineaCredito"
                        portType="ns19:ConsultarCondicionByIdLineaCreditoPT"
                        operation="consultarCondicionByIdLineaCredito"
                        inputVariable="inInvoke_ConsultarCondicionByLineaCredito"
                        outputVariable="outInvoke_ConsultarCondicionByLineaCredito"/>
                <assign name="XQTransform_Condiciones">
                  <bpelx:annotation>
                    <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from>ora:processXQuery10('../Transformations/ConsultarCondicion_TO_ConsultarLineaCredito.xqy', 'outputVariable.ConsultarLineaCreditoResponse', $outputVariable.ConsultarLineaCreditoResponse, 'outInvoke_ConsultarCondicionByLineaCredito.ConsultarCondicionByIdLineaCreditoResponse', $outInvoke_ConsultarCondicionByLineaCredito.ConsultarCondicionByIdLineaCreditoResponse)</from>
                    <to variable="outputVariable" part="ConsultarLineaCreditoResponse"/>
                  </copy>
                </assign>
              </sequence>
            </scope>
            <scope name="ScopeConsultarMontoDisponible">
              <sequence name="SequenceConsultarMontoDisponible">
                <if name="IfValidaIdFlex">
                  <documentation>
                    <![CDATA[No tiene IdFlex]]>
                  </documentation>
                  <condition>string-length($outInvoke_ConsultarLineaCredito.response/ns4:lineaCredito/ns5:Flexcube/ns5:id) = 0 or ($outInvoke_ConsultarLineaCredito.response/ns4:lineaCredito/ns5:EstadoMonto = 'true')</condition>
                  <empty name="Empty"/>
                  <else>
                    <documentation>
                      <![CDATA[OK]]>
                    </documentation>
                    <sequence name="SequenceValidaFlex">
                      <scope name="Scope1">
                        <sequence name="Sequence7">
                          <sequence>
                            <assign name="assingConsultaLfex">
                              <copy>
                                <from>$outInvoke_ConsultarLineaCredito.response/ns4:lineaCredito/ns5:Flexcube/ns5:id</from>
                                <to>$InvokeConsultarFLEXCUBE_In.request/ns4:codigoContrato</to>
                              </copy>
                              <copy>
                                <from>'LINEA'</from>
                                <to>$InvokeConsultarFLEXCUBE_In.request/ns4:nivelDetalle</to>
                              </copy>
                            </assign>
                            <invoke name="InvokeConsultarFlexcube" bpelx:invokeAsDetail="no"
                                    partnerLink="ConsultarFLEXCUBE" portType="ns25:ConsultarFLEXCUBE_PT"
                                    operation="ConsultarFLEXCUBE" inputVariable="InvokeConsultarFLEXCUBE_In"
                                    outputVariable="InvokeConsultarFLEXCUBE_Out"/>
                          </sequence>
                          <if name="IfError">
                            <documentation>
                              <![CDATA[Error]]>
                            </documentation>
                            <condition>$InvokeConsultarFLEXCUBE_Out.response/ns4:Resultado/ns13:result="ERROR"</condition>
                            <sequence>
                              <assign name="assingConsultaLfex_Recall">
                                <copy>
                                  <from>$InvokeConsultarFLEXCUBE_In.request</from>
                                  <to>$InvokeConsultarFLEXCUBE_In_Recall.request</to>
                                </copy>
                              </assign>
                              <invoke name="InvokeConsultarFlexcube_Recall" bpelx:invokeAsDetail="no"
                                      partnerLink="ConsultarFLEXCUBE" portType="ns25:ConsultarFLEXCUBE_PT"
                                      operation="ConsultarFLEXCUBE" inputVariable="InvokeConsultarFLEXCUBE_In_Recall"
                                      outputVariable="InvokeConsultarFLEXCUBE_Out_Recall"/>
                              <assign name="assingConsultaLfex_Response">
                                <copy>
                                  <from variable="InvokeConsultarFLEXCUBE_Out_Recall"/>
                                  <to variable="InvokeConsultarFLEXCUBE_Out"/>
                                </copy>
                              </assign>
                            </sequence>
                            <else>
                              <documentation>
                                <![CDATA[OK]]>
                              </documentation>
                              <empty name="Empty1"/>
                            </else>
                          </if>
                        </sequence>
                      </scope>
                      <if name="IfOK">
                        <documentation>
                          <![CDATA[OK]]>
                        </documentation>
                        <condition>$InvokeConsultarFLEXCUBE_Out.response/ns4:Resultado/ns13:result = 'OK'</condition>
                        <sequence name="SequenceConsultaFlexcube">
                          <sequence name="SequenceInvokeConsultarMontoDisponible">
                            <if name="IfValidaMonto">
                              <documentation>
                                <![CDATA[OK]]>
                              </documentation>
                              <condition>string-length($InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Monto/ns12:importe) = 0 </condition>
                              <sequence name="Sequence1">
                                <assign name="AssignConsultaMontoDisponible">
                                  <copy bpelx:insertMissingToData="yes">
                                    <from>'DISPONIBLE'</from>
                                    <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto/ns12:tipo/ns7:DescripcionCorta</to>
                                  </copy>
                                  <copy bpelx:insertMissingToData="yes">
                                    <from>''</from>
                                    <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto/ns12:importe</to>
                                  </copy>
                                </assign>
                              </sequence>
                              <else>
                                <sequence>
                                  <assign name="AssignOutConsultaMontoDisponible">
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:idLineaCredito</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:NumeroLineaCredito</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:MontoLinea</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:MontoLinea</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Flexcube/ns5:id</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Flexcube/ns5:id</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Monto/ns12:tipo/ns7:DescripcionCorta</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto/ns12:tipo/ns7:DescripcionCorta</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Monto/ns12:importe</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto/ns12:importe</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Monto/ns12:moneda/ns7:codigoExterno</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto/ns12:moneda/ns7:codigoExterno</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>'APROBADO'</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[5]/ns12:tipo/ns7:DescripcionCorta</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:MontoLinea</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[5]/ns12:importe</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Monto/ns12:moneda/ns7:codigoExterno</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[5]/ns12:moneda/ns7:codigoExterno</to>
                                    </copy>
                                  </assign>
                                </sequence>
                              </else>
                            </if>
                            <scope name="ScopeConsultaImporteTransito">
                              <sequence name="SequenceConsultarImporteTransito">
                                <assign name="AssignConsultaImporteTransitoIn">
                                  <copy>
                                    <from>$inputVariable.ConsultarLineaCreditoRequest/ns4:idLineaCredito</from>
                                    <to>$InvokeConsultaImporteTransitoIn.request/ns4:LineaCredito/ns5:idLineaCredito</to>
                                  </copy>
                                </assign>
                                <invoke name="InvokeConsultaImporteTransito" bpelx:invokeAsDetail="no"
                                        partnerLink="ConsultarImporteTransito"
                                        portType="ns26:ConsultarImporteTransito_PT" operation="ConsultarImporteTransito"
                                        inputVariable="InvokeConsultaImporteTransitoIn"
                                        outputVariable="InvokeConsultaImporteTransitoOut"/>
                                <if name="IfValidaMontoTransito">
                                  <documentation>
                                    <![CDATA[NULL]]>
                                  </documentation>
                                  <condition>string-length($InvokeConsultaImporteTransitoOut.response/ns4:LineaCredito/ns5:Monto/ns12:importe) = 0</condition>
                                  <assign name="AssignConsultaImporteTransito">
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>0</from>
                                      <to>$MontoImporteTransito</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>$InvokeConsultaImporteTransitoOut.response/ns4:LineaCredito/ns5:Monto/ns12:tipo/ns7:DescripcionCorta</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[2]/ns12:tipo/ns7:DescripcionCorta</to>
                                    </copy>
                                    <copy bpelx:insertMissingToData="yes">
                                      <from>0</from>
                                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[2]/ns12:importe</to>
                                    </copy>
                                  </assign>
                                  <else>
                                    <documentation>
                                      <![CDATA[OK]]>
                                    </documentation>
                                    <sequence>
                                      <assign name="AssignConsultaImporteTransito">
                                        <copy bpelx:insertMissingToData="yes">
                                          <from>$InvokeConsultaImporteTransitoOut.response/ns4:LineaCredito/ns5:Monto/ns12:tipo/ns7:DescripcionCorta</from>
                                          <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[2]/ns12:tipo/ns7:DescripcionCorta</to>
                                        </copy>
                                        <copy bpelx:insertMissingToData="yes">
                                          <from>$InvokeConsultaImporteTransitoOut.response/ns4:LineaCredito/ns5:Monto/ns12:importe</from>
                                          <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[2]/ns12:importe</to>
                                        </copy>
                                        <copy bpelx:insertMissingToData="yes">
                                          <from>$InvokeConsultaImporteTransitoOut.response/ns4:LineaCredito/ns5:Monto/ns12:importe</from>
                                          <to>$MontoImporteTransito</to>
                                        </copy>
                                      </assign>
                                    </sequence>
                                  </else>
                                </if>
                              </sequence>
                            </scope>
                            <if name="IfValidarSuma">
                              <documentation>
                                <![CDATA[OK]]>
                              </documentation>
                              <condition>string-length($InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Monto/ns12:importe)=0</condition>
                              <empty name="Empty"/>
                              <else>
                                <assign name="AssignMontoDisponibleDesembolso">
                                  <copy bpelx:insertMissingToData="yes">
                                    <from>'DISPONIBLE_DESEMBOLSO'</from>
                                    <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[3]/ns12:tipo/ns7:DescripcionCorta</to>
                                  </copy>
                                  <copy bpelx:insertMissingToData="yes">
                                    <from>($InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:Monto/ns12:importe)  - ($MontoImporteTransito)</from>
                                    <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:Monto[3]/ns12:importe</to>
                                  </copy>
                                </assign>
                              </else>
                            </if>
                          </sequence>
                          <scope name="ConsultarHerramientaCE"
                                 xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
                            <variables>
                              <variable name="inConsultarHerramientaCE"
                                        messageType="ns33:requestConsultarHerramientaCEMessage"/>
                            </variables>
                            <sequence name="Sequence3">
                              <assign name="requestConsultarHerramientaCE">
                                <copy ignoreMissingFromData="yes">
                                  <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:HerramientaCE/ns31:ActividadEconomica/ns7:codigoExterno</from>
                                  <to>$inConsultarHerramientaCE.request/ns34:HerramientaCE/ns31:ActividadEconomica/ns7:codigoExterno</to>
                                </copy>
                                <copy ignoreMissingFromData="yes">
                                  <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:HerramientaCE/ns31:EjeEstrategico/ns7:codigoExterno</from>
                                  <to>$inConsultarHerramientaCE.request/ns34:HerramientaCE/ns31:EjeEstrategico/ns7:codigoExterno</to>
                                </copy>
                                <copy ignoreMissingFromData="yes">
                                  <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:HerramientaCE/ns31:AreaFocalizacion/ns7:codigoExterno</from>
                                  <to>$inConsultarHerramientaCE.request/ns34:HerramientaCE/ns31:AreaFocalizacion/ns7:codigoExterno</to>
                                </copy>
                              </assign>
                              <invoke name="InvokeConsultarHerramientaCE_SB" bpelx:invokeAsDetail="no"
                                      partnerLink="ConsultarHerramientaCE_SB" portType="ns33:ConsultarHerramientaCE_PT"
                                      operation="consultarHerramientaCE" inputVariable="inConsultarHerramientaCE"
                                      outputVariable="outConsultarHerramientaCE"
                                      xmlns:bpelx="http://schemas.oracle.com/bpel/extension"/>
                              <if name="IfValidaOK">
                                <documentation>
                                  <![CDATA[OK]]>
                                </documentation>
                                <condition>$outConsultarHerramientaCE.response/ns34:Resultado/ns13:result = 'OK'</condition>
                                <sequence name="Sequence4">
                                  <assign name="addHerramientaCE">
                                    <bpelx:annotation>
                                      <bpelx:pattern patternName="bpelx:transformation"></bpelx:pattern>
                                    </bpelx:annotation>
                                    <copy>
                                      <from>ora:doXSLTransformForDoc("../Transformations/AddHerramientaCE.xsl", $outputVariable.ConsultarLineaCreditoResponse, "outConsultarHerramientaCE.response", $outConsultarHerramientaCE.response)</from>
                                      <to variable="outputVariable" part="ConsultarLineaCreditoResponse"/>
                                    </copy>
                                  </assign>
                                </sequence>
                                <else>
                                  <documentation>
                                    <![CDATA[ERROR]]>
                                  </documentation>
                                  <empty name="Empty"/>
                                </else>
                              </if>
                            </sequence>
                          </scope>
                          <sequence name="SequenceAsignaFlexcube">
                            <assign name="AssignOutConsultaFLEXCUBE">
                              <copy bpelx:insertMissingToData="yes">
                                <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:tasaMinima</from>
                                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:tasaMinima</to>
                              </copy>
                              <copy bpelx:insertMissingToData="yes">
                                <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:tasaMaxima</from>
                                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:tasaMaxima</to>
                              </copy>
                              <copy bpelx:insertMissingToData="yes">
                                <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:FechaVencimiento</from>
                                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:FechaVencimiento</to>
                              </copy>
                              <copy bpelx:insertMissingToData="yes">
                                <from>$InvokeConsultarFLEXCUBE_Out.response/ns4:TipoContrato/ns5:LineaCredito/ns5:FechaMaximaDesembolso</from>
                                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:FechaMaximaDesembolso</to>
                              </copy>
                            </assign>
                          </sequence>
                        </sequence>
                        <else>
                          <documentation>
                            <![CDATA[ERROR]]>
                          </documentation>
                          <empty name="Empty"/>
                        </else>
                      </if>
                    </sequence>
                  </else>
                </if>
              </sequence>
            </scope>
            <scope name="Scope_ObtenerURL">
              <variables>
                <variable name="inInvoke_ObtenerURL" messageType="ns21:ObtenerURLRequestMessage"/>
                <variable name="outInvoke_ObtenerURL" messageType="ns21:ObtenerURLResponseMessage"/>
              </variables>
              <sequence name="SequenceObtenerURL">
                <assign name="Assign_ObtenerURL">
                  <copy>
                    <from>'REPORTE_ADEUDOS'</from>
                    <to>$inInvoke_ObtenerURL.ObtenerURLRequest/ns22:URL</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from>'Linea'</from>
                    <to>$inInvoke_ObtenerURL.ObtenerURLRequest/ns22:Tags/ns23:tag</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:NumeroLineaCredito</from>
                    <to>$inInvoke_ObtenerURL.ObtenerURLRequest/ns22:Tags/ns23:valor</to>
                  </copy>
                </assign>
                <invoke name="Invoke_ObtenerURL" bpelx:invokeAsDetail="no" partnerLink="ObtenerURL"
                        portType="ns21:ObtenerURLPT" operation="obtenerURL" inputVariable="inInvoke_ObtenerURL"
                        outputVariable="outInvoke_ObtenerURL"/>
                <if name="IfResultadoObtenerURL">
                  <documentation>
                    <![CDATA[OK]]>
                  </documentation>
                  <condition>$outInvoke_ObtenerURL.ObtenerURLResponse/ns22:Resultado/ns13:result = 'OK'</condition>
                  <assign name="Assign_URL">
                    <copy bpelx:insertMissingToData="yes">
                      <from>'REPORTE_ADEUDOS'</from>
                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:atributos[1]/ns12:name</to>
                    </copy>
                    <copy bpelx:insertMissingToData="yes">
                      <from>$outInvoke_ObtenerURL.ObtenerURLResponse/ns22:URL</from>
                      <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:LineaCredito/ns5:atributos[1]/ns12:value</to>
                    </copy>
                  </assign>
                  <else>
                    <documentation>
                      <![CDATA[ERROR]]>
                    </documentation>
                    <empty name="Empty_Error"/>
                  </else>
                </if>
              </sequence>
            </scope>
          </sequence>
          <else>
            <documentation>
              <![CDATA[Sin_Registros]]>
            </documentation>
            <assign name="Assign_ErrorConsultarLC">
              <copy>
                <from>'Error'</from>
                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:Resultado/ns13:result</to>
              </copy>
              <copy>
                <from>'-1'</from>
                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:Resultado/ns13:error/ns14:errorCode</to>
              </copy>
              <copy>
                <from>'No se encontraron registros de la línea de crédito'</from>
                <to>$outputVariable.ConsultarLineaCreditoResponse/ns4:Resultado/ns13:error/ns14:errorDescription</to>
              </copy>
            </assign>
          </else>
        </if>
      </sequence>
    </scope>
    <assign name="TransformationFinal">
      <bpelx:annotation>
        <bpelx:pattern patternName="bpelx:transformation"></bpelx:pattern>
      </bpelx:annotation>
      <copy>
        <from>ora:doXSLTransformForDoc("../Transformations/Transformatio.xsl", $outputVariable.ConsultarLineaCreditoResponse)</from>
        <to variable="outputVariable" part="ConsultarLineaCreditoResponse"/>
      </copy>
    </assign>
    <!-- Generate reply to synchronous request -->
    <reply name="replyOutput" partnerLink="consultarlineacredito_bpel_client" portType="ns1:ConsultarLineaCreditoPT"
           operation="consultarLineaCredito" variable="outputVariable"/>
  </sequence>
</process>