package org.bcie.fenix.common.model.vo;

import java.security.Timestamp;

import oracle.adf.share.logging.ADFLogger;

import oracle.jbo.Row;
import oracle.jbo.RowSetIterator;
import oracle.jbo.server.ViewObjectImpl;

import org.bcie.fenix.common.model.vo.common.TrazabilidadOperacionVO;

// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Fri Oct 23 18:34:27 CDT 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class TrazabilidadOperacionVOImpl extends ViewObjectImpl implements TrazabilidadOperacionVO {
    /**
     * This is the default constructor (do not remove).
     */
    
    private static ADFLogger logger = null;
    
    public TrazabilidadOperacionVOImpl() {
        if (logger == null) {
            logger = ADFLogger.createADFLogger(this.getClass());
        }
    }

    /**
     * Returns the bind variable value for operacionId.
     * @return bind variable value for operacionId
     */
    public Long getoperacionId() {
        return (Long) getNamedWhereClauseParam("operacionId");
    }

    /**
     * Sets <code>value</code> for bind variable operacionId.
     * @param value value to bind as operacionId
     */
    public void setoperacionId(Long value) {
        setNamedWhereClauseParam("operacionId", value);
        this.executeQuery();
    }
    
    public Boolean validarProcesoOperacion(){
        Boolean retorno = Boolean.FALSE;
        
        RowSetIterator iter = createRowSetIterator(null);
        
        if(iter != null){
            iter.reset();
            while(iter.hasNext()){
                Row rowTrazabilidad = iter.next();
                Integer idProceso = Integer.valueOf(rowTrazabilidad.getAttribute(TrazabilidadOperacionVORowImpl.IDPROCESO).toString());
                if(idProceso != null && idProceso == 5){//idProceso de Formalizacion
                    retorno = Boolean.TRUE;
                }
            }
            iter.closeRowSetIterator();
        }
        return retorno;
    }
    
    public Integer validarProcesoOperacionTerminado(Integer idProceso){
        Integer retorno = 0;
        logger.warning("Valor idProceso: " + idProceso);
        
        RowSetIterator iter = createRowSetIterator(null);
        
        if(iter != null){
            iter.reset();
            while(iter.hasNext()){
                Row rowTrazabilidad = iter.next();
                Integer idProcesoTrazabilidad = Integer.valueOf(rowTrazabilidad.getAttribute(TrazabilidadOperacionVORowImpl.IDPROCESO).toString());
                
                if(idProceso != null && idProceso == idProcesoTrazabilidad){//idProceso
                    
                    String fechaFin = null;
                    if(null != rowTrazabilidad.getAttribute(TrazabilidadOperacionVORowImpl.FECHAFIN)){
                        
                        fechaFin = rowTrazabilidad.getAttribute(TrazabilidadOperacionVORowImpl.FECHAFIN).toString();
                        logger.warning("Fecha fin asignada a variable :" + fechaFin);
                    }else{
                        logger.warning("No se recupero fecha fin.");
                        fechaFin = null;
                    }
                    
                    if(fechaFin != null)
                        retorno = 1;
                    else
                        retorno = 2;
                    break;
                }
            }
            iter.closeRowSetIterator();
        }
        logger.warning("El valor de retorno es :" + retorno);
        return retorno;
    }
}

