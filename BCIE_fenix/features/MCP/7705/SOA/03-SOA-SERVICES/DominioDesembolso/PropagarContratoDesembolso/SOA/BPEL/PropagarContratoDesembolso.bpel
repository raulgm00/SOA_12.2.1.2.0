<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Wed Nov 23 19:06:48 CST 2016
  Author:  perla-osorio
  Purpose: Synchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="PropagarContratoDesembolso"
               targetNamespace="http://xmlns.oracle.com/DominioDesembolso/PropagarContratoDesembolso/PropagarContratoDesembolso"
               xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
               xmlns:client="http://xmlns.oracle.com/DominioDesembolso/PropagarContratoDesembolso/PropagarContratoDesembolso"
               xmlns:ora="http://schemas.oracle.com/xpath/extension"
               xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
               xmlns:ns1="http://www.bcie.org/PropagarContratoDesembolsoSOR"
               xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ui="http://xmlns.oracle.com/soa/designer" xmlns:ns2="http://www.bcie.org/ConsultarInformacionReglaById"
         xmlns:ns3="http://xmlns.bcie.com/LineaCreditoService"
         xmlns:ns4="http://www.bcie.org/CrearDesembolsoLoanFLEXCUBESAD" xmlns:ns5="http://www.bcie.org/DesembolsoMO"
         xmlns:ns20="http://www.bcie.org/TerminoBO" xmlns:ns16="http://www.bcie.org/ReglaBO"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns14="http://www.bcie.org/OperacionBO"
         xmlns:ns24="http://www.bcie.org/ResultBO" xmlns:ns8="http://www.bcie.org/CommonBO"
         xmlns:ns21="http://www.bcie.org/MatrizTCCBO" xmlns:ns7="http://www.bcie.org/LineaCreditoBO"
         xmlns:ns11="http://www.bcie.org/CondicionBO" xmlns:ns17="http://www.bcie.org/ProductoBO"
         xmlns:ns22="http://www.bcie.org/DeclaracionJuradaBO" xmlns:ns13="http://www.bcie.org/DocumentoBO"
         xmlns:ns18="http://www.bcie.org/HerramientaCEBO" xmlns:ns19="http://www.bcie.org/ComisionBO"
         xmlns:ns9="http://www.bcie.org/CatalogoBO" xmlns:ns15="http://www.bcie.org/DesembolsoBO"
         xmlns:ns23="http://www.bcie.org/ContratoBO" xmlns:ns10="http://www.bcie.org/ClienteBO"
         xmlns:ns12="http://www.bcie.org/AtributoBO" xmlns:ns25="http://www.bcie.org/ErrorBO"
         xmlns:ns6="http://www.bcie.org/LineaCreditoMO" xmlns:ns26="http://www.bcie.org/ConsultarDesembolsosByIdSAD"
         xmlns:ns27="http://www.bcie.org/CrearActualizarDesembolsoSAD"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions"
         xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue"
         xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:ess="http://xmlns.oracle.com/scheduler"
         xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         xmlns:ns28="http//www.bcie.org/CrearDesembolsoComplejoFLEXCUBE" xmlns:ns29="http://www.bcie.org/Desembolso"
         xmlns:ns30="http://www.bcie.org/CrearActualizarCondicionesFinancierasSAD"
         xmlns:ns31="http://www.bcie.org/CalcularCuotasSAD"
         xmlns:ns32="http://www.bcie.org/ConsultarDesembolsosByIdV2SAD"
         xmlns:ns33="http://xmlns.bcie.com/Flexcube14/PrestamoService" xmlns:ns34="http://www.bcie.org/DesembolsoBOV2"
         xmlns:ns35="http://www.bcie.org/FLEXCUBE14/PrestamoMO" xmlns:ns36="http://www.bcie.org/FLEXCUBE14/ResultBO"
         xmlns:ns37="http://www.bcie.org/FLEXCUBE14/ErrorBO" xmlns:ns38="http://www.bcie.org/ActualizarComponenteSAD"
         xmlns:ns39="http://www.bcie.org/ConsultarDesembolsosConfiguracionByIdSAD"
         xmlns:ns40="http://www.bice.org/ActualizarLineaCreditoService"
         xmlns:ns41="http://xmlns.bcie.com/OperacionService" xmlns:ns43="http://www.bcie.org/OperacionMO"
         xmlns:ns42="http://www.bcie.org/AprobacionBO">

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      PARTNERLINKS                                                      
      List of services participating in this BPEL process               
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <import namespace="http://www.bcie.org/DesembolsoMO"
          location="oramds:/apps/Resources/ComponentesComunes/DominioDesembolso/Desembolso/V1/Schema/DesembolsoMO.xsd"
          importType="http://www.w3.org/2001/XMLSchema"/>
  
  <import namespace="http://www.bcie.org/CrearActualizarDesembolsoSAD"
          location="oramds:/apps/Resources/ComponentesComunes/DominioDesembolso/Desembolso/V1/Wsdl/ADAPTER/CrearActualizarDesembolsosSAD.wsdl"
          importType="http://schemas.xmlsoap.org/wsdl/"/>
  <import namespace="http://www.bcie.org/ConsultarDesembolsosByIdV2SAD"
          location="oramds:/apps/Resources/ComponentesComunes/DominioDesembolso/Desembolso/V2/Wsdl/ADAPTER/ConsultarDesembolsoByIDV2SAD.wsdl"
          importType="http://schemas.xmlsoap.org/wsdl/"/>
  <import namespace="http://www.bcie.org/ConsultarDesembolsosByIdSAD"
          location="oramds:/apps/Resources/ComponentesComunes/DominioDesembolso/Desembolso/V1/Wsdl/ADAPTER/ConsultarDesembolsosByIdSAD.wsdl"
          importType="http://schemas.xmlsoap.org/wsdl/"/>
  <import namespace="http://www.bcie.org/PropagarContratoDesembolsoSOR"
          location="../WSDLs/PropagarContratoDesembolsoSORWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"
          ui:processWSDL="true"/>
  <partnerLinks>
    <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
    <partnerLink name="propagarcontratodesembolso_client" partnerLinkType="ns1:PropagarContratoDesembolso" myRole="PropagarContratoDesembolso_PT"/>
    <partnerLink name="ConsultarInformacionRegla_SB" partnerLinkType="ns2:ConsultarInformacionRegla_SB"
                 partnerRole="ConsultarInformacionReglaById_PT"/>
    <partnerLink name="LineaCreditoService_SB" partnerLinkType="ns3:LineaCreditoService_SB"
                 partnerRole="LineaCreditoPT"/>
    <partnerLink name="CrearDesembolsoLoanFLEXCUBE_SB" partnerLinkType="ns4:CrearDesembolsoLoanFLEXCUBE_SB"
                 partnerRole="CrearDesembolsoLoanFLEXCUBE_PT"/>
    <partnerLink name="ConsultarDesembolsoById_BS" partnerLinkType="ns26:ConsultarDesembolsoById_BS"
                 partnerRole="ConsultarDesembolsosById_PT"/>
    <partnerLink name="CrearActualizarDesembolsos_SB" partnerLinkType="ns27:CrearActualizarDesembolsos_SB"
                 partnerRole="CrearActualizarDesembolso_PT"/>
    <partnerLink name="CrearDesembolsoComplejoFLEXCUBE_SB" partnerLinkType="ns28:CrearDesembolsoComplejoFLEXCUBE_SB"
                 partnerRole="CrearDesembolsoComplejoFLEXCUBE_PT"/>
    <partnerLink name="DesembolsoService_SB" partnerLinkType="ns29:DesembolsoService_SB" partnerRole="Desembolso_PT"/>
    <partnerLink name="CrearActualizarCondicionesFinancieras_SB"
                 partnerLinkType="ns30:CrearActualizarCondicionesFinancieras_SB"
                 partnerRole="CrearActualizarCondicionesFinancierasPT"/>
    <partnerLink name="CalcularCuotas_SB" partnerLinkType="ns31:CalcularCuotas_SB" partnerRole="CalcularCuotas_PT"/>
    <partnerLink name="ConsultarDesembolsoByIdV2_BS" partnerLinkType="ns32:ConsultarDesembolsoByIdV2_BS"
                 partnerRole="ConsultarDesembolsosByIdV2_PT"/>
    <partnerLink name="CrearDesembolsoFLEXCUBE14_SB" partnerLinkType="ns33:CrearDesembolsoFLEXCUBE14_SB"
                 partnerRole="creaContratoOLFLEXCUBE_V14_PT"/>
    <partnerLink name="ActualizarComponente_SB" partnerLinkType="ns38:ActualizarComponente_SB"
                 partnerRole="ActualizarComponentePT"/>
    <partnerLink name="ConsultarDesembolsoConfiguracionById" partnerLinkType="ns39:ConsultarDesembolsoConfiguracionById"
                 partnerRole="ConsultarDesembolsosConfiguracionById_PT"/>
    <partnerLink name="ConsultarLineaCreditoByIdLineaCredito"
                 partnerLinkType="ns40:ConsultarLineaCreditoByIdLineaCredito"
                 partnerRole="ConsultarLineaCreditoByIdLineaCreditoPT"/>
    <partnerLink name="ConsultarOperacionByIdOperacion" partnerLinkType="ns41:ConsultarOperacionByIdOperacion"
                 partnerRole="ConsultarOperacionById12Port"/>
  </partnerLinks>

  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <variables>
    <!-- Reference to the message passed as input during initiation -->
    <variable name="inputVariable" messageType="ns1:requestPropagarContratoDesembolsoMessage"/>

    <!-- Reference to the message that will be returned to the requester-->
    <variable name="outputVariable" messageType="ns1:responsePropagarContratoDesembolsoMessage"/>
    <variable name="outCrearDesembolsoLoanFLEXCUBE" messageType="ns4:responseCrearDesembolsoLoanFLEXCUBEMessage"/>
    <variable name="outConsultarInformacionDesembolso" messageType="ns2:responseConsultarInformacionReglaByIdMessage"/>
    <variable name="outConsultarLineaCreditoById" messageType="ns3:ConsultarLineaCreditoByIdResponseMessage"/>
    <variable name="outConsultarDesembolsoById" messageType="ns26:responseConsultarDesembolsosByIdMessage"/>
    <variable name="outCrearActualizarDesembolso" messageType="ns27:responseCrearActualizarDesembolsoMessage"/>
    <variable name="setTitleVariable" type="xsd:string"/>
    <variable name="contratoDesembolso" messageType="ns26:responseConsultarDesembolsosByIdMessage"/>
    <variable name="ajuste" type="xsd:boolean"/>
    <variable name="outCrearDesembolsoComplejoFLEXCUBE"
              messageType="ns28:responseCrearDesembolsoComplejoFLEXCUBEMessage"/>
    <variable name="outConsultarDesembolso" messageType="ns26:responseConsultarDesembolsosByIdMessage"/>
    <variable name="outPropagarUtilizacion" messageType="ns29:responsePropagarUtilizacionMessage"/>
    <variable name="outCrearActualizarCondicionesFinancieras"
              messageType="ns30:responseCrearActualizarCondicionesFinancieras"/>
    <variable name="fechaBulletCapital" type="xsd:date"/>
    <variable name="contadorCapital" type="xsd:integer"/>
    <variable name="contadorInteres" type="xsd:integer"/>
    <variable name="fechaBulletInteres" type="xsd:date"/>
    <variable name="outCalcularCuotas" messageType="ns31:responseCalcularCuotasMessage"/>
    <variable name="inConsultarDesembolsoByIdV2" messageType="ns32:ConsultarDesembolsoByIdV2RequestMessage"/>
    <variable name="outConsultarDesembolsoByIdV2" messageType="ns32:ConsultarDesembolsoByIdV2ResponseMessage"/>
    <variable name="ContratoDesembolsoV2" messageType="ns32:ConsultarDesembolsoByIdV2ResponseMessage"/>
    <variable name="inCrearDesembolsoLoanFLEXCUBE14" messageType="ns33:requestCrearContratoOLMessage"/>
    <variable name="outCrearDesembolsoLoanFLEXCUBE14" messageType="ns33:responseCrearContratoOLMessage"/>
    <variable name="fechaBulletCapitalComponente" type="xsd:date"/>
    <variable name="fechaBulletInteresComponente" type="xsd:date"/>
    <variable name="contadorCapitalComponente" type="xsd:integer"/>
    <variable name="contadorInteresComponente" type="xsd:integer"/>
    <variable name="inCalcularCuotasCalendario" messageType="ns31:requestCalcularCuotasMessage"/>
    <variable name="outCalcularCuotasCalendario" messageType="ns31:responseCalcularCuotasMessage"/>
  </variables>
  <faultHandlers>
    <catchAll>
      <sequence name="Sequence11">
        <assign name="allFault">
          <copy>
            <from>'ERROR'</from>
            <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
          </copy>
          <copy>
            <from>ora:getFaultAsString()</from>
            <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
          </copy>
        </assign>
        <reply name="ReplyAllFault" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
               portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
        <exit name="ERROR"/>
      </sequence>
    </catchAll>
  </faultHandlers>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <sequence name="main">

    <!-- Receive input from requestor. (Note: This maps to operation defined in PropagarContratoDesembolso.wsdl) -->
    <receive name="receiveInput" partnerLink="propagarcontratodesembolso_client" portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso" variable="inputVariable" createInstance="yes"/>
    <validate name="Validate" variables="inputVariable"/>
    <assign name="setTitleInstance">
      <copy>
        <from>oraext:setFlowInstanceTitle(concat("IdDesembolso: ",$inputVariable.request/ns5:idDesembolso))</from>
        <to>$setTitleVariable</to>
      </copy>
    </assign>
    <scope name="ConsultarInformacionDesembolso">
      <variables>
        <variable name="inConsultarInformacionDesembolso"
                  messageType="ns2:requestConsultarInformacionReglaByIdMessage"/>
        <variable name="inConsultarDesembolsoConfiguracion"
                  messageType="ns39:ConsultarDesembolsosConfiguracionByIdRequestMessage"/>
        <variable name="outConsultarDesembolsoConfiguracion"
                  messageType="ns39:ConsultarDesembolsosConfiguracionByIdResponseMessage"/>
        <variable name="inConsultarLineaCreditoById"
                  messageType="ns40:ConsultarLineaCreditoByIdLineaCreditoRequestMessage"/>
        <variable name="outConsultarLineaCreditoById"
                  messageType="ns40:ConsultarLineaCreditoByIdLineaCreditoResponseMessage"/>
        <variable name="inConsultarOperacionById" messageType="ns41:requestConsultarOperacionMessage"/>
        <variable name="outConsultarOperacionById" messageType="ns41:responseConsultarOperacionMessage"/>
      </variables>
      <sequence name="Sequence1">
       <assign name="requestConsultarDesembolso">
          <copy>
            <from>$inputVariable.request/ns5:idDesembolso</from>
            <to>$inConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdRequest/ns5:idContratoDesembolso</to>
          </copy>
        </assign>
        <invoke name="InvokeConsultarDesembolso" partnerLink="ConsultarDesembolsoConfiguracionById"
                portType="ns39:ConsultarDesembolsosConfiguracionById_PT"
                operation="ConsultarDesembolsosConfiguracionById"
                inputVariable="inConsultarDesembolsoConfiguracion" outputVariable="outConsultarDesembolsoConfiguracion"
                bpelx:invokeAsDetail="no"/>
        <if name="IfValidaOK">
          <documentation>
            <![CDATA[OK]]>
          </documentation>
          <condition>$outConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdResponse/ns5:Resultado/ns24:result = 'OK'</condition>
          <empty name="OK"/>
          <else>
            <documentation>
              <![CDATA[ERROR]]>
            </documentation>
            <sequence name="Sequence45">
              <assign name="ErrorConsultarDesembolsoConfiguracion">
                <copy>
                  <from>'ERROR'</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                </copy>
                <copy>
                  <from>concat("Error en el servicio ConsultarDesembolsoConfiguracion ",$outConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdResponse/ns5:Resultado/ns24:message)</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                </copy>
              </assign>
              <reply name="ReplyERROR" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
                     portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
              <exit name="ERROR"/>
            </sequence>
          </else>
        </if>
        <assign name="AssignIdLineaCredito">
          <copy>
            <from>$outConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdResponse/ns5:ContratoDesembolso/ns15:idLinea</from>
            <to>$inConsultarLineaCreditoById.request/ns6:idLineaCredito</to>
          </copy>
        </assign>
        <invoke name="InvokeConsultarLineaCreditoById"
                partnerLink="ConsultarLineaCreditoByIdLineaCredito"
                portType="ns40:ConsultarLineaCreditoByIdLineaCreditoPT"
                operation="consultarLineaCreditoByIdLineaCredito" inputVariable="inConsultarLineaCreditoById"
                outputVariable="outConsultarLineaCreditoById" bpelx:invokeAsDetail="no"/>
        <if name="IfValidaOK">
          <documentation>
            <![CDATA[OK]]>
          </documentation>
          <condition>$outConsultarLineaCreditoById.response/ns6:Resultado/ns24:result = 'OK'</condition>
          <empty name="OK"/>
          <else>
            <documentation>
              <![CDATA[ERROR]]>
            </documentation>
            <sequence name="Sequence46">
              <assign name="ErrorConsultarLineaCreditoById">
                <copy>
                  <from>'ERROR'</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                </copy>
                <copy>
                  <from>concat("Error en el servicio ConsultarLineaCreditoById ",$outConsultarLineaCreditoById.response/ns6:Resultado/ns24:message)</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                </copy>
              </assign>
              <reply name="ReplyERROR" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
                     portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
              <exit name="ERROR"/>
            </sequence>
          </else>
        </if>
        <assign name="AssignIdOperacion">
          <copy>
            <from>$outConsultarLineaCreditoById.response/ns6:Operacion/ns14:idOperacion</from>
            <to>$inConsultarOperacionById.request/ns43:idOperacion</to>
          </copy>
          <copy>
            <from>'OPERACION'</from>
            <to>$inConsultarOperacionById.request/ns43:nivelDetalle</to>
          </copy>
          <copy>
            <from>false()</from>
            <to>$inConsultarOperacionById.request/ns43:infoDetalleCliente</to>
          </copy>
        </assign>
        <invoke name="InvokeConsultarOperacionById"
                partnerLink="ConsultarOperacionByIdOperacion" portType="ns41:ConsultarOperacionById12Port"
                operation="ConsultarOperacionById" inputVariable="inConsultarOperacionById"
                outputVariable="outConsultarOperacionById" bpelx:invokeAsDetail="no"/>
        <if name="IfValidaOK">
          <documentation>
            <![CDATA[OK]]>
          </documentation>
          <condition>concat("Error en el servicio ConsultarOperacionById ",$outConsultarOperacionById.response/ns43:Resultado/ns24:message)</condition>
          <empty name="OK"/>
          <else>
            <documentation>
              <![CDATA[ERROR]]>
            </documentation>
            <sequence name="Sequence47">
              <assign name="ErrorConsultarOperacionById">
                <copy>
                  <from>'ERROR'</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                </copy>
              </assign>
              <reply name="ReplyERROR" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
                     portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
              <exit name="ERROR"/>
            </sequence>
          </else>
        </if>
        <assign name="XQTransformConsultarInformacionRegla">
          <bpelx:annotation>
            <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
          </bpelx:annotation>
          <copy>
            <from>ora:processXQuery10('../Transformations/ConsultarInformacionReglaResponse.xqy', 'outInvokeConsultarDesembolsoById.ConsultarDesembolsosConfiguracionByIdResponse', $outConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdResponse, 'outConsultarLineaCreditoById.response', $outConsultarLineaCreditoById.response, 'outConsultarOperacionById.response', $outConsultarOperacionById.response)</from>
            <to variable="outConsultarInformacionDesembolso" part="response"/>
          </copy>
        </assign>
        <if name="IfValidaOK">
          <documentation>
            <![CDATA[OK]]>
          </documentation>
          <condition>$outConsultarInformacionDesembolso.response/ns5:Resultado/ns24:result = 'OK'</condition>
          <empty name="OK"/>
          <else>
            <documentation>
              <![CDATA[ERROR]]>
            </documentation>
            <sequence name="Sequence5">
              <assign name="ErrorConsultarInformacion">
                <copy>
                  <from>'ERROR'</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                </copy>
                <copy>
                  <from>concat("Error en el servicio ConsultarInformacionReglas ",$outConsultarInformacionDesembolso.response/ns5:Resultado/ns24:message)</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                </copy>
              </assign>
              <reply name="ReplyERROR" partnerLink="propagarcontratodesembolso_client"
                     portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"
                     variable="outputVariable"/>
              <exit name="ERROR"/>
            </sequence>
          </else>
        </if>
      </sequence>
    </scope>
    <scope name="ConsultarLineaCreditoById">
      <variables>
        <variable name="inConsultarLineaCreditoById" messageType="ns3:ConsultarLineaCreditoByIdRequestMessage"/>
      </variables>
      <sequence name="Sequence2">
        <assign name="requestConsultarLineaCredito">
          <copy>
            <from>$outConsultarInformacionDesembolso.response/ns5:LineaCredito/ns7:idLineaCredito</from>
            <to>$inConsultarLineaCreditoById.ConsultarLineaCreditoByIdRequest/ns6:idLineaCredito</to>
          </copy>
        </assign>
        <invoke name="InvokeConsultarLineaCreditoById_SB" bpelx:invokeAsDetail="no" partnerLink="LineaCreditoService_SB"
                portType="ns3:LineaCreditoPT" operation="consultarLineaCreditoById"
                inputVariable="inConsultarLineaCreditoById" outputVariable="outConsultarLineaCreditoById"/>
        <if name="IfValidarOK">
          <documentation>
            <![CDATA[OK]]>
          </documentation>
          <condition>$outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse/ns6:Resultado/ns24:result = 'OK'</condition>
          <empty name="OK"/>
          <else>
            <documentation>
              <![CDATA[ERROR]]>
            </documentation>
            <assign name="ErrorConsultarLineaCredito">
              <copy>
                <from>'ERROR'</from>
                <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
              </copy>
              <copy>
                <from>concat("Error en el servicio ConsultarLineaCredito ",$outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse/ns6:Resultado/ns24:message)</from>
                <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
              </copy>
            </assign>
          </else>
        </if>
      </sequence>
    </scope>
    <scope name="ScopePropagarDesembolsoFlexcube7">
      <bpelx:skipCondition>1 &gt; 0</bpelx:skipCondition>
      <sequence>
        <scope name="ConsultarDesembolsoById_SB">
          <variables>
            <variable name="inConsultarDesembolsoById" messageType="ns26:requestConsultarDesembolsosByIdMessage"/>
          </variables>
          <sequence name="Sequence4">
            <assign name="requestConsultarDesembolsoById">
              <copy>
                <from>$inputVariable.request/ns5:idDesembolso</from>
                <to>$inConsultarDesembolsoById.request/ns5:idContratoDesembolso</to>
              </copy>
            </assign>
            <invoke name="InvokeConsultarDesembolsoById_SB" bpelx:invokeAsDetail="no"
                    partnerLink="ConsultarDesembolsoById_BS" portType="ns26:ConsultarDesembolsosById_PT"
                    operation="ConsultarDesembolsosById" inputVariable="inConsultarDesembolsoById"
                    outputVariable="outConsultarDesembolsoById"/>
            <if name="IfValidaOK">
              <documentation>
                <![CDATA[OK]]>
              </documentation>
              <condition>$outConsultarDesembolsoById.response/ns5:Resultado/ns24:result = 'OK'</condition>
              <empty name="OK"/>
              <else>
                <documentation>
                  <![CDATA[ERROR]]>
                </documentation>
                <sequence name="Sequence6">
                  <assign name="errorConsultarDesembolsoById">
                    <copy>
                      <from>'ERROR'</from>
                      <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                    </copy>
                    <copy>
                      <from>concat("Error en el servicio ConsultarDesembolsoById ",$outConsultarDesembolsoById.response/ns5:Resultado/ns24:message)</from>
                      <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                    </copy>
                  </assign>
                  <exit name="ERROR"/>
                </sequence>
              </else>
            </if>
          </sequence>
        </scope>
        <scope name="PropagarDesembolsoFLEXCUBE">
          <variables>
            <variable name="inCrearDesembolsoLoanFLEXCUBE" messageType="ns4:requestCrearDesembolsoLoanFLEXCUBEMessage"/>
            <variable name="inCrearDesembolsoComplejoFLEXCUBE"
                      messageType="ns28:requestCrearDesembolsoComplejoFLEXCUBEMessage"/>
          </variables>
          <sequence name="Sequence3">
            <assign name="asignaIdUsuario">
              <copy>
                <from>string(ids:getUserProperty($outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:usuario, 'employeenumber'))</from>
                <to>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:usuario</to>
              </copy>
            </assign>
            <if name="IfValidaAjustarTasa">
              <documentation>
                <![CDATA[AjustarTasa]]>
              </documentation>
              <condition>string($outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:limite/ns8:maximo) != '' or string($outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:limite/ns8:minimo) != ''</condition>
              <sequence name="Sequence10">
                <assign name="XQ_AjustarTasa">
                  <bpelx:annotation>
                    <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from>ora:processXQuery10('../Transformations/XQ_AjustarTasa.xqy', 'outConsultarDesembolsoById.response', $outConsultarDesembolsoById.response)</from>
                    <to variable="contratoDesembolso" part="response"/>
                  </copy>
                </assign>
                <if name="IfRealizarAjuste">
                  <documentation>
                    <![CDATA[AjusteTasa]]>
                  </documentation>
                  <condition>count($contratoDesembolso.response/ns5:ContratoDesembolso) &gt;0</condition>
                  <sequence name="Sequence25">
                    <if name="IfValidarTipoAjuste">
                      <documentation>
                        <![CDATA[Variable]]>
                      </documentation>
                      <condition>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:tipo/ns9:codigoExterno = 'F'</condition>
                      <assign name="asignaAjusteTasa">
                        <copy ignoreMissingFromData="yes">
                          <from>$contratoDesembolso.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:spread/ns15:valor</from>
                          <to>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:spread/ns15:valor</to>
                        </copy>
                        <copy>
                          <from>'AJUSTE_TASA'</from>
                          <to>$outConsultarDesembolsoById.response/ns5:Resultado/ns24:message</to>
                        </copy>
                      </assign>
                      <elseif>
                        <documentation>
                          <![CDATA[Fija]]>
                        </documentation>
                        <condition>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:tipo/ns9:codigoExterno = 'X'</condition>
                        <assign name="asignaAjusteTasa"
                                xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
                          <copy ignoreMissingFromData="yes">
                            <from>$contratoDesembolso.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:fija/ns15:valor</from>
                            <to>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:fija/ns15:valor</to>
                          </copy>
                          <copy>
                            <from>'AJUSTE_TASA'</from>
                            <to>$outConsultarDesembolsoById.response/ns5:Resultado/ns24:message</to>
                          </copy>
                        </assign>
                      </elseif>
                      <else>
                        <empty name="SinAjuste"/>
                      </else>
                    </if>
                  </sequence>
                  <else>
                    <empty name="SinAjuste"/>
                  </else>
                </if>
              </sequence>
              <else>
                <documentation>
                  <![CDATA[SinAjuste]]>
                </documentation>
                <empty name="Empty"/>
              </else>
            </if>
            <if name="IfValidaTipoCalendario">
              <documentation>
                <![CDATA[Sencillo]]>
              </documentation>
              <condition>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tipoCalendario/ns9:DescripcionCorta = 'Sencillo'</condition>
              <sequence>
                <assign name="XQ_RequestCrearDesembolsoLoanFLEXCUBE">
                  <bpelx:annotation>
                    <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from>ora:processXQuery10('../Transformations/XQ_RequestCrearDesembolsoLoanFLEXCUBE.xqy', 'outConsultarInformacionDesembolso.response', $outConsultarInformacionDesembolso.response, 'outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse', $outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse, 'outConsultarDesembolsoById.response', $outConsultarDesembolsoById.response)</from>
                    <to variable="inCrearDesembolsoLoanFLEXCUBE" part="request"/>
                  </copy>
                </assign>
                <invoke name="InvokeCrearDesembolsoLoanFLEXCUBE_SB" bpelx:invokeAsDetail="no"
                        partnerLink="CrearDesembolsoLoanFLEXCUBE_SB" portType="ns4:CrearDesembolsoLoanFLEXCUBE_PT"
                        operation="crearDesembolsoLoanFLEXCUBE" inputVariable="inCrearDesembolsoLoanFLEXCUBE"
                        outputVariable="outCrearDesembolsoLoanFLEXCUBE"/>
                <if name="IfValidaOK">
                  <documentation>
                    <![CDATA[OK]]>
                  </documentation>
                  <condition>$outCrearDesembolsoLoanFLEXCUBE.response/ns5:Resultado/ns24:result = 'OK'</condition>
                  <sequence>
                    <assign name="asignarBHQ">
                      <copy bpelx:insertMissingToData="yes">
                        <from>$outCrearDesembolsoLoanFLEXCUBE.response/ns5:ContratoDesembolso/ns15:idFacturador</from>
                        <to>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:idFacturador</to>
                      </copy>
                    </assign>
                    <scope name="CrearActualizarDesembolsoSencillo_SB">
                      <variables>
                        <variable name="inCrearActualizarDesembolso"
                                  messageType="ns27:requestCrearActualizarDesembolsoMessage"/>
                      </variables>
                      <sequence name="Sequence8">
                        <assign name="XQ_RequestCrearActualizarDesembolso">
                          <bpelx:annotation>
                            <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                          </bpelx:annotation>
                          <copy>
                            <from>ora:processXQuery10('../Transformations/XQ_RequestCrearActualizarDesembolso.xqy', 'outConsultarDesembolsoById.response', $outConsultarDesembolsoById.response)</from>
                            <to variable="inCrearActualizarDesembolso" part="request"/>
                          </copy>
                        </assign>
                        <invoke name="InvokeCrearActualizarDesembolso_SB" bpelx:invokeAsDetail="no"
                                partnerLink="CrearActualizarDesembolsos_SB" portType="ns27:CrearActualizarDesembolso_PT"
                                operation="crearActualizarDesembolso" inputVariable="inCrearActualizarDesembolso"
                                outputVariable="outCrearActualizarDesembolso"/>
                        <if name="IfValidaOK">
                          <documentation>
                            <![CDATA[OK]]>
                          </documentation>
                          <condition>$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:result = 'OK'</condition>
                          <empty name="OK"/>
                          <else>
                            <documentation>
                              <![CDATA[ERROR]]>
                            </documentation>
                            <sequence name="Sequence9">
                              <assign name="errorCrearActualizarDesembolso">
                                <copy>
                                  <from>'ERROR'</from>
                                  <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                                </copy>
                                <copy>
                                  <from>concat("Error al CrearActualizarDesembolso ",$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:message)</from>
                                  <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                                </copy>
                              </assign>
                              <reply name="ReplyERROR" variable="outputVariable"
                                     partnerLink="propagarcontratodesembolso_client"
                                     portType="ns1:PropagarContratoDesembolso_PT"
                                     operation="propagarContratoDesembolso"/>
                              <exit name="ERROR"/>
                            </sequence>
                          </else>
                        </if>
                      </sequence>
                    </scope>
                  </sequence>
                  <else>
                    <documentation>
                      <![CDATA[ERROR]]>
                    </documentation>
                    <sequence name="Sequence7">
                      <assign name="errorCrearDesembolsoFLEXCUBE">
                        <copy>
                          <from>'ERROR'</from>
                          <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                        </copy>
                        <copy>
                          <from>concat("Error al crear el desembolso en FLEXCUBE ",$outCrearDesembolsoLoanFLEXCUBE.response/ns5:Resultado/ns24:message)</from>
                          <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                        </copy>
                      </assign>
                      <reply name="ReplyError" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
                             portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                      <exit name="ExitError"/>
                    </sequence>
                  </else>
                </if>
              </sequence>
              <else>
                <documentation>
                  <![CDATA[Complejo]]>
                </documentation>
                <sequence name="Sequence12">
                  <assign name="asignarFechas">
                    <copy>
                      <from>count($outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:calendarioComplejo[ns15:Monto/ns8:tipo/ns9:DescripcionCorta = 'CAPITAL'])</from>
                      <to>$contadorCapital</to>
                    </copy>
                    <copy>
                      <from>count($outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:calendarioComplejo[ns15:Monto/ns8:tipo/ns9:DescripcionCorta = 'INTERES'])</from>
                      <to>$contadorInteres</to>
                    </copy>
                    <copy>
                      <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:calendarioComplejo[ns15:Monto/ns8:tipo/ns9:DescripcionCorta= 'CAPITAL'][$contadorCapital]/ns15:Frecuencia/ns15:FechaInicio</from>
                      <to>$fechaBulletCapital</to>
                    </copy>
                    <copy bpelx:insertMissingToData="yes">
                      <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:calendarioComplejo[ns15:Monto/ns8:tipo/ns9:DescripcionCorta= 'INTERES'][$contadorInteres]/ns15:Frecuencia/ns15:FechaInicio</from>
                      <to>$fechaBulletInteres</to>
                    </copy>
                  </assign>
                  <if name="IfValidarFechaBulletCapital">
                    <documentation>
                      <![CDATA[Diferente]]>
                    </documentation>
                    <condition>$fechaBulletCapital != $outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:fechaVencimiento</condition>
                    <sequence name="Sequence20">
                      <assign name="errorFechaBulletCapital">
                        <copy>
                          <from>'ERROR'</from>
                          <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                        </copy>
                        <copy>
                          <from>'La fecha de inicio capital bullet deber ser igual a la fecha de vencimiento'</from>
                          <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                        </copy>
                      </assign>
                      <reply name="ReplyError" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
                             portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                      <exit name="Error"/>
                    </sequence>
                    <else>
                      <if name="IfValidarFechaBulletInteres">
                        <documentation>
                          <![CDATA[Diferente]]>
                        </documentation>
                        <condition>$fechaBulletInteres != $outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:fechaVencimiento</condition>
                        <sequence name="Sequence21">
                          <assign name="errorFechaBulletInteres">
                            <copy>
                              <from>'ERROR'</from>
                              <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                            </copy>
                            <copy>
                              <from>'La fecha inicio interes bullet debe ser igual a la fecha vencimiento'</from>
                              <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                            </copy>
                          </assign>
                          <reply name="ReplyError" variable="outputVariable"
                                 partnerLink="propagarcontratodesembolso_client"
                                 portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                          <exit name="Error"/>
                        </sequence>
                        <else>
                          <empty name="OK"/>
                        </else>
                      </if>
                    </else>
                  </if>
                  <scope name="CalcularCuota_SB">
                    <variables>
                      <variable name="inCalcularCuotas" messageType="ns31:requestCalcularCuotasMessage"/>
                    </variables>
                    <sequence name="Sequence22">
                      <if name="IfValidaRevision">
                        <documentation>
                          <![CDATA[TieneRevision]]>
                        </documentation>
                        <condition>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:revision/ns15:FechaInicio != ''</condition>
                        <sequence>
                          <assign name="requestCalcularCuotas">
                            <copy>
                              <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:revision/ns15:FechaInicio</from>
                              <to>$inCalcularCuotas.request/ns5:Plazo/ns15:FechaInicio</to>
                            </copy>
                            <copy>
                              <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:revision/ns15:Frecuencia</from>
                              <to>$inCalcularCuotas.request/ns5:Plazo/ns15:Frecuencia</to>
                            </copy>
                            <copy>
                              <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:fechaVencimiento</from>
                              <to>$inCalcularCuotas.request/ns5:FechaVencimiento</to>
                            </copy>
                          </assign>
                          <invoke name="InvokeCalcularCuotas_SB" bpelx:invokeAsDetail="no"
                                  partnerLink="CalcularCuotas_SB" portType="ns31:CalcularCuotas_PT"
                                  operation="calcularCuotas" inputVariable="inCalcularCuotas"
                                  outputVariable="outCalcularCuotas"/>
                          <if name="IfValidaOK">
                            <documentation>
                              <![CDATA[OK]]>
                            </documentation>
                            <condition>$outCalcularCuotas.response/ns5:Resultado/ns24:result = 'OK'</condition>
                            <assign name="asignaNumeroCuotas">
                              <copy>
                                <from>$outCalcularCuotas.response/ns5:numeroCuotas</from>
                                <to>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:calendarioComplejo[1]/ns15:NumeroCuotas</to>
                              </copy>
                            </assign>
                            <else>
                              <documentation>
                                <![CDATA[ERROR]]>
                              </documentation>
                              <sequence name="Sequence24">
                                <assign name="ERROR">
                                  <copy>
                                    <from>'ERROR'</from>
                                    <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                                  </copy>
                                  <copy>
                                    <from>$outCalcularCuotas.response/ns5:Resultado/ns24:message</from>
                                    <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                                  </copy>
                                </assign>
                                <reply name="ReplyError" variable="outputVariable"
                                       partnerLink="propagarcontratodesembolso_client"
                                       portType="ns1:PropagarContratoDesembolso_PT"
                                       operation="propagarContratoDesembolso"/>
                                <exit name="ERROR"/>
                              </sequence>
                            </else>
                          </if>
                        </sequence>
                        <else>
                          <empty name="SinRevision"/>
                        </else>
                      </if>
                    </sequence>
                  </scope>
                  <assign name="XQ_RequestCrearDesembolsoComplejo">
                    <bpelx:annotation>
                      <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                    </bpelx:annotation>
                    <copy>
                      <from>ora:processXQuery10('../Transformations/XQ_RequestCrearDesembolsoComplejo.xqy', 'outConsultarInformacionDesembolso.response', $outConsultarInformacionDesembolso.response, 'outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse', $outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse, 'outConsultarDesembolsoById.response', $outConsultarDesembolsoById.response)</from>
                      <to variable="inCrearDesembolsoComplejoFLEXCUBE" part="request"/>
                    </copy>
                  </assign>
                  <invoke name="InvokeCrearDesembolsoComplejoFLEXCUBE_SB" bpelx:invokeAsDetail="no"
                          partnerLink="CrearDesembolsoComplejoFLEXCUBE_SB"
                          portType="ns28:CrearDesembolsoComplejoFLEXCUBE_PT" operation="crearDesembolsoComplejoFLEXCUBE"
                          inputVariable="inCrearDesembolsoComplejoFLEXCUBE"
                          outputVariable="outCrearDesembolsoComplejoFLEXCUBE"/>
                  <if name="IfValidaOK">
                    <documentation>
                      <![CDATA[OK]]>
                    </documentation>
                    <condition>$outCrearDesembolsoComplejoFLEXCUBE.response/ns5:Resultado/ns24:result = 'OK'</condition>
                    <sequence>
                      <assign name="asignaBHQ">
                        <copy bpelx:insertMissingToData="yes">
                          <from>$outCrearDesembolsoComplejoFLEXCUBE.response/ns5:ContratoDesembolso/ns15:idFacturador</from>
                          <to>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:idFacturador</to>
                        </copy>
                      </assign>
                      <scope name="CrearActualizarDesembolsoComplejo_SB">
                        <variables>
                          <variable name="inCrearActualizarDesembolso"
                                    messageType="ns27:requestCrearActualizarDesembolsoMessage"/>
                        </variables>
                        <sequence name="Sequence8">
                          <assign name="XQ_RequestCrearActualizarDesembolso">
                            <bpelx:annotation xmlns:bpelx="http://schemas.oracle.com/bpel/extension">
                              <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                            </bpelx:annotation>
                            <copy>
                              <from>ora:processXQuery10('../Transformations/XQ_RequestCrearActualizarDesembolso.xqy', 'outConsultarDesembolsoById.response', $outConsultarDesembolsoById.response)</from>
                              <to variable="inCrearActualizarDesembolso" part="request"/>
                            </copy>
                          </assign>
                          <invoke name="InvokeCrearActualizarDesembolso_SB" bpelx:invokeAsDetail="no"
                                  partnerLink="CrearActualizarDesembolsos_SB"
                                  portType="ns27:CrearActualizarDesembolso_PT" operation="crearActualizarDesembolso"
                                  inputVariable="inCrearActualizarDesembolso"
                                  outputVariable="outCrearActualizarDesembolso"
                                  xmlns:bpelx="http://schemas.oracle.com/bpel/extension"/>
                          <if name="IfValidaOK">
                            <documentation>
                              <![CDATA[OK]]>
                            </documentation>
                            <condition>$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:result = 'OK'</condition>
                            <empty name="OK"/>
                            <else>
                              <documentation>
                                <![CDATA[ERROR]]>
                              </documentation>
                              <sequence name="Sequence9">
                                <assign name="errorCrearActualizarDesembolso">
                                  <copy>
                                    <from>'ERROR'</from>
                                    <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                                  </copy>
                                  <copy>
                                    <from>concat("Error al CrearActualizarDesembolso ",$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:message)</from>
                                    <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                                  </copy>
                                </assign>
                                <reply name="ReplyERROR" variable="outputVariable"
                                       partnerLink="propagarcontratodesembolso_client"
                                       portType="ns1:PropagarContratoDesembolso_PT"
                                       operation="propagarContratoDesembolso"/>
                                <exit name="ERROR"/>
                              </sequence>
                            </else>
                          </if>
                        </sequence>
                      </scope>
                    </sequence>
                    <else>
                      <documentation>
                        <![CDATA[ERROR]]>
                      </documentation>
                      <sequence name="Sequence26">
                        <assign name="errrorCrearDesembolsoComplejo">
                          <copy>
                            <from>'ERROR'</from>
                            <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                          </copy>
                          <copy>
                            <from>concat("Error en el servicio CrearDesembolsoComplejoFLEXCUBE: ",$outCrearDesembolsoComplejoFLEXCUBE.response/ns5:Resultado/ns24:message)</from>
                            <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                          </copy>
                        </assign>
                        <reply name="ReplyError" variable="outputVariable"
                               partnerLink="propagarcontratodesembolso_client"
                               portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                        <exit name="ExitError"/>
                      </sequence>
                    </else>
                  </if>
                </sequence>
              </else>
            </if>
          </sequence>
        </scope>
        <scope name="CrearActualizarCondicionesFinancieras">
          <variables>
            <variable name="inCrearActualizarCondicionesFinancieras"
                      messageType="ns30:requestCrearActualizarCondicionesFinancieras"/>
          </variables>
          <sequence name="CrearActualizarCondicionesFinancieras">
            <if name="IfAjusteTasa">
              <documentation>
                <![CDATA[AjusteTasa]]>
              </documentation>
              <condition>$outConsultarDesembolsoById.response/ns5:Resultado/ns24:message = 'AJUSTE_TASA'</condition>
              <sequence name="Sequence19">
                <if name="IfValidarTipoTasa">
                  <documentation>
                    <![CDATA[Variable]]>
                  </documentation>
                  <condition>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:tipo/ns9:codigoExterno = 'F'</condition>
                  <assign name="requestCrearActualizarCondicionesFinancieras">
                    <copy>
                      <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:idCondicionFinanciera</from>
                      <to>$inCrearActualizarCondicionesFinancieras.request/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:idCondicionFinanciera</to>
                    </copy>
                    <copy>
                      <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:spread/ns15:valor</from>
                      <to>$inCrearActualizarCondicionesFinancieras.request/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:variable/ns15:spread/ns15:valor</to>
                    </copy>
                  </assign>
                  <elseif>
                    <documentation>
                      <![CDATA[Fija]]>
                    </documentation>
                    <condition>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:tipo/ns9:codigoExterno = 'X'</condition>
                    <assign name="requestCrearActualizarCondicionesFinancieras"
                            xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable">
                      <copy>
                        <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:idCondicionFinanciera</from>
                        <to>$inCrearActualizarCondicionesFinancieras.request/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:idCondicionFinanciera</to>
                      </copy>
                      <copy>
                        <from>$outConsultarDesembolsoById.response/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:fija/ns15:valor</from>
                        <to>$inCrearActualizarCondicionesFinancieras.request/ns5:ContratoDesembolso/ns15:condicionesFinancieras/ns15:tasa/ns15:fija/ns15:valor</to>
                      </copy>
                    </assign>
                  </elseif>
                  <else>
                    <empty name="Empty"/>
                  </else>
                </if>
                <invoke name="InvokeCrearActualizarCondicionesFinancieras_SB" bpelx:invokeAsDetail="no"
                        partnerLink="CrearActualizarCondicionesFinancieras_SB"
                        portType="ns30:CrearActualizarCondicionesFinancierasPT"
                        operation="crearActualizarCondicionesFinancieras"
                        inputVariable="inCrearActualizarCondicionesFinancieras"
                        outputVariable="outCrearActualizarCondicionesFinancieras"/>
              </sequence>
              <else>
                <documentation>
                  <![CDATA[SinAjuste]]>
                </documentation>
                <empty name="Empty"/>
              </else>
            </if>
          </sequence>
        </scope>
      </sequence>
    </scope>
    <scope name="ScopePropagarDesembolsoFlexcube14">
      <variables>
        <variable name="inCrearActualizarDesembolso" messageType="ns27:requestCrearActualizarDesembolsoMessage"/>
        <variable name="inCalcularCuotas" messageType="ns31:requestCalcularCuotasMessage"/>
      </variables>
      <sequence name="SequenceConsultarDesembolsoByIdV2_SB">
        <assign name="requestConsultarDesembolsoByIdV2">
          <copy>
            <from>$inputVariable.request/ns5:idDesembolso</from>
            <to>$inConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Request/ns5:idContratoDesembolso</to>
          </copy>
        </assign>
        <invoke name="InvokeConsultarDesembolsoByIdV2" bpelx:invokeAsDetail="no"
                partnerLink="ConsultarDesembolsoByIdV2_BS" portType="ns32:ConsultarDesembolsosByIdV2_PT"
                operation="ConsultarDesembolsosByIdV2" inputVariable="inConsultarDesembolsoByIdV2"
                outputVariable="outConsultarDesembolsoByIdV2"/>
        <if name="IfValidaOk">
          <documentation>
            <![CDATA[OK]]>
          </documentation>
          <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:Resultado/ns24:result = 'OK'</condition>
          <empty name="OK"/>
          <else>
            <documentation>
              <![CDATA[ERROR]]>
            </documentation>
            <sequence name="Sequence27">
              <assign name="errorConsultarDesembolsoByIdv2">
                <copy>
                  <from>'ERROR'</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                </copy>
                <copy ignoreMissingFromData="yes">
                  <from>concat("Error en el servicio ConsultarDesembolsoByIdV2 ",$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:Resultado/ns24:message)</from>
                  <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                </copy>
              </assign>
              <exit name="ERROR"/>
            </sequence>
          </else>
        </if>
        <sequence name="PropagarDesembolsoFLEXCUBE14">
          <assign name="assignIdUsuario">
            <copy>
              <from>string(ids:getUserProperty($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:usuario, 'employeenumber'))</from>
              <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:usuario</to>
            </copy>
          </assign>
          <forEach parallel="no" counterName="ComponentesCounter" name="ForEachComponentes">
            <startCounterValue>1</startCounterValue>
            <finalCounterValue>count($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente)</finalCounterValue>
            <scope name="Scope1">
              <sequence name="Sequence42">
                <if name="IfRealizarAjusteTasaComponente">
                  <documentation>
                    <![CDATA[AjustarTasa]]>
                  </documentation>
                  <condition>string($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:LimiteTasaMaxima) != '' or string($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:LimiteTasaMinima) != ''</condition>
                  <sequence name="Sequence28">
                    <assign name="XQ_AjustarTasaComponente">
                      <copy>
                        <from>ora:processXQuery10('../Transformations/XQ_AjustarTasaComponente.xqy', 'outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response', $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response,'ComponentesCounter',$ComponentesCounter)</from>
                        <to>$ContratoDesembolsoV2.ConsultarDesembolsoByIdV2Response</to>
                      </copy>
                    </assign>
                    <if name="IfValidarTipoAjusteComponente">
                      <documentation>
                        <![CDATA[Variable]]>
                      </documentation>
                      <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:TipoTasa/ns9:codigoExterno = 'F'</condition>
                      <assign name="AssignAjusteTasa">
                        <copy ignoreMissingFromData="yes">
                          <from>$ContratoDesembolsoV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente/ns34:SpreadTasa</from>
                          <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:SpreadTasa</to>
                        </copy>
                        <copy>
                          <from>'AJUSTE_TASA'</from>
                          <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:Resultado/ns24:message</to>
                        </copy>
                      </assign>
                      <elseif>
                        <documentation>
                          <![CDATA[Fija]]>
                        </documentation>
                        <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:TipoTasa/ns9:codigoExterno = 'X'</condition>
                        <assign name="AssignAjusteTasa">
                          <copy ignoreMissingFromData="yes">
                            <from>$ContratoDesembolsoV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente/ns34:Tasa</from>
                            <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:Tasa</to>
                          </copy>
                          <copy>
                            <from>'AJUSTE_TASA'</from>
                            <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:Resultado/ns24:message</to>
                          </copy>
                        </assign>
                      </elseif>
                      <else>
                        <empty name="SinAjuste"/>
                      </else>
                    </if>
                  </sequence>
                  <else>
                    <documentation>
                      <![CDATA[SinAjuste]]>
                    </documentation>
                    <empty name="Empty"/>
                  </else>
                </if>
                <sequence name="SequenceCalcularCuotas">
                  <forEach parallel="no" counterName="CalendarioCounter" name="ForEachCalendario">
                    <startCounterValue>1</startCounterValue>
                    <finalCounterValue>count($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario)</finalCounterValue>
                    <scope name="Scope3">
                      <if name="IfCalendarioTipoP">
                        <documentation>
                          <![CDATA[NoContieneFechaNoVencimiento]]>
                        </documentation>
                        <condition>string($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:FechaInicio) != '' and string($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:Frecuencia/ns8:Tipo/ns9:codigoExterno) != 'B'</condition>
                        <sequence name="Sequence43">
                          <assign name="AssignCalcularCuota">
                            <copy>
                              <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:FechaInicio</from>
                              <to>$inCalcularCuotasCalendario.request/ns5:Plazo/ns15:FechaInicio</to>
                            </copy>
                            <copy>
                              <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:Frecuencia</from>
                              <to>$inCalcularCuotasCalendario.request/ns5:Plazo/ns15:Frecuencia</to>
                            </copy>
                            <copy>
                              <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:fechaVencimiento</from>
                              <to>$inCalcularCuotasCalendario.request/ns5:FechaVencimiento</to>
                            </copy>
                          </assign>
                          <invoke name="InvokeCalcularCuotasCalendario" bpelx:invokeAsDetail="no"
                                  partnerLink="CalcularCuotas_SB" portType="ns31:CalcularCuotas_PT"
                                  operation="calcularCuotas" inputVariable="inCalcularCuotasCalendario"
                                  outputVariable="outCalcularCuotasCalendario"/>
                          <if name="IfCuotasOk">
                            <documentation>
                              <![CDATA[Ok]]>
                            </documentation>
                            <condition>$outCalcularCuotasCalendario.response/ns5:Resultado/ns24:result = 'OK'</condition>
                            <sequence name="Sequence44">
                              <if name="IfCuotaTipoP">
                                <documentation>
                                  <![CDATA[TipoP]]>
                                </documentation>
                                <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario[$CalendarioCounter]/ns34:TipoPlan/ns9:codigoExterno = 'P'</condition>
                                <assign name="AssignNumeroCuotasP">
                                  <copy>
                                    <from>$outCalcularCuotasCalendario.response/ns5:numeroCuotas</from>
                                    <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario[$CalendarioCounter]/ns34:NumeroCuotas</to>
                                  </copy>
                                </assign>
                                <else>
                                  <documentation>
                                    <![CDATA[TipoR]]>
                                  </documentation>
                                  <assign name="AssignNumeroCuotasR">
                                    <copy>
                                      <from>$outCalcularCuotasCalendario.response/ns5:numeroCuotas - 1</from>
                                      <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:calendario[$CalendarioCounter]/ns34:NumeroCuotas</to>
                                    </copy>
                                  </assign>
                                </else>
                              </if>
                            </sequence>
                            <else>
                              <documentation>
                                <![CDATA[Continua]]>
                              </documentation>
                              <empty name="Continua"/>
                            </else>
                          </if>
                        </sequence>
                        <else>
                          <documentation>
                            <![CDATA[ContieneFechaNoVencimiento]]>
                          </documentation>
                          <empty name="Continua"/>
                        </else>
                      </if>
                    </scope>
                  </forEach>
                </sequence>
              </sequence>
            </scope>
          </forEach>
          <scope name="ScopeCalcularCuotaCalendarioPrincipal">
          <sequence name="SequenceCalcularCuotas">
                  <forEach parallel="no" counterName="CalendarioCounter" name="ForEachCalendario">
                    <startCounterValue>1</startCounterValue>
                    <finalCounterValue>count($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario)</finalCounterValue>
                    <scope name="Scope3">
                      <if name="IfCalendarioTipoP">
                        <documentation>
                      <![CDATA[Tipo P]]>
                    </documentation>
                        <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[$CalendarioCounter]/ns34:TipoPlan/ns9:codigoExterno = 'P' and string ($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:FechaInicio) != ''  and  string ($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:Frecuencia/ns8:Tipo/ns9:codigoExterno) != 'B'</condition>
                        <sequence name="Sequence43">
                          <assign name="AssignCalcularCuota">
                        <copy>
                          <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:FechaInicio</from>
                          <to>$inCalcularCuotasCalendario.request/ns5:Plazo/ns15:FechaInicio</to>
                        </copy>
                        <copy>
                          <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[$CalendarioCounter]/ns34:Frecuencia/ns34:Frecuencia</from>
                          <to>$inCalcularCuotasCalendario.request/ns5:Plazo/ns15:Frecuencia</to>
                        </copy>
                        <copy>
                          <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:fechaVencimiento</from>
                          <to>$inCalcularCuotasCalendario.request/ns5:FechaVencimiento</to>
                        </copy>
                      </assign>
                          <invoke name="InvokeCalcularCuotasCalendario" bpelx:invokeAsDetail="no"
                                  partnerLink="CalcularCuotas_SB" portType="ns31:CalcularCuotas_PT"
                                  operation="calcularCuotas" inputVariable="inCalcularCuotasCalendario"
                                  outputVariable="outCalcularCuotasCalendario"/>
                          <if name="IfCuotasOk">
                            <documentation>
                          <![CDATA[Ok]]>
                        </documentation>
                            <condition>$outCalcularCuotasCalendario.response/ns5:Resultado/ns24:result = 'OK'</condition>
                            <assign name="AssignNumeroCuotas">
                          <copy>
                            <from>$outCalcularCuotasCalendario.response/ns5:numeroCuotas</from>
                            <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[$CalendarioCounter]/ns34:NumeroCuotas</to>
                          </copy>
                        </assign>
                            <else>
                              <documentation>
                                <![CDATA[Continua]]>
                              </documentation>
                              <empty name="Continua"/>
                            </else>
                          </if>
                        </sequence>
                        <else>
                          <documentation>
                            <![CDATA[Tipo R]]>
                          </documentation>
                          <empty name="Continua"/>
                        </else>
                      </if>
                    </scope>
                  </forEach>
                </sequence>
            </scope>
          <if name="IfValidaTipoCalendario">
            <documentation>
              <![CDATA[Sencillo]]>
            </documentation>
            <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:tipoCalendario/ns9:DescripcionCorta = 'Sencillo'</condition>
            <sequence name="Sequence29">
              <assign name="XQ_RequestCrearDesembolsoLoanFLEXCUBE14">
                <bpelx:annotation>
                  <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                </bpelx:annotation>
                <copy>
                  <from>ora:processXQuery10('../Transformations/XQ_RequestCrearContratoOLFLEXCUBE14.xqy', 'outConsultarInformacionDesembolso.response', $outConsultarInformacionDesembolso.response, 'outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse', $outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse, 'outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response', $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response)</from>
                  <to variable="inCrearDesembolsoLoanFLEXCUBE14" part="requestCrearContratoOL"/>
                </copy>
              </assign>
              <invoke name="InvokeCrearDesembolsoLoanFLEXCUBE14_SB" bpelx:invokeAsDetail="no"
                      partnerLink="CrearDesembolsoFLEXCUBE14_SB" portType="ns33:creaContratoOLFLEXCUBE_V14_PT"
                      operation="creaContratoOL" inputVariable="inCrearDesembolsoLoanFLEXCUBE14"
                      outputVariable="outCrearDesembolsoLoanFLEXCUBE14"/>
              <if name="IfValidaOK">
                <documentation>
                  <![CDATA[OK]]>
                </documentation>
                <condition>$outCrearDesembolsoLoanFLEXCUBE14.responseCreaContratoOL/ns35:Response/ns35:Resultado/ns36:result = 'OK'</condition>
                <sequence name="Sequence31">
                  <assign name="AssignBHQ">
                    <copy bpelx:insertMissingToData="yes">
                      <from>$outCrearDesembolsoLoanFLEXCUBE14.responseCreaContratoOL/ns35:Response/ns35:Codigo_Contrato</from>
                      <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:idFacturador</to>
                    </copy>
                  </assign>
                  <sequence name="SequenceCrearActualizarDesembolsoSencillo">
                    <assign name="XQ_RequestCrearActualizarDesembolso">
                      <bpelx:annotation>
                        <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                      </bpelx:annotation>
                      <copy>
                        <from>ora:processXQuery10('../Transformations/XQ_RequestCrearActualizarDesembolsoV2.xqy', 'outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response', $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response)</from>
                        <to variable="inCrearActualizarDesembolso" part="request"/>
                      </copy>
                    </assign>
                    <invoke name="InvokeCrearActualizarDesembolso_SB"
                            partnerLink="CrearActualizarDesembolsos_SB" portType="ns27:CrearActualizarDesembolso_PT"
                            operation="crearActualizarDesembolso" inputVariable="inCrearActualizarDesembolso"
                            bpelx:invokeAsDetail="no" outputVariable="outCrearActualizarDesembolso"/>
                    <if name="IfValidaOK">
                      <documentation>
                        <![CDATA[OK]]>
                      </documentation>
                      <condition>$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:result = 'OK'</condition>
                      <empty name="OK"/>
                      <else>
                        <documentation>
                          <![CDATA[ERROR]]>
                        </documentation>
                        <sequence name="Sequence32">
                          <assign name="errorCrearActualizarDesembolso">
                            <copy>
                              <from>'ERROR'</from>
                              <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                            </copy>
                            <copy>
                              <from>concat("Error al CrearActualizarDesembolso Flexcube14 ",$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:message)</from>
                              <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                            </copy>
                          </assign>
                          <reply name="ReplyERROR" variable="outputVariable"
                                 partnerLink="propagarcontratodesembolso_client"
                                 portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                          <exit name="ERROR"/>
                        </sequence>
                      </else>
                    </if>
                  </sequence>
                </sequence>
                <else>
                  <documentation>
                    <![CDATA[ERROR]]>
                  </documentation>
                  <sequence name="Sequence30">
                    <assign name="errorCrearDesembolsoFLEXCUBE14">
                      <copy>
                        <from>'ERROR'</from>
                        <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                      </copy>
                      <copy>
                        <from>concat("Error al crear el desembolso en FLEXCUBE14 ",$outCrearDesembolsoLoanFLEXCUBE14.responseCreaContratoOL/ns35:Response/ns35:Resultado/ns36:message)</from>
                        <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                      </copy>
                    </assign>
                    <reply name="ReplyError" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
                           portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                    <exit name="ExitError"/>
                  </sequence>
                </else>
              </if>
            </sequence>
            <else>
              <documentation>
                <![CDATA[Complejo]]>
              </documentation>
              <sequence name="Sequence33">
                <assign name="AssignFechas">
                  <copy>
                    <from>count($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='P'])</from>
                    <to>$contadorCapitalComponente</to>
                  </copy>
                  <copy>
                    <from>count($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[ns34:TipoComponente/ns9:codigoExterno='INTERES']/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='P'])</from>
                    <to>$contadorInteresComponente</to>
                  </copy>
                  <copy>
                    <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='P'][$contadorCapitalComponente]/ns34:Frecuencia/ns34:FechaInicio</from>
                    <to>$fechaBulletCapitalComponente</to>
                  </copy>
                  <copy bpelx:insertMissingToData="yes">
                    <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[ns34:TipoComponente/ns9:codigoExterno='INTERES']/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='P'][$contadorInteresComponente]/ns34:Frecuencia/ns34:FechaInicio</from>
                    <to>$fechaBulletInteresComponente</to>
                  </copy>
                </assign>
                <if name="IfValidarFechaBulletCapital">
                  <documentation>
                    <![CDATA[Diferente]]>
                  </documentation>
                  <condition>$fechaBulletCapitalComponente != $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:fechaVencimiento</condition>
                  <sequence name="Sequence39">
                    <assign name="errorFechaBulletCapitalComponente">
                      <copy>
                        <from>'ERROR'</from>
                        <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                      </copy>
                      <copy>
                        <from>'La fecha de inicio capital bullet deber ser igual a la fecha de vencimiento'</from>
                        <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                      </copy>
                    </assign>
                    <reply name="ReplyError" variable="outputVariable" partnerLink="propagarcontratodesembolso_client"
                           portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                    <exit name="Error"/>
                  </sequence>
                  <else>
                    <if name="IfValidarFechaBulletInteres">
                      <documentation>
                        <![CDATA[Diferente]]>
                      </documentation>
                      <condition>$fechaBulletInteresComponente != $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:fechaVencimiento</condition>
                      <sequence name="Sequence40">
                        <assign name="errorFechaBulletInteresComponente">
                          <copy>
                            <from>'ERROR'</from>
                            <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                          </copy>
                          <copy>
                            <from>'La fecha inicio interes bullet debe ser igual a la fecha vencimiento'</from>
                            <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                          </copy>
                        </assign>
                        <reply name="ReplyError" variable="outputVariable"
                               partnerLink="propagarcontratodesembolso_client"
                               portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                        <exit name="Error"/>
                      </sequence>
                      <else>
                        <empty name="OK"/>
                      </else>
                    </if>
                  </else>
                </if>
                <if name="IfValidaRevision">
                  <bpelx:skipCondition>1=1</bpelx:skipCondition>
                  <documentation>
                    <![CDATA[TieneRevision]]>
                  </documentation>
                  <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='R']/ns34:Frecuencia/ns34:FechaInicio != ''</condition>
                  <sequence name="Sequence34">
                    <assign name="requestCalcularCuotas">
                      <copy>
                        <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='R']/ns34:Frecuencia/ns34:FechaInicio</from>
                        <to>$inCalcularCuotas.request/ns5:Plazo/ns15:FechaInicio</to>
                      </copy>
                      <copy>
                        <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='R']/ns34:Frecuencia/ns34:Frecuencia</from>
                        <to>$inCalcularCuotas.request/ns5:Plazo/ns15:Frecuencia</to>
                      </copy>
                      <copy>
                        <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:fechaVencimiento</from>
                        <to>$inCalcularCuotas.request/ns5:FechaVencimiento</to>
                      </copy>
                    </assign>
                    <invoke name="InvokeCalcularCuotas_SB" partnerLink="CalcularCuotas_SB"
                            portType="ns31:CalcularCuotas_PT" operation="calcularCuotas"
                            inputVariable="inCalcularCuotas" bpelx:invokeAsDetail="no"
                            outputVariable="outCalcularCuotas"/>
                    <if name="IfValidaOK">
                      <documentation>
                        <![CDATA[OK]]>
                      </documentation>
                      <condition>$outCalcularCuotas.response/ns5:Resultado/ns24:result = 'OK'</condition>
                      <assign name="Assign8">
                        <copy>
                          <from>$outCalcularCuotas.response/ns5:numeroCuotas</from>
                          <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:calendario[ns34:TipoPlan/ns9:codigoExterno='R']/ns34:NumeroCuotas</to>
                        </copy>
                      </assign>
                      <else>
                        <documentation>
                          <![CDATA[ERROR]]>
                        </documentation>
                        <sequence name="Sequence38">
                          <assign name="ERROR">
                            <copy>
                              <from>'ERROR'</from>
                              <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                            </copy>
                            <copy>
                              <from>$outCalcularCuotas.response/ns5:Resultado/ns24:message</from>
                              <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                            </copy>
                          </assign>
                          <reply name="ReplyError" variable="outputVariable"
                                 partnerLink="propagarcontratodesembolso_client"
                                 portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                          <exit name="ERROR"/>
                        </sequence>
                      </else>
                    </if>
                  </sequence>
                  <else>
                    <empty name="SinRevision"/>
                  </else>
                </if>
                <assign name="XQ_RequestCrearDesembolsoComplejo">
                  <bpelx:annotation>
                    <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from>ora:processXQuery10('../Transformations/XQ_RequestCrearContratoOLFLEXCUBE14.xqy', 'outConsultarInformacionDesembolso.response', $outConsultarInformacionDesembolso.response, 'outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse', $outConsultarLineaCreditoById.ConsultarLineaCreditoByIdResponse, 'outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response', $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response)</from>
                    <to variable="inCrearDesembolsoLoanFLEXCUBE14" part="requestCrearContratoOL"/>
                  </copy>
                </assign>
                <invoke name="InvokeCrearDesembolsoComplejoFlexcube14" bpelx:invokeAsDetail="no"
                        partnerLink="CrearDesembolsoFLEXCUBE14_SB" portType="ns33:creaContratoOLFLEXCUBE_V14_PT"
                        operation="creaContratoOL" inputVariable="inCrearDesembolsoLoanFLEXCUBE14"
                        outputVariable="outCrearDesembolsoLoanFLEXCUBE14"/>
                <if name="IfValidaOk">
                  <documentation>
                    <![CDATA[OK]]>
                  </documentation>
                  <condition>$outCrearDesembolsoLoanFLEXCUBE14.responseCreaContratoOL/ns35:Response/ns35:Resultado/ns36:result = 'OK'</condition>
                  <sequence name="Sequence35">
                    <assign name="AssignBHQ">
                      <copy bpelx:insertMissingToData="yes">
                        <from>$outCrearDesembolsoLoanFLEXCUBE14.responseCreaContratoOL/ns35:Response/ns35:Codigo_Contrato</from>
                        <to>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:idFacturador</to>
                      </copy>
                    </assign>
                    <sequence name="Sequence35">
                      <assign name="XQ_RequestCrearActualizarDesembolso">
                        <bpelx:annotation>
                          <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                        </bpelx:annotation>
                        <copy>
                          <from>ora:processXQuery10('../Transformations/XQ_RequestCrearActualizarDesembolsoV2.xqy', 'outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response', $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response)</from>
                          <to variable="inCrearActualizarDesembolso" part="request"/>
                        </copy>
                      </assign>
                      <invoke name="InvokeCrearActualizarDesembolso_SB" bpelx:invokeAsDetail="no"
                              partnerLink="CrearActualizarDesembolsos_SB" portType="ns27:CrearActualizarDesembolso_PT"
                              operation="crearActualizarDesembolso" inputVariable="inCrearActualizarDesembolso"
                              outputVariable="outCrearActualizarDesembolso"/>
                      <if name="IfValidaOK">
                        <documentation>
                          <![CDATA[OK]]>
                        </documentation>
                        <condition>$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:result = 'OK'</condition>
                        <empty name="OK"/>
                        <else>
                          <documentation>
                            <![CDATA[ERROR]]>
                          </documentation>
                          <sequence name="Sequence37">
                            <assign name="errorCrearActualizarDesembolso">
                              <copy>
                                <from>'ERROR'</from>
                                <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                              </copy>
                              <copy>
                                <from>concat("Error al CrearActualizarDesembolso ",$outCrearActualizarDesembolso.response/ns5:Resultado/ns24:message)</from>
                                <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                              </copy>
                            </assign>
                            <reply name="ReplyERROR" variable="outputVariable"
                                   partnerLink="propagarcontratodesembolso_client"
                                   portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                            <exit name="ERROR"/>
                          </sequence>
                        </else>
                      </if>
                    </sequence>
                  </sequence>
                  <else>
                    <documentation>
                      <![CDATA[ERROR]]>
                    </documentation>
                    <sequence name="Sequence36">
                      <assign name="errrorCrearDesembolsoComplejoFlex14">
                        <copy>
                          <from>'ERROR'</from>
                          <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                        </copy>
                        <copy>
                          <from>concat("Error en el servicio CrearDesembolsoComplejoFLEXCUBE14: ",$outCrearDesembolsoLoanFLEXCUBE14.responseCreaContratoOL/ns35:Response/ns35:Resultado/ns36:message)</from>
                          <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                        </copy>
                      </assign>
                      <reply name="ReplyError" variable="outputVariable"
                             partnerLink="propagarcontratodesembolso_client"
                             portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso"/>
                      <exit name="ExitError"/>
                    </sequence>
                  </else>
                </if>
              </sequence>
            </else>
          </if>
          <if name="IfAjusteTasa">
            <documentation>
              <![CDATA[AjustaTasa]]>
            </documentation>
            <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:Resultado/ns24:message = 'AJUSTE_TASA'</condition>
            <forEach parallel="no" counterName="ComponentesCounter" name="ForEachComponenteAjuste">
              <startCounterValue>1</startCounterValue>
              <finalCounterValue>count($outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente)</finalCounterValue>
              <scope name="Scope2">
                <variables>
                  <variable name="inActualizarComponente" messageType="ns38:ActualizarComponenteRequestMessage"/>
                  <variable name="outActualizarComponente" messageType="ns38:ActualizarComponenteResponseMessage"/>
                </variables>
                <sequence name="Sequence41">
                  <if name="IfValidarTipoTasa">
                    <documentation>
                      <![CDATA[Variable]]>
                    </documentation>
                    <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:TipoTasa/ns9:codigoExterno = 'F'</condition>
                    <assign name="requestActualizarComponentes">
                      <copy>
                        <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns9:Id</from>
                        <to>$inActualizarComponente.requestActualizarComponente/ns5:Componente/ns9:Id</to>
                      </copy>
                      <copy>
                        <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:SpreadTasa</from>
                        <to>$inActualizarComponente.requestActualizarComponente/ns5:Componente/ns34:SpreadTasa</to>
                      </copy>
                      <copy ignoreMissingFromData="yes" bpelx:insertMissingToData="yes">
                        <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:SpreadTasa + $outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:ValorTasaReferencia</from>
                        <to>$inActualizarComponente.requestActualizarComponente/ns5:Componente/ns34:Tasa</to>
                      </copy>
                    </assign>
                    <elseif>
                      <documentation>
                        <![CDATA[Fija]]>
                      </documentation>
                      <condition>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:TipoTasa/ns9:codigoExterno = 'X'</condition>
                      <assign name="requestActualizarComponentes">
                        <copy>
                          <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns9:Id</from>
                          <to>$inActualizarComponente.requestActualizarComponente/ns5:Componente/ns9:Id</to>
                        </copy>
                        <copy>
                          <from>$outConsultarDesembolsoByIdV2.ConsultarDesembolsoByIdV2Response/ns5:ContratoDesembolso/ns34:condicionesFinancieras/ns34:Componente[$ComponentesCounter]/ns34:Tasa</from>
                          <to>$inActualizarComponente.requestActualizarComponente/ns5:Componente/ns34:Tasa</to>
                        </copy>
                      </assign>
                    </elseif>
                    <else>
                      <empty name="Continua"/>
                    </else>
                  </if>
                  <invoke name="InvokeActualizarComponente"
                          partnerLink="ActualizarComponente_SB" portType="ns38:ActualizarComponentePT"
                          operation="ActualizarComponente" inputVariable="inActualizarComponente"
                          outputVariable="outActualizarComponente" bpelx:invokeAsDetail="no"/>
                </sequence>
              </scope>
            </forEach>
            <else>
              <documentation>
                <![CDATA[SinAjuste]]>
              </documentation>
              <empty name="Continua"/>
            </else>
          </if>
        </sequence>
      </sequence>
    </scope>
    <scope name="PropagarUtilizacion">
      <variables>
        <variable name="inConsultarDesembolso" messageType="ns26:requestConsultarDesembolsosByIdMessage"/>
        <variable name="inPropagarUtilizacion" messageType="ns29:requestPropagarUtilizacionMessage"/>
        <variable name="inConsultarDesembolsoConfiguracion"
                  messageType="ns39:ConsultarDesembolsosConfiguracionByIdRequestMessage"/>
        <variable name="outConsultarDesembolsoConfiguracion"
                  messageType="ns39:ConsultarDesembolsosConfiguracionByIdResponseMessage"/>
      </variables>
      <sequence name="PropagarUtilizacion">
        <assign name="requestConsultarDesembolso">
          <copy>
            <from>$inputVariable.request/ns5:idDesembolso</from>
            <to>$inConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdRequest/ns5:idContratoDesembolso</to>
          </copy>
        </assign>
        <invoke name="InvokeConsultarDesembolso" partnerLink="ConsultarDesembolsoConfiguracionById"
                portType="ns39:ConsultarDesembolsosConfiguracionById_PT"
                operation="ConsultarDesembolsosConfiguracionById"
                inputVariable="inConsultarDesembolsoConfiguracion" outputVariable="outConsultarDesembolsoConfiguracion"
                bpelx:invokeAsDetail="no"/>
        <if name="IfValidaBHQDesembolso">
          <documentation>
            <![CDATA[PropagarUtilizacion]]>
          </documentation>
          <condition>$outConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdResponse/ns5:ContratoDesembolso/ns15:idFacturador != ''</condition>
          <sequence name="Sequence16">
            <assign name="requestPropagarUtilizacion">
              <copy>
                <from>$inputVariable.request/ns5:idDesembolso</from>
                <to>$inPropagarUtilizacion.request/ns5:idDesembolso</to>
              </copy>
            </assign>
            <invoke name="InvokePropagarUtilizacion_SB" partnerLink="DesembolsoService_SB"
                    portType="ns29:Desembolso_PT" operation="PropagarUtilizacion" inputVariable="inPropagarUtilizacion"
                    outputVariable="outPropagarUtilizacion" bpelx:invokeAsDetail="no"/>
            <if name="IfValidaOK">
              <documentation>
                <![CDATA[OK]]>
              </documentation>
              <condition>$outPropagarUtilizacion.response/ns5:Resultado/ns24:result = 'OK'</condition>
              <sequence name="Sequence18">
                <assign name="XQ_ResponsePropagarDesembolso">
                  <bpelx:annotation>
                    <bpelx:pattern patternName="bpelx:xquery"></bpelx:pattern>
                  </bpelx:annotation>
                  <copy>
                    <from>ora:processXQuery10('../Transformations/XQ_ResponsePropagarDesembolso.xqy', 'outConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdResponse', $outConsultarDesembolsoConfiguracion.ConsultarDesembolsosConfiguracionByIdResponse, 'outPropagarUtilizacion.response', $outPropagarUtilizacion.response)</from>
                    <to variable="outputVariable" part="response"/>
                  </copy>
                </assign>
              </sequence>
              <else>
                <documentation>
                  <![CDATA[ERROR]]>
                </documentation>
                <sequence name="Sequence17">
                  <assign name="errorPropagarReserva">
                    <copy>
                      <from>'ERROR'</from>
                      <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
                    </copy>
                    <copy>
                      <from>$outPropagarUtilizacion.response/ns5:Resultado/ns24:message</from>
                      <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
                    </copy>
                  </assign>
                  <reply name="ReplyErrorPropagarUtilizacion" variable="outputVariable"
                         partnerLink="propagarcontratodesembolso_client" portType="ns1:PropagarContratoDesembolso_PT"
                         operation="propagarContratoDesembolso"/>
                  <exit name="Error"/>
                </sequence>
              </else>
            </if>
          </sequence>
          <else>
            <assign name="responseSinBHQ">
              <copy>
                <from>'ERROR'</from>
                <to>$outputVariable.response/ns5:Resultado/ns24:result</to>
              </copy>
              <copy>
                <from>'El Desembolso no cuenta con idFacturador'</from>
                <to>$outputVariable.response/ns5:Resultado/ns24:message</to>
              </copy>
            </assign>
          </else>
        </if>
      </sequence>
    </scope>
    <!-- Generate reply to synchronous request -->
    <reply name="replyOutput" partnerLink="propagarcontratodesembolso_client" portType="ns1:PropagarContratoDesembolso_PT" operation="propagarContratoDesembolso" variable="outputVariable"/>
  </sequence>
</process>