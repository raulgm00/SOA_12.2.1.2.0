package org.bcie.fenix.common.model.vo;

import java.sql.Timestamp;

import java.util.Date;

import oracle.adf.share.logging.ADFLogger;

import oracle.jbo.Key;
import oracle.jbo.Row;
import oracle.jbo.server.ViewObjectImpl;
import oracle.jbo.server.SequenceImpl;
import org.bcie.fenix.common.model.FenixModelConstants;
import org.bcie.fenix.common.model.vo.common.ConcursanteAdjudicatarioVO;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Tue Feb 21 08:54:38 CST 2017
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class ConcursanteAdjudicatarioVOImpl extends ViewObjectImpl implements ConcursanteAdjudicatarioVO {
    
    private static ADFLogger logger = null;
    
    /**
     * This is the default constructor (do not remove).
     */
    public ConcursanteAdjudicatarioVOImpl() {
        if (logger == null) {
            logger = ADFLogger.createADFLogger(this.getClass());
        }
    }
    
    public void contrataAdjudicatario(Long idConcursante, Long idNoObjecion) {
        logger.warning("Into contrataAdjudicatario.");
        logger.warning("idConcursante : " + idConcursante);
        logger.warning("idNoObjecion : " + idNoObjecion);
        
        Row concursanteRow = null;
        Row nuevoConcursanteRow = null;
        concursanteRow = this.getRow(new Key(new Object[] { idConcursante }));
        
        if (concursanteRow != null) {
            // Obtenemos siguiente valor de la secuencia
            oracle.jbo.domain.Number nuevoId = null;
            SequenceImpl seqConcursante = null;
            Long noobjecionanterior=(Long)concursanteRow.getAttribute("IdNoObjecion");

            seqConcursante = new SequenceImpl("CONCURSANTE_ADQUISICION_SEQ", getDBTransaction());
            nuevoId = seqConcursante.getSequenceNumber();
            
            logger.log(ADFLogger.WARNING, "idConcursante:" + nuevoId.longValue());
            logger.log(ADFLogger.WARNING, "noobjecionanterior:" + noobjecionanterior);
            
            // Agregamos un nuevo row
            Row row = this.createRow();
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.ID, nuevoId.longValue());
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDNOOBJECION, idNoObjecion);
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDTCATIPOPERFIL,  FenixModelConstants.ID_TIPO_PERFIL_CONTRATADO);
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.NOMBRE, concursanteRow.getAttribute(ConcursanteAdjudicatarioVORowImpl.NOMBRE));
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDCATPAIS, concursanteRow.getAttribute(ConcursanteAdjudicatarioVORowImpl.IDCATPAIS));
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.MONTO, concursanteRow.getAttribute(ConcursanteAdjudicatarioVORowImpl.MONTO));
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDNOOBJECIONANTERIOR, noobjecionanterior);
            row.setAttribute(ConcursanteAdjudicatarioVORowImpl.FECHAREGISTRO, new java.sql.Timestamp(new Date().getTime()));
            this.insertRow(row);
            this.setCurrentRow(row);
        } else {
            logger.log(ADFLogger.WARNING, "No record found in PrepagoVo with idConcursante : " + idConcursante);
        }

//        Row concursanteRow = null;
//        concursanteRow = this.getRow(new Key(new Object[] { idConcursante }));
//        
//        if (concursanteRow != null) {
//
//            concursanteRow.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDTCATIPOPERFIL, FenixModelConstants.ID_TIPO_PERFIL_CONTRATADO);
//            concursanteRow.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDNOOBJECION, idNoObjecion);
//            //getDBTransaction().commit();
//        } else {
//            logger.log(ADFLogger.WARNING, "No record found in PrepagoVo with idConcursante : " + idConcursante);
//        }
    }
    
    public void adjudicaContratado(Long idConcursante, Long idNoObjecion) {
        logger.warning("Into adjudicaContratado.");
        logger.warning("idConcursante : " + idConcursante);
        logger.warning("idNoObjecion : " + idNoObjecion);
        
        Row concursanteRow = null;
        concursanteRow = this.getRow(new Key(new Object[] { idConcursante }));
        
        if (concursanteRow != null) {
            concursanteRow.remove();
        } else {
            logger.log(ADFLogger.WARNING, "No record found in ConcursanteAdjudicatarioVO with idConcursante : " + idConcursante);
        }

//        Row concursanteRow = null;
//        concursanteRow = this.getRow(new Key(new Object[] { idConcursante }));
//        
//        if (concursanteRow != null) {
//
//            concursanteRow.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDTCATIPOPERFIL, FenixModelConstants.ID_TIPO_PERFIL_ADJUDICATARIO);
//            concursanteRow.setAttribute(ConcursanteAdjudicatarioVORowImpl.IDNOOBJECION, idNoObjecion);
//            //getDBTransaction().commit();
//        } else {
//            logger.log(ADFLogger.WARNING, "No record found in PrepagoVo with idConcursante : " + idConcursante);
//        }
    }
}

