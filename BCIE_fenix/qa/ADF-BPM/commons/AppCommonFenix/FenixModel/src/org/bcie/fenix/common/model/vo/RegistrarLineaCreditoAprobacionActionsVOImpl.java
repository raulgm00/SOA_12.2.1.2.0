package org.bcie.fenix.common.model.vo;

import java.math.BigDecimal;

import java.math.BigInteger;

import oracle.jbo.Key;
import oracle.jbo.Row;
import oracle.jbo.RowSetIterator;
import oracle.jbo.server.ViewObjectImpl;

import org.bcie.aprobacionmo.ConsultarAprobacionResponseType;
import org.bcie.lineacreditobo.LineaCredito;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Sat Dec 12 15:19:53 CST 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class RegistrarLineaCreditoAprobacionActionsVOImpl
  extends ViewObjectImpl
{
  /**
   * This is the default constructor (do not remove).
   */
  public RegistrarLineaCreditoAprobacionActionsVOImpl()
  {
  }
  
  
  public void actualizarLineaActionVO(Integer piId, Number pnIdLinea,  String psNumeroLinea, String psDecripcion, BigDecimal pdMonto, Integer piIdTipoMoneda)
  {
    Row row = obtenerRowLineaAction(piId);

    if (null != row)
    {
      modificarLineaAction(row, psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda);
    }
    else
    {
      agregarLineaAction(piId, pnIdLinea, psNumeroLinea, psDecripcion, pdMonto, piIdTipoMoneda);
    }
  }
  
  public void eliminarLineaAction(Integer piId)
  {
    Row row = obtenerRowLineaAction(piId);

    if (null != row)
    {   
        oracle.jbo.domain.Number idNumLinea = (oracle.jbo.domain.Number) row.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDLINEA);
        if(idNumLinea != null){
            row.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.ELIMINADO, Boolean.TRUE);      
        }else{
            row.remove();
        }
    }
  }
  
  
  
  private void agregarLineaAction(Integer piId, Number pnIdLinea,  String psNumeroLinea, String psDecripcion, BigDecimal pdMonto, Integer piIdTipoMoneda)
  {
    RegistrarLineaCreditoAprobacionActionsVORowImpl newRow = (RegistrarLineaCreditoAprobacionActionsVORowImpl) this.createRow();

    newRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.ID, piId);
    newRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDLINEA, pnIdLinea);
    newRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.NUMERO, psNumeroLinea);
    newRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.DESCRIPCION, psDecripcion);
    newRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.MONTO, pdMonto);
    newRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.ELIMINADO, Boolean.FALSE);
    newRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDTCATIPOMONEDA, piIdTipoMoneda);

    this.insertRow(newRow);
  }

  private void modificarLineaAction(Row poLineaActionRow, String psNumeroLinea, String psDecripcion, BigDecimal pdMonto, Integer piIdTipoMoneda)
  {
      poLineaActionRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.NUMERO, psNumeroLinea);
      poLineaActionRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.DESCRIPCION, psDecripcion);
      poLineaActionRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.MONTO, pdMonto);
      poLineaActionRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.MODIFICADO, Boolean.TRUE);
      poLineaActionRow.setAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDTCATIPOMONEDA, piIdTipoMoneda);
  }

  private Row obtenerRowLineaAction (Integer piId)
  {
    return this.getRow((new Key(new Object[]{piId})));
  }
  
  public Integer getNewId()
  {
    return (this.getRowCount()+1);
  }

  public void cargarLineas(ConsultarAprobacionResponseType poAprobacionResponse)
  {
    if(null!= poAprobacionResponse.getAprobacion().getLineaCredito())
    {
      int i = 1;
      for(LineaCredito lcredito: poAprobacionResponse.getAprobacion().getLineaCredito())
      {
        //Dado que el id de tipos de monedas es un valor pequeño, no hay problemas de conversión aquí
        Integer idTcaTipoMoneda = lcredito.getIdTipoMonedaMontoLinea() != null ? lcredito.getIdTipoMonedaMontoLinea().intValue() : null;
        agregarLineaAction(i, lcredito.getIdLineaCredito(), lcredito.getNumeroLineaCredito(), lcredito.getDescripcion(), lcredito.getMontoLinea(), idTcaTipoMoneda);
        i++;
      }
    }
  }
  
  public void setLineasRequest(org.bcie.aprobacionbo.Aprobacion poAprobacionReq)
  {
    RowSetIterator rs = this.createRowSetIterator(null);
    rs.reset();
    
    
    while (rs.hasNext()) {
        RegistrarLineaCreditoAprobacionActionsVORowImpl row = (RegistrarLineaCreditoAprobacionActionsVORowImpl) rs.next();
        //TODO Vlidar si esta aliminada y no tienen id de DB no debera de formar parte del payload
        LineaCredito lineaCredito = generarLineaCredito (row);
      
        poAprobacionReq.getLineaCredito().add(lineaCredito);
    }

    rs.closeRowSetIterator();
  }
  
  
  private LineaCredito generarLineaCredito(RegistrarLineaCreditoAprobacionActionsVORowImpl poRow)
  {
    LineaCredito lineaCredito = new LineaCredito();
    if(null!=poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDLINEA))
      lineaCredito.setIdLineaCredito(new Long(poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDLINEA).toString()));
    
    if(null!=poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.ELIMINADO))
    {
      lineaCredito.setEstado(!((Boolean)poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.ELIMINADO)));
    }
    
    lineaCredito.setNumeroLineaCredito(null!=poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.NUMERO)?poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.NUMERO).toString():"");
    lineaCredito.setDescripcion(null!=poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.DESCRIPCION)?poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.DESCRIPCION).toString():"");
    lineaCredito.setMontoLinea(null!=poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.MONTO)? new BigDecimal(poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.MONTO).toString()):new BigDecimal(0));
    lineaCredito.setIdTipoMonedaMontoLinea(null!=poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDTCATIPOMONEDA) ? BigInteger.valueOf((Integer)poRow.getAttribute(RegistrarLineaCreditoAprobacionActionsVORowImpl.IDTCATIPOMONEDA)) : null);
    
    
    
    return lineaCredito;
  }
}
