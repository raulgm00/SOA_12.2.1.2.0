package org.bcie.fenix.common.model.vo;

import com.bcie.xmlns.clienteservice.Cliente12BndQSService;
import com.bcie.xmlns.clienteservice.ClientePT;

import java.math.BigDecimal;

import java.util.Date;

import java.util.ResourceBundle;

import oracle.adf.share.logging.ADFLogger;

import oracle.javatools.resourcebundle.BundleFactory;

import oracle.jbo.JboException;
import oracle.jbo.Key;
import oracle.jbo.NameValuePairs;
import oracle.jbo.Row;
import oracle.jbo.ViewCriteria;
import oracle.jbo.server.SequenceImpl;
import oracle.jbo.server.ViewObjectImpl;

import org.bcie.clientemo.EliminarContactoRequestType;
import org.bcie.clientemo.EliminarContactoResponseType;
import org.bcie.fenix.common.model.FenixModelConstants;
import org.bcie.fenix.common.model.am.FenixAMImpl;
import org.bcie.fenix.common.model.utils.IWsdlLocation;
import org.bcie.fenix.common.model.utils.ModelUtils;
import org.bcie.fenix.common.model.vo.common.ConcursanteAdquisicionVO;
import org.bcie.resultbo.Resultado;

// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Tue Nov 22 18:14:50 CST 2016
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class ConcursanteAdquisicionVOImpl extends ViewObjectImpl implements ConcursanteAdquisicionVO {
    
    private static ADFLogger logger = null;
    
    /**
     * This is the default constructor (do not remove).
     */
    public ConcursanteAdquisicionVOImpl() {
        if (logger == null) {
            logger = ADFLogger.createADFLogger(this.getClass());
        }
    }
    
    /** 
     * M&eacute;todo para crear un concursante adquisicion
     * @author Jonathan Ruiz
     * @param idNoObjecion id de la no objeci&oacute;n
     * @param idTcaTipoPerfil id del tipo de perfil
     * @param nombre nombre del concursante
     * @param nacionalidad nacionalidad del concursante
     * @param monto monto del concursante (opcional)
     * @return Row del concursante creado
     */
    public Row crearConcursante(Long idNoObjecion, Integer idTcaTipoPerfil, String nombre, BigDecimal monto) {
        logger.log(ADFLogger.TRACE, "Inside crearContrato.");
        
        // Validamos los parametros necesarios
        if (idNoObjecion == null || idTcaTipoPerfil == null || nombre == null) {
            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
            String msg = rb.getString("org.bcie.fenix.common.vo.concursante.adquisicion.msg.campos.nulos");
            
            JboException ex = new JboException(msg);
            throw ex;
        }
        
        // Creamos un nuevo concursante asignado a un idNoObjecion e idTcaTipoPerfil
        Row contratoRow = null;
        oracle.jbo.domain.Number idConcursante = null;
        NameValuePairs nvpConcursante = null;
        SequenceImpl seqConcursante = null;

        seqConcursante = new SequenceImpl("CONCURSANTE_ADQUISICION_SEQ", getDBTransaction());
        idConcursante = seqConcursante.getSequenceNumber();
        
        nvpConcursante = new NameValuePairs();
        nvpConcursante.setAttribute("Id", idConcursante);
        nvpConcursante.setAttribute("IdNoObjecion", idNoObjecion);
        nvpConcursante.setAttribute("IdTcaTipoPerfil", idTcaTipoPerfil);
        nvpConcursante.setAttribute("Nombre", nombre);
        //nvpConcursante.setAttribute("Nacionalidad", nacionalidad);
        nvpConcursante.setAttribute("Monto", monto);
        nvpConcursante.setAttribute("FechaRegistro", new java.sql.Timestamp(new Date().getTime()));
        
        contratoRow = this.createAndInitRow(nvpConcursante);
                
        getDBTransaction().commit();
        return contratoRow;
    }
    
    /** 
     * M&eacute;todo para actualizar un concursante adquisicion
     * @author Jonathan Ruiz
     * @param id id del concursante
     * @param nuevoIdTcaTipoPerfil nuevo id del tipo de perfil
     * @param monto monto del concursante
     */
    public void actualizarConcursante(Long id, Integer nuevoIdTcaTipoPerfil, BigDecimal monto) {
        logger.log(ADFLogger.TRACE, "Inside actualizarFechas.");
        Long idConcursante = null;
        Row concursanteRow = null;
        
        // Validamos los parametros necesarios
        if (id == null || nuevoIdTcaTipoPerfil == null || monto == null) {
            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
            String msg = rb.getString("org.bcie.fenix.common.vo.concursante.adquisicion.msg.campos.nulos.update");
            
            JboException ex = new JboException(msg);
            throw ex;
        }
        
        // Obtenemos row de concursante a actualizar
        concursanteRow = this.getRow(new Key(new Object[] {id}));
                
        // Actualizamos datos
        if(concursanteRow != null) {
            logger.log(ADFLogger.WARNING, "Inside actualizarConcursante. nuevoIdTcaTipoPerfil: " + nuevoIdTcaTipoPerfil + ". monto: " + monto);
            
            if(nuevoIdTcaTipoPerfil != null)
                concursanteRow.setAttribute("IdTcaTipoPerfil", nuevoIdTcaTipoPerfil);

            if(monto != null)
                concursanteRow.setAttribute("Monto", monto);
            
            getDBTransaction().commit();
        }
    }
        
    /** 
     * M&eacute;todo para obtener la implementaci&oacute;n del ConcursanteAdquisicionVORow
     * por el id de la no objeci&oacute;n y el id del tipo de perfil
     * @author Jonathan Ruiz
     * @param idNoObjecion id de la no objeci&oacute;n
     * @param idTcaTipoPerfil id del tipo de perfil
     * @return objetos de implementaci&oacute;n de ConcursanteAdquisicionVORow
     */
    public Row[] getConcursanteByIdNoObjecionAndIdTcaTipoPerfil(Long idNoObjecion, Integer idTcaTipoPerfil) {
        logger.log(ADFLogger.TRACE, "Inside getConcursanteByIdNoObjecionAndIdTcaTipoPerfil.");
        ConcursanteAdquisicionVORowImpl concursanteRow = null;
        ViewCriteria criteriaByIdNoObjecionAndIdTcaTipoPerfil = null;
        Row[] concursantesRow = null;
        
        // Validamos los parametros necesarios
        if (idNoObjecion == null || idTcaTipoPerfil == null) {
            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
            String msg = rb.getString("org.bcie.fenix.common.vo.concursante.adquisicion.msg.campos.nulos.getby.tipoperfil");
            
            JboException ex = new JboException(msg);
            throw ex;
        }
        
        // Los atributos idOperacion e instanciaProceso son requeridos por el ViewCriteria
        if(idNoObjecion != null && idTcaTipoPerfil != null) {
            // 1) Filtramos el VO por idOperacion e instanciaProceso
            criteriaByIdNoObjecionAndIdTcaTipoPerfil = 
                this.getViewCriteriaManager().getViewCriteria("ConcursanteAdquisicionVOCriteriaByIdNoObjecionAndIdTcaTipoPerfil");
            
            criteriaByIdNoObjecionAndIdTcaTipoPerfil.ensureVariableManager().setVariableValue("varIdNoObjecion", idNoObjecion);
            criteriaByIdNoObjecionAndIdTcaTipoPerfil.ensureVariableManager().setVariableValue("varIdTcaTipoPerfil", idTcaTipoPerfil);
            
            this.applyViewCriteria(criteriaByIdNoObjecionAndIdTcaTipoPerfil);
            this.setRangeSize(-1);
            this.executeQuery();
            
            // 2) Asignamos valor de retorno
            if(this.getEstimatedRowCount() > 0) {
                concursantesRow = this.getAllRowsInRange();
                
                // Removemos criteria del VO
                this.getViewCriteriaManager().removeApplyViewCriteriaName("ConcursanteAdquisicionVOCriteriaByIdNoObjecionAndIdTcaTipoPerfil");
                
                // Re-ejecutamos el query 
                this.executeQuery();
            }
        }
        
        return concursantesRow;
    }
    
    /** 
     * M&eacute;todo para obtener la implementaci&oacute;n del ConcursanteAdquisicionVORow
     * por el id de la no objeci&oacute;n
     * @author Jonathan Ruiz
     * @param idNoObjecion id de la no objeci&oacute;n
     * @return objetos de implementaci&oacute;n de ConcursanteAdquisicionVORow
     */
    public Row[] getConcursanteByIdNoObjecion(Long idNoObjecion) {
        logger.log(ADFLogger.TRACE, "Inside getConcursanteByIdNoObjecion. idNoObjecion:" + idNoObjecion);
        ConcursanteAdquisicionVORowImpl concursanteRow = null;
        ViewCriteria criteriaByIdNoObjecionAndIdTcaTipoPerfil = null;
        Row[] concursantesRow = null;
        
        // Validamos los parametros necesarios
        if (idNoObjecion == null) {
            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
            String msg = rb.getString("org.bcie.fenix.common.vo.concursante.adquisicion.msg.campos.nulos.getby.noobjecion");
            
            JboException ex = new JboException(msg);
            throw ex;
        }
        
        // Los atributos idOperacion e instanciaProceso son requeridos por el ViewCriteria
        if(idNoObjecion != null) {
            // 1) Filtramos el VO por idOperacion e instanciaProceso
            criteriaByIdNoObjecionAndIdTcaTipoPerfil = 
                this.getViewCriteriaManager().getViewCriteria("ConcursanteAdquisicionVOCriteriaByIdNoObjecion");
            
            criteriaByIdNoObjecionAndIdTcaTipoPerfil.ensureVariableManager().setVariableValue("varIdNoObjecion", idNoObjecion);
            
            this.applyViewCriteria(criteriaByIdNoObjecionAndIdTcaTipoPerfil);
            this.setRangeSize(-1);
            this.executeQuery();
            
            // 2) Asignamos valor de retorno
            if(this.getEstimatedRowCount() > 0) {
                concursantesRow = this.getAllRowsInRange();
                
                // Removemos criteria del VO
                this.getViewCriteriaManager().removeApplyViewCriteriaName("ConcursanteAdquisicionVOCriteriaByIdNoObjecion");
                
                // Re-ejecutamos el query 
                this.executeQuery();
            }
        }
        
        return concursantesRow;
    }
    
    /**
     * Método para eliminar un concursante
     * @autor Jonathan Ruiz
     * @param id id del concursante
     */
    public void eliminarConcursante(Long id) {
        logger.log(ADFLogger.TRACE, "Inside eliminarConcursante. id:" + id);
        Row concursanteRow = null;
        
        // Validamos los parametros necesarios
        if (id == null) {
            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
            String msg = rb.getString("org.bcie.fenix.common.vo.concursante.adquisicion.msg.campos.nulos.deleteby.id");
            
            JboException ex = new JboException(msg);
            throw ex;
        }
        
        // Obtenemos row de concursante a eliminar
        concursanteRow = this.getRow(new Key(new Object[] {id}));

        try {
            if (concursanteRow != null) {
                concursanteRow.remove();
                getDBTransaction().commit();
            }
        } catch (Exception e) {
            JboException ex = new JboException(e);
            throw ex;
        }
    }
    
    /**
     * Método para eliminar los concursantes por id de no objeci&oacute;n
     * @autor Jonathan Ruiz
     * @param Long idNoObjecion id de la no objeci&oacute;n
     */
    public void eliminarConcursanteByIdNoObjecion(Long idNoObjecion) {
        logger.log(ADFLogger.TRACE, "Inside eliminarConcursante. idNoObjecion:" + idNoObjecion);
    
        // Validamos los parametros necesarios
        if (idNoObjecion == null) {
            ResourceBundle rb = BundleFactory.getBundle("org.bcie.fenix.common.model.FenixModelBundle");
            String msg = rb.getString("org.bcie.fenix.common.vo.concursante.adquisicion.msg.campos.nulos.deleteby.noobjecion");
            
            JboException ex = new JboException(msg);
            throw ex;
        }
        
        try {
            // Consultamos los oferentes de la no objecion
            Row[] concursantesRow = getConcursanteByIdNoObjecion(idNoObjecion);
            
            if (concursantesRow != null) {
                int length = concursantesRow.length -1;
                for(int i = length; i >= 0; i--) {
                    concursantesRow[i].remove();
                }
            }
        } catch (Exception e) {
            JboException ex = new JboException(e);
            throw ex;
        }
        
        getDBTransaction().commit();
    }

    /**
     * Returns the variable value for varIdNoObjecion.
     * @return variable value for varIdNoObjecion
     */
    public Long getvarIdNoObjecion() {
        return (Long) ensureVariableManager().getVariableValue("varIdNoObjecion");
    }

    /**
     * Sets <code>value</code> for variable varIdNoObjecion.
     * @param value value to bind as varIdNoObjecion
     */
    public void setvarIdNoObjecion(Long value) {
        ensureVariableManager().setVariableValue("varIdNoObjecion", value);
    }

    /**
     * Returns the variable value for varIdTcaTipoPerfil.
     * @return variable value for varIdTcaTipoPerfil
     */
    public Integer getvarIdTcaTipoPerfil() {
        return (Integer) ensureVariableManager().getVariableValue("varIdTcaTipoPerfil");
    }

    /**
     * Sets <code>value</code> for variable varIdTcaTipoPerfil.
     * @param value value to bind as varIdTcaTipoPerfil
     */
    public void setvarIdTcaTipoPerfil(Integer value) {
        ensureVariableManager().setVariableValue("varIdTcaTipoPerfil", value);
    }

    /**
     * Returns the variable value for varId.
     * @return variable value for varId
     */
    public Long getvarId() {
        return (Long) ensureVariableManager().getVariableValue("varId");
    }

    /**
     * Sets <code>value</code> for variable varId.
     * @param value value to bind as varId
     */
    public void setvarId(Long value) {
        ensureVariableManager().setVariableValue("varId", value);
    }

    public void actualizaPerfil(Long id, Long idNoObjecion, Integer perfil) {
        logger.warning("into method actualizaPerfil in ConcursanteAdquisicionVO");
        logger.warning("id "+ id);
        logger.warning("idNoObjecion "+ idNoObjecion);
        logger.warning("perfil "+ perfil);
        this.setRangeSize(-1);
        ViewCriteria criteria = null;
        Row concursantesRow = null;
        Integer perfilActual = null;
        Integer perfilAdjudicatario = FenixModelConstants.CONCURSANTE_ADJUDICADO;
        Integer perfilContrato = FenixModelConstants.CONCURSANTE_CONTRATADO;
        Long noObjecion = null;

        criteria = this.getViewCriteriaManager().getViewCriteria("ConcursanteIdCriteria");

        criteria.ensureVariableManager().setVariableValue("varId", id);

        this.applyViewCriteria(criteria);
        this.executeQuery();

        // 2) Asignamos valor de retorno
        if (this.getEstimatedRowCount() > 0) {
            logger.warning("Aplica cambio");
            concursantesRow = getRowAtRangeIndex(0);
            if (null != concursantesRow.getAttribute("IdTcaTipoPerfil")) {
                perfilActual = (Integer) concursantesRow.getAttribute("IdTcaTipoPerfil");
            }
            if (perfil.compareTo(perfilAdjudicatario) == 0) {
                if (null != perfilActual) {
                    if (perfilActual.compareTo(perfil) == 0) {
                        logger.warning("No se actualiza perfil adjudicatario");
                    } else {
                        logger.warning("Se actualiza perfil adjudicatario y retorna idNoObjecion original");

                        getRowAtRangeIndex(0).setAttribute("IdTcaTipoPerfil", perfilAdjudicatario);
                        getRowAtRangeIndex(0).setAttribute("IdNoObjecion",
                                                           concursantesRow.getAttribute("IdNoObjecionAnterior"));

                    }
                } else {
                    logger.warning("No se recibe perfil adjudicatario");
                }
            } else {
                if (perfil.compareTo(perfilContrato) == 0) {
                    if (null != perfilActual) {
                        if (perfilActual.compareTo(perfil) == 0) {
                            logger.warning("No se actualiza perfil contratado");
                        } else {
                            logger.warning("Se actualiza perfil contratado y idNoObjecion");
                            getRowAtRangeIndex(0).setAttribute("IdTcaTipoPerfil", perfilContrato);
                            getRowAtRangeIndex(0).setAttribute("IdNoObjecion", idNoObjecion);
                        }
                    } else {
                        logger.warning("No se recibe perfil contratado");
                    }

                } else {
                    logger.warning("los perfiles no coinciden con las condiciones");
                }
            }

            // Removemos criteria del VO
            this.getViewCriteriaManager().removeApplyViewCriteriaName("ConcursanteIdCriteria");

            // Re-ejecutamos el query
            this.executeQuery();
        }
    }
}

